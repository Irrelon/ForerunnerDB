!function(Ta){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=Ta();else if("function"==typeof define&&define.amd)define([],Ta);else{var h;"undefined"!=typeof window?h=window:"undefined"!=typeof global?h=global:"undefined"!=typeof self&&(h=self);h.ForerunnerDB=Ta()}}(function(){return function h(m,f,k){function c(b,e){if(!f[b]){if(!m[b]){var g="function"==typeof require&&require;if(!e&&g)return g(b,!0);if(a)return a(b,!0);g=Error("Cannot find module '"+b+"'");throw g.code="MODULE_NOT_FOUND",
g;}g=f[b]={exports:{}};m[b][0].call(g.exports,function(g){var a=m[b][1][g];return c(a?a:g)},g,g.exports,h,m,f,k)}return f[b].exports}for(var a="function"==typeof require&&require,b=0;b<k.length;b++)c(k[b]);return c}({1:[function(h,m,f){f=h("../lib/Core");h("../lib/CollectionGroup");h("../lib/View");h("../lib/Highcharts");h("../lib/Persist");h("../lib/Document");h("../lib/Overview");h("../lib/vendor/jsviews");m.exports=f},{"../lib/CollectionGroup":4,"../lib/Core":5,"../lib/Document":7,"../lib/Highcharts":8,
"../lib/Overview":13,"../lib/Persist":15,"../lib/View":18,"../lib/vendor/jsviews":19}],2:[function(h,m,f){m.exports={chain:function(k){this._chain=this._chain||[];-1===this._chain.indexOf(k)&&this._chain.push(k)},unChain:function(k){this._chain&&(k=this._chain.indexOf(k),-1<k&&this._chain.splice(k,1))},chainSend:function(k,c,a){if(this._chain){var b=this._chain,d=b.length,e;for(e=0;e<d;e++)b[e].chainReceive(this,k,c,a)}},chainReceive:function(k,c,a,b){k={sender:k,type:c,data:a,options:b};(!this._chainHandler||
this._chainHandler&&!this._chainHandler(k))&&this.chainSend(k.type,k.data,k.options)}}},{}],3:[function(h,m,f){var k,c,a,b,d;f=h("./Shared");var e=function(g){this.init.apply(this,arguments)};e.prototype.init=function(g){this._primaryKey="_id";this._primaryIndex=new c("primary");this._primaryCrc=new c("primaryCrc");this._crcLookup=new c("crcLookup");this._name=g;this._data=[];this._groups=[];this._metrics=new k;this._linked=0;this._deferQueue={insert:[],update:[],remove:[],upsert:[]};this._deferThreshold=
{insert:100,update:100,remove:100,upsert:100};this._deferTime={insert:1,update:1,remove:1,upsert:1};this._subsetOf(this)};f.addModule("Collection",e);f.inherit(e.prototype,f.chainReactor);k=h("./Metrics");c=h("./KeyValueStore");a=h("./Path");b=h("./Index");d=h("./Crc");h=f.modules.Core;e.prototype.debug=f.common.debug;e.prototype.crc=d;f.synthesize(e.prototype,"name");e.prototype.on=f.common.on;e.prototype.off=f.common.off;e.prototype.emit=f.common.emit;e.prototype.drop=function(){if(this._db&&this._db._collection&&
this._name){this.debug()&&console.log("Dropping collection "+this._name);this.emit("drop");delete this._db._collection[this._name];var g=[],a;for(a=0;a<this._groups.length;a++)g.push(this._groups[a]);for(a=0;a<g.length;a++)this._groups[a].removeCollection(this);return!0}return!1};e.prototype.primaryKey=function(g){return void 0!==g?(this._primaryKey!==g&&(this._primaryKey=g,this._primaryIndex.primaryKey(g),this._rebuildPrimaryKeyIndex()),this):this._primaryKey};e.prototype._onInsert=function(g,a){this.emit("insert",
g,a)};e.prototype._onUpdate=function(g){this.emit("update",g)};e.prototype._onRemove=function(g){this.emit("remove",g)};f.synthesize(e.prototype,"db");e.prototype.setData=function(g,a,b){if(g){var e=this._metrics.create("setData");e.start();a=a||{};a.$decouple=void 0!==a.$decouple?a.$decouple:!0;a.$decouple&&(g=this.decouple(g));g instanceof Array||(g=[g]);e.time("transformIn");g=this.transformIn(g);e.time("transformIn");var d=this._data;this._linked?this.remove():this._data=[];g.length&&(this._linked?
this.insert(g):this._data=this._data.concat(g));e.time("Rebuild Primary Key Index");this._rebuildPrimaryKeyIndex(a);e.time("Rebuild Primary Key Index");e.time("Resolve chains");this.chainSend("setData",g,{oldData:d});e.time("Resolve chains");e.stop();this.emit("setData",this._data,d)}b&&b(!1);return this};e.prototype._rebuildPrimaryKeyIndex=function(g){var a=g&&void 0!==g.ensureKeys?g.ensureKeys:!0;g=g&&void 0!==g.violationCheck?g.violationCheck:!0;var b,e,d,c=this._primaryIndex,k=this._primaryCrc,
f=this._crcLookup,h=this._primaryKey,p;c.truncate();k.truncate();f.truncate();b=this._data;for(e=b.length;e--;){d=b[e];a&&this._ensurePrimaryKey(d);if(g){if(!c.uniqueSet(d[h],d))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+d[this._primaryKey];}else c.set(d[h],d);p=JSON.stringify(d);k.set(d[h],p);f.set(p,d)}};e.prototype._ensurePrimaryKey=function(g){void 0===g[this._primaryKey]&&(g[this._primaryKey]=
this.objectId())};e.prototype.truncate=function(){this.emit("truncate",this._data);this._data.length=0;this.deferEmit("change");return this};e.prototype.upsert=function(g,a){if(g){var b=this._deferQueue.upsert,e=this._deferThreshold.upsert,d={},c;if(g instanceof Array){if(g.length>e){this._deferQueue.upsert=b.concat(g);this.processQueue("upsert",a);return}d=[];for(b=0;b<g.length;b++)d.push(this.upsert(g[b]));a&&a();return d}g[this._primaryKey]?(c={},c[this._primaryKey]=g[this._primaryKey],this._primaryIndex.lookup(c)[0]?
d.op="update":d.op="insert"):d.op="insert";switch(d.op){case "insert":d.result=this.insert(g);break;case "update":d.result=this.update(c,g)}return d}a&&a()};e.prototype.update=function(g,a,b){a=this.decouple(a);a=this.transformIn(a);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var e=this,d=this._metrics.create("update"),c=this._primaryKey,k,f,h=function(d){if(a&&void 0!==a[c]&&a[c]!=d[c]){e._removeIndex(d);var k=e._updateObject(d,a,g,b,"");if(e._insertIndex(d))return k;
throw"Primary key violation in update! Key violated: "+d[c];}return e._updateObject(d,a,g,b,"")};d.start();d.time("Retrieve documents to update");k=this.find(g,{$decouple:!1});d.time("Retrieve documents to update");k.length&&(d.time("Update documents"),f=k.filter(h),d.time("Update documents"),f.length&&(d.time("Resolve chains"),this.chainSend("update",{query:g,update:a},b),d.time("Resolve chains"),this._onUpdate(f),this.deferEmit("change",{type:"update",data:f})));d.stop();return f||[]};e.prototype.updateById=
function(g,a){var b={};b[this._primaryKey]=g;return this.update(b,a)};e.prototype._updateObject=function(g,b,e,d,c,k){b=this.decouple(b);c=c||"";"."===c.substr(0,1)&&(c=c.substr(1,c.length-1));var f=!1,h=!1,n,p,q,l;for(l in b)if(b.hasOwnProperty(l)){n=!1;if("$"===l.substr(0,1))switch(l){case "$index":n=!0;break;default:n=!0,(h=this._updateObject(g,b[l],e,d,c,l))&&(f=!0)}if(this._isPositionalKey(l)&&(n=!0,l=l.substr(0,l.length-2),h=new a(c+"."+l),g[l]&&g[l]instanceof Array&&g[l].length)){p=[];for(q=
0;q<g[l].length;q++)this._match(g[l][q],h.value(e)[0])&&p.push(q);for(q=0;q<p.length;q++)(h=this._updateObject(g[l][p[q]],b[l+".$"],e,d,c+"."+l,k))&&(f=!0)}if(!n)if(k||"object"!==typeof b[l])switch(k){case "$inc":this._updateIncrement(g,l,b[l]);f=!0;break;case "$push":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array){if(void 0!==b[l].$position&&b[l].$each instanceof Array)for(h=b[l].$position,n=b[l].$each.length,q=0;q<n;q++)this._updateSplicePush(g[l],h+q,b[l].$each[q]);else if(b[l].$each instanceof
Array)for(n=b[l].$each.length,q=0;q<n;q++)this._updatePush(g[l],b[l].$each[q]);else this._updatePush(g[l],b[l]);f=!0}else throw"Cannot push to a key that is not an array! ("+l+")";break;case "$pull":if(g[l]instanceof Array){p=[];for(q=0;q<g[l].length;q++)this._match(g[l][q],b[l])&&p.push(q);for(n=p.length;n--;)this._updatePull(g[l],p[n]),f=!0}break;case "$pullAll":if(g[l]instanceof Array)if(b[l]instanceof Array){if(p=g[l],n=p.length,0<n)for(;n--;){for(h=0;h<b[l].length;h++)p[n]===b[l][h]&&(this._updatePull(g[l],
n),n--,f=!0);if(0>n)break}}else throw"Cannot pullAll without being given an array of values to pull! ("+l+")";break;case "$addToSet":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array){q=g[l];var m;p=q.length;var s;n=!0;m=d&&d.$addToSet;var ca;m&&m.key?(h=!1,ca=new a(m.key),s=ca.value(b[l])[0]):(s=JSON.stringify(b[l]),h=!0);for(m=0;m<p;m++)if(h){if(JSON.stringify(q[m])===s){n=!1;break}}else if(s===ca.value(q[m])[0]){n=!1;break}n&&(this._updatePush(g[l],b[l]),f=!0)}else throw"Cannot addToSet on a key that is not an array! (undefined)!";
break;case "$splicePush":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array)if(h=b.$index,void 0!==h)delete b.$index,h>g[l].length&&(h=g[l].length),this._updateSplicePush(g[l],h,b[l]),f=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+l+")";break;case "$move":if(g[l]instanceof Array)for(q=0;q<g[l].length;q++){if(this._match(g[l][q],b[l])){f=b.$index;if(void 0!==f)delete b.$index,this._updateSpliceMove(g[l],q,f),f=!0;else throw"Cannot move without a $index integer value!";
break}}else throw"Cannot move on a key that is not an array! ("+l+")";break;case "$mul":this._updateMultiply(g,l,b[l]);f=!0;break;case "$rename":this._updateRename(g,l,b[l]);f=!0;break;case "$unset":this._updateUnset(g,l);f=!0;break;case "$pop":if(g[l]instanceof Array)this._updatePop(g[l],b[l])&&(f=!0);else throw"Cannot pop from a key that is not an array! ("+l+")";break;default:g[l]!==b[l]&&(this._updateProperty(g,l,b[l]),f=!0)}else if(null!==g[l]&&"object"===typeof g[l])if(q=g[l]instanceof Array,
p=b[l]instanceof Array,q||p)if(!p&&q)for(q=0;q<g[l].length;q++)(h=this._updateObject(g[l][q],b[l],e,d,c+"."+l,k))&&(f=!0);else g[l]!==b[l]&&(this._updateProperty(g,l,b[l]),f=!0);else(h=this._updateObject(g[l],b[l],e,d,c+"."+l,k))&&(f=!0);else g[l]!==b[l]&&(this._updateProperty(g,l,b[l]),f=!0)}return f};e.prototype._isPositionalKey=function(g){return".$"===g.substr(g.length-2,2)};e.prototype._updateProperty=function(g,a,b){this._linked?(jQuery.observable(g).setProperty(a,b),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+
a+'" for collection "'+this.name()+'"')):(g[a]=b,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+a+'" for collection "'+this.name()+'"'))};e.prototype._updateIncrement=function(g,a,b){this._linked?jQuery.observable(g).setProperty(a,g[a]+b):g[a]+=b};e.prototype._updateSpliceMove=function(g,a,b){this._linked?(jQuery.observable(g).move(a,b),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+a+'" to "'+b+'" for collection "'+
this.name()+'"')):(g.splice(b,0,g.splice(a,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+a+'" to "'+b+'" for collection "'+this.name()+'"'))};e.prototype._updateSplicePush=function(g,a,b){g.length>a?this._linked?jQuery.observable(g).insert(a,b):g.splice(a,0,b):this._linked?jQuery.observable(g).insert(b):g.push(b)};e.prototype._updatePush=function(g,a){this._linked?jQuery.observable(g).insert(a):g.push(a)};e.prototype._updatePull=function(g,
a){this._linked?jQuery.observable(g).remove(a):g.splice(a,1)};e.prototype._updateMultiply=function(g,a,b){this._linked?jQuery.observable(g).setProperty(a,g[a]*b):g[a]*=b};e.prototype._updateRename=function(g,a,b){var e=g[a];this._linked?(jQuery.observable(g).setProperty(b,e),jQuery.observable(g).removeProperty(a)):(g[b]=e,delete g[a])};e.prototype._updateUnset=function(g,a){this._linked?jQuery.observable(g).removeProperty(a):delete g[a]};e.prototype._updatePop=function(g,a){var b,e=!1;0<g.length&&
(this._linked?(1===a?b=g.length-1:-1===a&&(b=0),-1<b&&(jQuery.observable(arr).remove(b),e=!0)):1===a?(g.pop(),e=!0):-1===a&&(g.shift(),e=!0));return e};e.prototype.remove=function(g,a,b){var e,d;if(g instanceof Array){d=[];for(b=0;b<g.length;b++)d.push(this.remove(g[b],{noEmit:!0}));(!a||a&&!a.noEmit)&&this._onRemove(d);return d}b=this.find(g,{$decouple:!1});if(b.length){for(d=0;d<b.length;d++)e=b[d],this._removeIndex(e),e=this._data.indexOf(e),this._linked?jQuery.observable(this._data).remove(e):
this._data.splice(e,1);this.chainSend("remove",{query:g},a);(!a||a&&!a.noEmit)&&this._onRemove(b);this.deferEmit("change",{type:"remove",data:b})}return b};e.prototype.removeById=function(g){var a={};a[this._primaryKey]=g;return this.remove(a)};e.prototype.deferEmit=function(){var g=this,a;this._noEmitDefer||this._db&&(!this._db||this._db._noEmitDefer)?this.emit.apply(this,arguments):(a=arguments,this._changeTimeout&&clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){g.debug()&&
console.log("ForerunnerDB.Collection: Emitting "+a[0]);g.emit.apply(g,a)},100))};e.prototype.processQueue=function(g,a){var b=this._deferQueue[g],e=this._deferThreshold[g],d=this._deferTime[g];if(b.length){var c=this;b.length&&(b=b.length>e?b.splice(0,e):b.splice(0,b.length),this[g](b));setTimeout(function(){c.processQueue(g,a)},d)}else a&&a()};e.prototype.insert=function(g,a,b){"function"===typeof a?(b=a,a=this._data.length):void 0===a&&(a=this._data.length);g=this.transformIn(g);return this._insertHandle(g,
a,b)};e.prototype._insertHandle=function(g,a,b){var e=this._deferQueue.insert,d=this._deferThreshold.insert,c=[],k=[];if(g instanceof Array){if(g.length>d){this._deferQueue.insert=e.concat(g);this.processQueue("insert",b);return}for(d=0;d<g.length;d++)e=this._insert(g[d],a+d),!0===e?c.push(g[d]):k.push({doc:g[d],reason:e})}else e=this._insert(g,a),!0===e?c.push(g):k.push({doc:g,reason:e});this.chainSend("insert",g,{index:a});this._onInsert(c,k);b&&b();this.deferEmit("change",{type:"insert",data:c});
return{inserted:c,failed:k}};e.prototype._insert=function(g,a){if(g){var b;this._ensurePrimaryKey(g);if(b=this.insertIndexViolation(g))return"Index violation in index: "+b;this._insertIndex(g);a>this._data.length&&(a=this._data.length);this._linked?jQuery.observable(this._data).insert(a,g):this._data.splice(a,0,g);return!0}return"No document passed to insert"};e.prototype._insertIndex=function(g){var a=this._indexByName,b,e,d=JSON.stringify(g);e=this._primaryIndex.uniqueSet(g[this._primaryKey],g);
this._primaryCrc.uniqueSet(g[this._primaryKey],d);this._crcLookup.uniqueSet(d,g);for(b in a)a.hasOwnProperty(b)&&a[b].insert(g);return e};e.prototype._removeIndex=function(g){var a=this._indexByName,b,e=JSON.stringify(g);this._primaryIndex.unSet(g[this._primaryKey]);this._primaryCrc.unSet(g[this._primaryKey]);this._crcLookup.unSet(e);for(b in a)a.hasOwnProperty(b)&&a[b].remove(g)};e.prototype.subset=function(g,a){var b=this.find(g,a);return(new e)._subsetOf(this).primaryKey(this._primaryKey).setData(b)};
e.prototype.subsetOf=function(){return this.__subsetOf};e.prototype._subsetOf=function(a){this.__subsetOf=a;return this};e.prototype.distinct=function(g,b,e){b=this.find(b,e);g=new a(g);e={};var d=[],c,k;for(k=0;k<b.length;k++)(c=g.value(b[k])[0])&&!e[c]&&(e[c]=!0,d.push(c));return d};e.prototype.decouple=f.common.decouple;e.prototype.findById=function(a,b){var e={};e[this._primaryKey]=a;return this.find(e,b)[0]};e.prototype.peek=function(a,b){var d=this._data,c=d.length,k,f,h=new e;if("string"===
typeof a){for(k=0;k<c;k++)f=JSON.stringify(d[k]),-1<f.indexOf(a)&&h.insert(d[k]);return h.find({},b)}return this.find(a,b)};e.prototype.explain=function(a,b){return this.find(a,b).__fdbOp._data};e.prototype.find=function(g,b){g=g||{};b=b||{};b.$decouple=void 0!==b.$decouple?b.$decouple:!0;var e=this._metrics.create("find"),d=this,c,k=!0,f,h,n,p,q,l,m,s,ca,na=[];h=function(a){return d._match(a,g,"and")};e.start();if(g){e.time("analyseQuery");c=this._analyseQuery(g,b,e);e.time("analyseQuery");e.data("analysis",
c);if(c.hasJoin&&c.queriesJoin){e.time("joinReferences");for(n=0;n<c.joinsOn.length;n++)q=c.joinsOn[n],p=new a(c.joinQueries[q]),p=p.value(g)[0],this._db.collection(c.joinsOn[n]).subset(p);e.time("joinReferences")}c.indexMatch.length&&(!b||b&&!b.$skipIndex)?(e.data("index.potential",c.indexMatch),e.data("index.used",c.indexMatch[0].index),e.time("indexLookup"),f=c.indexMatch[0].lookup,e.time("indexLookup"),c.indexMatch[0].keyData.totalKeyCount===c.indexMatch[0].keyData.matchedKeyCount&&(k=!1)):e.flag("usedIndex",
!1);k&&(f&&f.length?(c=f.length,e.time("tableScan: "+c),f=f.filter(h)):(c=this._data.length,e.time("tableScan: "+c),f=this._data.filter(h)),b.$orderBy&&(e.time("sort"),f=this.sort(b.$orderBy,f),e.time("sort")),e.time("tableScan: "+c));b.limit&&f&&f.length>b.limit&&(f.length=b.limit,e.data("limit",b.limit));b.$decouple&&(e.time("decouple"),f=this.decouple(f),e.time("decouple"),e.data("flag.decouple",!0));if(b.join){for(h=0;h<b.join.length;h++)for(q in b.join[h])if(b.join[h].hasOwnProperty(q))for(s=
q,c=this._db.collection(q),k=b.join[h][q],ca=0;ca<f.length;ca++){m={};p=n=!1;for(l in k)if(k.hasOwnProperty(l))if("$"===l.substr(0,1))switch(l){case "$as":s=k[l];break;case "$multi":n=k[l];break;case "$require":p=k[l];break;default:l.substr(0,3)}else m[l]=(new a(k[l])).value(f[ca])[0];m=c.find(m);!p||p&&m[0]?f[ca][s]=!1===n?m[0]:m:na.push(f[ca])}e.data("flag.join",!0)}if(na.length){e.time("removalQueue");for(l=0;l<na.length;l++)q=f.indexOf(na[l]),-1<q&&f.splice(q,1);e.time("removalQueue")}if(b.transform){e.time("transform");
for(l=0;l<f.length;l++)f.splice(l,1,b.transform(f[l]));e.time("transform");e.data("flag.transform",!0)}this._transformEnabled&&this._transformOut&&(e.time("transformOut"),f=this.transformOut(f),e.time("transformOut"));e.data("results",f.length);e.stop()}else e.stop(),f=[];f.__fdbOp=e;return f};e.prototype.indexOf=function(a){if(a=this.find(a,{$decouple:!1})[0])return this._data.indexOf(a)};e.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this._transformEnabled=
a.enabled),void 0!==a.dataIn&&(this._transformIn=a.dataIn),void 0!==a.dataOut&&(this._transformOut=a.dataOut)):this._transformEnabled=!1===a?!1:!0,this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};e.prototype.transformIn=function(a){if(this._transformEnabled&&this._transformIn){if(a instanceof Array){var b=[],e;for(e=0;e<a.length;e++)b[e]=this._transformIn(a[e]);return b}return this._transformIn(a)}return a};e.prototype.transformOut=function(a){if(this._transformEnabled&&
this._transformOut){if(a instanceof Array){var b=[],e;for(e=0;e<a.length;e++)b[e]=this._transformOut(a[e]);return b}return this._transformOut(a)}return a};e.prototype.sort=function(a,b){b=b||[];var e=[],d,c;for(d in a)a.hasOwnProperty(d)&&(c={},c[d]=a[d],c.___fdbKey=d,e.push(c));return 2>e.length?this._sort(a,b):this._bucketSort(e,b)};e.prototype._bucketSort=function(a,b){var e=a.shift(),d,c,k=[];if(0<a.length){b=this._sort(e,b);d=this.bucket(e.___fdbKey,b);for(c in d)d.hasOwnProperty(c)&&(e=[].concat(a),
k=k.concat(this._bucketSort(e,d[c])));return k}return this._sort(e,b)};e.prototype._sort=function(b,e){var d,c=new a;d=c.parse(b,!0)[0];c.path(d.path);if(1===d.value)d=function(a,b){var g=c.value(a)[0],e=c.value(b)[0];return"string"===typeof g&&"string"===typeof e?g.localeCompare(e):g>e?1:g<e?-1:0};else if(-1===d.value)d=function(a,b){var g=c.value(a)[0],e=c.value(b)[0];return"string"===typeof g&&"string"===typeof e?1===g.localeCompare(e)?-1:1:g>e?-1:g<e?1:0};else throw this._name+": $orderBy clause has invalid direction: "+
d.value+", accepted values are 1 or -1 for ascending or descending!";return e.sort(d)};e.prototype.bucket=function(a,b){var e,d={};for(e=0;e<b.length;e++)d[b[e][a]]=d[b[e][a]]||[],d[b[e][a]].push(b[e]);return d};e.prototype._analyseQuery=function(b,e,d){var c={queriesOn:[this._name],indexMatch:[],hasJoin:!1,queriesJoin:!1,joinQueries:{},query:b,options:e},k,f=[],h=[],m,n,p,q,l;d.time("checkIndexes");void 0!==b[this._primaryKey]&&(d.time("checkIndexMatch: Primary Key"),m=new a,c.indexMatch.push({lookup:this._primaryIndex.lookup(b,
e),keyData:{matchedKeys:[this._primaryKey],matchedKeyCount:1,totalKeyCount:m.countKeys(b)},index:this._primaryIndex}),d.time("checkIndexMatch: Primary Key"));for(l in this._indexById)if(this._indexById.hasOwnProperty(l)&&(n=this._indexById[l],p=n.name(),d.time("checkIndexMatch: "+p),m=n.match(b,e),q=n.lookup(b,e),0<m.matchedKeyCount&&c.indexMatch.push({lookup:q,keyData:m,index:n}),d.time("checkIndexMatch: "+p),m.totalKeyCount===m.matchedKeyCount))break;d.time("checkIndexes");1<c.indexMatch.length&&
(d.time("findOptimalIndex"),c.indexMatch.sort(function(a,b){return a.keyData.totalKeyCount===a.keyData.matchedKeyCount?-1:b.keyData.totalKeyCount===b.keyData.matchedKeyCount?1:a.keyData.matchedKeyCount===b.keyData.matchedKeyCount?a.lookup.length-b.lookup.length:b.keyData.matchedKeyCount-a.keyData.matchedKeyCount}),d.time("findOptimalIndex"));if(e.join){c.hasJoin=!0;for(d=0;d<e.join.length;d++)for(k in e.join[d])e.join[d].hasOwnProperty(k)&&(f.push(k),"$as"in e.join[d][k]?h.push(e.join[d][k].$as):
h.push(k));for(k=0;k<h.length;k++)if(e=this._queryReferencesCollection(b,h[k],""))c.joinQueries[f[k]]=e,c.queriesJoin=!0;c.joinsOn=f;c.queriesOn=c.queriesOn.concat(f)}return c};e.prototype._queryReferencesCollection=function(a,b,e){for(var d in a)if(a.hasOwnProperty(d)){if(d===b)return e&&(e+="."),e+d;if("object"===typeof a[d])return e&&(e+="."),e+=d,this._queryReferencesCollection(a[d],b,e)}return!1};e.prototype._match=function(a,b,e){var d,c;d=typeof a;c=typeof b;var k=!0,f;if(!("string"!==d&&"number"!==
d||"string"!==c&&"number"!==c))a!==b&&(k=!1);else for(f in b)if(b.hasOwnProperty(f)){d=!1;if("$"===f.substr(0,1))switch(f){case "$gt":if(a>b[f]){if("or"===e)return!0}else k=!1;d=!0;break;case "$gte":if(a>=b[f]){if("or"===e)return!0}else k=!1;d=!0;break;case "$lt":if(a<b[f]){if("or"===e)return!0}else k=!1;d=!0;break;case "$lte":if(a<=b[f]){if("or"===e)return!0}else k=!1;d=!0;break;case "$exists":if(void 0===a!==b[f]){if("or"===e)return!0}else k=!1;d=!0;break;case "$or":d=!0;for(c=0;c<b[f].length;c++){if(this._match(a,
b[f][c],"and"))return!0;k=!1}break;case "$and":d=!0;for(c=0;c<b[f].length;c++)if(!this._match(a,b[f][c],"and"))return!1;break;case "$in":if(b[f]instanceof Array){d=b[f];c=d.length;var h,m=!1;for(h=0;h<c;h++)if(d[h]===a){m=!0;break}if(m){if("or"===e)return!0}else k=!1}else throw"Cannot use a $nin operator on a non-array key: "+f;d=!0;break;case "$nin":if(b[f]instanceof Array){d=b[f];c=d.length;m=!0;for(h=0;h<c;h++)if(d[h]===a){m=!1;break}if(m){if("or"===e)return!0}else k=!1}else throw"Cannot use a $nin operator on a non-array key: "+
f;d=!0;break;case "$ne":if(a!=b[f]){if("or"===e)return!0}else k=!1;d=!0}if(!d&&b[f]instanceof RegExp)if(d=!0,"object"===typeof a&&void 0!==a[f]&&b[f].test(a[f])){if("or"===e)return!0}else k=!1;if(!d)if("object"===typeof b[f])if(void 0!==a[f]){if(a[f]instanceof Array&&!(b[f]instanceof Array))for(d=!1,c=0;c<a[f].length&&!(d=this._match(a[f][c],b[f],void 0));c++);else if(!(a[f]instanceof Array)&&b[f]instanceof Array)for(d=!1,c=0;c<b[f].length&&!(d=this._match(a[f],b[f][c],void 0));c++);else d="object"===
typeof a?this._match(a[f],b[f],void 0):this._match(void 0,b[f],void 0);if(d){if("or"===e)return!0}else k=!1}else if(b[f]&&void 0!==b[f].$exists)if(d=this._match(void 0,b[f],void 0)){if("or"===e)return!0}else k=!1;else k=!1;else if(a&&a[f]===b[f]){if("or"===e)return!0}else if(a&&a[f]&&a[f]instanceof Array&&b[f]&&"object"!==typeof b[f]){d=!1;for(c=0;c<a[f].length&&!(d=this._match(a[f][c],b[f],void 0));c++);if(d){if("or"===e)return!0}else k=!1}else k=!1;if("and"===e&&!k)return!1}return k};e.prototype.count=
function(a,b){return a?this.find(a,b).length:this._data.length};e.prototype.link=function(a,b){if(window.jQuery){this._links=this._links||{};var e,d;b&&"object"===typeof b?b.template&&"string"===typeof b.template&&(e=this.objectId(b.template),d=b.template):e=b;if(!this._links[e]){if(jQuery(a).length){if(!jQuery.templates[e]){if(!d)if(d=jQuery(b),d.length)d=jQuery(d[0]).html();else throw"Unable to bind collection to target because template does not exist: "+b;jQuery.views.templates(e,d)}jQuery.templates[e].link(a,
this._data);this._links[e]=a;this._linked++;this.debug()&&console.log('ForerunnerDB.Collection: Added binding collection "'+this.name()+'" to output target: '+a);return this}throw'Cannot bind view data to output target selector "'+a+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+a+" with the template: "+e;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};e.prototype.unlink=function(a,b){if(window.jQuery){this._links=this._links||
{};var e;b&&"object"===typeof b?b.template&&"string"===typeof b.template&&(e=this.objectId(b.template)):e=b;if(this._links[e])return jQuery.templates[e].unlink(a),delete this._links[e],this._linked--,this.debug()&&console.log('ForerunnerDB.Collection: Removed binding collection "'+this.name()+'" to output target: '+a),this;console.log("Cannot remove link, one does not exist to the target: "+a+" with the template: "+b)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";return this};
e.prototype.isLinked=function(){return Boolean(this._data._linked)};e.prototype.findSub=function(b,e,d,c){var f=new a(e);b=this.find(b);var k=b.length,h,m,n=this._db.collection("__FDB_temp_"+this.objectId()),p={parents:k,subDocTotal:0,subDocs:[],pathFound:!1,err:""};for(h=0;h<k;h++)if(m=f.value(b[h])[0]){n.setData(m);m=n.find(d,c);if(c.returnFirst&&m.length)return m[0];p.subDocs.push(m);p.subDocTotal+=m.length;p.pathFound=!0}n.drop();if(c.noStats)return p.subDocs;p.pathFound||(p.err="No objects found in the parent documents with a matching path of: "+
e);return p};e.prototype.insertIndexViolation=function(b){var a,e=this._indexByName,d,c;if(this._primaryIndex.get(b[this._primaryKey]))a=this._primaryIndex;else for(d in e)if(e.hasOwnProperty(d)&&(c=e[d],c.unique()&&c.violation(b))){a=c;break}return a?a.name():!1};e.prototype.ensureIndex=function(a,e){this._indexByName=this._indexByName||{};this._indexById=this._indexById||{};var d=new b(a,e,this),c={start:(new Date).getTime()};if(this._indexByName[d.name()])return{err:"Index with that name already exists"};
if(this._indexById[d.id()])return{err:"Index with those keys already exists"};d.rebuild();this._indexByName[d.name()]=d;this._indexById[d.id()]=d;c.end=(new Date).getTime();c.total=c.end-c.start;this._lastOp={type:"ensureIndex",stats:{time:c}};return{index:d,id:d.id(),name:d.name(),state:d.state()}};e.prototype.index=function(b){if(this._indexByName)return this._indexByName[b]};e.prototype.lastOp=function(){return this._metrics.list()};e.prototype.objectId=f.common.objectId;e.prototype.diff=function(b){var a=
{insert:[],update:[],remove:[]},e=this.primaryKey(),d,c,f,k;if(e===b.primaryKey()){for(d=b._data;d&&!(d instanceof Array);)b=d,d=b._data;k=d.length;for(c=0;c<k;c++)f=d[c],this._primaryIndex.get(f[e])?this._primaryCrc.get(f[e])!==b._primaryCrc.get(f[e])&&a.update.push(f):a.insert.push(f);d=this._data;k=d.length;for(c=0;c<k;c++)f=d[c],b._primaryIndex.get(f[e])||a.remove.push(f)}else throw"Collection diffing requires that both collections have the same primary key!";return a};h.prototype.collection=
function(b,a){if(b)return this._collection[b]||this.debug()&&console.log("Creating collection "+b),this._collection[b]=this._collection[b]||(new e(b)).db(this),void 0!==a&&this._collection[b].primaryKey(a),this._collection[b];throw"Cannot get collection with undefined name!";};h.prototype.collectionExists=function(b){return Boolean(this._collection[b])};h.prototype.collections=function(){var b=[],a;for(a in this._collection)this._collection.hasOwnProperty(a)&&b.push({name:a,count:this._collection[a].count()});
return b};m.exports=e},{"./Crc":6,"./Index":9,"./KeyValueStore":10,"./Metrics":11,"./Path":14,"./Shared":17}],4:[function(h,m,f){var k,c;f=h("./Shared");var a=function(){this.init.apply(this,arguments)};a.prototype.init=function(b){this._name=b;this._data=new c("__FDB__cg_data_"+this._name);this._collections=[];this._views=[]};f.addModule("CollectionGroup",a);f.inherit(a.prototype,f.chainReactor);c=h("./Collection");h=f.modules.Core;k=f.modules.Core.prototype.init;a.prototype.debug=f.common.debug;
a.prototype.on=function(){this._data.on.apply(this._data,arguments)};a.prototype.off=function(){this._data.off.apply(this._data,arguments)};a.prototype.emit=function(){this._data.emit.apply(this._data,arguments)};a.prototype.primaryKey=function(b){return void 0!==b?(this._primaryKey=b,this):this._primaryKey};f.synthesize(a.prototype,"db");a.prototype.addCollection=function(b){if(b&&-1===this._collections.indexOf(b)){if(this._collections.length){if(this._primaryKey!==b.primaryKey())throw"All collections in a collection group must have the same primary key!";
}else this.primaryKey(b.primaryKey());this._collections.push(b);b._groups.push(this);b.chain(this);this._data.insert(b.find())}return this};a.prototype.removeCollection=function(b){if(b){var a=this._collections.indexOf(b);-1!==a&&(b.unChain(this),this._collections.splice(a,1),a=b._groups.indexOf(this),-1!==a&&b._groups.splice(a,1));0===this._collections.length&&delete this._primaryKey}return this};a.prototype.decouple=f.common.decouple;a.prototype._chainHandler=function(b){switch(b.type){case "setData":b.data=
this.decouple(b.data);this._data.remove(b.options.oldData);this._data.insert(b.data);break;case "insert":b.data=this.decouple(b.data);this._data.insert(b.data);break;case "update":this._data.update(b.data.query,b.data.update,b.options);break;case "remove":this._data.remove(b.data.query,b.options)}};a.prototype.insert=function(){this._collectionsRun("insert",arguments)};a.prototype.update=function(){this._collectionsRun("update",arguments)};a.prototype.updateById=function(){this._collectionsRun("updateById",
arguments)};a.prototype.remove=function(){this._collectionsRun("remove",arguments)};a.prototype._collectionsRun=function(b,a){for(var e=0;e<this._collections.length;e++)this._collections[e][b].apply(this._collections[e],a)};a.prototype.find=function(b,a){return this._data.find(b,a)};a.prototype.removeById=function(b){for(var a=0;a<this._collections.length;a++)this._collections[a].removeById(b)};a.prototype.subset=function(a,d){var e=this.find(a,d);return(new c)._subsetOf(this).primaryKey(this._primaryKey).setData(e)};
a.prototype.drop=function(){var a,d=[].concat(this._collections),e=[].concat(this._views);this._debug&&console.log("Dropping collection group "+this._name);for(a=0;a<d.length;a++)this.removeCollection(d[a]);for(a=0;a<e.length;a++)this._removeView(e[a]);this.emit("drop");return!0};h.prototype.init=function(){this._collectionGroup={};k.apply(this,arguments)};h.prototype.collectionGroup=function(b){return b?(this._collectionGroup[b]=this._collectionGroup[b]||(new a(b)).db(this),this._collectionGroup[b]):
this._collectionGroup};m.exports=a},{"./Collection":3,"./Shared":17}],5:[function(h,m,f){var k,c;k=h("./Shared.js");f=function(){this.init.apply(this,arguments)};f.prototype.init=function(){this._collection={};this._debug={};this._version="1.2.7"};f.prototype.moduleLoaded=k.overload({string:function(a){if(void 0!==a){a=a.replace(/ /g,"");var b=a.split(","),d;for(d=0;d<b.length;d++)if(!k.modules[a])return!1;return!0}return!1},"string, function":function(a,b){if(void 0!==a){a=a.replace(/ /g,"");var d=
a.split(","),e;for(e=0;e<d.length;e++)if(!k.modules[a])return!1;b()}},"string, function, function":function(a,b,d){if(void 0!==a){a=a.replace(/ /g,"");var e=a.split(","),g;for(g=0;g<e.length;g++)if(!k.modules[a])return d(),!1;b()}}});f.moduleLoaded=f.prototype.moduleLoaded;f.shared=k;f.prototype.shared=k;k.addModule("Core",f);k.inherit(f.prototype,k.chainReactor);c=h("./Collection.js");h("./Metrics.js");h=h("./Crc.js");f.prototype._isServer=!1;f.prototype.isClient=function(){return!this._isServer};
f.prototype.isServer=function(){return this._isServer};f.prototype.crc=h;f.prototype.isClient=function(){return!this._isServer};f.prototype.isServer=function(){return this._isServer};f.prototype.decouple=k.common.decouple;f.prototype.debug=k.common.debug;f.prototype.arrayToCollection=function(a){return(new c).setData(a)};f.prototype.on=function(a,b){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||[];this._listeners[a].push(b);return this};f.prototype.off=function(a,b){if(a in
this._listeners){var d=this._listeners[a],e=d.indexOf(b);-1<e&&d.splice(e,1)}return this};f.prototype.emit=function(a,b){this._listeners=this._listeners||{};if(a in this._listeners){var d=this._listeners[a],e=d.length,g;for(g=0;g<e;g++)d[g].apply(this,Array.prototype.slice.call(arguments,1))}return this};f.prototype.objectId=k.common.objectId;f.prototype.peek=function(a){var b,d,e=[],g=typeof a;for(b in this._collection)this._collection.hasOwnProperty(b)&&(d=this._collection[b],e="string"===g?e.concat(d.peek(a)):
e.concat(d.find(a)));return e};f.prototype.peekCat=function(a){var b,d,e={},g,c=typeof a;for(b in this._collection)this._collection.hasOwnProperty(b)&&(d=this._collection[b],(g="string"===c?d.peek(a):d.find(a))&&g.length&&(e[d.name()]=g));return e};m.exports=f},{"./Collection.js":3,"./Crc.js":6,"./Metrics.js":11,"./Shared.js":17}],6:[function(h,m,f){var k=function(){var c=[],a,b,d;for(b=0;256>b;b++){a=b;for(d=0;8>d;d++)a=a&1?3988292384^a>>>1:a>>>1;c[b]=a}return c}();m.exports=function(c){var a=-1,
b;for(b=0;b<c.length;b++)a=a>>>8^k[(a^c.charCodeAt(b))&255];return(a^-1)>>>0}},{}],7:[function(h,m,f){var k,c;f=h("./Shared");var a=function(){this.init.apply(this,arguments)};a.prototype.init=function(a){this._name=a;this._data={}};f.addModule("Document",a);f.inherit(a.prototype,f.chainReactor);h=h("./Collection");k=f.modules.Core;c=f.modules.Core.prototype.init;f.synthesize(a.prototype,"db");f.synthesize(a.prototype,"name");a.prototype.setData=function(a){var d,e;if(a)if(a=this.decouple(a),this._linked){e=
{};for(d in this._data)"jQuery"!==d.substr(0,6)&&this._data.hasOwnProperty(d)&&void 0===a[d]&&(e[d]=1);a.$unset=e;this._updateObject(this._data,a,{})}else this._data=a;return this};a.prototype.decouple=f.common.decouple;a.prototype.objectId=f.common.objectId;a.prototype.on=f.common.on;a.prototype.off=f.common.off;a.prototype.emit=f.common.emit;a.prototype.debug=f.common.debug;a.prototype.update=function(a,d,e){this._updateObject(this._data,d,a,e)};a.prototype._updateObject=h.prototype._updateObject;
a.prototype._isPositionalKey=function(a){return".$"===a.substr(a.length-2,2)};a.prototype._updateProperty=function(a,d,e){this._linked?(jQuery.observable(a).setProperty(d,e),this.debug()&&console.log('ForerunnerDB.Document: Setting data-bound document property "'+d+'" for collection "'+this.name()+'"')):(a[d]=e,this.debug()&&console.log('ForerunnerDB.Document: Setting non-data-bound document property "'+d+'" for collection "'+this.name()+'"'))};a.prototype._updateIncrement=function(a,d,e){this._linked?
jQuery.observable(a).setProperty(d,a[d]+e):a[d]+=e};a.prototype._updateSpliceMove=function(a,d,e){this._linked?(jQuery.observable(a).move(d,e),this.debug()&&console.log('ForerunnerDB.Document: Moving data-bound document array index from "'+d+'" to "'+e+'" for collection "'+this.name()+'"')):(a.splice(e,0,a.splice(d,1)[0]),this.debug()&&console.log('ForerunnerDB.Document: Moving non-data-bound document array index from "'+d+'" to "'+e+'" for collection "'+this.name()+'"'))};a.prototype._updateSplicePush=
function(a,d,e){a.length>d?this._linked?jQuery.observable(a).insert(d,e):a.splice(d,0,e):this._linked?jQuery.observable(a).insert(e):a.push(e)};a.prototype._updatePush=function(a,d){this._linked?jQuery.observable(a).insert(d):a.push(d)};a.prototype._updatePull=function(a,d){this._linked?jQuery.observable(a).remove(d):a.splice(d,1)};a.prototype._updateMultiply=function(a,d,e){this._linked?jQuery.observable(a).setProperty(d,a[d]*e):a[d]*=e};a.prototype._updateRename=function(a,d,e){var g=a[d];this._linked?
(jQuery.observable(a).setProperty(e,g),jQuery.observable(a).removeProperty(d)):(a[e]=g,delete a[d])};a.prototype._updateUnset=function(a,d){this._linked?jQuery.observable(a).removeProperty(d):delete a[d]};a.prototype._updatePop=function(a,d){var e,g=!1;0<a.length&&(this._linked?(1===d?e=a.length-1:-1===d&&(e=0),-1<e&&(jQuery.observable(arr).remove(e),g=!0)):1===d?(a.pop(),g=!0):-1===d&&(a.shift(),g=!0));return g};a.prototype.link=function(a,d){if(window.jQuery){this._links=this._links||{};this._linked||
(this._linked=0);var e,g;d&&"object"===typeof d?d.template&&"string"===typeof d.template&&(e=this.objectId(d.template),g=d.template):e=d;if(!this._links[e]){if(jQuery(a).length){if(!jQuery.templates[e]){if(!g)if(g=jQuery(d),g.length)g=jQuery(g[0]).html();else throw"Unable to bind document to target because template does not exist: "+d;jQuery.views.templates(e,g)}jQuery.templates[e].link(a,this._data);this._links[e]=a;this._linked++;this.debug()&&console.log('ForerunnerDB.Document: Added binding document "'+
this.name()+'" to output target: '+a);return this}throw'Cannot bind view data to output target selector "'+a+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+a+" with the template: "+e;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};a.prototype.unlink=function(a,d){if(window.jQuery){this._links=this._links||{};var e;d&&"object"===typeof d?d.template&&"string"===typeof d.template&&(e=this.objectId(d.template)):e=d;if(this._links[e])return jQuery.templates[e].unlink(a),
delete this._links[e],this._linked--,this.debug()&&console.log('ForerunnerDB.Document: Removed binding document "'+this.name()+'" to output target: '+a),this;console.log("Cannot remove link, one does not exist to the target: "+a+" with the template: "+d)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";};a.prototype.drop=function(){this._db&&this._name&&this._db&&this._db._document&&this._db._document[this._name]&&(delete this._db._document[this._name],this._data={})};
k.prototype.init=function(){c.apply(this,arguments)};k.prototype.document=function(b){return b?(this._document=this._document||{},this._document[b]=this._document[b]||(new a(b)).db(this),this._document[b]):this._document};m.exports=a},{"./Collection":3,"./Shared":17}],8:[function(h,m,f){var k;h=h("./Shared");var c=function(a,b){this.init.apply(this,arguments)};c.prototype.init=function(a,b){this._options=b;this._selector=$(this._options.selector);this._listeners={};this._collection=a;this._options.series=
[];var d,e;switch(this._options.type){case "pie":this._selector.highcharts(this._options.chartOptions);this._chart=this._selector.highcharts();d=this._collection.find();e={allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {y} ({point.percentage:.0f}%)",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}};d=this.pieDataFromCollectionData(d,this._options.keyField,this._options.valField);$.extend(e,this._options.seriesOptions);$.extend(e,
{type:"pie",name:this._options.seriesName,data:d});this._chart.addSeries(e);break;case "line":d=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,this._options.orderBy),this._options.chartOptions.xAxis=d.xAxis,this._options.chartOptions.series=d.series,this._selector.highcharts(this._options.chartOptions),this._chart=this._selector.highcharts()}this._hookEvents()};h=h.modules.Collection;k=h.prototype.init;c.prototype.pieDataFromCollectionData=
function(a,b,d){var e=[],g;for(g=0;g<a.length;g++)e.push([a[g][b],a[g][d]]);return e};c.prototype.lineDataFromCollectionData=function(a,b,d,e){var g=this._collection.distinct(a),c=[],f={categories:[]},k,h,m,fa,ba;for(fa=0;fa<g.length;fa++){k=g[fa];h={};h[a]=k;m=[];h=this._collection.find(h,{orderBy:e});for(ba=0;ba<h.length;ba++)f.categories.push(h[ba][b]),m.push(h[ba][d]);c.push({name:k,data:m})}return{xAxis:f,series:c}};c.prototype._hookEvents=function(){this._collection.on("change",this._changeListener);
this._collection.on("drop",this._dropListener)};c.prototype._changeListener=function(){if("undefined"!==typeof this._collection&&this._chart){var a=this._collection.find();switch(this._options.type){case "pie":this._chart.series[0].setData(this.pieDataFromCollectionData(a,this._options.keyField,this._options.valField));break;case "line":a=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,this._options.orderBy);this._chart.xAxis[0].setCategories(a.xAxis.categories);
for(var b=0;b<a.series.length;b++)this._chart.series[b].setData(a.series[b].data)}}};c.prototype._dropListener=function(){this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener)};c.prototype.drop=function(){this._chart.destroy();this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener);delete this._collection._highcharts[this._options.selector];delete this._chart;delete this._options;delete this._collection;return this};
h.prototype.init=function(){this._highcharts={};k.apply(this,arguments)};h.prototype.chart=function(a){this._highcharts[a.selector]||(this._highcharts[a.selector]=new c(this,a));return this._highcharts[a.selector]};h.prototype.dropChart=function(a){this._highcharts[a]&&this._highcharts[a].drop()};m.exports=c},{"./Shared":17}],9:[function(h,m,f){f=h("./Shared");var k=h("./Path");h=function(){this.init.apply(this,arguments)};h.prototype.init=function(c,a,b){this._crossRef={};this._size=0;this._id=this._itemKeyHash(c,
c);this.data({});this.unique(a&&a.unique?a.unique:!1);void 0!==c&&this.keys(c);void 0!==b&&this.collection(b);this.name(a&&a.name?a.name:this._id)};f.addModule("Index",h);f.inherit(h.prototype,f.chainReactor);h.prototype.id=function(){return this._id};h.prototype.state=function(){return this._state};h.prototype.size=function(){return this._size};h.prototype.data=function(c){return void 0!==c?(this._data=c,this):this._data};f.synthesize(h.prototype,"name");h.prototype.collection=function(c){return void 0!==
c?(this._collection=c,this):this._collection};h.prototype.keys=function(c){return void 0!==c?(this._keys=c,this._keyCount=(new k).parse(this._keys).length,this):this._keys};h.prototype.type=function(c){return void 0!==c?(this._type=c,this):this._type};h.prototype.unique=function(c){return void 0!==c?(this._unique=c,this):this._unique};h.prototype.rebuild=function(){if(this._collection){var c=this._collection.subset({},{$decouple:!1,$orderBy:this._keys}).find(),a,b=c.length;this._data={};this._unique&&
(this._uniqueLookup={});for(a=0;a<b;a++)this.insert(c[a])}this._state={name:this._name,keys:this._keys,indexSize:this._size,built:new Date,updated:new Date,ok:!0}};h.prototype.insert=function(c,a){var b,d;this._unique&&(b=this._itemHash(c,this._keys),this._uniqueLookup[b]=c);b=this._itemHashArr(c,this._keys);for(d=0;d<b.length;d++)this.pushToPathValue(b[d],c)};h.prototype.remove=function(c,a){var b,d;this._unique&&(b=this._itemHash(c,this._keys),delete this._uniqueLookup[b]);b=this._itemHashArr(c,
this._keys);for(d=0;d<b.length;d++)this.pullFromPathValue(b[d],c)};h.prototype.violation=function(c){c=this._itemHash(c,this._keys);return Boolean(this._uniqueLookup[c])};h.prototype.hashViolation=function(c){return Boolean(this._uniqueLookup[c])};h.prototype.pushToPathValue=function(c,a){var b=this._data[c]=this._data[c]||[];-1===b.indexOf(a)&&(b.push(a),this._size++,this.pushToCrossRef(a,b))};h.prototype.pullFromPathValue=function(c,a){var b=this._data[c],d;d=b.indexOf(a);-1<d&&(b.splice(d,1),this._size--,
this.pullFromCrossRef(a,b));b.length||delete this._data[c]};h.prototype.pull=function(c){var a=c[this._collection.primaryKey()],b=this._crossRef[a],d,e=b.length,g;for(d=0;d<e;d++)g=b[d],this._pullFromArray(g,c);this._size--;delete this._crossRef[a]};h.prototype._pullFromArray=function(c,a){for(var b=c.length;b--;)c[b]===a&&c.splice(b,1)};h.prototype.pushToCrossRef=function(c,a){var b=c[this._collection.primaryKey()];this._crossRef[b]=this._crossRef[b]||[];b=this._crossRef[b];-1===b.indexOf(a)&&b.push(a)};
h.prototype.pullFromCrossRef=function(c,a){var b=c[this._collection.primaryKey()];delete this._crossRef[b]};h.prototype.lookup=function(c){return this._data[this._itemHash(c,this._keys)]||[]};h.prototype.match=function(c,a){return(new k).countObjectPaths(this._keys,c)};h.prototype._itemHash=function(c,a){var b=new k,d,e="",g;d=b.parse(a);for(g=0;g<d.length;g++)e&&(e+="_"),e+=b.value(c,d[g].path).join(":");return e};h.prototype._itemKeyHash=function(c,a){var b=new k,d,e="",g;d=b.parse(a);for(g=0;g<
d.length;g++)e&&(e+="_"),e+=b.keyValue(c,d[g].path);return e};h.prototype._itemHashArr=function(c,a){var b=new k,d,e=[],g,f,h,m;d=b.parse(a);for(h=0;h<d.length;h++)for(g=b.value(c,d[h].path),f=0;f<g.length;f++)if(0===h)e.push(g[f]);else for(m=0;m<e.length;m++)e[m]=e[m]+"_"+g[f];return e};m.exports=h},{"./Path":14,"./Shared":17}],10:[function(h,m,f){h=h("./Shared");f=function(f){this.init.apply(this,arguments)};f.prototype.init=function(f){this._name=f;this._data={};this._primaryKey="_id"};h.addModule("KeyValueStore",
f);h.inherit(f.prototype,h.chainReactor);h.synthesize(f.prototype,"name");f.prototype.primaryKey=function(f){return void 0!==f?(this._primaryKey=f,this):this._primaryKey};f.prototype.truncate=function(){this._data={};return this};f.prototype.set=function(f,c){this._data[f]=c?c:!0;return this};f.prototype.get=function(f){return this._data[f]};f.prototype.lookup=function(f){f=f[this._primaryKey];var c,a,b,d;if(f instanceof Array){a=f.length;d=[];for(c=0;c<a;c++)(b=this._data[f[c]])&&d.push(b);return d}if(f instanceof
RegExp){d=[];for(c in this._data)this._data.hasOwnProperty(c)&&f.test(c)&&d.push(this._data[c]);return d}if("object"===typeof f){if(f.$ne){d=[];for(c in this._data)this._data.hasOwnProperty(c)&&c!==f.$ne&&d.push(this._data[c]);return d}if(f.$in&&f.$in instanceof Array){d=[];for(c in this._data)this._data.hasOwnProperty(c)&&-1<f.$in.indexOf(c)&&d.push(this._data[c]);return d}if(f.$nin&&f.$nin instanceof Array){d=[];for(c in this._data)this._data.hasOwnProperty(c)&&-1===f.$nin.indexOf(c)&&d.push(this._data[c]);
return d}if(f.$or&&f.$or instanceof Array){d=[];for(c=0;c<f.$or.length;c++)d=d.concat(this.lookup(f.$or[c]));return d}}else return b=this._data[f],void 0!==b?[b]:[]};f.prototype.unSet=function(f){delete this._data[f];return this};f.prototype.uniqueSet=function(f,c){return void 0===this._data[f]?(this._data[f]=c,!0):!1};m.exports=f},{"./Shared":17}],11:[function(h,m,f){f=h("./Shared");var k=h("./Operation");h=function(){this.init.apply(this,arguments)};h.prototype.init=function(){this._data=[]};f.addModule("Metrics",
h);f.inherit(h.prototype,f.chainReactor);h.prototype.create=function(c){c=new k(c);this._enabled&&this._data.push(c);return c};h.prototype.start=function(){this._enabled=!0;return this};h.prototype.stop=function(){this._enabled=!1;return this};h.prototype.clear=function(){this._data=[];return this};h.prototype.list=function(){return this._data};m.exports=h},{"./Operation":12,"./Shared":17}],12:[function(h,m,f){f=h("./Shared");var k=h("./Path");h=function(c){this.pathSolver=new k;this.counter=0;this.init.apply(this,
arguments)};h.prototype.init=function(c){this._data={operation:c,index:{potential:[],used:!1},steps:[],time:{startMs:0,stopMs:0,totalMs:0,process:{}},flag:{},log:[]}};f.addModule("Operation",h);f.inherit(h.prototype,f.chainReactor);h.prototype.start=function(){this._data.time.startMs=(new Date).getTime()};h.prototype.log=function(c){if(c){var a=0<this._log.length?this._data.log[this._data.log.length-1].time:0;c={event:c,time:(new Date).getTime(),delta:0};this._data.log.push(c);a&&(c.delta=c.time-
a);return this}return this._data.log};h.prototype.time=function(c){if(void 0!==c){var a=this._data.time.process,a=a[c]=a[c]||{};a.startMs?(a.stopMs=(new Date).getTime(),a.totalMs=a.stopMs-a.startMs,a.stepObj.totalMs=a.totalMs,delete a.stepObj):(a.startMs=(new Date).getTime(),a.stepObj={name:c},this._data.steps.push(a.stepObj));return this}return this._data.time};h.prototype.flag=function(c,a){if(void 0!==c&&void 0!==a)this._data.flag[c]=a;else return void 0!==c?this._data.flag[c]:this._data.flag};
h.prototype.data=function(c,a,b){return void 0!==a?(this.pathSolver.set(this._data,c,a),this):this.pathSolver.get(this._data,c)};h.prototype.pushData=function(c,a,b){this.pathSolver.push(this._data,c,a)};h.prototype.stop=function(){this._data.time.stopMs=(new Date).getTime();this._data.time.totalMs=this._data.time.stopMs-this._data.time.startMs};m.exports=h},{"./Path":14,"./Shared":17}],13:[function(h,m,f){var k,c,a;f=h("./Shared");var b=function(){this.init.apply(this,arguments)};b.prototype.init=
function(b){this._name=b;this._data=new a("__FDB__dc_data_"+this._name);this._collData=new c;this._collections=[]};f.addModule("Overview",b);f.inherit(b.prototype,f.chainReactor);c=h("./Collection");a=h("./Document");h=f.modules.Core;k=f.modules.Core.prototype.init;f.synthesize(b.prototype,"db");f.synthesize(b.prototype,"name");f.synthesize(b.prototype,"query",function(a){var b=this.$super(a);void 0!==a&&this._refresh();return b});f.synthesize(b.prototype,"queryOptions",function(a){var b=this.$super(a);
void 0!==a&&this._refresh();return b});f.synthesize(b.prototype,"reduce",function(a){var b=this.$super(a);void 0!==a&&this._refresh();return b});b.prototype.debug=f.common.debug;b.prototype.objectId=f.common.objectId;b.prototype.from=function(a){void 0!==a&&("string"===typeof a&&(a=this._db.collection(a)),this._addCollection(a));return this};b.prototype.find=function(){return this._collData.find.apply(this._collData,arguments)};b.prototype.count=function(){return this._collData.count.apply(this._collData,
arguments)};b.prototype._addCollection=function(a){-1===this._collections.indexOf(a)&&(this._collections.push(a),a.chain(this),this._refresh());return this};b.prototype._removeCollection=function(a){-1<this._collections.indexOf(a)&&(this._collections.splice(a,1),a.unChain(this),this._refresh());return this};b.prototype._refresh=function(){if(this._collections&&this._collections[0]){this._collData.primaryKey(this._collections[0].primaryKey());var a=[],b;for(b=0;b<this._collections.length;b++)a=a.concat(this._collections[b].find(this._query,
this._queryOptions));this._collData.setData(a)}this._reduce&&(a=this._reduce(),this._data.setData(a))};b.prototype._chainHandler=function(a){switch(a.type){case "setData":case "insert":case "update":case "remove":this._refresh()}};b.prototype.link=function(a,b){this._data.link.apply(this._data,arguments);this._refresh()};b.prototype.unlink=function(a,b){this._data.unlink.apply(this._data,arguments);this._refresh()};b.prototype.isLinked=function(){return this._data.isLinked()};h.prototype.init=function(){this._overview=
{};k.apply(this,arguments)};h.prototype.overview=function(a){return a?(this._overview[a]=this._overview[a]||(new b(a)).db(this),this._overview[a]):this._overview};m.exports=b},{"./Collection":3,"./Document":7,"./Shared":17}],14:[function(h,m,f){h=h("./Shared");f=function(f){this.init.apply(this,arguments)};f.prototype.init=function(f){f&&this.path(f)};h.addModule("Path",f);h.inherit(f.prototype,h.chainReactor);f.prototype.path=function(f){return void 0!==f?(this._path=this.clean(f),this._pathParts=
this._path.split("."),this):this._path};f.prototype.hasObjectPaths=function(f,c){var a=!0,b;for(b in f)if(f.hasOwnProperty(b)&&(void 0===c[b]||"object"===typeof f[b]&&(a=this.hasObjectPaths(f[b],c[b]),!a)))return!1;return a};f.prototype.countKeys=function(f){var c=0,a;for(a in f)f.hasOwnProperty(a)&&void 0!==f[a]&&("object"!==typeof f[a]?c++:c+=this.countKeys(f[a]));return c};f.prototype.countObjectPaths=function(f,c){var a,b={},d=0,e=0,g;for(g in c)c.hasOwnProperty(g)&&("object"===typeof c[g]?(a=
this.countObjectPaths(f[g],c[g]),b[g]=a.matchedKeys,e+=a.totalKeyCount,d+=a.matchedKeyCount):(e++,f&&f[g]&&"object"!==typeof f[g]?(b[g]=!0,d++):b[g]=!1));return{matchedKeys:b,matchedKeyCount:d,totalKeyCount:e}};f.prototype.parse=function(f,c){var a=[],b="",d,e,g;for(e in f)if(f.hasOwnProperty(e))if(b=e,"object"===typeof f[e])if(c)for(d=this.parse(f[e],c),g=0;g<d.length;g++)a.push({path:b+"."+d[g].path,value:d[g].value});else for(d=this.parse(f[e]),g=0;g<d.length;g++)a.push({path:b+"."+d[g].path});
else c?a.push({path:b,value:f[e]}):a.push({path:b});return a};f.prototype.parseArr=function(f,c){c=c||{};return this._parseArr(f,"",[],c)};f.prototype._parseArr=function(f,c,a,b){var d,e="";c=c||"";a=a||[];for(d in f)f.hasOwnProperty(d)&&(!b.ignore||b.ignore&&!b.ignore.test(d))&&(e=c?c+"."+d:d,"object"===typeof f[d]?this._parseArr(f[d],e,a,b):a.push(e));return a};f.prototype.value=function(f,c){if(void 0!==f&&"object"===typeof f){var a,b,d,e,g=[],h;void 0!==c&&(c=this.clean(c),a=c.split("."));a=a||
this._pathParts;b=a.length;d=f;for(h=0;h<b;h++){d=d[a[h]];if(e instanceof Array){for(b=0;b<e.length;b++)g=g.concat(this.value(e,b+"."+a[h]));return g}if(!d||"object"!==typeof d)break;e=d}return[d]}return[]};f.prototype.set=function(f,c,a){if(void 0!==f&&void 0!==c){var b;c=this.clean(c);c=c.split(".");b=c.shift();c.length?(f[b]=f[b]||{},this.set(f[b],c.join("."),a)):f[b]=a}return f};f.prototype.get=function(f,c){return this.value(f,c)[0]};f.prototype.push=function(f,c,a){if(void 0!==f&&void 0!==c){var b;
c=this.clean(c);c=c.split(".");b=c.shift();if(c.length)f[b]=f[b]||{},this.set(f[b],c.join("."),a);else if(f[b]=f[b]||[],f[b]instanceof Array)f[b].push(a);else throw"Cannot push to a path whose endpoint is not an array!";}return f};f.prototype.keyValue=function(f,c){var a,b,d,e,g;void 0!==c&&(c=this.clean(c),a=c.split("."));a=a||this._pathParts;b=a.length;d=f;for(g=0;g<b;g++)if(d=d[a[g]],!d||"object"!==typeof d){e=a[g]+":"+d;break}return e};f.prototype.clean=function(f){"."===f.substr(0,1)&&(f=f.substr(1,
f.length-1));return f};m.exports=f},{"./Shared":17}],15:[function(h,m,f){f=h("./Shared");var k,c,a,b;b=function(){this.init.apply(this,arguments)};b.prototype.init=function(a){a.isClient()&&void 0!==Storage&&this.mode("localStorage")};f.addModule("Persist",b);f.inherit(b.prototype,f.chainReactor);f=f.modules.Core;k=h("./Collection");c=k.prototype.drop;h("./CollectionGroup");a=f.prototype.init;b.prototype.mode=function(a){return void 0!==a?(this._mode=a,this):this._mode};b.prototype.save=function(a,
b,c){switch(this.mode()){case "localStorage":b="object"===typeof b?"json::fdb::"+JSON.stringify(b):"raw::fdb::"+b;try{localStorage.setItem(a,b)}catch(f){if(c)c(f);else throw f;break}if(c)c(!1);else return!1;break;default:if(c)c("No data handler.");else throw"No data handler.";}};b.prototype.load=function(a,b){var c,f;switch(this.mode()){case "localStorage":try{c=localStorage.getItem(a)}catch(h){b(h,null)}if(c){c=c.split("::fdb::");switch(c[0]){case "json":f=JSON.parse(c[1]);break;case "raw":f=c[1]}if(b)b(!1,
f);else return f}break;default:if(b)b("No data handler or unrecognised data type.");else throw"No data handler or unrecognised data type.";}};b.prototype.drop=function(a,b){switch(this.mode()){case "localStorage":try{localStorage.removeItem(a)}catch(c){b&&b(c)}b&&b(!1);break;default:b&&b("No data handler or unrecognised data type.")}};k.prototype.drop=function(a){if(a)if(this._name)if(this._db)this._db.persist.drop(this._name);else return callback&&callback("Cannot drop a collection's persistent storage when the collection is not attached to a database!"),
"Cannot drop a collection's persistent storage when the collection is not attached to a database!";else return callback&&callback("Cannot drop a collection's persistent storage when no name assigned to collection!"),"Cannot drop a collection's persistent storage when no name assigned to collection!";c.apply(this)};k.prototype.save=function(a){if(this._name)if(this._db)this._db.persist.save(this._name,this._data,a);else return a&&a("Cannot save a collection that is not attached to a database!"),"Cannot save a collection that is not attached to a database!";
else return a&&a("Cannot save a collection with no assigned name!"),"Cannot save a collection with no assigned name!"};k.prototype.load=function(a){var b=this;if(this._name)if(this._db)this._db.persist.load(this._name,function(c,f){if(c)return a&&a(c),c;f&&b.setData(f);a&&a(!1)});else return a&&a("Cannot load a collection that is not attached to a database!"),"Cannot load a collection that is not attached to a database!";else return a&&a("Cannot load a collection with no assigned name!"),"Cannot load a collection with no assigned name!"};
f.prototype.init=function(){this.persist=new b(this);a.apply(this,arguments)};m.exports=b},{"./Collection":3,"./CollectionGroup":4,"./Shared":17}],16:[function(h,m,f){h=h("./Shared");f=function(f,c,a){if(f&&c&&a){this._reactorIn=f;this._reactorOut=c;this._chainHandler=a;if(!f.chain||!c.chainReceive)throw"ReactorIO requires passed in and out objects to implement the ChainReactor mixin!";f.chain(this);this.chain(c)}else throw"ReactorIO requires an in, out and process argument to instantiate!";};f.prototype.drop=
function(){this._reactorIn.unChain(this);this.unChain(this._reactorOut);delete this._reactorIn;delete this._reactorOut;delete this._chainHandler};h.addModule("ReactorIO",f);h.inherit(f.prototype,h.chainReactor);m.exports=f},{"./Shared":17}],17:[function(h,m,f){var k=0,c=function(a){var b=[],d,e=["string","object","number","function","undefined"],g;if(-1<a.indexOf("*"))for(g=0;g<e.length;g++)d=a.replace("*",e[g]),b=b.concat(c(d));else b.push(a);return b};f=function(a){if(a){var b,d,e,g,f;if(!(a instanceof
Array)){e={};for(b in a)if(a.hasOwnProperty(b))if(g=b.replace(/ /g,""),-1===g.indexOf("*"))e[g]=a[b];else for(f=c(g),g=0;g<f.length;g++)e[f[g]]||(e[f[g]]=a[b]);a=e}return function(){if(a instanceof Array)for(d=a.length,b=0;b<d;b++){if(a[b].length===arguments.length)return a[b].apply(this,arguments)}else{var e=[],c;for(b=0;b<arguments.length;b++)e.push(typeof arguments[b]);c=e.join(",");if(a[c])return a[c].apply(this,arguments);for(b=e.length;0<=b;b--)if(c=e.slice(0,b).join(","),a[c+",..."])return a[c+
",..."].apply(this,arguments)}throw"Overloaded method does not have a matching signature for the passed arguments!";}}return function(){}};h={modules:{},common:{decouple:function(a){if(void 0!==a)return JSON.parse(JSON.stringify(a))},objectId:function(a){var b=Math.pow(10,17);if(a){var c=0,e=a.length,g;for(g=0;g<e;g++)c+=a.charCodeAt(g)*b;a=c.toString(16)}else k++,a=(k+(Math.random()*b+Math.random()*b+Math.random()*b+Math.random()*b)).toString(16);return a},debug:new f([function(){return this._debug&&
this._debug.all},function(a){return void 0!==a?"boolean"===typeof a?(this._debug=this._debug||{},this._debug.all=a,this.chainSend("debug",this._debug),this):this._debug&&this._debug[a]||this._db&&this._db._debug&&this._db._debug[a]||this._debug&&this._debug.all:this._debug&&this._debug.all},function(a,b){return void 0!==a?void 0!==b?(this._debug=this._debug||{},this._debug[a]=b,this.chainSend("debug",this._debug),this):this._debug&&this._debug[b]||this._db&&this._db._debug&&this._db._debug[a]:this._debug&&
this._debug.all}]),on:new f({"string, function":function(a,b){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||{};this._listeners[a]["*"]=this._listeners[a]["*"]||[];this._listeners[a]["*"].push(b);return this},"string, *, function":function(a,b,c){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||{};this._listeners[a][b]=this._listeners[a][b]||[];this._listeners[a][b].push(c);return this}}),off:new f({string:function(a){this._listeners&&this._listeners[a]&&
a in this._listeners&&delete this._listeners[a];return this},"string, function":function(a,b){var c,e;"string"===typeof b?this._listeners&&this._listeners[a]&&this._listeners[a][b]&&delete this._listeners[a][b]:a in this._listeners&&(c=this._listeners[a]["*"],e=c.indexOf(b),-1<e&&c.splice(e,1));return this},"string, *, function":function(a,b,c){this._listeners&&a in this._listeners&&b in this.listeners[a]&&(a=this._listeners[a][b],c=a.indexOf(c),-1<c&&a.splice(c,1))},"string, *":function(a,b){this._listeners&&
a in this._listeners&&b in this._listeners[a]&&delete this._listeners[a][b]}}),emit:function(a,b){this._listeners=this._listeners||{};if(a in this._listeners){if(this._listeners[a]["*"]){var c=this._listeners[a]["*"],e=c.length,g;for(g=0;g<e;g++)c[g].apply(this,Array.prototype.slice.call(arguments,1))}if(b instanceof Array&&b[0]&&b[0][this._primaryKey]){var c=this._listeners[a],f,h,e=b.length;for(g=0;g<e;g++)if(c[b[g][this._primaryKey]])for(f=c[b[g][this._primaryKey]].length,h=0;h<f;h++)c[b[g][this._primaryKey]][h].apply(this,
Array.prototype.slice.call(arguments,1))}}return this}},_synth:{},addModule:function(a,b){this.modules[a]=b},inherit:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},synthesize:function(a,b,c){this._synth[b]=this._synth[b]||function(a){return void 0!==a?(this["_"+b]=a,this):this["_"+b]};if(c){var e=this;a[b]=function(){var a=this.$super,f;this.$super=e._synth[b];f=c.apply(this,arguments);this.$super=a;return f}}else a[b]=this._synth[b]},overload:f,chainReactor:h("./ChainReactor")};m.exports=
h},{"./ChainReactor":2}],18:[function(h,m,f){var k,c,a,b;f=h("./Shared");var d=function(a,b,c){this.init.apply(this,arguments)};d.prototype.init=function(a,b,c){this._name=a;this._groups=[];this._listeners={};this._querySettings={query:b,options:c};this._debug={};this._privateData=new k("__FDB__view_privateData_"+this._name)};f.addModule("View",d);f.inherit(d.prototype,f.chainReactor);k=h("./Collection");CollectionGroup=h("./CollectionGroup");b=h("./ReactorIO");c=k.prototype.init;h=f.modules.Core;
a=h.prototype.init;f.synthesize(d.prototype,"name");d.prototype.debug=f.common.debug;d.prototype.insert=function(){this._from.insert.apply(this._from,arguments)};d.prototype.update=function(){this._from.update.apply(this._from,arguments)};d.prototype.updateById=function(){this._from.updateById.apply(this._from,arguments)};d.prototype.remove=function(){this._from.remove.apply(this._from,arguments)};d.prototype.find=function(a,b){return this.publicData().find(a,b)};d.prototype.link=function(a,b){var c=
this.publicData();this.debug()&&console.log('ForerunnerDB.View: Setting up data binding on view "'+this.name()+'" in underlying (internal) view collection "'+c.name()+'" for output target: '+a);c.link(a,b);return this};d.prototype.unlink=function(a,b){var c=this.publicData();this.debug()&&console.log('ForerunnerDB.View: Removing data binding on view "'+this.name()+'" in underlying (internal) view collection "'+c.name()+'" for output target: '+a);c.unlink(a,b);return this};d.prototype.isLinked=function(){return this._privateData.isLinked()};
d.prototype.decouple=f.common.decouple;d.prototype.from=function(a){var c=this;if(void 0!==a){"string"===typeof a&&(a=this._db.collection(a));this._from=a;this._io=new b(a,this,function(a){var b,e,d;if("insert"===a.type){if(c._querySettings.query){b=a.data;if(b instanceof Array)for(e=[],a=0;a<b.length;a++)c._privateData._match(b[a],c._querySettings.query,"and")&&(e.push(b[a]),d=!0);else c._privateData._match(b,c._querySettings.query,"and")&&(e=b,d=!0);d&&this.chainSend("insert",e);return!0}return!1}if("update"===
a.type){if(c._querySettings.query&&(e=c._privateData.diff(c._from.subset(c._querySettings.query,c._querySettings.options)),e.insert.length||e.remove.length)){e.insert.length&&this.chainSend("insert",e.insert);if(e.update.length)for(d=c._privateData.primaryKey(),a=0;a<e.update.length;a++)b={},b[d]=e.update[a][d],this.chainSend("update",{query:b,update:e.update[a]});if(e.remove.length){d=c._privateData.primaryKey();b=[];var f={$or:b};for(a=0;a<e.remove.length;a++)b.push({_id:e.remove[a][d]});this.chainSend("remove",
f)}return!0}return!1}});var d=a.find(this._querySettings.query,this._querySettings.options);this._transformPrimaryKey(a.primaryKey());this._transformInsert(d);this._privateData.primaryKey(a.primaryKey());this._privateData.insert(d)}return this};d.prototype.ensureIndex=function(){return this._privateData.ensureIndex.apply(this._privateData,arguments)};d.prototype._chainHandler=function(a){var b,c,d,f;switch(a.type){case "setData":this.debug()&&console.log('ForerunnerDB.View: Setting data on view "'+
this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');a.data=this.decouple(a.data);this._transformSetData(a.data);this._privateData.setData(a.data);break;case "insert":this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');a.data=this.decouple(a.data);a.data instanceof Array||(a.data=[a.data]);b=this._privateData._data.length;this._transformInsert(a.data,
b);this._privateData._insertHandle(a.data,b);this._refreshSort(a.data);break;case "update":this.debug()&&console.log('ForerunnerDB.View: Updating some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');this._privateData.primaryKey();a=this._privateData.update(a.data.query,a.data.update,a.data.options);this._refreshSort(a);if(this._transformEnabled&&this._transformIn)for(b=this._publicData.primaryKey(),f=0;f<a.length;f++)c={},d=a[f],c[b]=d[b],this._transformUpdate(c,
d);break;case "remove":this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"'),this._transformRemove(a.data.query,a.options),this._privateData.remove(a.data.query,a.options)}};d.prototype._refreshSort=function(){this._querySettings.options&&this._querySettings.options.$orderBy&&this._refreshSortAction()};d.prototype._refreshSortAction=function(){var a,b,c,d;delete this._refreshSortDebounce;
a=this._privateData.find({},{$orderBy:this._querySettings.options.$orderBy,$decouple:!1});for(d=0;d<a.length;d++)b=this._privateData._data.indexOf(a[d]),c=a.indexOf(a[d]),b!==c&&this._privateData._updateSpliceMove(this._privateData._data,b,c)};d.prototype.on=function(){this._privateData.on.apply(this._privateData,arguments)};d.prototype.off=function(){this._privateData.off.apply(this._privateData,arguments)};d.prototype.emit=function(){this._privateData.emit.apply(this._privateData,arguments)};d.prototype.drop=
function(){return this._from?((this.debug()||this._db&&this._db.debug())&&console.log("ForerunnerDB.View: Dropping view "+this._name),this._io.drop(),this._privateData.drop(),!0):!1};d.prototype.db=function(a){return void 0!==a?(this._db=a,this.privateData().db(a),this.publicData().db(a),this):this._db};d.prototype.primaryKey=function(){return this._privateData.primaryKey()};d.prototype.queryData=function(a,b,c){void 0!==a&&(this._querySettings.query=a);void 0!==b&&(this._querySettings.options=b);
return void 0!==a||void 0!==b?(void 0!==c&&!0!==c||this.refresh(),this):this._querySettings};d.prototype.queryAdd=function(a,b,c){var d=this._querySettings.query,f;if(void 0!==a)for(f in a)a.hasOwnProperty(f)&&(void 0===d[f]||void 0!==d[f]&&b)&&(d[f]=a[f]);void 0!==c&&!0!==c||this.refresh()};d.prototype.queryRemove=function(a,b){var c=this._querySettings.query,d;if(void 0!==a)for(d in a)a.hasOwnProperty(d)&&delete c[d];void 0!==b&&!0!==b||this.refresh()};d.prototype.query=function(a,b){return void 0!==
a?(this._querySettings.query=a,void 0!==b&&!0!==b||this.refresh(),this):this._querySettings.query};d.prototype.queryOptions=function(a,b){return void 0!==a?(this._querySettings.options=a,void 0===a.$decouple&&(a.$decouple=!0),void 0!==b&&!0!==b||this.refresh(),this):this._querySettings.options};d.prototype.refresh=function(){if(this._from){var a=this.publicData();this._privateData.remove();a.remove();this._privateData.insert(this._from.find(this._querySettings.query,this._querySettings.options))}return this};
d.prototype.count=function(){return this._privateData&&this._privateData._data?this._privateData._data.length:0};d.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this._transformEnabled=a.enabled),void 0!==a.dataIn&&(this._transformIn=a.dataIn),void 0!==a.dataOut&&(this._transformOut=a.dataOut)):this._transformEnabled=!1===a?!1:!0,this._transformPrimaryKey(this.privateData().primaryKey()),this._transformSetData(this.privateData().find()),this):{enabled:this._transformEnabled,
dataIn:this._transformIn,dataOut:this._transformOut}};d.prototype.privateData=function(){return this._privateData};d.prototype.publicData=function(){return this._transformEnabled?this._publicData:this._privateData};d.prototype._transformSetData=function(a){this._transformEnabled&&(this._publicData=new k("__FDB__view_publicData_"+this._name),this._publicData.db(this._privateData._db),this._publicData.transform({enabled:!0,dataIn:this._transformIn,dataOut:this._transformOut}),this._publicData.setData(a))};
d.prototype._transformInsert=function(a,b){this._transformEnabled&&this._publicData&&this._publicData.insert(a,b)};d.prototype._transformUpdate=function(a,b,c){this._transformEnabled&&this._publicData&&this._publicData.update(a,b,c)};d.prototype._transformRemove=function(a,b){this._transformEnabled&&this._publicData&&this._publicData.remove(a,b)};d.prototype._transformPrimaryKey=function(a){this._transformEnabled&&this._publicData&&this._publicData.primaryKey(a)};k.prototype.init=function(){this._views=
[];c.apply(this,arguments)};k.prototype.view=function(a,b,c){if(this._db&&this._db._views){if(this._db._views[a])throw"Cannot create a view using this collection because one with this name already exists: "+a;a=(new d(a,b,c)).db(this._db)._addCollection(this);this._views=this._views||[];this._views.push(a);return a}};k.prototype._addView=CollectionGroup.prototype._addView=function(a){void 0!==a&&this._views.push(a);return this};k.prototype._removeView=CollectionGroup.prototype._removeView=function(a){void 0!==
a&&(a=this._views.indexOf(a),-1<a&&this._views.splice(a,1));return this};h.prototype.init=function(){this._views={};a.apply(this,arguments)};h.prototype.view=function(a){this._views[a]||(this.debug()||this._db&&this._db.debug())&&console.log("Core.View: Creating view "+a);this._views[a]=this._views[a]||(new d(a)).db(this);return this._views[a]};h.prototype.viewExists=function(a){return Boolean(this._views[a])};h.prototype.views=function(){var a=[],b;for(b in this._views)this._views.hasOwnProperty(b)&&
a.push({name:b,count:this._views[b].count()});return a};m.exports=d},{"./Collection":3,"./CollectionGroup":4,"./ReactorIO":16,"./Shared":17}],19:[function(h,m,f){window.jQuery&&(this.jQuery=window.jQuery,function(){(function(f,c,a){function b(a,b){for(var c in b.props)B.test(c)&&(a[c]=b.props[c])}function d(a){return a}function e(a){debugger;return a}function g(a){P=(Ca._dbgMode=a)?"Unavailable (nested view): use #getIndex()":"";La("dbg",Ma.dbg=za.dbg=a?e:d)}function h(a){this.name=(t.link?"JsViews":
"JsRender")+" Error";this.message=a||this.name}function m(a,b){for(var c in b)a[c]=b[c];return a}function ea(a){return"function"===typeof a}function Ka(a,b,c){if(!Da.rTag||a)Q=a?a.charAt(0):Q,J=a?a.charAt(1):J,u=b?b.charAt(0):u,N=b?b.charAt(1):N,X=c||X,a="\\"+Q+"(\\"+X+")?\\"+J,b="\\"+u+"\\"+N,O="(?:(?:(\\w+(?=[\\/\\s\\"+u+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+u+"]|\\"+u+"(?!\\"+N+"))*?)",Da.rTag=O+")",O=RegExp(a+O+"(\\/)?|(?:\\/(\\w+)))"+b,"g"),A=RegExp("<.*>|([^\\\\]|^)[{}]|"+
a+".*"+b);return[Q,J,u,N,X]}function aa(b,c){c||(c=b,b=a);var d,e,f,g;f=this;d=!c||"root"===c;if(b){if(g=f.type===c?f:a,!g)if(d=f.views,f._.useKey)for(e in d){if(g=d[e].get(b,c))break}else for(e=0,f=d.length;!g&&e<f;e++)g=d[e].get(b,c)}else if(d)for(;f.parent.parent;)g=f=f.parent;else for(;f&&!g;)g=f.type===c?f:a,f=f.parent;return g}function fa(){var b=this.get("item");return b?b.index:a}function ba(){return this.index}function n(b){var c,d=this,e=d.linkCtx,g=(d.ctx||{})[b];g===a&&e&&e.ctx&&(g=e.ctx[b]);
g===a&&(g=Ma[b]);g&&ea(g)&&!g._wrp&&(c=function(){return g.apply(this&&this!==f?this:d,arguments)},c._wrp=!0,m(c,g));return c||g}function p(c,d,e,f){var g,h,k=+e===e&&d.tmpl.bnds[e-1],r=d.linkCtx;e=(f=f!==a&&{props:{},args:[f]})||(k?k(d.data,d,H):e);h=e.args[0];if(c||k)g=r&&r.tag,g||(g={_:{inline:!r,bnd:k},tagName:":",cvt:c,flow:!0,tagCtx:e,_is:"tag"},r&&(r.tag=g,g.linkCtx=r,e.ctx=I(e.ctx,r.view.ctx)),Da._lnk(g)),g._er=f&&h,b(g,e),e.view=d,g.ctx=e.ctx||{},delete e.ctx,d._.tag=g,h=q(g,g.convert||"true"!==
c&&c)[0],h=k&&d._.onRender?d._.onRender(h,d,k):h,d._.tag=a;return h!=a?h:""}function q(a,b){var c=a.tagCtx,d=c.view,e=c.args;b=b&&(""+b===b?d.getRsc("converters",b)||da("Unknown converter: '"+b+"'"):b);e=e.length||c.index?b?e.slice():e:[d.data];b&&(b.depends&&(a.depends=Da.getDeps(a.depends,a,b.depends,b)),e[0]=b.apply(a,e));return e}function l(b,c){for(var d,e=this;d===a&&e;)d=(d=e.tmpl[b])&&d[c],e=e.parent;return d||H[b][c]}function qa(c,d,e,f,g,h){var k,r,l,z,E,D,G,p,t,n="",v=d.linkCtx||0,R=d.ctx,
u=e||d.tmpl,s=+f===f&&u.bnds[f-1];"tag"===c._is&&(k=c,c=k.tagName,f=k.tagCtxs);k=k||v.tag;f=(h=h!==a&&(n+=h,[{props:{},args:[]}]))||(s?s(d.data,d,H):f);D=f.length;for(E=0;E<D;E++){E||e&&k||(p=d.getRsc("tags",c)||da("Unknown tag: {{"+c+"}}"));r=f[E];if(!v.tag||k._er)e=r.tmpl,e=r.content=e&&u.tmpls[e-1],m(r,{tmpl:(k?k:p).template||e,render:oa,index:E,view:d,ctx:I(r.ctx,R)});if(e=r.props.tmpl)e=""+e===e?d.getRsc("templates",e)||S(e):e,r.tmpl=e;k||(p._ctr?(k=new p._ctr,t=!!k.init):Da._lnk(k={render:p.render}),
k._={inline:!v},v&&(v.tag=k,k.linkCtx=v),(k._.bnd=s||v.fn)?k._.arrVws={}:k.dataBoundOnly&&da("{^{"+c+"}} tag must be data-bound"),k.tagName=c,k.parent=z=R&&R.tag,k._is="tag",k._def=p,k.tagCtxs=f);r.tag=k;k.dataMap&&k.tagCtxs&&(r.map=k.tagCtxs[E].map);k.flow||(G=r.ctx=r.ctx||{},r=k.parents=G.parentTags=R&&I(G.parentTags,R.parentTags)||{},z&&(r[z.tagName]=z),r[k.tagName]=G.tag=k)}d._.tag=k;if(!(k._er=h)){b(k,f[0]);k.rendering={};for(E=0;E<D;E++){r=k.tagCtx=k.tagCtxs[E];z=r.props;c=q(k,k.convert);if(f=
z.dataMap||k.dataMap)if(c.length||z.dataMap){h=r.map;if(!h||h.src!==c[0]||g)h&&h.src&&h.unmap(),h=r.map=f.map(c[0],z);c=[h.tgt]}k.ctx=r.ctx;!E&&t&&(f=k.template,k.init(r,v,k.ctx),t=a,k.template!==f&&(k._.tmpl=k.template),v&&(v.attr=k.attr=v.attr||k.attr));f=a;k.render&&(f=k.render.apply(k,c));c=c.length?c:[d];f=f!==a?f:r.render(c[0],!0)||(g?a:"");n=n?n+(f||""):f}delete k.rendering}k.tagCtx=k.tagCtxs[0];k.ctx=k.tagCtx.ctx;k._.inline&&(l=k.attr)&&l!==x&&(n="text"===l?za.html(n):"");return s&&d._.onRender?
d._.onRender(n,d,s):n}function s(a,b,c,d,e,f,g,h){var k="array"===b,r={key:0,useKey:k?0:1,id:""+V++,onRender:h,bnds:{}};this.data=d;this.tmpl=e;this.content=g;this.views=k?[]:{};this.parent=c;this.type=b||"top";this._=r;this.linked=!!h;c?(b=c.views,d=c._,d.useKey?(b[r.key="_"+d.useKey++]=this,this.index=P,this.getIndex=fa,f=d.tag,r.bnd=k&&(!f||!!f._.bnd&&f)):b.splice(r.key=this.index=f,0,this),this.ctx=a||c.ctx):this.ctx=a}function ca(a){var b,c,d,e,f,g;for(b in Pa)if(e=Pa[b],(f=e.compile)&&(c=a[b+
"s"]))for(d in c)(e=c[d]=f(d,c[d],a))&&(g=Da.onStore[b])&&g(d,e,f)}function na(b,c,d){ea(c)?c={depends:c.depends,render:c}:(c.baseTag&&(c.flow=!!c.flow,c=m(m({},c.baseTag),c)),(b=c.template)!==a&&(c.template=""+b===b?S[b]||S(b):b),!1!==c.init&&(b=c._ctr=function(){},(b.prototype=c).constructor=b));d&&(c._parentTmpl=d);return c}function xa(b,d,e,g){function h(d){if(""+d===d||0<d.nodeType){try{l=0<d.nodeType?d:!A.test(d)&&c&&c(f.document).find(d)[0]}catch(r){}l&&(d=S[b=b||l.getAttribute(Y)],d||(b=b||
"_"+ia++,l.setAttribute(Y,b),d=S[b]=xa(b,l.innerHTML,e,g)),l=a);return d}}var r,l;d=d||"";r=h(d);g=g||(d.markup?d:{});g.tmplName=b;e&&(g._parentTmpl=e);!r&&d.markup&&(r=h(d.markup))&&r.fn&&(r.debug!==d.debug||r.allowCode!==d.allowCode)&&(r=r.markup);if(r!==a)return b&&!e&&(Na[b]=function(){return d.render.apply(d,arguments)}),r.fn||d.fn?r.fn&&(d=b&&b!==r.tmplName?I(g,r):r):(d=ka(r,g),Ia(r.replace(W,"\\$&"),d)),ca(g),d}function Qa(a){function b(c,d){this.tgt=a.getTgt(c,d)}ea(a)&&(a={getTgt:a});a.baseMap&&
(a=m(m({},a.baseMap),a));a.map=function(a,c){return new b(a,c)};return a}function ka(a,b){var c,d=Ca.wrapMap||{},e=m({markup:a,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:Z},b);b.htmlTag||(c=ab.exec(a),e.htmlTag=c?c[1].toLowerCase():"");(c=d[e.htmlTag])&&c!==d.div&&(e.markup=t.trim(e.markup));return e}function ua(b,c){function d(f,g,h){var k,r,l;if(f&&"object"===typeof f&&!f.nodeType&&!f.markup&&!f.getTgt){for(r in f)d(r,f[r],g);return H}g===a&&(g=f,f=a);f&&""+f!==f&&(h=g,g=f,f=a);l=h?
h[e]=h[e]||{}:d;r=c.compile;null===g?f&&delete l[f]:(g=r?g=r(f,g,h):g,f&&(l[f]=g));r&&g&&(g._is=b);g&&(k=Da.onStore[b])&&k(f,g,r);return g}var e=b+"s";H[e]=d;Pa[b]=c}function Fa(a,b,c){var d=this.jquery&&(this[0]||da('Unknown template: "'+this.selector+'"')),e=d.getAttribute(Y);return Z.call(e?S[e]:S(d),a,b,c)}function Aa(a,b,c){if(Ca._dbgMode)try{return a.fn(b,c,H)}catch(d){return da(d,c)}return a.fn(b,c,H)}function Z(a,b,c,d,e,f){return d||!this.fn._nvw||t.isArray(a)?oa.call(this,a,b,c,d,e,f):Aa(this,
a,{tmpl:this})}function oa(b,c,d,e,f,g){var h,k,r,l,z,E,m,D,q;r=this;var G="";!!c===c&&(d=c,c=a);!0===f&&(h=!0,f=0);r.tag?(E=r,r=r.tag,k=r._,z=r.tagName,D=k.tmpl||E.tmpl,q=r.attr&&r.attr!==x,c=I(c,r.ctx),m=E.content,!1===E.props.link&&(c=c||{},c.link=!1),e=e||E.view,b=arguments.length?b:e):D=r;if(D&&(!e&&b&&"view"===b._is&&(e=b),e&&(m=m||e.content,g=g||e._.onRender,b===e&&(b=e.data),c=I(c,e.ctx)),e&&"top"!==e.type||((c=c||{}).root=b),D.fn||(D=S[D]||S(D)),D)){E=g=!1!==(c&&c.link)&&!q&&g;!0===g&&(E=
a,g=e._.onRender);c=D.helpers?I(D.helpers,c):c;if(t.isArray(b)&&!d)for(l=h?e:f!==a&&e||new s(c,"array",e,b,D,f,m,g),h=0,k=b.length;h<k;h++)r=b[h],z=new s(c,"item",l,r,D,(f||0)+h,m,g),r=Aa(D,r,z),G+=l._.onRender?l._.onRender(r,z):r;else{if(e||!D.fn._nvw)l=h?e:new s(c,z||"data",e,b,D,f,m,g),k&&!r.flow&&(l.tag=r);G+=Aa(D,b,l)}return E?E(G,l):G}return""}function da(a,b,c){c=Ca.onError(a,b,c);if(""+a===a)throw new Da.Err(c);return!b.linkCtx&&b.linked?za.html(c):c}function la(a){da("Syntax error\n"+a)}
function Ia(a,b,c,d){function e(b){(b-=m)&&q.push(a.substr(m,b).replace(C,"\\n"))}function f(b){b&&la('Unmatched or missing tag: "{{/'+b+'}}" in template:\n'+a)}var g,h,k,l=b&&b.allowCode,z=[],m=0,G=[],q=z,v=[,,z];c&&(a=Q+a+N);f(G[0]&&G[0][2].pop()[0]);a.replace(O,function(g,r,z,D,I,n,p,t,R,u,s,T){n&&(I=":",D=x);u=u||c;r=(r||c)&&[[]];var sa="",pa="",M="",L="",Ja="",Ba="",Oa="",Sa="";p=!u&&!I&&!p;z=z||(R=R||"#data",I);e(T);m=T+g.length;t?l&&q.push(["*","\n"+R.replace(y,"$1")+"\n"]):z?("else"===z&&
(ga.test(R)&&la('for "{{else if expr}}" use "{{else expr}}"'),r=v[7],v[8]=a.substring(v[8],T),v=G.pop(),q=v[2],p=!0),R&&(E(R.replace(C," "),r,b).replace(U,function(a,b,c,d,e,f,g,T){g?(pa+=f+",",L+="'"+T+"',"):c?(M+=d+f+",",Ba+=d+"'"+T+"',"):b?Oa+=f:("trigger"===e&&(Sa+=f),sa+=d+f+",",Ja+=d+"'"+T+"',",k=k||B.test(e));return""}).slice(0,-1),r&&r[0]&&r.pop()),h=[z,D||!!d||k||"",p&&[],[L.slice(0,-1),Ja.slice(0,-1),Ba.slice(0,-1)],[pa.slice(0,-1),sa.slice(0,-1),M.slice(0,-1)],Oa,Sa,r||0],q.push(h),p&&
(G.push(v),v=h,v[8]=m)):s&&(f(s!==v[0]&&"else"!==v[0]&&s),v[8]=a.substring(v[8],T),v=G.pop());f(!v&&s);q=v[2]});e(a.length);(m=z[z.length-1])&&f(""+m!==m&&+m[8]===m[8]&&m[0]);c?(g=D(z,a,c),r(g,z[0][7])):g=D(z,b);g._nvw&&(g._nvw=!/[~#]/.test(a));return g}function r(a,b){a.deps=[];for(var c in b)"_jsvto"!==c&&b[c].length&&(a.deps=a.deps.concat(b[c]));a.paths=b}function z(a,b){return"\n\t"+(b?b+":{":"")+"args:["+a[0]+"]"+(a[1]||!b?",\n\tprops:{"+a[1]+"}":"")+(a[2]?",\n\tctx:{"+a[2]+"}":"")}function E(a,
b,c){var d,e,f,g,h,k=b&&b[0],r=0,l=c?c.links:k&&(k.links=k.links||{}),z={},E={0:-1},m=0;return(a+(c?" ":"")).replace(/\)\^/g,").").replace(ja,function(D,G,q,v,p,I,n,R,t,s,x,A,T,sa,pa,M,L,Ja,Ba,Oa){function Sa(a,c,g,T,sa,h,pa,M){return g&&(k&&("linkTo"===d&&(e=b._jsvto=b._jsvto||[],e.push(p)),d&&!f||k.push(p.slice(c.length))),"."!==g)?(a=(T?'view.hlp("'+T+'")':sa?"view":"data")+(M?(h?"."+h:T?"":sa?"":"."+g)+(pa||""):(M=T?"":sa?h||"":g,"")),a+=M?"."+M:"",c+("view.data"===a.slice(0,9)?a.slice(5):a)):
a}I=I||"";q=q||G||A;p=p||t;s=s||L||"";t=Oa.length-1;if(!n||h||g)return!k||!M||h||g||d&&!f&&!e||(M=E[m],t>Ba-M&&(M=Oa.slice(M,Ba+1),M=J+":"+M+u,n=l[M],n||(l[M]=!0,l[M]=n=Ia(M,c||k,!0),n.paths.push({_jsvOb:n})),!0!==n&&(e||k).push({_jsvOb:n}))),h?(h=!T,h?D:'"'):g?(g=!sa,g?D:'"'):(q?(m++,E[m]=Ba++,q):"")+(Ja?m?"":(r=Oa.slice(r,Ba),d?(d=f=e=!1,"\b"):"\b,")+r+(r=Ba+D.length,k&&b.push(k=[]),"\b"):R?(m&&la(a),k&&b.pop(),d=p,f=v,r=Ba+D.length,v&&(k=b[d]=[]),p+":"):p?p.split("^").join(".").replace(ma,Sa)+
(s?(z[++m]=!0,"."!==p.charAt(0)&&(E[m]=Ba),s):I):I?I:pa?(z[m--]=!1,pa)+(s?(z[++m]=!0,s):""):x?(z[m]||la(a),","):G?"":(h=T,g=sa,'"'));la(a)})}function D(b,c,d){var e,f,g,h,k,l,m,E,G,q,v,p,n,I,R,t,s,u,A,O,J,N,H,T,sa,pa,M=0,L="",Ja={},Ba=b.length;""+c===c?(u=d?'data-link="'+c.replace(C," ").slice(1,-1)+'"':c,c=0):(u=c.tmplName||"unnamed",c.allowCode&&(Ja.allowCode=!0),c.debug&&(Ja.debug=!0),v=c.bnds,s=c.tmpls);for(e=0;e<Ba;e++)if(f=b[e],""+f===f)L+='\n+"'+f+'"';else if(g=f[0],"*"===g)L+=";\n"+f[1]+"\nret=ret";
else{h=f[1];J=f[2];k=z(f[3],"params")+"},"+z(n=f[4]);T=f[5];pa=f[6];R=f[8];(I="else"===g)||(M=0,v&&(p=f[7])&&(M=v.push(p)));(f=":"===g)?h&&(g=h===x?">":h+g):(J&&(A=ka(R,Ja),A.tmplName=u+"/"+g,D(J,A),s.push(A)),I||(O=g,N=L,L=""),A=(A=b[e+1])&&"else"===A[0]);sa=T?";\ntry{\nret+=":"\n+";R=I="";if(f&&(p||pa||h&&h!==x)){H="return {"+k+"};";t='c("'+h+'",view,';H=new Function("data,view,j,u"," // "+u+" "+M+" "+g+"\n"+H);H._er=T;I=t+M+",";R=")";H._tag=g;if(d)return H;r(H,p);q=!0}L+=f?(d?(T?"\ntry{\n":"")+
"return ":sa)+(q?(q=a,G=E=!0,t+(p?(v[M-1]=H,M):"{"+k+"}")+")"):">"===g?(m=!0,"h("+n[0]+")"):"((v="+n[0]+')!=null?v:"")'):(G=l=!0,"\n{view:view,tmpl:"+(J?s.length:"0")+","+k+"},");if(O&&!A){L="["+L.slice(0,-1)+"]";t='t("'+O+'",view,this,';if(d||p){L=new Function("data,view,j,u"," // "+u+" "+M+" "+O+"\nreturn "+L+";");L._er=T;L._tag=g;p&&r(v[M-1]=L,p);if(d)return L;I=t+M+",undefined,";R=")"}L=N+sa+t+(M||L)+")";O=p=0}T&&(G=!0,L+=";\n}catch(e){ret"+(d?"urn ":"+=")+I+"j._err(e,view,"+T+")"+R+";}\n"+(d?
"":"ret=ret"))}L="// "+u+"\nvar v"+(l?",t=j._tag":"")+(E?",c=j._cnvt":"")+(m?",h=j.converters.html":"")+(d?";\n":',ret=""\n')+(Ja.debug?"debugger;":"")+L+(d?"\n":";\nreturn ret;");try{L=new Function("data,view,j,u",L)}catch(Oa){la("Compiled template code:\n\n"+L+'\n: "'+Oa.message+'"')}c&&(c.fn=L);G||(L._nvw=!0);return L}function I(a,b){return a&&a!==b?b?m(m({},b),a):a:b&&m({},b)}function v(a){return ha[a]||(ha[a]="&#"+a.charCodeAt(0)+";")}function R(a){var b,c,d=[];if("object"===typeof a)for(b in a)(c=
a[b])&&c.toJSON&&!c.toJSON()||ea(c)||d.push({key:b,prop:c});return d}function G(a){return null!=a?ta.test(a)&&(""+a).replace(Ra,v)||a:""}if(!(c&&c.render||f.jsviews)){var t,va,O,A,P,Q="{",J="{",u="}",N="}",X="^",ma=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,ja=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^|\s*$)|[)\]])([([]?))|(\s+)/g,
C=/[ \t]*(\r\n|\n|\r)/g,y=/\\(['"])/g,W=/['"\\]/g,U=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,ga=/^if\s/,ab=/<(\w+)[>\s]/,ta=/[\x00`><\"'&]/,B=/^on[A-Z]|^convert(Back)?$/,Ra=/[\x00`><"'&]/g,ia=0,V=0,ha={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},x="html",Y="data-jsv-tmpl",Na={},Pa={template:{compile:xa},tag:{compile:na},helper:{},converter:{}},H={jsviews:"v1.0.0-beta",settings:function(a){m(Ca,a);g(Ca._dbgMode);Ca.jsv&&Ca.jsv()},
sub:{View:s,Err:h,tmplFn:Ia,cvt:q,parse:E,extend:m,syntaxErr:la,onStore:{},_lnk:d,_ths:b},map:Qa,_cnvt:p,_tag:qa,_err:da};(h.prototype=Error()).constructor=h;fa.depends=function(){return[this.get("item"),"index"]};ba.depends=function(){return["index"]};s.prototype={get:aa,getIndex:ba,getRsc:l,hlp:n,_is:"view"};for(va in Pa)ua(va,Pa[va]);var S=H.templates,za=H.converters,Ma=H.helpers,La=H.tags,Da=H.sub,Ca=H.settings;c?(t=c,t.fn.render=Fa,t.observable&&(m(Da,t.views.sub),H.map=t.views.map)):(t=f.jsviews=
{},t.isArray=Array&&Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)});t.render=Na;t.views=H;t.templates=S=H.templates;Ca({debugMode:g,delimiters:Ka,onError:function(b,c,d){c&&(b=d===a?"{Error: "+b+"}":ea(d)?d(b,c):d);return b==a?"":b},_dbgMode:!0});La({"else":function(){},"if":{render:function(a){return this.rendering.done||!a&&(arguments.length||!this.tagCtx.index)?"":(this.rendering.done=!0,this.selected=this.tagCtx.index,this.tagCtx.render(this.tagCtx.view,
!0))},onUpdate:function(a,b,c){var d;for(a=0;(d=this.tagCtxs[a])&&d.args.length;a++)if(d=d.args[0],b=!d!==!c[a].args[0],!this.convert&&d||b)return b;return!1},flow:!0},"for":{render:function(b){var c,d=this.tagCtx,e="",f=0;if(!this.rendering.done){if(c=!arguments.length)b=d.view.data;b!==a&&(e+=d.render(b,c),f+=t.isArray(b)?b.length:1);if(this.rendering.done=f)this.selected=d.index}return e},flow:!0},include:{flow:!0},"*":{render:d,flow:!0}});La("props",{baseTag:La["for"],dataMap:Qa(R)});za({html:G,
attr:G,url:function(b){return b!=a?encodeURI(""+b):null===b?b:""}});Ka()}})(this,this.jQuery);(function(f,c,a){function b(a){return s(a)?new e(a):new d(a)}function d(a){this._data=a;return this}function e(a){this._data=a;return this}function g(a,b){a=s(a)?a:[a];var c,d,e=b,f=e,h=a.length,k=[];for(c=0;c<h;c++)d=a[c],Z(d)?k=k.concat(g(d.call(b,b),b)):""+d!==d?(b=f=d,f!==e&&k.push(e=f)):(f!==e&&k.push(e=f),k.push(d));return k}function h(a,b){var c,d;for(c in a){d=!0;break}d||delete Fa[b]}function m(b,
c){if(!b.data||!b.data.off){var d,e,f,g,h,k=c.oldValue,l=c.value,q=b.data,p=q.observeAll,n=!q.cb.noArray,P=q.paths;if(b.type===ua)(q.cb.array||q.cb).call(q,b,c);else if(q.prop===c.path||"*"===q.prop)g=typeof k===na&&(P[0]||n&&s(k)),h=typeof l===na&&(P[0]||n&&s(l)),p?(d=p._path+"."+c.path,e=p.filter,f=[b.target].concat(p.parents()),g&&aa(n,p.ns,[k],P,q.cb,!0,e,[f],d),h&&aa(n,p.ns,[l],P,q.cb,a,e,[f],d)):(g&&aa(n,[k],P,q.cb,!0),h&&aa(n,[l],P,q.cb)),q.cb(b,c)}}function ea(){function d(a,b,e,f){var g,
h=la(x),k=s(x)?[x]:x;a=ga?a+"."+ga:a;if(O||f)h&&c(k).off(a,m);else{if(u=h&&c._data(x))for(Q=(u=(u=u&&u.events)&&u[e?ua:ka])&&u.length;Q--;)if((J=u[Q].data)&&J.cb._cId===A._cId&&J.ns===ga){if(e)return;("*"===b&&J.prop!==b||J.prop===n)&&c(x).off(a,m)}b=e?{}:{fullPath:t,paths:b?[b]:[],prop:n};b.ns=ga;b.cb=A;W&&(b.observeAll={_path:W,path:function(){g=y.length;return W.replace(/[[.]/g,function(a){g--;return"["===a?"["+c.inArray(y[g-1],y[g]):"."})},parents:function(){return y},filter:U,ns:ga});c(k).on(a,
null,b,m);ma&&(ma[c.data(x,"obId")||c.data(x,"obId",oa++)]=x)}}function e(a,b){a._ob=N(a,ha);var c=ha;return function(d,e){var g=a._ob,h=b.length;typeof g===na&&(f(g,!0),(h||B&&s(g))&&aa(B,[g],b,A,N,!0));g=a._ob=N(a,c);typeof g===na&&(f(g),(h||B&&s(g))&&aa(B,[g],b,A,N,[c]));A(d,e)}}function f(c,e,g,h){if(B){var k=x,l=W;x=c;h&&(x=c[h],W+="."+h);U&&x&&(x=b._fltr(W,x,h?[c].concat(y):y,U));x&&(g||s(x))&&d(ua+".observe"+(A?".obs"+(P=A._cId=A._cId||da++):""),a,!0,e);x=k;W=l}}var k,l,q,p,n,t,ca,O,A,P,Q,
J,u,N,X,ma,ja,C,y,W,U,ga,ba,ea,B=!1!=this,fa=!0,ia=Aa,V=Array.apply(0,arguments);k=V.pop();var ha=V.shift(),x=C=ha,Y=V.length;ha+""===ha&&B&&(ga=ha,ha=x=C=V.shift(),Y--);if(Z(k))A=k;else if(k+""===k&&(W=k,y=V.pop(),U=V.pop(),k=V.pop(),Y-=3),!0===k?O=k:k&&(ha=k,fa=a),k=V[Y-1],Y&&k===a||Z(k))A=V.pop(),Y--;Y&&Z(V[Y-1])&&(N=A,A=V.pop(),Y--);ia+=O?A?".obs"+A._cId:"":".obs"+(P=A._cId=A._cId||da++);O||(ma=Fa[P]=Fa[P]||{});ba=ga&&ga.match(Qa)||[""];for(ea=ba.length;ea--;)for(ga=ba[ea],s(C)?f(C,O,!0):O&&0===
Y&&C&&d(ia,""),k=ja=0;k<Y;k++)if(t=V[k],""!==t){x=C;if(""+t===t){p=t.split("^");p[1]&&(ja=p[0].split(".").length,t=p.join("."),ja=t.split(".").length-ja);if(N&&(X=N(t,C))){Y+=X.length-1;qa.apply(V,[k--,1].concat(X));continue}p=t.split(".")}else fa&&!Z(t)&&(t&&t._jsvOb&&(C=e(t,V.slice(k+1)),C.noArray=!B,C._cId=A._cId,aa(B,[ha],V.slice(0,k),C,N),C=a,t=t._ob),x=t),C=t,p=[C];for(;x&&(n=p.shift())!==a;)if(typeof x===na){if(""+n===n){if(""===n)continue;if(p.length<ja+1&&!x.nodeType){if(!O&&(u=la(x)&&c._data(x))){Q=
(u=(u=u.events)&&u[ka])&&u.length;for(q=0;Q--;)!(J=u[Q].data)||J.cb!==A||J.ns!==ga||J.prop!==n&&"*"!==J.prop||((l=p.join("."))&&J.paths.push(l),q++);if(q){x=x[n];continue}}if("*"===n){!O&&u&&u.length&&d(ia,"",!1,!0);Z(x)?(ca=x.depends)&&aa(B,[ca],A,O||ha):d(ia,"");for(l in x)f(x,O,a,l);break}else n&&d(ia+"."+n,p.join("^"))}W&&(W+="."+n);n=x[n]}if(Z(n)){(ca=n.depends)&&aa(B,[x],g(ca,x),A,N,O||[ha]);break}x=n}f(x,O)}P&&h(ma,P);return{cbId:P,bnd:ma}}function Ka(){[].push.call(arguments,!0);return ea.apply(this,
arguments)}function aa(){var a=[].concat.apply([],arguments);return ea.apply(a.shift(),a)}function fa(a,b,c,d){a+""!==a&&(c=b,b=a,a="");n(a,this._data,b,c,[],"root",d)}function ba(a,b,c){fa.call(this,a,b,c,!0)}function n(c,d,e,f,g,h,k){function l(a,b){p=a.length;Q=[[a]].concat(Q);for(P=h+"[]";p--;)m(a,p,b,1)}function m(d,g,h,k){var l;g!==ca&&(l=b._fltr(P,d[g],Q,f))&&n(c,l,e,f||(k?a:0),Q.slice(),P,h)}function q(a,b){var c=g;h=a.data.observeAll._path;Q=[a.target].concat(g);switch(b.change){case "insert":l(b.items);
break;case "remove":l(b.items,!0);break;case "refresh":l(b.oldItems,!0);l(a.target);break;case "set":P=h+"."+b.path,m(b,"oldValue",!0),m(b,"value")}e.apply(this,arguments);g=c}var p,A,P,Q;if(typeof d===na){A=s(d)?"":"*";if(e){if(A||0!==f)q._cId=e._cId=e._cId||da++,ea(c,d,A,q,k,f,g,h)}else ea(c,d,A,a,k,f,g,h);if(A)for(p in Q=[d].concat(g),d)P=h+"."+p,m(d,p,k);else l(d,k)}}function p(a){return 0>a.indexOf(".")&&0>a.indexOf("[")}if(!c)throw"jsViews/jsObservable require jQuery";if(!c.observable){f=c.views=
c.views||{jsviews:"v1.0.0-alpha",sub:{}};var q=f.sub,l=c.event.special,qa=[].splice,s=c.isArray,ca=c.expando,na="object",xa=parseInt,Qa=/\S+/g,ka=q.propChng=q.propChng||"propertyChange",ua=q.arrChng=q.arrChng||"arrayChange",Fa=q._cbBnds=q._cbBnds||{},Aa=ka+".observe",Z=c.isFunction,oa=1,da=1,la=c.hasData,Ia={};q.getDeps=function(){var a=arguments;return function(){for(var b,c,d=[],e=a.length;e--;)b=a[e--],(c=a[e])&&(d=d.concat(Z(c)?c(b,b):c));return d}};c.observable=b;b._fltr=function(a,b,c,d){if(d&&
Z(d)?d(a,b,c):1)return b=Z(b)?b.set&&b.call(c[0]):b,typeof b===na&&b};b.Object=d;b.Array=e;c.observe=b.observe=ea;c.unobserve=b.unobserve=Ka;b._apply=aa;d.prototype={_data:null,observeAll:fa,unobserveAll:ba,data:function(){return this._data},setProperty:function(b,c,d){var e,f=this._data;b=b||"";if(f)if(s(b))for(e=b.length;e--;)c=b[e],this.setProperty(c.name,c.value,d===a||d);else if(""+b!==b)for(e in b)this.setProperty(e,b[e],c);else if(b!==ca){for(b=b.split(".");f&&1<b.length;)f=f[b.shift()];f&&
this._setProperty(f,b[0],c,d)}return this},removeProperty:function(a){this.setProperty(a,Ia);return this},_setProperty:function(b,c,d,e){var f,g,h,k=c?b[c]:b;Z(k)&&k.set&&(g=k,f=!0===k.set?k:k.set,k=k.call(b));if(k!==d||e&&k!=d)if(!(k instanceof Date)||k>d||k<d)f?(f.call(b,d),d=g.call(b)):(h=d===Ia)?(delete b[c],d=a):c&&(b[c]=d),this._trigger(b,{change:"set",path:c,value:d,oldValue:k,remove:h})},_trigger:function(a,b){c(a).triggerHandler(ka,b)}};e.prototype={_data:null,observeAll:fa,unobserveAll:ba,
data:function(){return this._data},insert:function(a,b){var c=this._data;1===arguments.length&&(b=a,a=c.length);a=xa(a);-1<a&&a<=c.length&&(b=s(b)?b:[b],b.length&&this._insert(a,b));return this},_insert:function(a,b){var c=this._data,d=c.length;qa.apply(c,[a,0].concat(b));this._trigger({change:"insert",index:a,items:b},d)},remove:function(b,c){var d;d=this._data;b===a&&(b=d.length-1);b=xa(b);c=c?xa(c):0===c?0:1;-1<c&&-1<b&&(d=d.slice(b,b+c),(c=d.length)&&this._remove(b,c,d));return this},_remove:function(a,
b,c){var d=this._data,e=d.length;d.splice(a,b);this._trigger({change:"remove",index:a,items:c},e)},move:function(a,b,c){c=c?xa(c):0===c?0:1;a=xa(a);b=xa(b);if(0<c&&-1<a&&-1<b&&a!==b){var d=this._data.slice(a,a+c);(c=d.length)&&this._move(a,b,c,d)}return this},_move:function(a,b,c,d){var e=this._data,f=e.length;e.splice(a,c);e.splice.apply(e,[b,0].concat(d));this._trigger({change:"move",oldIndex:a,index:b,items:d},f)},refresh:function(a){var b=this._data.slice();this._refresh(b,a);return this},_refresh:function(a,
b){var c=this._data,d=c.length;qa.apply(c,[0,c.length].concat(b));this._trigger({change:"refresh",oldItems:a},d)},_trigger:function(a,b){var d=this._data,e=d.length,d=c([d]);d.triggerHandler(ua,a);e!==b&&d.triggerHandler(ka,{change:"set",path:"length",value:e,oldValue:b})}};l[ka]=l[ua]={remove:function(a){var b,d,e,f,g=a.data;if(g&&(g.off=!0,g=g.cb)&&(b=Fa[g._cId])){a=c._data(this).events[a.type];for(e=a.length;e--&&!d;)d=(f=a[e].data)&&f.cb===g;d||(delete b[c.data(this,"obId")],h(b,g._cId))}}};f.map=
function(d){function e(c,f,g){var h,k=this;this.src&&this.unmap();"object"===typeof c&&(k.src=c,k.tgt=g||k.tgt||[],k.options=f||k.options,k.update(),d.obsSrc&&b(k.src).observeAll(k.obs=function(b,c){h||(h=!0,d.obsSrc(k,b,c),h=a)},k.srcFlt),d.obsTgt&&b(k.tgt).observeAll(k.obt=function(b,c){h||(h=!0,d.obsTgt(k,b,c),h=a)},k.tgtFlt))}Z(d)&&(d={getTgt:d});d.baseMap&&(d=c.extend({},d.baseMap,d));d.map=function(a,b,c){return new e(a,b,c)};(e.prototype={srcFlt:d.srcFlt||p,tgtFlt:d.tgtFlt||p,update:function(a){b(this.tgt).refresh(d.getTgt(this.src,
this.options=a||this.options))},unmap:function(){this.src&&(this.obs&&b(this.src).unobserveAll(this.obs,this.srcFlt),this.obt&&b(this.tgt).unobserveAll(this.obt,this.tgtFlt),this.src=a)},map:e,_def:d}).constructor=e;return d}}})(this,this.jQuery);(function(f,c,a){function b(b,d,e){var f,g,h,k,l,p,q,r,n,F=b.target,s=F._jsvBnd,w=/&(\d+)\+?/g;if(s)for(;h=w.exec(s);)if(h=Ea[h[1]])if(d=h.to){h=h.linkCtx;q=h.view;n=h.tag;p=c(F);l=q.hlp(Y);r=q.hlp(Na);g=m(F);f=Va[g];e===a&&(e=ga(g)?g(F):f?p[f]():p.attr(g));
f=d[1];d=d[0];f&&(k=ga(f)?f:q.getRsc("converters",f));k&&(e=k.call(n,e));f=q.linkCtx;q.linkCtx=h;g={change:"change",oldValue:h._val,value:e};if(!(l&&!1===l.call(h,b,g)||n&&n.onBeforeChange&&!1===n.onBeforeChange(b,g)||e===a)&&(l=d[0],e!==a&&l)){l=l._jsvOb?l._ob:l;n&&(n._.chging=!0);B(l).setProperty(d[2]||d[1],e);r&&r.call(h,b,g);if(n){if(n.onAfterChange)n.onAfterChange(b,g);delete n._.chging}h._val=e}q.linkCtx=f}}function d(b,d,f){var g,h,k,l,q,p=this.tag,n=this.data,r=this.elem;k=this.convert;var p=
r.parentNode,s=this.view,F=s.linkCtx,t=s.hlp(Y);s.linkCtx=this;if(p&&!(t&&d&&!1===t.call(this,b,d)||d&&"*"!==b.data.prop&&b.data.prop!==d.path)){d&&(this.eventArgs=d);if(d||this._initVal){delete this._initVal;if(f._er)try{h=f(n,s)}catch(w){l=f._er,q=P(w,s,(new Function("data,view","return "+l+";"))(n,s)),h=[{props:{},args:[q]}]}else h=f(n,s,C);a:{var x=h,u=p=this.tag;g=this.attr||m(r,!0,k!==a);var v,A,z=u&&u.parentElem||this.elem;if(x!==a){A=c(z);g=u&&u.attr||g;ga(x)&&P(this.expr+": missing parens");
if(u=/^css-/.test(g)&&g.slice(4))v=c.style(z,u),+x===x&&(v=parseInt(v));else if("link"!==g){if("value"===g)z.type===S&&(v=A.prop(g=H));else if(g===za)if(z.value===""+x)v=A.prop(H);else break a;v===a&&(v=(v=Va[g])?A[v]():A.attr(g))}this._val=v}}if(p){k=l||p._er;h=h[0]?h:[h];f=!k&&d&&p.onUpdate&&!1===p.onUpdate(b,d,h);Fa(p,h,k);if(f||g===Ma){g===ra&&p.onBeforeLink&&p.onBeforeLink();xa(p,p.tagCtx);aa(this,n,r);s.linkCtx=F;return}if(p._.chging)return;h=":"===p.tagName?C._cnvt(p.cvt,s,h[0]):C._tag(p,s,
s.tmpl,h,!0,q)}else f._tag&&(h=(k=""===k?La:k)?C._cnvt(k,s,h[0]||h):C._tag(f._tag,s,s.tmpl,h,!0,q),p=this.tag,g=this.attr||g);e(h,this,g,p)&&d&&(t=s.hlp(Na))&&t.call(this,b,d);p&&(p._er=l,xa(p,p.tagCtx))}aa(this,n,r);s.linkCtx=F}}function e(b,d,e,g){var h,l,m,p,q,n,s=b!==a,t=d.data,F=g&&g.parentElem||d.elem,v=c(F),w=d.view;n=d._val;var x=w.linkCtx,u=g||e===ra;g&&(g.parentElem=g.parentElem||d.expr||g._elCnt?F:F.parentNode,l=g._prv,m=g._nxt);if(s){"visible"===e&&(e="css-display");if(/^css-/.test(e))"visible"===
d.attr&&(d=(F.currentStyle||hb.call(f,F,"")).display,b?(b=F._jsvd||d,b!==Ma||(b=db[h=F.nodeName])||(d=ja.createElement(h),ja.body.appendChild(d),b=db[h]=(d.currentStyle||hb.call(f,d,"")).display,ja.body.removeChild(d))):(F._jsvd=d,b=Ma)),(u=u||n!==b)&&c.style(F,e.slice(4),b);else if("link"!==e){if(e===H)q=!0,b=b&&"false"!==b;else if(e===za)if(F.value===""+b)b=q=!0,e=H;else{aa(d,t,F);return}else if("selected"===e||"disabled"===e||"multiple"===e||"readonly"===e)b=b&&"false"!==b?e:null;if(h=Va[e])if(e===
ra){w.linkCtx=d;if(g&&g._.inline){e=g.nodes(!0);if(g._elCnt){if(l&&l!==m)r(l,m,F,g._tgId,"^",!0);else if(p=F._dfr)n=g._tgId+"^",h=p.indexOf("#"+n)+1,q=p.indexOf("/"+n),h&&0<q&&(h+=n.length,q>h&&(F._dfr=p.slice(0,h)+p.slice(q),z(p.slice(h,q))));l=l?l.previousSibling:m?m.previousSibling:F.lastChild}c(e).remove();if(g&&g.onBeforeLink)g.onBeforeLink();p=w.link(w.data,F,l,m,b,g&&{tag:g._tgId,lazyLink:g.tagCtx.props.lazyLink})}else{s&&v.empty();if(g&&g.onBeforeLink)g.onBeforeLink();s&&(p=w.link(t,F,l,m,
b,g&&{tag:g._tgId}))}w.linkCtx=x}else{if(u=u||n!==b)if("text"===e&&F.children&&!F.children[0])F.textContent!==a?F.textContent=b:F.innerText=null===b?"":b;else v[h](b)}else if(u=u||n!==b)v[q?"prop":"attr"](e,b!==a||q?b:null);d._val=b}return p||u}if(e===ra&&g&&g.onBeforeLink)g.onBeforeLink()}function g(a,b){var c=this.hlp(Y),d=this.hlp(Na);if(!c||!1!==c.call(this,a,b)){if(b){var c=b.index,e=b.items;switch(b.change){case "insert":this.addViews(c,e);break;case "remove":this.removeViews(c,e.length);break;
case "move":this.refresh();break;case "refresh":this.refresh()}}d&&d.call(this,a,b)}}function h(b){var d,e=b.type,f=b.data,k=b._.bnd;if(!b._.useKey&&k){if(d=b._.bndArr)c([d[1]]).off(ha,d[0]),b._.bndArr=a;k!==!!k&&k._.inline?e?k._.arrVws[b._.id]=b:delete k._.arrVws[b._.id]:e&&f&&(d=function(a){a.data&&a.data.off||g.apply(b,arguments)},c([f]).on(ha,d),b._.bndArr=[d,f])}}function m(a,b,c){var d=a.nodeName.toLowerCase(),e=W.merge[d]||a.contentEditable===La&&{to:ra,from:ra};return e?b?"input"===d&&a.type===
za?za:e.to:e.from:b?c?"text":ra:""}function ea(b,d,e,f,g,h,k){var l,m,p,q=b.parentElem,n=b._prv,s=b._nxt,t=b._elCnt;n&&n.parentNode!==q&&P("Missing parentNode");if(k)for(p in m=b.nodes(),t&&n&&n!==s&&r(n,s,q,b._.id,"_",!0),b.removeViews(a,a,!0),f=s,t&&(n=n?n.previousSibling:s?s.previousSibling:q.lastChild),c(m).remove(),b._.bnds)Z(p);else{if(d){l=f[d-1];if(!l)return!1;n=l._nxt}t?n=(f=n)?f.previousSibling:q.lastChild:f=n.nextSibling}d=e.render(g,h,b._.useKey&&k,b,k||d,!0);b.link(g,q,n,f,d,l)}function Ka(b,
c,d){var e;d?(e="^`",c=c._.tag,d=c._tgId,d||(Ea[d=eb++]=c,c._tgId=""+d)):(e="_`",ma[d=c._.id]=c);return"#"+d+e+(b!=a?b:"")+"/"+d+e}function aa(b,c,d){var e,f=b.tag,g=b.convertBack,h=[],k=b._bndId||""+eb++,l=b._hdlr;delete b._bndId;f&&(h=f.depends||h,h=ga(h)?f.depends(f):h,e=f.linkedElem);if(!b._depends||""+b._depends!==""+h)if(b._depends&&B._apply(!1,[c],b._depends,l,!0),c=B._apply(!1,[c],b.fn.deps,h,l,b._ctxCb),c.elem=d,c.linkCtx=b,c._tgId=k,d._jsvBnd=d._jsvBnd||"",d._jsvBnd+="&"+k,b._depends=h,
b.view._.bnds[k]=k,Ea[k]=c,e&&(c.to=[[],g]),(e||g!==a)&&ua(c,f&&f.convertBack||g),f){if(f.onAfterBind)f.onAfterBind(c);f.flow||f._.inline||(d.setAttribute(ia,(d.getAttribute(ia)||"")+"#"+k+"^/"+k+"^"),f._tgId=""+k)}if(e&&e[0])for(f._.radio&&(e=e.children("input[type=radio]")),b=e.length;b--;)e[b]._jsvBnd=e[b]._jsvBnd||d._jsvBnd+"+",e[b]._jsvLkEl=f}function fa(a,b,c,d,e,f,g){return ba(this,a,b,c,d,e,f,g)}function ba(d,e,f,g,h,k,l,m){if(d&&e){e=e.jquery?e:c(e);v||(v=ja.body,c(v).on(x,b).on("blur","[contenteditable]",
b));for(var n,q,r,t,F,u,w,A,z=Ka,C=g&&"replace"===g.target,E=e.length;E--;)if(w=e[E],""+d===d)p(d,w,R(w),a,!0,f,g);else{k=k||R(w);if(d.markup!==a)!1===k.link&&(g=g||{},g.link=z=!1),C&&(u=w.parentNode),r=d.render(f,g,h,k,a,z),u?(l=w.previousSibling,m=w.nextSibling,c.cleanData([w],!0),u.removeChild(w),w=u):(l=m=a,c(w).empty());else if(!0===d&&k===X)A={lnk:1};else break;if(w._dfr&&!m){t=s(w._dfr,!0,fb);n=0;for(q=t.length;n<q;n++)F=t[n],(F=ma[F.id])&&F.data!==a&&F.parent.removeViews(F._.key,a,!0);w._dfr=
""}k.link(f,w,l,m,r,A,g)}}return e}function n(b,d,e,f,k,m,n,q){function r(b,c,d,e,f,g,h,T,sa,l,pa,m,M){var p,n="";if(M)return F=0,b;w=T||sa||"";e=e||l;d=d||m;ka&&!d&&(e||w||g)&&(ka=a,S=oa.shift());if(e=e||d)F=0,ka=a,ha&&(d||m?$a[S]||/;svg;|;math;/.test(";"+oa.join(";")+";")||(p="'<"+S+".../"):$a[e]?p="'</"+e:oa.length&&e===S||(p="Mismatch: '</"+e),p&&Xa(p+">' in:\n"+k)),ra=ya,S=oa.shift(),ya=Za[S],l=l?"</"+l+">":"",ra&&(wa+=Ga,Ga="",ya?wa+="-":(n=l+Ca+"@"+wa+Da+(pa||""),wa=Ia.shift()));ya?(g?Ga+=
g:c=l||m||"",w&&(c+=w,Ga&&(c+=" "+ia+'="'+Ga+'"',Ga=""))):c=g?c+n+f+Ca+g+Da+h+w:n||b;F&&g&&Xa(" No {^{ tags within elem markup ("+F+' ). Use data-link="..."');w&&(F=w,oa.unshift(S),S=w.slice(1),oa[0]&&oa[0]===mb[S]&&P("Parent of <tr> must be <tbody>"),ka=$a[S],(ya=Za[S])&&!ra&&(Ia.unshift(wa),wa=""),ra=ya,wa&&ya&&(wa+="+"));return c}function t(b,c){var e,f,k,T,pa=[];if(b){"@"===b._tkns.charAt(0)&&(c=K.previousSibling,K.parentNode.removeChild(K),K=a);for(G=b.length;G--;){B=b[G];k=B.ch;if(e=B.path)for(D=
e.length-1;f=e.charAt(D--);)"+"===f?"-"===e.charAt(D)?(D--,c=c.previousSibling):c=c.parentNode:c=c.lastChild;if("^"===k){if(w=Ea[e=B.id]){f=c&&(!K||K.parentNode!==c);if(!K||f)w.parentElem=c;B.elCnt&&f&&(c._dfr=(B.open?"#":"/")+e+k+(c._dfr||""));pa.push([f?null:K,B])}}else if(y=ma[e=B.id])(y.parentElem||(y.parentElem=c||K&&K.parentNode||d,y._.onRender=Ka,y._.onArrayChange=g,h(y)),f=y.parentElem,B.open)?(y._elCnt=B.elCnt,c&&!K?c._dfr="#"+e+k+(c._dfr||""):(y._prv||(f._dfr=l(f._dfr,"#"+e+k)),y._prv=K)):
(!c||K&&K.parentNode===c?K&&(y._nxt||(f._dfr=l(f._dfr,"/"+e+k)),y._nxt=K):(c._dfr="/"+e+k+(c._dfr||""),y._nxt=a),z=y.linkCtx,(T=y.ctx&&y.ctx.onAfterCreate||Ma)&&T.call(z,y))}for(G=pa.length;G--;)va.push(pa[G])}return!b||b.elCnt}function v(a){var b,c;if(a)for(G=a.length,D=0;D<G;D++)if(B=a[D],U.id)U.id=U.id!==B.id&&U.id;else if(c=w=Ea[B.id].linkCtx.tag,!w.flow){if(!ba){for(b=1;c=c.parent;)b++;fa=fa||b}!ba&&b!==fa||ea&&w.tagName!==ea||Z.push(w)}}function x(){H=Ya?d.querySelectorAll(u):c(u,d).get();E=
H.length;e&&e.innerHTML&&(O=Ya?e.querySelectorAll(u):c(u,e).get(),e=O.length?O[O.length-1]:e);for(C=fa=0;C<E;C++)if(K=H[C],e&&!Aa)Aa=K===e;else if(f&&K===f)break;else K.parentNode&&(za&&(B=s(K,a,gb))&&(B=B[0])&&(ta=ta?B.id!==ta&&ta:B.open&&B.id),!ta&&Na(s(K,a,Z&&qb))&&!U&&K.getAttribute(Q)&&va.push([K]));k===a&&d.getAttribute(Q)&&va.push([d]);ca(e,ya);ca(f,ya);if(!U){if(ya&&wa+Ga&&(K=f,wa&&(f?t(s(wa+"+",!0),f):t(s(wa,!0),d)),t(s(Ga,!0),d),f)){Ha=f.getAttribute(ia);if(E=Ha.indexOf(ua)+1)Ha=Ha.slice(E+
ua.length-1);f.setAttribute(ia,Ga+Ha)}E=va.length;for(C=0;C<E;C++)if(K=va[C],J=K[1],K=K[0],J){if(w=Ea[J.id]){if(z=w.linkCtx)w=z.tag,w.linkCtx=z;J.open?(K&&(w.parentElem=K.parentNode,w._prv=K),w._elCnt=J.elCnt,!w||w.onBeforeLink&&!1===w.onBeforeLink()||w._.bound||(w._.bound=!0,y=w.tagCtx.view,p(a,w._prv,y,J.id)),w._.linking=!0):(w._nxt=K,w._.linking&&(ga=w.tagCtx,y=ga.view,delete w._.linking,w._.bound||(w._.bound=!0,p(a,w._prv,y,J.id)),xa(w,ga)))}}else p(K.getAttribute(Q),K,R(K),a,za,b,n)}qa&&qa.resolve()}
var F,z,w,C,E,D,G,H,K,y,B,J,O,I,Y,X,V,Z,ba,ea,ga,ha,fa,U,aa,da,S,ka,la,Ha,ya,ra,Ga,ua,Aa,ta,qa,za,Fa=this._.id+"_",wa="",va=[],oa=[],Ia=[],Ma=this.hlp(Pa),Na=t;m&&(qa=m.lazyLink&&c.Deferred(),m.tmpl?Y="/"+m._.id+"_":(za=m.lnk,U=m.get,m.tag&&(Fa=m.tag+"^",m=!0)),m=!0===m);U&&(Na=v,Z=U.tags,ba=U.deep,ea=U.name);d=d?""+d===d?c(d)[0]:d.jquery?d[0]:d:this.parentElem||ja.body;ha=!W.noValidate&&d.contentEditable!==La;S=d.tagName.toLowerCase();ya=!!Za[S];e=e&&na(e,ya);f=f&&na(f,ya)||null;if(k!=a){la=aa=ja.createElement("div");
ua=Ga="";da="http://www.w3.org/2000/svg"===d.namespaceURI?"svg_ns":(I=kb.exec(k))&&I[1]||"";A&&I&&I[2]&&P("Unsupported: "+I[2]);if(ya){for(V=f;V&&!(X=s(V));)V=V.nextSibling;if(Ha=X?X._tkns:d._dfr){I=Y||"";if(m||!Y)I+="#"+Fa;D=Ha.indexOf(I);D+1&&(D+=I.length,ua=Ga=Ha.slice(0,D),Ha=Ha.slice(D),X?V.setAttribute(ia,Ha):d._dfr=Ha)}}ka=a;k=(""+k).replace(ob,r);ha&&oa.length&&Xa("Mismatched '<"+S+"...>' in:\n"+k);if(q)return;cb.appendChild(aa);da=N[da]||N.div;m=da[0];for(la.innerHTML=da[1]+k+da[2];m--;)la=
la.lastChild;cb.removeChild(aa);for(aa=ja.createDocumentFragment();da=la.firstChild;)aa.appendChild(da);d.insertBefore(aa,f)}qa?setTimeout(x,0):x();return qa&&qa.promise()}function p(b,d,e,f,g,h,k){var l,p,n,r,s,u,v;if(f)g=Ea[f],g=g.linkCtx?g.linkCtx.tag:g,u=g.linkCtx||{data:e.data,elem:g._elCnt?g.parentElem:d,view:e,ctx:e.ctx,attr:ra,fn:g._.bnd,tag:g,_bndId:f},q(u,u.fn);else if(b&&d)for(h=g?h:e.data,f=e.tmpl,p=m(d),b=c.trim(b).replace(lb,"\\$&"),b=b.slice(-1)!==va?t+":"+b+(p?":":"")+va:b,G.lastIndex=
0;l=G.exec(b);)v=G.lastIndex,p=l[1],s=l[3],r=l[10],n=a,u={data:h,elem:d,view:e,ctx:k,attr:p,isLk:g,_initVal:!l[2]},l[6]&&(!p&&(n=/:([\w$]*)$/.exec(r))&&(n=n[1],n!==a&&(r=-n.length-1,s=s.slice(0,r-1)+va)),null===n&&(n=a),u.convert=l[5]||""),u.expr=p+s,(l=f.links[s])||(f.links[s]=l=y.tmplFn(s,f,!0,n)),u.fn=l,p||n===a||(u.convertBack=n),q(u,l),G.lastIndex=v}function q(b,c){function e(a,f){d.call(b,a,f,c)}e.noArray=!0;b.isLk&&(b.view=new y.View(b.ctx,"link",X,b.data,X.tmpl,a,a,Ka));b._ctxCb=la(b.view);
b._hdlr=e;e(!0)}function l(a,b){var c;return a?(c=a.indexOf(b),c+1?a.slice(0,c)+a.slice(c+b.length):a):""}function qa(a){return a&&(""+a===a?a:"SCRIPT"===a.tagName?a.type.slice(3):1===a.nodeType&&a.getAttribute(ia)||"")}function s(a,b,c){function d(a,b,c,g,h,k){f.push({elCnt:e,id:g,ch:h,open:b,close:c,path:k,token:a})}var e,f=[];if(b=b?a:qa(a))return f.elCnt=!a.type,e="@"===b.charAt(0)||!a.type,f._tkns=b,b.replace(c||rb,d),f}function ca(a,b){a&&("jsv"===a.type?a.parentNode.removeChild(a):b&&""===
a.getAttribute(Q)&&a.removeAttribute(Q))}function na(a,b){for(var c=a;b&&c&&1!==c.nodeType;)c=c.previousSibling;c&&(1!==c.nodeType?(c=ja.createElement("SCRIPT"),c.type="jsv",a.parentNode.insertBefore(c,a)):qa(c)||c.getAttribute(Q)||c.setAttribute(Q,""));return c}function xa(b,d){var e,f,g,h,k,l,m;e=d.view;var p=b.linkCtx=b.linkCtx||{tag:b,data:e.data,view:e,ctx:e.ctx};if(b.onAfterLink)b.onAfterLink(d,p);if(f=(e=b.targetTag?b.targetTag.linkedElem:b.linkedElem)&&e[0]){if(g=b._.radio)e=e.children("input[type=radio]");
if(g||!b._.chging){h=y.cvt(b,b.convert)[0];if(g||f!==p.elem){for(m=e.length;m--;){f=e[m];k=f._jsvLkEl;if(b._.inline&&(!k||k!==b&&k.targetTag!==b))for(f._jsvLkEl=b,k=p.elem?p.elem._jsvBnd:b._prv._jsvBnd,f._jsvBnd=k+"+",k=k.slice(1).split("&"),l=k.length;l--;)ua(Ea[k[l]],b.convertBack);g&&(f[H]=h===f.value)}p._val=h}h!==a&&(g||f.value===a?f.contentEditable===La&&(f.innerHTML=h):f.type===S?f[H]=h&&"false"!==h:e.val(h))}}if(f=f||":"===b.tagName&&p.elem)g=f._jsvTr,h=d.props.trigger,g!==h&&(f._jsvTr=h,
e=e||c(f),ka(e,g,"off"),ka(e,h,"on"))}function Qa(a){setTimeout(function(){b(a)},0)}function ka(a,c,d){c&&a[d](!0===c?"keydown":c,!0===c?Qa:b)}function ua(a,b){var c,d,e,f,g,h=a.linkCtx,k=h.data,l=h.fn.paths;if(a&&l){for(d=(l=(c=l._jsvto)||l[0])&&l.length;d&&""+(f=l[--d])!==f;);!f||h.tag&&!h.tag.tagCtx.args.length?a.to=[[],b]:(f=f.split("^").join("."),a.to="."===f.charAt(0)?[[g=l[d-1],f.slice(1)],b]:[h._ctxCb(e=d?l[0].split("^").join("."):f)||[k,e],b],c&&g&&(a.to[0][0]=h._ctxCb(g,k)))}}function Fa(a,
b,c){var d;d=a.tagCtx.view;var e=a.tagCtxs||[a.tagCtx],f=e.length,g=!b;b=b||a._.bnd.call(d.tmpl,(a.linkCtx||d).data,d,C);if(c)e=a.tagCtxs=b,a.tagCtx=e[0];else for(;f--;)c=e[f],d=b[f],B(c.props).setProperty(d.props),U(c.ctx,d.ctx),c.args=d.args,g&&(c.tmpl=d.tmpl);y._ths(a,e[0]);return e}function Aa(a){for(var b,c,d=[],e=b=a.length;e--;)d.push(a[e]);for(e=b;e--;)if(b=d[e],b.parentNode){if(c=b._jsvBnd)for(c=c.slice(1).split("&"),b._jsvBnd="",a=c.length;a--;)Z(c[a],b._jsvLkEl,b);z(qa(b)+(b._dfr||""))}}
function Z(b,d,e){var f,g,h,k=Ea[b];if(d)e===d.linkedElem[0]&&(delete e._jsvLkEl,delete d.linkedElem);else if(k){delete Ea[b];for(f in k.bnd)d=k.bnd[f],e=".obs"+k.cbId,c.isArray(d)?c([d]).off(ha+e).off(V+e):c(d).off(V+e),delete k.bnd[f];if(f=k.linkCtx){if(d=f.tag){if(e=d.tagCtxs)for(g=e.length;g--;)(h=e[g].map)&&h.unmap();if(g=(e=(h=d.linkedElem)&&h[0]||f.elem)&&e._jsvTr)ka(h||c(e),g,"off"),e._jsvTr=a;if(d.onDispose)d.onDispose();d._elCnt||(d._prv&&d._prv.parentNode.removeChild(d._prv),d._nxt&&d._nxt.parentNode.removeChild(d._nxt))}delete f.view._.bnds[b]}delete y._cbBnds[k.cbId]}}
function oa(d,e){d===a?(v&&(c(v).off(x,b).off("blur","[contenteditable]",b),v=a),d=!0,X.removeViews(),Aa(ja.body.getElementsByTagName("*"))):e&&!0===d&&(e=e.jquery?e:c(e),e.each(function(){for(var b;(b=R(this,!0))&&b.parent;)b.parent.removeViews(b._.key,a,!0);Aa(this.getElementsByTagName("*"));Aa([this])}));return e}function da(a,b){return oa(this,a,b)}function la(a){return function(b,c){var d,e,f=[c];if(a&&b){if(b._jsvOb)return b._jsvOb.call(a.tmpl,c,a,C);if("~"===b.charAt(0)){if("~tag"===b.slice(0,
4)&&(e=a.ctx,"."===b.charAt(4)&&(d=b.slice(5).split("."),e=e.tag),d))return e?[e,d.join("."),c]:[];b=b.slice(1).split(".");if(c=a.hlp(b.shift()))b.length&&f.unshift(b.join(".")),f.unshift(c);return c?f:[]}if("#"===b.charAt(0))return"#data"===b?[]:[a,b.replace(nb,""),c]}}}function Ia(a){return a.type===S?a[H]:a.value}function r(a,b,c,d,e,f){var g,h,k,m,p,n,q=0,r=a===b;if(a){k=s(a)||[];g=0;for(h=k.length;g<h;g++){m=k[g];n=m.id;if(n===d&&m.ch===e)if(f)h=0;else break;r||(p="_"===m.ch?ma[n]:Ea[n].linkCtx.tag,
m.open?p._prv=b:m.close&&(p._nxt=b));q+=n.length+2}q&&a.setAttribute(ia,a.getAttribute(ia).slice(q));a=b?b.getAttribute(ia):c._dfr;if(h=a.indexOf("/"+d+e)+1)a=k._tkns.slice(0,q)+a.slice(h+(f?-1:d.length+1));a&&(b?b.setAttribute(ia,a):c._dfr=a)}else c._dfr=l(c._dfr,"#"+d+e),f||b||(c._dfr=l(c._dfr,"/"+d+e))}function z(b){var c,d,e;if(e=s(b,!0,pb))for(b=0,c=e.length;b<c;b++)d=e[b],"_"===d.ch?(d=ma[d.id])&&d.type&&d.parent.removeViews(d._.key,a,!0):Z(d.id)}function E(a,b,c){if("set"===c.change){a=a.tgt;
for(b=a.length;b--&&a[b].key!==c.path;);-1===b?c.path&&B(a).insert({key:c.path,prop:c.value}):c.remove?B(a).remove(b):B(a[b]).setProperty("prop",c.value)}}function D(a,b,c){a=a.src;var d=c.change;"set"===d?"prop"===c.path?B(a).setProperty(b.target.key,c.value):(B(a).setProperty(c.oldValue,null),delete a[c.oldValue],B(a).setProperty(c.value,b.target.prop)):"remove"===d?(b=c.items[0],B(a).removeProperty(b.key),delete a[b.key]):"insert"===d&&(b=c.items[0],b.key&&B(a).setProperty(b.key,b.prop))}function I(a){return 0>
a.indexOf(".")}var v,R,G,t,va,O,A,P,Q,J,u,N,X,ma,ja=f.document,C=c.views,y=C.sub,W=C.settings,U=y.extend,ga=c.isFunction,ab=C.converters,ta=C.tags,B=c.observable,Ra=B.observe,ia="data-jsv",V=y.propChng=y.propChng||"propertyChange",ha=y.arrChng=y.arrChng||"arrayChange",x="change.jsv",Y="onBeforeChange",Na="onAfterChange",Pa="onAfterCreate",H="checked",S="checkbox",za="radio",Ma="none",La="true",Da='">\x3c/script>',Ca='<script type="jsv',Ua="script,["+ia+"]",ra="html",Va={value:"val",input:"val",html:ra,
text:"text"},bb={from:"value",to:"value"},Wa=0,ib=c.cleanData,jb=W.delimiters,Xa=y.syntaxErr,kb=/<(?!script)(\w+)(?:[^>]*(on\w+)\s*=)?[^>]*>/,lb=/['"\\]/g,cb=ja.createDocumentFragment(),Ya=ja.querySelector,Za={ol:1,ul:1,table:1,tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1,svg:1,svg_ns:1},mb={tr:"table"},$a={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,param:1,source:1,track:1,wbr:1},db={},Ea={},eb=1,nb=/^#(view\.?)?/,ob=/(^|(\/>)|<\/(\w+)>|)(\s*)([#\/]\d+[_^])`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|<\/(\w+)>(\s*)|(\/>)\s*|(>))/g,
fb=/(#)()(\d+)(_)/g,pb=/(#)()(\d+)([_^])/g,gb=/(?:(#)|(\/))(\d+)(_)/g,qb=/(#)()(\d+)(\^)/g,rb=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g,hb=f.getComputedStyle;if(!c)throw"JsViews requires jQuery";if(!C)throw"JsViews requires JsRender";if(!B)throw"JsViews requires jquery.observable";c.link||(J={contents:function(b,d){b!==!!b&&(d=b,b=a);var e,f=c(this.nodes());f[0]&&(e=d?f.filter(d):f,f=b&&d?e.add(f.find(d)):e);return f},nodes:function(a,b,c){var d=this._elCnt,e=!b&&d,f=[];b=b||this._prv;c=c||this._nxt;
for(b=e?b===this._nxt?this.parentElem.lastSibling:b:!1===this._.inline?b||this.linkCtx.elem.firstChild:b&&b.nextSibling;b&&(!c||b!==c);)(a||d||"SCRIPT"!==b.tagName)&&f.push(b),b=b.nextSibling;return f},childTags:function(b,c){b!==!!b&&(c=b,b=a);var d=this.link?this:this.tagCtx.view,e=this._prv,f=this._elCnt,g=[];e&&d.link(a,this.parentElem,f?e.previousSibling:e,this._nxt,a,{get:{tags:g,deep:b,name:c,id:f&&this._tgId}});return g},refresh:function(b){var c,d=this.linkCtx,f=this.tagCtx.view;this.disposed&&
P("Removed tag");b===a&&(b=C._tag(this,f,f.tmpl,Fa(this),!0));b+""===b&&(c=this._.inline?ra:d.attr||m(this.parentElem,!0),c=e(b,d,c,this));xa(this,this.tagCtx);return c||this},update:function(c){var d=this.linkedElem;d&&b({target:d[0]},a,c)}},y.onStore.template=function(a,b){b.link=fa;b.unlink=da;a&&(c.link[a]=function(){return fa.apply(b,arguments)},c.unlink[a]=function(){return da.apply(b,arguments)})},y.onStore.tag=function(a,b){y._lnk(b)},y._lnk=function(a){return U(a,J)},y.viewInfos=s,(W.delimiters=
function(){var a=jb.apply(C,arguments);t=a[1];va=a[2];O=a[4];G=RegExp("(?:^|\\s*)([\\w-]*)(\\"+O+")?(\\"+t+y.rTag+"\\"+va+")","g");return this})(),U(y._lnk(y.View.prototype),{addViews:function(a,b,c){var d,e=b.length,f=this.views;if(!this._.useKey&&e&&(c=this.tmpl)&&(d=f.length+e,!1!==ea(this,a,c,f,b,this.ctx)))for(a+=e;a<d;a++)B(f[a]).setProperty("index",a);return this},removeViews:function(b,d,e){function f(b){var d,g,k,l,p,n=m[b];if(n&&n.link){b=n._.id;e||(p=n.nodes());n.removeViews(a,a,!0);n.type=
a;k=n._prv;l=n._nxt;g=n.parentElem;e||(n._elCnt&&r(k,l,g,b,"_"),c(p).remove());if(!n._elCnt)try{k.parentNode.removeChild(k),l.parentNode.removeChild(l)}catch(q){}h(n);for(d in n._.bnds)Z(d);delete ma[b]}}var g,k,l=!this._.useKey,m=this.views;l&&(k=m.length);if(b===a)if(l){for(g=k;g--;)f(g);this.views=[]}else{for(g in m)f(g);this.views={}}else if(d===a&&(l?d=1:(f(b),delete m[b])),l&&d){for(g=b+d;g-- >b;)f(g);m.splice(b,d);if(k=m.length)for(;b<k;)B(m[b]).setProperty("index",b++)}return this},refresh:function(a){var b=
this.parent;b&&(ea(this,this.index,this.tmpl,b.views,this.data,a,!0),h(this));return this},link:n}),ma={0:X=new y.View},ab.merge=function(a){var b,c=this.linkCtx._val||"",d=this.tagCtx.props.toggle;d&&(b=d.replace(/[\\^$.|?*+()[{]/g,"\\$&"),c=c.replace(RegExp("(\\s(?="+b+"$)|(\\s)|^)("+b+"(\\s|$))"),"$2"),a=c+(a?(c&&" ")+d:""));return a},ta("on",{attr:Ma,onAfterLink:function(b,d){for(var e,f,g=0,h=b.args,k=h.length,l=b.props.data,m=b.view,n=b.props.context;g<k&&!(f=ga(e=h[g++])););if(f){f=h.slice(g);
h=h.slice(0,g-1);n||(n=(n=/^(.*)[\.^][\w$]+$/.exec(b.params.args.slice(-f.length-1)[0]))&&y.tmplFn("{:"+n[1]+"}",m.tmpl,!0)(d.data,m));if(this._evs)this.onDispose();c(d.elem).on(this._evs=h[0]||"click",this._sel=h[1],l==a?null:l,this._hlr=function(a){return e.apply(n||d.data,[].concat(f,a,{change:a.type,view:m,linkCtx:d}))})}},onDispose:function(){c(this.parentElem).off(this._evs,this._sel,this._hlr)},flow:!0}),U(ta["for"],{onArrayChange:function(a,b){var c,d=b.change;if(this.tagCtxs[1]&&("insert"===
d&&a.target.length===b.items.length||"remove"===d&&!a.target.length||"refresh"===d&&!b.oldItems.length!==!a.target.length))this.refresh();else for(c in this._.arrVws)c=this._.arrVws[c],c.data===a.target&&c._.onArrayChange.apply(c,arguments);a.done=!0},onAfterLink:function(){var a,b,d,e,f=this,g=f._ars||{},h=f.tagCtxs,k=h.length,l=f.selected||0;for(a=0;a<=l;a++)b=h[a],e=b.map?b.map.tgt:b.args.length?b.args[0]:b.view.data,(d=g[a])&&e!==d[0]&&(Ra(d[0],d[1],!0),delete g[a]),!g[a]&&c.isArray(e)&&(Ra(e,
b=function(a,b){f.onArrayChange(a,b)}),g[a]=[e,b]);for(a=l+1;a<k;a++)if(d=g[a])Ra(d[0],d[1],!0),delete g[a];f._ars=g},onDispose:function(){for(var a in this._ars)Ra(this._ars[a][0],this._ars[a][1],!0)}}),U(ta["for"],J),U(ta["if"],J),U(ta.include,J),ta("props",{baseTag:ta["for"],dataMap:C.map({getTgt:ta.props.dataMap.getTgt,obsSrc:E,obsTgt:D,tgtFlt:I})}),U(c,{view:C.view=R=function(b,d,e){function f(a,b){if(a)for(h=s(a,b,fb),k=0,l=h.length;k<l&&(!(g=ma[h[k].id])||!(g=g&&e?g.get(!0,e):g));k++);}d!==
!!d&&(e=d,d=a);var g,h,k,l,m;m=0;var n=ja.body;if(b&&b!==n&&1<X._.useKey&&(b=""+b===b?c(b)[0]:b.jquery?b[0]:b)){if(d){f(b._dfr,!0);if(!g)for(m=Ya?b.querySelectorAll(Ua):c(Ua,b).get(),d=m.length,b=0;!g&&b<d;b++)f(m[b]);return g}for(;b;){if(h=s(b,a,gb))for(d=h.length;d--;)if(g=h[d],g.open){if(1>m)return(g=ma[g.id])&&e?g.get(e):g||X;m--}else m++;b=b.previousSibling||b.parentNode}}return X},link:C.link=ba,unlink:C.unlink=oa,cleanData:function(a){a.length&&Wa&&Aa(a);ib.apply(c,arguments)}}),C.utility=
{validate:function(b){try{X.link(a,ja.createElement("div"),a,a,b,a,a,1)}catch(c){return c.message}}},U(c.fn,{link:function(a,b,c,d,e,f,g){return ba(a,this,b,c,d,e,f,g)},unlink:function(a){return oa(a,this)},view:function(a){return R(this[0],a)}}),c.each([ra,"replaceWith","empty","remove"],function(a,b){var d=c.fn[b];c.fn[b]=function(){var a;Wa=1;try{a=d.apply(this,arguments)}finally{Wa=0}return a}}),U(X,{tmpl:{links:{},tags:{}}}),X._.onRender=Ka,W({wrapMap:N={option:[1,"<select multiple='multiple'>",
"</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],svg_ns:[1,"<svg>","</svg>"],div:jQuery.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},linkAttr:Q="data-link",merge:{input:{from:Ia,to:"value"},textarea:bb,select:bb,optgroup:{to:"label"}},jsrDbgMode:W.debugMode,
debugMode:function(a){W.jsrDbgMode(a);a?f._jsv={views:ma,bindings:Ea}:delete f._jsv},jsv:function(){W.debugMode(W._dbgMode);Q=W.linkAttr;P=C._err;u=Ua+",["+Q+"]";A=W.noDomLevel0;N.optgroup=N.option;N.tbody=N.tfoot=N.colgroup=N.caption=N.thead;N.th=N.td}}))})(this,this.jQuery)}())},{}]},{},[1])(1)});
