!function(Pa){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=Pa();else if("function"==typeof define&&define.amd)define([],Pa);else{var h;"undefined"!=typeof window?h=window:"undefined"!=typeof global?h=global:"undefined"!=typeof self&&(h=self);h.ForerunnerDB=Pa()}}(function(){return function h(m,e,k){function c(a,d){if(!e[a]){if(!m[a]){var g="function"==typeof require&&require;if(!d&&g)return g(a,!0);if(b)return b(a,!0);g=Error("Cannot find module '"+a+"'");throw g.code="MODULE_NOT_FOUND",
g;}g=e[a]={exports:{}};m[a][0].call(g.exports,function(g){var b=m[a][1][g];return c(b?b:g)},g,g.exports,h,m,e,k)}return e[a].exports}for(var b="function"==typeof require&&require,a=0;a<k.length;a++)c(k[a]);return c}({1:[function(h,m,e){e=h("../lib/Core");h("../lib/CollectionGroup");h("../lib/View");h("../lib/Highcharts");h("../lib/Persist");h("../lib/Document");h("../lib/Overview");h("../lib/vendor/jsviews");m.exports=e},{"../lib/CollectionGroup":4,"../lib/Core":5,"../lib/Document":7,"../lib/Highcharts":8,
"../lib/Overview":13,"../lib/Persist":15,"../lib/View":18,"../lib/vendor/jsviews":19}],2:[function(h,m,e){m.exports={chain:function(k){this._chain=this._chain||[];-1===this._chain.indexOf(k)&&this._chain.push(k)},unChain:function(k){this._chain&&(k=this._chain.indexOf(k),-1<k&&this._chain.splice(k,1))},chainSend:function(k,c,b){if(this._chain){var a=this._chain,f=a.length,d;for(d=0;d<f;d++)a[d].chainReceive(this,k,c,b)}},chainReceive:function(k,c,b,a){k={sender:k,type:c,data:b,options:a};(!this._chainHandler||
this._chainHandler&&!this._chainHandler(k))&&this.chainSend(k.type,k.data,k.options)}}},{}],3:[function(h,m,e){var k,c,b,a,f;e=h("./Shared");var d=function(g){this.init.apply(this,arguments)};d.prototype.init=function(g){this._primaryKey="_id";this._primaryIndex=new c("primary");this._primaryCrc=new c("primaryCrc");this._crcLookup=new c("crcLookup");this._name=g;this._data=[];this._groups=[];this._metrics=new k;this._linked=0;this._deferQueue={insert:[],update:[],remove:[],upsert:[]};this._deferThreshold=
{insert:100,update:100,remove:100,upsert:100};this._deferTime={insert:1,update:1,remove:1,upsert:1};this._subsetOf(this)};e.addModule("Collection",d);e.inherit(d.prototype,e.chainReactor);k=h("./Metrics");c=h("./KeyValueStore");b=h("./Path");a=h("./Index");f=h("./Crc");h=e.modules.Core;d.prototype.debug=e.common.debug;d.prototype.crc=f;e.synthesize(d.prototype,"name");d.prototype.on=e.common.on;d.prototype.off=e.common.off;d.prototype.emit=e.common.emit;d.prototype.drop=function(){if(this._db&&this._db._collection&&
this._name){this.debug()&&console.log("Dropping collection "+this._name);this.emit("drop");delete this._db._collection[this._name];var g=[],b;for(b=0;b<this._groups.length;b++)g.push(this._groups[b]);for(b=0;b<g.length;b++)this._groups[b].removeCollection(this);return!0}return!1};d.prototype.primaryKey=function(g){return void 0!==g?(this._primaryKey!==g&&(this._primaryKey=g,this._primaryIndex.primaryKey(g),this._rebuildPrimaryKeyIndex()),this):this._primaryKey};d.prototype._onInsert=function(g,b){this.emit("insert",
g,b)};d.prototype._onUpdate=function(g){this.emit("update",g)};d.prototype._onRemove=function(g){this.emit("remove",g)};e.synthesize(d.prototype,"db");d.prototype.setData=function(g,b,a){if(g){var d=this._metrics.create("setData");d.start();b=b||{};b.$decouple=void 0!==b.$decouple?b.$decouple:!0;b.$decouple&&(g=this.decouple(g));g instanceof Array||(g=[g]);d.time("transformIn");g=this.transformIn(g);d.time("transformIn");var f=this._data;this._linked?this.remove():this._data=[];g.length&&(this._linked?
this.insert(g):this._data=this._data.concat(g));d.time("Rebuild Primary Key Index");this._rebuildPrimaryKeyIndex(b);d.time("Rebuild Primary Key Index");d.time("Resolve chains");this.chainSend("setData",g,{oldData:f});d.time("Resolve chains");d.stop();this.emit("setData",this._data,f)}a&&a(!1);return this};d.prototype._rebuildPrimaryKeyIndex=function(g){var b=g&&void 0!==g.ensureKeys?g.ensureKeys:!0;g=g&&void 0!==g.violationCheck?g.violationCheck:!0;var a,d,f,c=this._primaryIndex,k=this._primaryCrc,
e=this._crcLookup,h=this._primaryKey,q;c.truncate();k.truncate();e.truncate();a=this._data;for(d=a.length;d--;)if(f=a[d],b&&this._ensurePrimaryKey(f),g){if(!c.uniqueSet(f[h],f))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+f[this._primaryKey];}else q=JSON.stringify(f),c.set(f[h],f),k.set(f[h],q),e.set(q,f)};d.prototype._ensurePrimaryKey=function(g){void 0===g[this._primaryKey]&&(g[this._primaryKey]=
this.objectId())};d.prototype.truncate=function(){this.emit("truncate",this._data);this._data.length=0;this.deferEmit("change");return this};d.prototype.upsert=function(g,b){if(g){var a=this._deferQueue.upsert,d=this._deferThreshold.upsert,f={},c;if(g instanceof Array){if(g.length>d){this._deferQueue.upsert=a.concat(g);this.processQueue("upsert",b);return}f=[];for(a=0;a<g.length;a++)f.push(this.upsert(g[a]));b&&b();return f}g[this._primaryKey]?(c={},c[this._primaryKey]=g[this._primaryKey],this._primaryIndex.lookup(c)[0]?
f.op="update":f.op="insert"):f.op="insert";switch(f.op){case "insert":f.result=this.insert(g);break;case "update":f.result=this.update(c,g)}return f}b&&b()};d.prototype.update=function(g,b,a){b=this.decouple(b);b=this.transformIn(b);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var d=this,f=this._metrics.create("update"),c=this._primaryKey,k,e,h=function(f){if(b&&void 0!==b[c]&&b[c]!=f[c]){d._primaryIndex.unSet(f[c]);var k=d._updateObject(f,b,g,a,"");
if(d._primaryIndex.uniqueSet(f[c],f))return k;throw"Primary key violation in update! Key violated: "+f[c];}return d._updateObject(f,b,g,a,"")};f.start();f.time("Retrieve documents to update");k=this.find(g,{$decouple:!1});f.time("Retrieve documents to update");k.length&&(f.time("Update documents"),e=k.filter(h),f.time("Update documents"),e.length&&(f.time("Resolve chains"),this.chainSend("update",{query:g,update:b},a),f.time("Resolve chains"),this._onUpdate(e),this.deferEmit("change",{type:"update",
data:e})));f.stop();return e||[]};d.prototype.updateById=function(g,b){var a={};a[this._primaryKey]=g;return this.update(a,b)};d.prototype._updateObject=function(g,a,d,f,c,k){a=this.decouple(a);c=c||"";"."===c.substr(0,1)&&(c=c.substr(1,c.length-1));var e=!1,h=!1,n,q,p,l;for(l in a)if(a.hasOwnProperty(l)){n=!1;if("$"===l.substr(0,1))switch(l){case "$index":break;default:n=!0,(h=this._updateObject(g,a[l],d,f,c,l))&&(e=!0)}if(this._isPositionalKey(l)&&(n=!0,l=l.substr(0,l.length-2),h=new b(c+"."+l),
g[l]&&g[l]instanceof Array&&g[l].length)){q=[];for(p=0;p<g[l].length;p++)this._match(g[l][p],h.value(d)[0])&&q.push(p);for(p=0;p<q.length;p++)(h=this._updateObject(g[l][q[p]],a[l+".$"],d,f,c+"."+l,k))&&(e=!0)}if(!n)if(k||"object"!==typeof a[l])switch(k){case "$inc":this._updateIncrement(g,l,a[l]);e=!0;break;case "$push":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array){if(void 0!==a[l].$position&&a[l].$each instanceof Array)for(h=a[l].$position,n=a[l].$each.length,p=0;p<n;p++)this._updateSplicePush(g[l],
h+p,a[l].$each[p]);else if(a[l].$each instanceof Array)for(n=a[l].$each.length,p=0;p<n;p++)this._updatePush(g[l],a[l].$each[p]);else this._updatePush(g[l],a[l]);e=!0}else throw"Cannot push to a key that is not an array! ("+l+")";break;case "$pull":if(g[l]instanceof Array){q=[];for(p=0;p<g[l].length;p++)this._match(g[l][p],a[l])&&q.push(p);for(n=q.length;n--;)this._updatePull(g[l],q[n]),e=!0}break;case "$pullAll":if(g[l]instanceof Array)if(a[l]instanceof Array){if(q=g[l],n=q.length,0<n)for(;n--;){for(h=
0;h<a[l].length;h++)q[n]===a[l][h]&&(this._updatePull(g[l],n),n--,e=!0);if(0>n)break}}else throw"Cannot pullAll without being given an array of values to pull! ("+l+")";break;case "$addToSet":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array){p=g[l];var m;q=p.length;var E;n=!0;m=f&&f.$addToSet;var aa;m&&m.key?(h=!1,aa=new b(m.key),E=aa.value(a[l])[0]):(E=JSON.stringify(a[l]),h=!0);for(m=0;m<q;m++)if(h){if(JSON.stringify(p[m])===E){n=!1;break}}else if(E===aa.value(p[m])[0]){n=!1;break}n&&(this._updatePush(g[l],
a[l]),e=!0)}else throw"Cannot addToSet on a key that is not an array! (undefined)!";break;case "$splicePush":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array)if(h=a.$index,void 0!==h)delete a.$index,h>g[l].length&&(h=g[l].length),this._updateSplicePush(g[l],h,a[l]),e=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+l+")";break;case "$move":if(g[l]instanceof Array)for(p=0;p<g[l].length;p++){if(this._match(g[l][p],a[l])){e=
a[l].$index;if(void 0!==e)this._updateSpliceMove(g[l],p,e),e=!0;else throw"Cannot move without a $index integer value!";break}}else throw"Cannot move on a key that is not an array! ("+l+")";break;case "$mul":this._updateMultiply(g,l,a[l]);e=!0;break;case "$rename":this._updateRename(g,l,a[l]);e=!0;break;case "$unset":this._updateUnset(g,l);e=!0;break;case "$pop":if(g[l]instanceof Array)this._updatePop(g[l],a[l])&&(e=!0);else throw"Cannot pop from a key that is not an array! ("+l+")";break;default:g[l]!==
a[l]&&(this._updateProperty(g,l,a[l]),e=!0)}else if(null!==g[l]&&"object"===typeof g[l])if(p=g[l]instanceof Array,q=a[l]instanceof Array,p||q)if(!q&&p)for(p=0;p<g[l].length;p++)(h=this._updateObject(g[l][p],a[l],d,f,c+"."+l,k))&&(e=!0);else g[l]!==a[l]&&(this._updateProperty(g,l,a[l]),e=!0);else(h=this._updateObject(g[l],a[l],d,f,c+"."+l,k))&&(e=!0);else g[l]!==a[l]&&(this._updateProperty(g,l,a[l]),e=!0)}return e};d.prototype._isPositionalKey=function(g){return".$"===g.substr(g.length-2,2)};d.prototype._updateProperty=
function(g,b,a){this._linked?(jQuery.observable(g).setProperty(b,a),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+b+'" for collection "'+this.name()+'"')):(g[b]=a,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+b+'" for collection "'+this.name()+'"'))};d.prototype._updateIncrement=function(g,b,a){this._linked?jQuery.observable(g).setProperty(b,g[b]+a):g[b]+=a};d.prototype._updateSpliceMove=function(g,b,a){this._linked?
(jQuery.observable(g).move(b,a),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+b+'" to "'+a+'" for collection "'+this.name()+'"')):(g.splice(a,0,g.splice(b,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+b+'" to "'+a+'" for collection "'+this.name()+'"'))};d.prototype._updateSplicePush=function(g,b,a){g.length>b?this._linked?jQuery.observable(g).insert(b,a):g.splice(b,0,a):this._linked?
jQuery.observable(g).insert(a):g.push(a)};d.prototype._updatePush=function(g,b){this._linked?jQuery.observable(g).insert(b):g.push(b)};d.prototype._updatePull=function(g,b){this._linked?jQuery.observable(g).remove(b):g.splice(b,1)};d.prototype._updateMultiply=function(g,b,a){this._linked?jQuery.observable(g).setProperty(b,g[b]*a):g[b]*=a};d.prototype._updateRename=function(g,b,a){var d=g[b];this._linked?(jQuery.observable(g).setProperty(a,d),jQuery.observable(g).removeProperty(b)):(g[a]=d,delete g[b])};
d.prototype._updateUnset=function(g,b){this._linked?jQuery.observable(g).removeProperty(b):delete g[b]};d.prototype._updatePop=function(g,b){var a,d=!1;0<g.length&&(this._linked?(1===b?a=g.length-1:-1===b&&(a=0),-1<a&&(jQuery.observable(arr).remove(a),d=!0)):1===b?(g.pop(),d=!0):-1===b&&(g.shift(),d=!0));return d};d.prototype.remove=function(g,b,a){var d,f;if(g instanceof Array){f=[];for(a=0;a<g.length;a++)f.push(this.remove(g[a],{noEmit:!0}));(!b||b&&!b.noEmit)&&this._onRemove(f);return f}a=this.find(g,
{$decouple:!1});if(a.length){for(f=0;f<a.length;f++)d=a[f],this._removeIndex(d),d=this._data.indexOf(d),this._linked?jQuery.observable(this._data).remove(d):this._data.splice(d,1);this.chainSend("remove",{query:g},b);(!b||b&&!b.noEmit)&&this._onRemove(a);this.deferEmit("change",{type:"remove",data:a})}return a};d.prototype.removeById=function(g){var b={};b[this._primaryKey]=g;return this.remove(b)};d.prototype.deferEmit=function(){var g=this,b;this._noEmitDefer||this._db&&(!this._db||this._db._noEmitDefer)?
this.emit.apply(this,arguments):(b=arguments,this._changeTimeout&&clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){g.debug()&&console.log("ForerunnerDB.Collection: Emitting "+b[0]);g.emit.apply(g,b)},100))};d.prototype.processQueue=function(g,b){var a=this._deferQueue[g],d=this._deferThreshold[g],f=this._deferTime[g];if(a.length){var c=this;a.length&&(a=a.length>d?a.splice(0,d):a.splice(0,a.length),this[g](a));setTimeout(function(){c.processQueue(g,b)},f)}else b&&b()};d.prototype.insert=
function(g,b,a){"function"===typeof b?(a=b,b=this._data.length):void 0===b&&(b=this._data.length);g=this.transformIn(g);return this._insertHandle(g,b,a)};d.prototype._insertHandle=function(g,b,a){var d=this._deferQueue.insert,f=this._deferThreshold.insert,c=[],k=[];if(g instanceof Array){if(g.length>f){this._deferQueue.insert=d.concat(g);this.processQueue("insert",a);return}for(f=0;f<g.length;f++)d=this._insert(g[f],b+f),!0===d?c.push(g[f]):k.push({doc:g[f],reason:d})}else d=this._insert(g,b),!0===
d?c.push(g):k.push({doc:g,reason:d});this.chainSend("insert",g,{index:b});this._onInsert(c,k);a&&a();this.deferEmit("change",{type:"insert",data:c});return{inserted:c,failed:k}};d.prototype._insert=function(g,b){if(g){var a;this._ensurePrimaryKey(g);if(a=this.insertIndexViolation(g))return"Index violation in index: "+a;this._insertIndex(g);b>this._data.length&&(b=this._data.length);this._linked?jQuery.observable(this._data).insert(b,g):this._data.splice(b,0,g);return!0}return"No document passed to insert"};
d.prototype._insertIndex=function(g){var b=this._indexByName,a,d=JSON.stringify(g);this._primaryIndex.uniqueSet(g[this._primaryKey],g);this._primaryCrc.uniqueSet(g[this._primaryKey],d);this._crcLookup.uniqueSet(d,g);for(a in b)b.hasOwnProperty(a)&&b[a].insert(g)};d.prototype._removeIndex=function(g){var b=this._indexByName,a,d=JSON.stringify(g);this._primaryIndex.unSet(g[this._primaryKey]);this._primaryCrc.unSet(g[this._primaryKey]);this._crcLookup.unSet(d);for(a in b)b.hasOwnProperty(a)&&b[a].remove(g)};
d.prototype.subset=function(g,b){var a=this.find(g,b);return(new d)._subsetOf(this).primaryKey(this._primaryKey).setData(a)};d.prototype.subsetOf=function(){return this.__subsetOf};d.prototype._subsetOf=function(g){this.__subsetOf=g;return this};d.prototype.distinct=function(g,a,d){a=this.find(a,d);g=new b(g);d={};var f=[],c,k;for(k=0;k<a.length;k++)(c=g.value(a[k])[0])&&!d[c]&&(d[c]=!0,f.push(c));return f};d.prototype.decouple=e.common.decouple;d.prototype.findById=function(g,b){var a={};a[this._primaryKey]=
g;return this.find(a,b)[0]};d.prototype.peek=function(g,b){var a=this._data,f=a.length,c,k,e=new d;if("string"===typeof g){for(c=0;c<f;c++)k=JSON.stringify(a[c]),-1<k.indexOf(g)&&e.insert(a[c]);return e.find({},b)}return this.find(g,b)};d.prototype.explain=function(g,b){return this.find(g,b).__fdbOp._data};d.prototype.find=function(g,a){g=g||{};a=a||{};a.$decouple=void 0!==a.$decouple?a.$decouple:!0;var d=this._metrics.create("find"),f=this,c,k=!0,e,h,n,q,p,l,m,E,aa,ma=[];h=function(a){return f._match(a,
g,"and")};d.start();if(g){d.time("analyseQuery");c=this._analyseQuery(g,a,d);d.time("analyseQuery");d.data("analysis",c);if(c.hasJoin&&c.queriesJoin){d.time("joinReferences");for(n=0;n<c.joinsOn.length;n++)p=c.joinsOn[n],q=new b(c.joinQueries[p]),q=q.value(g)[0],this._db.collection(c.joinsOn[n]).subset(q);d.time("joinReferences")}c.indexMatch.length&&(!a||a&&!a.$skipIndex)?(d.data("index.potential",c.indexMatch),d.data("index.used",c.indexMatch[0].index),d.time("indexLookup"),e=c.indexMatch[0].lookup,
d.time("indexLookup"),c.indexMatch[0].keyData.totalKeyCount===c.indexMatch[0].keyData.matchedKeyCount&&(k=!1)):d.flag("usedIndex",!1);k&&(e&&e.length?(c=e.length,d.time("tableScan: "+c),e=e.filter(h)):(c=this._data.length,d.time("tableScan: "+c),e=this._data.filter(h)),a.$orderBy&&(d.time("sort"),e=this.sort(a.$orderBy,e),d.time("sort")),d.time("tableScan: "+c));a.limit&&e&&e.length>a.limit&&(e.length=a.limit,d.data("limit",a.limit));a.$decouple&&(d.time("decouple"),e=this.decouple(e),d.time("decouple"),
d.data("flag.decouple",!0));if(a.join){for(h=0;h<a.join.length;h++)for(p in a.join[h])if(a.join[h].hasOwnProperty(p))for(E=p,c=this._db.collection(p),k=a.join[h][p],aa=0;aa<e.length;aa++){m={};q=n=!1;for(l in k)if(k.hasOwnProperty(l))if("$"===l.substr(0,1))switch(l){case "$as":E=k[l];break;case "$multi":n=k[l];break;case "$require":q=k[l];break;default:l.substr(0,3)}else m[l]=(new b(k[l])).value(e[aa])[0];m=c.find(m);!q||q&&m[0]?e[aa][E]=!1===n?m[0]:m:ma.push(e[aa])}d.data("flag.join",!0)}if(ma.length){d.time("removalQueue");
for(l=0;l<ma.length;l++)p=e.indexOf(ma[l]),-1<p&&e.splice(p,1);d.time("removalQueue")}if(a.transform){d.time("transform");for(l=0;l<e.length;l++)e.splice(l,1,a.transform(e[l]));d.time("transform");d.data("flag.transform",!0)}this._transformEnabled&&this._transformOut&&(d.time("transformOut"),e=this.transformOut(e),d.time("transformOut"));d.data("results",e.length);d.stop()}else d.stop(),e=[];e.__fdbOp=d;return e};d.prototype.indexOf=function(a){if(a=this.find(a,{$decouple:!1})[0])return this._data.indexOf(a)};
d.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this._transformEnabled=a.enabled),void 0!==a.dataIn&&(this._transformIn=a.dataIn),void 0!==a.dataOut&&(this._transformOut=a.dataOut)):this._transformEnabled=!1===a?!1:!0,this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};d.prototype.transformIn=function(a){if(this._transformEnabled&&this._transformIn){if(a instanceof Array){var b=[],d;for(d=0;d<a.length;d++)b[d]=
this._transformIn(a[d]);return b}return this._transformIn(a)}return a};d.prototype.transformOut=function(a){if(this._transformEnabled&&this._transformOut){if(a instanceof Array){var b=[],d;for(d=0;d<a.length;d++)b[d]=this._transformOut(a[d]);return b}return this._transformOut(a)}return a};d.prototype.sort=function(a,b){b=b||[];var d=[],f,c;for(f in a)a.hasOwnProperty(f)&&(c={},c[f]=a[f],c.___fdbKey=f,d.push(c));return 2>d.length?this._sort(a,b):this._bucketSort(d,b)};d.prototype._bucketSort=function(a,
b){var d=a.shift(),f,c,k=[];if(0<a.length){b=this._sort(d,b);f=this.bucket(d.___fdbKey,b);for(c in f)f.hasOwnProperty(c)&&(d=[].concat(a),k=k.concat(this._bucketSort(d,f[c])));return k}return this._sort(d,b)};d.prototype._sort=function(a,d){var f=new b,c=f.parse(a,!0)[0];f.path(c.path);return d.sort(1===c.value?function(a,b){var g=f.value(a)[0],d=f.value(b)[0];return"string"===typeof g&&"string"===typeof d?g.localeCompare(d):g>d?1:g<d?-1:0}:function(a,b){var g=f.value(a)[0],d=f.value(b)[0];return"string"===
typeof g&&"string"===typeof d?1===g.localeCompare(d)?-1:1:g>d?-1:g<d?1:0})};d.prototype.bucket=function(a,b){var d,f={};for(d=0;d<b.length;d++)f[b[d][a]]=f[b[d][a]]||[],f[b[d][a]].push(b[d]);return f};d.prototype._analyseQuery=function(a,d,f){var c={queriesOn:[this._name],indexMatch:[],hasJoin:!1,queriesJoin:!1,joinQueries:{},query:a,options:d},k,e=[],h=[],m,n,q,p,l;f.time("checkIndexes");void 0!==a[this._primaryKey]&&(f.time("checkIndexMatch: Primary Key"),m=new b,c.indexMatch.push({lookup:this._primaryIndex.lookup(a,
d),keyData:{matchedKeys:[this._primaryKey],matchedKeyCount:1,totalKeyCount:m.countKeys(a)},index:this._primaryIndex}),f.time("checkIndexMatch: Primary Key"));for(l in this._indexById)if(this._indexById.hasOwnProperty(l)&&(n=this._indexById[l],q=n.name(),f.time("checkIndexMatch: "+q),m=n.match(a,d),p=n.lookup(a,d),0<m.matchedKeyCount&&c.indexMatch.push({lookup:p,keyData:m,index:n}),f.time("checkIndexMatch: "+q),m.totalKeyCount===m.matchedKeyCount))break;f.time("checkIndexes");1<c.indexMatch.length&&
(f.time("findOptimalIndex"),c.indexMatch.sort(function(a,b){return a.keyData.totalKeyCount===a.keyData.matchedKeyCount?-1:b.keyData.totalKeyCount===b.keyData.matchedKeyCount?1:a.keyData.matchedKeyCount===b.keyData.matchedKeyCount?a.lookup.length-b.lookup.length:b.keyData.matchedKeyCount-a.keyData.matchedKeyCount}),f.time("findOptimalIndex"));if(d.join){c.hasJoin=!0;for(f=0;f<d.join.length;f++)for(k in d.join[f])d.join[f].hasOwnProperty(k)&&(e.push(k),"$as"in d.join[f][k]?h.push(d.join[f][k].$as):
h.push(k));for(k=0;k<h.length;k++)if(d=this._queryReferencesCollection(a,h[k],""))c.joinQueries[e[k]]=d,c.queriesJoin=!0;c.joinsOn=e;c.queriesOn=c.queriesOn.concat(e)}return c};d.prototype._queryReferencesCollection=function(a,b,d){for(var f in a)if(a.hasOwnProperty(f)){if(f===b)return d&&(d+="."),d+f;if("object"===typeof a[f])return d&&(d+="."),d+=f,this._queryReferencesCollection(a[f],b,d)}return!1};d.prototype._match=function(a,b,d){var f,c;f=typeof a;c=typeof b;var k=!0,e;if(!("string"!==f&&"number"!==
f||"string"!==c&&"number"!==c))a!==b&&(k=!1);else for(e in b)if(b.hasOwnProperty(e)){f=!1;if("$"===e.substr(0,1))switch(e){case "$gt":if(a>b[e]){if("or"===d)return!0}else k=!1;f=!0;break;case "$gte":if(a>=b[e]){if("or"===d)return!0}else k=!1;f=!0;break;case "$lt":if(a<b[e]){if("or"===d)return!0}else k=!1;f=!0;break;case "$lte":if(a<=b[e]){if("or"===d)return!0}else k=!1;f=!0;break;case "$exists":if(void 0===a!==b[e]){if("or"===d)return!0}else k=!1;f=!0;break;case "$or":f=!0;for(c=0;c<b[e].length;c++){if(this._match(a,
b[e][c],"and"))return!0;k=!1}break;case "$and":f=!0;for(c=0;c<b[e].length;c++)if(!this._match(a,b[e][c],"and"))return!1;break;case "$in":if(b[e]instanceof Array){f=b[e];c=f.length;var h,m=!1;for(h=0;h<c;h++)if(f[h]===a){m=!0;break}if(m){if("or"===d)return!0}else k=!1}else throw"Cannot use a $nin operator on a non-array key: "+e;f=!0;break;case "$nin":if(b[e]instanceof Array){f=b[e];c=f.length;m=!0;for(h=0;h<c;h++)if(f[h]===a){m=!1;break}if(m){if("or"===d)return!0}else k=!1}else throw"Cannot use a $nin operator on a non-array key: "+
e;f=!0;break;case "$ne":if(a!=b[e]){if("or"===d)return!0}else k=!1;f=!0}if(!f&&b[e]instanceof RegExp)if(f=!0,"object"===typeof a&&void 0!==a[e]&&b[e].test(a[e])){if("or"===d)return!0}else k=!1;if(!f)if("object"===typeof b[e])if(void 0!==a[e]){if(a[e]instanceof Array&&!(b[e]instanceof Array))for(f=!1,c=0;c<a[e].length&&!(f=this._match(a[e][c],b[e],void 0));c++);else if(!(a[e]instanceof Array)&&b[e]instanceof Array)for(f=!1,c=0;c<b[e].length&&!(f=this._match(a[e],b[e][c],void 0));c++);else f="object"===
typeof a?this._match(a[e],b[e],void 0):this._match(void 0,b[e],void 0);if(f){if("or"===d)return!0}else k=!1}else if(b[e]&&void 0!==b[e].$exists)if(f=this._match(void 0,b[e],void 0)){if("or"===d)return!0}else k=!1;else k=!1;else if(a&&a[e]===b[e]){if("or"===d)return!0}else if(a&&a[e]&&a[e]instanceof Array&&b[e]&&"object"!==typeof b[e]){f=!1;for(c=0;c<a[e].length&&!(f=this._match(a[e][c],b[e],void 0));c++);if(f){if("or"===d)return!0}else k=!1}else k=!1;if("and"===d&&!k)return!1}return k};d.prototype.count=
function(a,b){return a?this.find(a,b).length:this._data.length};d.prototype.link=function(a,b){if(window.jQuery){this._links=this._links||{};var d,f;b&&"object"===typeof b?b.template&&"string"===typeof b.template&&(d=this.objectId(b.template),f=b.template):d=b;if(!this._links[d]){if(jQuery(a).length){if(!jQuery.templates[d]){if(!f)if(f=jQuery(b),f.length)f=jQuery(f[0]).html();else throw"Unable to bind collection to target because template does not exist: "+b;jQuery.views.templates(d,f)}jQuery.templates[d].link(a,
this._data);this._links[d]=a;this._linked++;this.debug()&&console.log('ForerunnerDB.Collection: Added binding collection "'+this.name()+'" to output target: '+a);return this}throw'Cannot bind view data to output target selector "'+a+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+a+" with the template: "+d;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};d.prototype.unlink=function(a,b){if(window.jQuery){this._links=this._links||
{};var d;b&&"object"===typeof b?b.template&&"string"===typeof b.template&&(d=this.objectId(b.template)):d=b;if(this._links[d])return jQuery.templates[d].unlink(a),delete this._links[d],this._linked--,this.debug()&&console.log('ForerunnerDB.Collection: Removed binding collection "'+this.name()+'" to output target: '+a),this;console.log("Cannot remove link, one does not exist to the target: "+a+" with the template: "+b)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";};
d.prototype.findSub=function(a,d,f,c){var e=new b(d);a=this.find(a);var k=a.length,h,m,n=this._db.collection("__FDB_temp_"+this.objectId()),q={parents:k,subDocTotal:0,subDocs:[],pathFound:!1,err:""};for(h=0;h<k;h++)if(m=e.value(a[h])[0]){n.setData(m);m=n.find(f,c);if(c.returnFirst&&m.length)return m[0];q.subDocs.push(m);q.subDocTotal+=m.length;q.pathFound=!0}n.drop();if(c.noStats)return q.subDocs;q.pathFound||(q.err="No objects found in the parent documents with a matching path of: "+d);return q};
d.prototype.insertIndexViolation=function(a){var b,d=this._indexByName,f,c;if(this._primaryIndex.get(a[this._primaryKey]))b=this._primaryIndex;else for(f in d)if(d.hasOwnProperty(f)&&(c=d[f],c.unique()&&c.violation(a))){b=c;break}return b?b.name():!1};d.prototype.ensureIndex=function(b,d){this._indexByName=this._indexByName||{};this._indexById=this._indexById||{};var f=new a(b,d,this),c={start:(new Date).getTime()};if(this._indexByName[f.name()])return{err:"Index with that name already exists"};if(this._indexById[f.id()])return{err:"Index with those keys already exists"};
f.rebuild();this._indexByName[f.name()]=f;this._indexById[f.id()]=f;c.end=(new Date).getTime();c.total=c.end-c.start;this._lastOp={type:"ensureIndex",stats:{time:c}};return{index:f,id:f.id(),name:f.name(),state:f.state()}};d.prototype.index=function(a){if(this._indexByName)return this._indexByName[a]};d.prototype.lastOp=function(){return this._metrics.list()};d.prototype.objectId=e.common.objectId;d.prototype.diff=function(a){var b={insert:[],update:[],remove:[]},d=this.primaryKey(),f,c,e,k;if(d===
a.primaryKey()){for(f=a._data;f&&!(f instanceof Array);)a=f,f=a._data;k=f.length;for(c=0;c<k;c++)e=f[c],this._primaryIndex.get(e[d])?this._primaryCrc.get(e[d])!==a._primaryCrc.get(e[d])&&b.update.push(e):b.insert.push(e);f=this._data;k=f.length;for(c=0;c<k;c++)e=f[c],a._primaryIndex.get(e[d])||b.remove.push(e)}else throw"Collection diffing requires that both collections have the same primary key!";return b};h.prototype.collection=function(a,b){if(a)return this._collection[a]||this.debug()&&console.log("Creating collection "+
a),this._collection[a]=this._collection[a]||(new d(a)).db(this),void 0!==b&&this._collection[a].primaryKey(b),this._collection[a];throw"Cannot get collection with undefined name!";};h.prototype.collectionExists=function(a){return Boolean(this._collection[a])};h.prototype.collections=function(){var a=[],b;for(b in this._collection)this._collection.hasOwnProperty(b)&&a.push({name:b,count:this._collection[b].count()});return a};m.exports=d},{"./Crc":6,"./Index":9,"./KeyValueStore":10,"./Metrics":11,
"./Path":14,"./Shared":17}],4:[function(h,m,e){var k,c;e=h("./Shared");var b=function(){this.init.apply(this,arguments)};b.prototype.init=function(a){this._name=a;this._data=new c("__FDB__cg_data_"+this._name);this._collections=[];this._views=[]};e.addModule("CollectionGroup",b);e.inherit(b.prototype,e.chainReactor);c=h("./Collection");h=e.modules.Core;k=e.modules.Core.prototype.init;b.prototype.debug=e.common.debug;b.prototype.on=function(){this._data.on.apply(this._data,arguments)};b.prototype.off=
function(){this._data.off.apply(this._data,arguments)};b.prototype.emit=function(){this._data.emit.apply(this._data,arguments)};b.prototype.primaryKey=function(a){return void 0!==a?(this._primaryKey=a,this):this._primaryKey};e.synthesize(b.prototype,"db");b.prototype.addCollection=function(a){if(a&&-1===this._collections.indexOf(a)){if(this._collections.length){if(this._primaryKey!==a.primaryKey())throw"All collections in a collection group must have the same primary key!";}else this.primaryKey(a.primaryKey());
this._collections.push(a);a._groups.push(this);a.chain(this);this._data.insert(a.find())}return this};b.prototype.removeCollection=function(a){if(a){var b=this._collections.indexOf(a);-1!==b&&(a.unChain(this),this._collections.splice(b,1),b=a._groups.indexOf(this),-1!==b&&a._groups.splice(b,1));0===this._collections.length&&delete this._primaryKey}return this};b.prototype.decouple=e.common.decouple;b.prototype._chainHandler=function(a){switch(a.type){case "setData":a.data=this.decouple(a.data);this._data.remove(a.options.oldData);
this._data.insert(a.data);break;case "insert":a.data=this.decouple(a.data);this._data.insert(a.data);break;case "update":this._data.update(a.data.query,a.data.update,a.options);break;case "remove":this._data.remove(a.data.query,a.options)}};b.prototype.insert=function(){this._collectionsRun("insert",arguments)};b.prototype.update=function(){this._collectionsRun("update",arguments)};b.prototype.updateById=function(){this._collectionsRun("updateById",arguments)};b.prototype.remove=function(){this._collectionsRun("remove",
arguments)};b.prototype._collectionsRun=function(a,b){for(var d=0;d<this._collections.length;d++)this._collections[d][a].apply(this._collections[d],b)};b.prototype.find=function(a,b){return this._data.find(a,b)};b.prototype.removeById=function(a){for(var b=0;b<this._collections.length;b++)this._collections[b].removeById(a)};b.prototype.subset=function(a,b){var d=this.find(a,b);return(new c)._subsetOf(this).primaryKey(this._primaryKey).setData(d)};b.prototype.drop=function(){var a,b=[].concat(this._collections),
d=[].concat(this._views);this._debug&&console.log("Dropping collection group "+this._name);for(a=0;a<b.length;a++)this.removeCollection(b[a]);for(a=0;a<d.length;a++)this._removeView(d[a]);this.emit("drop");return!0};h.prototype.init=function(){this._collectionGroup={};k.apply(this,arguments)};h.prototype.collectionGroup=function(a){return a?(this._collectionGroup[a]=this._collectionGroup[a]||(new b(a)).db(this),this._collectionGroup[a]):this._collectionGroup};m.exports=b},{"./Collection":3,"./Shared":17}],
5:[function(h,m,e){var k,c;k=h("./Shared.js");e=function(){this.init.apply(this,arguments)};e.prototype.init=function(){this._collection={};this._debug={};this._version="1.2.7"};e.prototype.moduleLoaded=k.overload({string:function(b){if(void 0!==b){b=b.replace(/ /g,"");var a=b.split(","),f;for(f=0;f<a.length;f++)if(!k.modules[b])return!1;return!0}return!1},"string, function":function(b,a){if(void 0!==b){b=b.replace(/ /g,"");var f=b.split(","),d;for(d=0;d<f.length;d++)if(!k.modules[b])return!1;a()}},
"string, function, function":function(b,a,f){if(void 0!==b){b=b.replace(/ /g,"");var d=b.split(","),g;for(g=0;g<d.length;g++)if(!k.modules[b])return f(),!1;a()}}});e.moduleLoaded=e.prototype.moduleLoaded;e.shared=k;e.prototype.shared=k;k.addModule("Core",e);k.inherit(e.prototype,k.chainReactor);c=h("./Collection.js");h("./Metrics.js");h=h("./Crc.js");e.prototype._isServer=!1;e.prototype.isClient=function(){return!this._isServer};e.prototype.isServer=function(){return this._isServer};e.prototype.crc=
h;e.prototype.isClient=function(){return!this._isServer};e.prototype.isServer=function(){return this._isServer};e.prototype.decouple=k.common.decouple;e.prototype.debug=k.common.debug;e.prototype.arrayToCollection=function(b){return(new c).setData(b)};e.prototype.on=function(b,a){this._listeners=this._listeners||{};this._listeners[b]=this._listeners[b]||[];this._listeners[b].push(a);return this};e.prototype.off=function(b,a){if(b in this._listeners){var f=this._listeners[b],d=f.indexOf(a);-1<d&&f.splice(d,
1)}return this};e.prototype.emit=function(b,a){this._listeners=this._listeners||{};if(b in this._listeners){var f=this._listeners[b],d=f.length,g;for(g=0;g<d;g++)f[g].apply(this,Array.prototype.slice.call(arguments,1))}return this};e.prototype.objectId=k.common.objectId;e.prototype.peek=function(b){var a,f,d=[],g=typeof b;for(a in this._collection)this._collection.hasOwnProperty(a)&&(f=this._collection[a],d="string"===g?d.concat(f.peek(b)):d.concat(f.find(b)));return d};e.prototype.peekCat=function(b){var a,
f,d={},g,c=typeof b;for(a in this._collection)this._collection.hasOwnProperty(a)&&(f=this._collection[a],(g="string"===c?f.peek(b):f.find(b))&&g.length&&(d[f.name()]=g));return d};m.exports=e},{"./Collection.js":3,"./Crc.js":6,"./Metrics.js":11,"./Shared.js":17}],6:[function(h,m,e){var k=function(){var c=[],b,a,f;for(a=0;256>a;a++){b=a;for(f=0;8>f;f++)b=b&1?3988292384^b>>>1:b>>>1;c[a]=b}return c}();m.exports=function(c){var b=-1,a;for(a=0;a<c.length;a++)b=b>>>8^k[(b^c.charCodeAt(a))&255];return(b^
-1)>>>0}},{}],7:[function(h,m,e){var k,c;e=h("./Shared");var b=function(){this.init.apply(this,arguments)};b.prototype.init=function(a){this._name=a;this._data={}};e.addModule("Document",b);e.inherit(b.prototype,e.chainReactor);h=h("./Collection");k=e.modules.Core;c=e.modules.Core.prototype.init;e.synthesize(b.prototype,"db");e.synthesize(b.prototype,"name");b.prototype.setData=function(a){var b,d;if(a)if(a=this.decouple(a),this._linked){d={};for(b in this._data)"jQuery"!==b.substr(0,6)&&this._data.hasOwnProperty(b)&&
void 0===a[b]&&(d[b]=1);a.$unset=d;this._updateObject(this._data,a,{})}else this._data=a;return this};b.prototype.decouple=e.common.decouple;b.prototype.objectId=e.common.objectId;b.prototype.on=e.common.on;b.prototype.off=e.common.off;b.prototype.emit=e.common.emit;b.prototype.debug=e.common.debug;b.prototype.update=function(a,b,d){this._updateObject(this._data,b,a,d)};b.prototype._updateObject=h.prototype._updateObject;b.prototype._isPositionalKey=function(a){return".$"===a.substr(a.length-2,2)};
b.prototype._updateProperty=function(a,b,d){this._linked?(jQuery.observable(a).setProperty(b,d),this.debug()&&console.log('ForerunnerDB.Document: Setting data-bound document property "'+b+'" for collection "'+this.name()+'"')):(a[b]=d,this.debug()&&console.log('ForerunnerDB.Document: Setting non-data-bound document property "'+b+'" for collection "'+this.name()+'"'))};b.prototype._updateIncrement=function(b,f,d){this._linked?jQuery.observable(b).setProperty(f,b[f]+d):b[f]+=d};b.prototype._updateSpliceMove=
function(b,f,d){this._linked?(jQuery.observable(b).move(f,d),this.debug()&&console.log('ForerunnerDB.Document: Moving data-bound document array index from "'+f+'" to "'+d+'" for collection "'+this.name()+'"')):(b.splice(d,0,b.splice(f,1)[0]),this.debug()&&console.log('ForerunnerDB.Document: Moving non-data-bound document array index from "'+f+'" to "'+d+'" for collection "'+this.name()+'"'))};b.prototype._updateSplicePush=function(b,f,d){b.length>f?this._linked?jQuery.observable(b).insert(f,d):b.splice(f,
0,d):this._linked?jQuery.observable(b).insert(d):b.push(d)};b.prototype._updatePush=function(b,f){this._linked?jQuery.observable(b).insert(f):b.push(f)};b.prototype._updatePull=function(b,f){this._linked?jQuery.observable(b).remove(f):b.splice(f,1)};b.prototype._updateMultiply=function(b,f,d){this._linked?jQuery.observable(b).setProperty(f,b[f]*d):b[f]*=d};b.prototype._updateRename=function(b,f,d){var g=b[f];this._linked?(jQuery.observable(b).setProperty(d,g),jQuery.observable(b).removeProperty(f)):
(b[d]=g,delete b[f])};b.prototype._updateUnset=function(b,f){this._linked?jQuery.observable(b).removeProperty(f):delete b[f]};b.prototype._updatePop=function(b,f){var d,g=!1;0<b.length&&(this._linked?(1===f?d=b.length-1:-1===f&&(d=0),-1<d&&(jQuery.observable(arr).remove(d),g=!0)):1===f?(b.pop(),g=!0):-1===f&&(b.shift(),g=!0));return g};b.prototype.link=function(b,f){if(window.jQuery){this._links=this._links||{};this._linked||(this._linked=0);var d,g;f&&"object"===typeof f?f.template&&"string"===typeof f.template&&
(d=this.objectId(f.template),g=f.template):d=f;if(!this._links[d]){if(jQuery(b).length){if(!jQuery.templates[d]){if(!g)if(g=jQuery(f),g.length)g=jQuery(g[0]).html();else throw"Unable to bind document to target because template does not exist: "+f;jQuery.views.templates(d,g)}jQuery.templates[d].link(b,this._data);this._links[d]=b;this._linked++;this.debug()&&console.log('ForerunnerDB.Document: Added binding document "'+this.name()+'" to output target: '+b);return this}throw'Cannot bind view data to output target selector "'+
b+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+b+" with the template: "+d;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};b.prototype.unlink=function(b,f){if(window.jQuery){this._links=this._links||{};var d;f&&"object"===typeof f?f.template&&"string"===typeof f.template&&(d=this.objectId(f.template)):d=f;if(this._links[d])return jQuery.templates[d].unlink(b),delete this._links[d],this._linked--,this.debug()&&console.log('ForerunnerDB.Document: Removed binding document "'+
this.name()+'" to output target: '+b),this;console.log("Cannot remove link, one does not exist to the target: "+b+" with the template: "+f)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";};b.prototype.drop=function(){this._db&&this._name&&this._db&&this._db._document&&this._db._document[this._name]&&(delete this._db._document[this._name],this._data={})};k.prototype.init=function(){c.apply(this,arguments)};k.prototype.document=function(a){return a?(this._document=this._document||
{},this._document[a]=this._document[a]||(new b(a)).db(this),this._document[a]):this._document};m.exports=b},{"./Collection":3,"./Shared":17}],8:[function(h,m,e){var k;h=h("./Shared");var c=function(b,a){this.init.apply(this,arguments)};c.prototype.init=function(b,a){this._options=a;this._selector=$(this._options.selector);this._listeners={};this._collection=b;this._options.series=[];var f,d;switch(this._options.type){case "pie":this._selector.highcharts(this._options.chartOptions);this._chart=this._selector.highcharts();
f=this._collection.find();d={allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {y} ({point.percentage:.0f}%)",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}};f=this.pieDataFromCollectionData(f,this._options.keyField,this._options.valField);$.extend(d,this._options.seriesOptions);$.extend(d,{type:"pie",name:this._options.seriesName,data:f});this._chart.addSeries(d);break;case "line":f=this.lineDataFromCollectionData(this._options.seriesField,
this._options.keyField,this._options.valField,this._options.orderBy),this._options.chartOptions.xAxis=f.xAxis,this._options.chartOptions.series=f.series,this._selector.highcharts(this._options.chartOptions),this._chart=this._selector.highcharts()}this._hookEvents()};h=h.modules.Collection;k=h.prototype.init;c.prototype.pieDataFromCollectionData=function(b,a,f){var d=[],g;for(g=0;g<b.length;g++)d.push([b[g][a],b[g][f]]);return d};c.prototype.lineDataFromCollectionData=function(b,a,f,d){var g=this._collection.distinct(b),
c=[],e={categories:[]},k,h,m,X,Y;for(X=0;X<g.length;X++){k=g[X];h={};h[b]=k;m=[];h=this._collection.find(h,{orderBy:d});for(Y=0;Y<h.length;Y++)e.categories.push(h[Y][a]),m.push(h[Y][f]);c.push({name:k,data:m})}return{xAxis:e,series:c}};c.prototype._hookEvents=function(){this._collection.on("change",this._changeListener);this._collection.on("drop",this._dropListener)};c.prototype._changeListener=function(){if("undefined"!==typeof this._collection&&this._chart){var b=this._collection.find();switch(this._options.type){case "pie":this._chart.series[0].setData(this.pieDataFromCollectionData(b,
this._options.keyField,this._options.valField));break;case "line":b=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,this._options.orderBy);this._chart.xAxis[0].setCategories(b.xAxis.categories);for(var a=0;a<b.series.length;a++)this._chart.series[a].setData(b.series[a].data)}}};c.prototype._dropListener=function(){this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener)};c.prototype.drop=function(){this._chart.destroy();
this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener);delete this._collection._highcharts[this._options.selector];delete this._chart;delete this._options;delete this._collection;return this};h.prototype.init=function(){this._highcharts={};k.apply(this,arguments)};h.prototype.chart=function(b){this._highcharts[b.selector]||(this._highcharts[b.selector]=new c(this,b));return this._highcharts[b.selector]};h.prototype.dropChart=function(b){this._highcharts[b]&&
this._highcharts[b].drop()};m.exports=c},{"./Shared":17}],9:[function(h,m,e){e=h("./Shared");var k=h("./Path");h=function(){this.init.apply(this,arguments)};h.prototype.init=function(c,b,a){this._crossRef={};this._size=0;this._id=this._itemKeyHash(c,c);this.data({});this.unique(b&&b.unique?b.unique:!1);void 0!==c&&this.keys(c);void 0!==a&&this.collection(a);this.name(b&&b.name?b.name:this._id)};e.addModule("Index",h);e.inherit(h.prototype,e.chainReactor);h.prototype.id=function(){return this._id};
h.prototype.state=function(){return this._state};h.prototype.size=function(){return this._size};h.prototype.data=function(c){return void 0!==c?(this._data=c,this):this._data};e.synthesize(h.prototype,"name");h.prototype.collection=function(c){return void 0!==c?(this._collection=c,this):this._collection};h.prototype.keys=function(c){return void 0!==c?(this._keys=c,this._keyCount=(new k).parse(this._keys).length,this):this._keys};h.prototype.type=function(c){return void 0!==c?(this._type=c,this):this._type};
h.prototype.unique=function(c){return void 0!==c?(this._unique=c,this):this._unique};h.prototype.rebuild=function(){if(this._collection){var c=this._collection.subset({},{$decouple:!1,$orderBy:this._keys}).find(),b,a=c.length;this._data={};this._unique&&(this._uniqueLookup={});for(b=0;b<a;b++)this.insert(c[b])}this._state={name:this._name,keys:this._keys,indexSize:this._size,built:new Date,updated:new Date,ok:!0}};h.prototype.insert=function(c,b){var a,f;this._unique&&(a=this._itemHash(c,this._keys),
this._uniqueLookup[a]=c);a=this._itemHashArr(c,this._keys);for(f=0;f<a.length;f++)this.pushToPathValue(a[f],c)};h.prototype.remove=function(c,b){var a,f;this._unique&&(a=this._itemHash(c,this._keys),delete this._uniqueLookup[a]);a=this._itemHashArr(c,this._keys);for(f=0;f<a.length;f++)this.pullFromPathValue(a[f],c)};h.prototype.violation=function(c){c=this._itemHash(c,this._keys);return Boolean(this._uniqueLookup[c])};h.prototype.hashViolation=function(c){return Boolean(this._uniqueLookup[c])};h.prototype.pushToPathValue=
function(c,b){var a=this._data[c]=this._data[c]||[];-1===a.indexOf(b)&&(a.push(b),this._size++,this.pushToCrossRef(b,a))};h.prototype.pullFromPathValue=function(c,b){var a=this._data[c],f;f=a.indexOf(b);-1<f&&(a.splice(f,1),this._size--,this.pullFromCrossRef(b,a));a.length||delete this._data[c]};h.prototype.pull=function(c){var b=c[this._collection.primaryKey()],a=this._crossRef[b],f,d=a.length,g;for(f=0;f<d;f++)g=a[f],this._pullFromArray(g,c);this._size--;delete this._crossRef[b]};h.prototype._pullFromArray=
function(c,b){for(var a=c.length;a--;)c[a]===b&&c.splice(a,1)};h.prototype.pushToCrossRef=function(c,b){var a=c[this._collection.primaryKey()];this._crossRef[a]=this._crossRef[a]||[];a=this._crossRef[a];-1===a.indexOf(b)&&a.push(b)};h.prototype.pullFromCrossRef=function(c,b){var a=c[this._collection.primaryKey()];delete this._crossRef[a]};h.prototype.lookup=function(c){return this._data[this._itemHash(c,this._keys)]||[]};h.prototype.match=function(c,b){return(new k).countObjectPaths(this._keys,c)};
h.prototype._itemHash=function(c,b){var a=new k,f,d="",g;f=a.parse(b);for(g=0;g<f.length;g++)d&&(d+="_"),d+=a.value(c,f[g].path).join(":");return d};h.prototype._itemKeyHash=function(c,b){var a=new k,f,d="",g;f=a.parse(b);for(g=0;g<f.length;g++)d&&(d+="_"),d+=a.keyValue(c,f[g].path);return d};h.prototype._itemHashArr=function(c,b){var a=new k,f,d=[],g,e,h,m;f=a.parse(b);for(h=0;h<f.length;h++)for(g=a.value(c,f[h].path),e=0;e<g.length;e++)if(0===h)d.push(g[e]);else for(m=0;m<d.length;m++)d[m]=d[m]+
"_"+g[e];return d};m.exports=h},{"./Path":14,"./Shared":17}],10:[function(h,m,e){h=h("./Shared");e=function(e){this.init.apply(this,arguments)};e.prototype.init=function(e){this._name=e;this._data={};this._primaryKey="_id"};h.addModule("KeyValueStore",e);h.inherit(e.prototype,h.chainReactor);h.synthesize(e.prototype,"name");e.prototype.primaryKey=function(e){return void 0!==e?(this._primaryKey=e,this):this._primaryKey};e.prototype.truncate=function(){this._data={};return this};e.prototype.set=function(e,
c){this._data[e]=c?c:!0;return this};e.prototype.get=function(e){return this._data[e]};e.prototype.lookup=function(e){e=e[this._primaryKey];var c,b,a,f;if(e instanceof Array){b=e.length;f=[];for(c=0;c<b;c++)(a=this._data[e[c]])&&f.push(a);return f}if(e instanceof RegExp){f=[];for(c in this._data)this._data.hasOwnProperty(c)&&e.test(c)&&f.push(this._data[c]);return f}if("object"===typeof e){if(e.$ne){f=[];for(c in this._data)this._data.hasOwnProperty(c)&&c!==e.$ne&&f.push(this._data[c]);return f}if(e.$in&&
e.$in instanceof Array){f=[];for(c in this._data)this._data.hasOwnProperty(c)&&-1<e.$in.indexOf(c)&&f.push(this._data[c]);return f}if(e.$nin&&e.$nin instanceof Array){f=[];for(c in this._data)this._data.hasOwnProperty(c)&&-1===e.$nin.indexOf(c)&&f.push(this._data[c]);return f}if(e.$or&&e.$or instanceof Array){f=[];for(c=0;c<e.$or.length;c++)f=f.concat(this.lookup(e.$or[c]));return f}}else return a=this._data[e],void 0!==a?[a]:[]};e.prototype.unSet=function(e){delete this._data[e];return this};e.prototype.uniqueSet=
function(e,c){return void 0===this._data[e]?(this._data[e]=c,!0):!1};m.exports=e},{"./Shared":17}],11:[function(h,m,e){e=h("./Shared");var k=h("./Operation");h=function(){this.init.apply(this,arguments)};h.prototype.init=function(){this._data=[]};e.addModule("Metrics",h);e.inherit(h.prototype,e.chainReactor);h.prototype.create=function(c){c=new k(c);this._enabled&&this._data.push(c);return c};h.prototype.start=function(){this._enabled=!0;return this};h.prototype.stop=function(){this._enabled=!1;return this};
h.prototype.clear=function(){this._data=[];return this};h.prototype.list=function(){return this._data};m.exports=h},{"./Operation":12,"./Shared":17}],12:[function(h,m,e){e=h("./Shared");var k=h("./Path");h=function(c){this.pathSolver=new k;this.counter=0;this.init.apply(this,arguments)};h.prototype.init=function(c){this._data={operation:c,index:{potential:[],used:!1},steps:[],time:{startMs:0,stopMs:0,totalMs:0,process:{}},flag:{},log:[]}};e.addModule("Operation",h);e.inherit(h.prototype,e.chainReactor);
h.prototype.start=function(){this._data.time.startMs=(new Date).getTime()};h.prototype.log=function(c){if(c){var b=0<this._log.length?this._data.log[this._data.log.length-1].time:0;c={event:c,time:(new Date).getTime(),delta:0};this._data.log.push(c);b&&(c.delta=c.time-b);return this}return this._data.log};h.prototype.time=function(c){if(void 0!==c){var b=this._data.time.process,b=b[c]=b[c]||{};b.startMs?(b.stopMs=(new Date).getTime(),b.totalMs=b.stopMs-b.startMs,b.stepObj.totalMs=b.totalMs,delete b.stepObj):
(b.startMs=(new Date).getTime(),b.stepObj={name:c},this._data.steps.push(b.stepObj));return this}return this._data.time};h.prototype.flag=function(c,b){if(void 0!==c&&void 0!==b)this._data.flag[c]=b;else return void 0!==c?this._data.flag[c]:this._data.flag};h.prototype.data=function(c,b,a){return void 0!==b?(this.pathSolver.set(this._data,c,b),this):this.pathSolver.get(this._data,c)};h.prototype.pushData=function(c,b,a){this.pathSolver.push(this._data,c,b)};h.prototype.stop=function(){this._data.time.stopMs=
(new Date).getTime();this._data.time.totalMs=this._data.time.stopMs-this._data.time.startMs};m.exports=h},{"./Path":14,"./Shared":17}],13:[function(h,m,e){var k,c,b;e=h("./Shared");var a=function(){this.init.apply(this,arguments)};a.prototype.init=function(a){this._name=a;this._data=new b("__FDB__dc_data_"+this._name);this._collData=new c;this._collections=[]};e.addModule("Overview",a);e.inherit(a.prototype,e.chainReactor);c=h("./Collection");b=h("./Document");h=e.modules.Core;k=e.modules.Core.prototype.init;
e.synthesize(a.prototype,"db");e.synthesize(a.prototype,"name");e.synthesize(a.prototype,"query",function(b){var a=this.$super(b);void 0!==b&&this._refresh();return a});e.synthesize(a.prototype,"queryOptions",function(b){var a=this.$super(b);void 0!==b&&this._refresh();return a});e.synthesize(a.prototype,"reduce",function(b){var a=this.$super(b);void 0!==b&&this._refresh();return a});a.prototype.debug=e.common.debug;a.prototype.objectId=e.common.objectId;a.prototype.from=function(b){void 0!==b&&("string"===
typeof b&&(b=this._db.collection(b)),this._addCollection(b));return this};a.prototype.find=function(){return this._collData.find.apply(this._collData,arguments)};a.prototype.count=function(){return this._collData.count.apply(this._collData,arguments)};a.prototype._addCollection=function(b){-1===this._collections.indexOf(b)&&(this._collections.push(b),b.chain(this),this._refresh());return this};a.prototype._removeCollection=function(b){-1<this._collections.indexOf(b)&&(this._collections.splice(b,1),
b.unChain(this),this._refresh());return this};a.prototype._refresh=function(){if(this._collections&&this._collections[0]){this._collData.primaryKey(this._collections[0].primaryKey());var b=[],a;for(a=0;a<this._collections.length;a++)b=b.concat(this._collections[a].find(this._query,this._queryOptions));this._collData.setData(b)}this._reduce&&(b=this._reduce(),this._data.setData(b))};a.prototype._chainHandler=function(b){switch(b.type){case "setData":case "insert":case "update":case "remove":this._refresh()}};
a.prototype.link=function(b,a){this._data.link.apply(this._data,arguments);this._refresh()};a.prototype.unlink=function(b,a){this._data.unlink.apply(this._data,arguments);this._refresh()};h.prototype.init=function(){this._overview={};k.apply(this,arguments)};h.prototype.overview=function(b){return b?(this._overview[b]=this._overview[b]||(new a(b)).db(this),this._overview[b]):this._overview};m.exports=a},{"./Collection":3,"./Document":7,"./Shared":17}],14:[function(h,m,e){h=h("./Shared");e=function(e){this.init.apply(this,
arguments)};e.prototype.init=function(e){e&&this.path(e)};h.addModule("Path",e);h.inherit(e.prototype,h.chainReactor);e.prototype.path=function(e){return void 0!==e?(this._path=this.clean(e),this._pathParts=this._path.split("."),this):this._path};e.prototype.hasObjectPaths=function(e,c){var b=!0,a;for(a in e)if(e.hasOwnProperty(a)&&(void 0===c[a]||"object"===typeof e[a]&&(b=this.hasObjectPaths(e[a],c[a]),!b)))return!1;return b};e.prototype.countKeys=function(e){var c=0,b;for(b in e)e.hasOwnProperty(b)&&
void 0!==e[b]&&("object"!==typeof e[b]?c++:c+=this.countKeys(e[b]));return c};e.prototype.countObjectPaths=function(e,c){var b,a={},f=0,d=0,g;for(g in c)c.hasOwnProperty(g)&&("object"===typeof c[g]?(b=this.countObjectPaths(e[g],c[g]),a[g]=b.matchedKeys,d+=b.totalKeyCount,f+=b.matchedKeyCount):(d++,e&&e[g]&&"object"!==typeof e[g]?(a[g]=!0,f++):a[g]=!1));return{matchedKeys:a,matchedKeyCount:f,totalKeyCount:d}};e.prototype.parse=function(e,c){var b=[],a="",f,d,g;for(d in e)if(e.hasOwnProperty(d))if(a=
d,"object"===typeof e[d])if(c)for(f=this.parse(e[d],c),g=0;g<f.length;g++)b.push({path:a+"."+f[g].path,value:f[g].value});else for(f=this.parse(e[d]),g=0;g<f.length;g++)b.push({path:a+"."+f[g].path});else c?b.push({path:a,value:e[d]}):b.push({path:a});return b};e.prototype.parseArr=function(e,c){c=c||{};return this._parseArr(e,"",[],c)};e.prototype._parseArr=function(e,c,b,a){var f,d="";c=c||"";b=b||[];for(f in e)e.hasOwnProperty(f)&&(!a.ignore||a.ignore&&!a.ignore.test(f))&&(d=c?c+"."+f:f,"object"===
typeof e[f]?this._parseArr(e[f],d,b,a):b.push(d));return b};e.prototype.value=function(e,c){if(void 0!==e&&"object"===typeof e){var b,a,f,d,g=[],h;void 0!==c&&(c=this.clean(c),b=c.split("."));b=b||this._pathParts;a=b.length;f=e;for(h=0;h<a;h++){f=f[b[h]];if(d instanceof Array){for(a=0;a<d.length;a++)g=g.concat(this.value(d,a+"."+b[h]));return g}if(!f||"object"!==typeof f)break;d=f}return[f]}return[]};e.prototype.set=function(e,c,b){if(void 0!==e&&void 0!==c){var a;c=this.clean(c);c=c.split(".");a=
c.shift();c.length?(e[a]=e[a]||{},this.set(e[a],c.join("."),b)):e[a]=b}return e};e.prototype.get=function(e,c){return this.value(e,c)[0]};e.prototype.push=function(e,c,b){if(void 0!==e&&void 0!==c){var a;c=this.clean(c);c=c.split(".");a=c.shift();if(c.length)e[a]=e[a]||{},this.set(e[a],c.join("."),b);else if(e[a]=e[a]||[],e[a]instanceof Array)e[a].push(b);else throw"Cannot push to a path whose endpoint is not an array!";}return e};e.prototype.keyValue=function(e,c){var b,a,f,d,g;void 0!==c&&(c=this.clean(c),
b=c.split("."));b=b||this._pathParts;a=b.length;f=e;for(g=0;g<a;g++)if(f=f[b[g]],!f||"object"!==typeof f){d=b[g]+":"+f;break}return d};e.prototype.clean=function(e){"."===e.substr(0,1)&&(e=e.substr(1,e.length-1));return e};m.exports=e},{"./Shared":17}],15:[function(h,m,e){e=h("./Shared");var k,c,b,a;a=function(){this.init.apply(this,arguments)};a.prototype.init=function(b){b.isClient()&&void 0!==Storage&&this.mode("localStorage")};e.addModule("Persist",a);e.inherit(a.prototype,e.chainReactor);e=e.modules.Core;
k=h("./Collection");c=k.prototype.drop;h("./CollectionGroup");b=e.prototype.init;a.prototype.mode=function(b){return void 0!==b?(this._mode=b,this):this._mode};a.prototype.save=function(b,a,c){switch(this.mode()){case "localStorage":a="object"===typeof a?"json::fdb::"+JSON.stringify(a):"raw::fdb::"+a;try{localStorage.setItem(b,a)}catch(e){if(c)c(e);else throw e;break}if(c)c(!1);else return!1;break;default:if(c)c("No data handler.");else throw"No data handler.";}};a.prototype.load=function(b,a){var c,
e;switch(this.mode()){case "localStorage":try{c=localStorage.getItem(b)}catch(h){a(h,null)}if(c){c=c.split("::fdb::");switch(c[0]){case "json":e=JSON.parse(c[1]);break;case "raw":e=c[1]}if(a)a(!1,e);else return e}break;default:if(a)a("No data handler or unrecognised data type.");else throw"No data handler or unrecognised data type.";}};a.prototype.drop=function(b,a){switch(this.mode()){case "localStorage":try{localStorage.removeItem(b)}catch(c){a&&a(c)}a&&a(!1);break;default:a&&a("No data handler or unrecognised data type.")}};
k.prototype.drop=function(b){if(b)if(this._name)if(this._db)this._db.persist.drop(this._name);else return callback&&callback("Cannot drop a collection's persistent storage when the collection is not attached to a database!"),"Cannot drop a collection's persistent storage when the collection is not attached to a database!";else return callback&&callback("Cannot drop a collection's persistent storage when no name assigned to collection!"),"Cannot drop a collection's persistent storage when no name assigned to collection!";
c.apply(this)};k.prototype.save=function(b){if(this._name)if(this._db)this._db.persist.save(this._name,this._data,b);else return b&&b("Cannot save a collection that is not attached to a database!"),"Cannot save a collection that is not attached to a database!";else return b&&b("Cannot save a collection with no assigned name!"),"Cannot save a collection with no assigned name!"};k.prototype.load=function(b){var a=this;if(this._name)if(this._db)this._db.persist.load(this._name,function(c,e){if(c)return b&&
b(c),c;e&&a.setData(e);b&&b(!1)});else return b&&b("Cannot load a collection that is not attached to a database!"),"Cannot load a collection that is not attached to a database!";else return b&&b("Cannot load a collection with no assigned name!"),"Cannot load a collection with no assigned name!"};e.prototype.init=function(){this.persist=new a(this);b.apply(this,arguments)};m.exports=a},{"./Collection":3,"./CollectionGroup":4,"./Shared":17}],16:[function(h,m,e){h=h("./Shared");e=function(e,c,b){if(e&&
c&&b){this._reactorIn=e;this._reactorOut=c;this._chainHandler=b;if(!e.chain||!c.chainReceive)throw"ReactorIO requires passed in and out objects to implement the ChainReactor mixin!";e.chain(this);this.chain(c)}else throw"ReactorIO requires an in, out and process argument to instantiate!";};e.prototype.drop=function(){this._reactorIn.unChain(this);this.unChain(this._reactorOut);delete this._reactorIn;delete this._reactorOut;delete this._chainHandler};h.addModule("ReactorIO",e);h.inherit(e.prototype,
h.chainReactor);m.exports=e},{"./Shared":17}],17:[function(h,m,e){var k=0,c=function(b){var a=[],f,d=["string","object","number","function","undefined"],g;if(-1<b.indexOf("*"))for(g=0;g<d.length;g++)f=b.replace("*",d[g]),a=a.concat(c(f));else a.push(b);return a};e=function(b){if(b){var a,f,d,g,e;if(!(b instanceof Array)){d={};for(a in b)if(b.hasOwnProperty(a))if(g=a.replace(/ /g,""),-1===g.indexOf("*"))d[g]=b[a];else for(e=c(g),g=0;g<e.length;g++)d[e[g]]||(d[e[g]]=b[a]);b=d}return function(){if(b instanceof
Array)for(f=b.length,a=0;a<f;a++){if(b[a].length===arguments.length)return b[a].apply(this,arguments)}else{var d=[],c;for(a=0;a<arguments.length;a++)d.push(typeof arguments[a]);c=d.join(",");if(b[c])return b[c].apply(this,arguments);for(a=d.length;0<=a;a--)if(c=d.slice(0,a).join(","),b[c+",..."])return b[c+",..."].apply(this,arguments)}throw"Overloaded method does not have a matching signature for the passed arguments!";}}return function(){}};h={modules:{},common:{decouple:function(b){if(void 0!==
b)return JSON.parse(JSON.stringify(b))},objectId:function(b){var a=Math.pow(10,17);if(b){var c=0,d=b.length,g;for(g=0;g<d;g++)c+=b.charCodeAt(g)*a;b=c.toString(16)}else k++,b=(k+(Math.random()*a+Math.random()*a+Math.random()*a+Math.random()*a)).toString(16);return b},debug:new e([function(){return this._debug&&this._debug.all},function(b){return void 0!==b?"boolean"===typeof b?(this._debug=this._debug||{},this._debug.all=b,this.chainSend("debug",this._debug),this):this._debug&&this._debug[b]||this._db&&
this._db._debug&&this._db._debug[b]||this._debug&&this._debug.all:this._debug&&this._debug.all},function(b,a){return void 0!==b?void 0!==a?(this._debug=this._debug||{},this._debug[b]=a,this.chainSend("debug",this._debug),this):this._debug&&this._debug[a]||this._db&&this._db._debug&&this._db._debug[b]:this._debug&&this._debug.all}]),on:new e({"string, function":function(b,a){this._listeners=this._listeners||{};this._listeners[b]=this._listeners[b]||{};this._listeners[b]["*"]=this._listeners[b]["*"]||
[];this._listeners[b]["*"].push(a);return this},"string, *, function":function(b,a,c){this._listeners=this._listeners||{};this._listeners[b]=this._listeners[b]||{};this._listeners[b][a]=this._listeners[b][a]||[];this._listeners[b][a].push(c);return this}}),off:new e({string:function(b){this._listeners&&this._listeners[b]&&b in this._listeners&&delete this._listeners[b];return this},"string, function":function(b,a){var c,d;"string"===typeof a?this._listeners&&this._listeners[b]&&this._listeners[b][a]&&
delete this._listeners[b][a]:b in this._listeners&&(c=this._listeners[b]["*"],d=c.indexOf(a),-1<d&&c.splice(d,1));return this},"string, *, function":function(b,a,c){this._listeners&&b in this._listeners&&a in this.listeners[b]&&(b=this._listeners[b][a],c=b.indexOf(c),-1<c&&b.splice(c,1))},"string, *":function(b,a){this._listeners&&b in this._listeners&&a in this._listeners[b]&&delete this._listeners[b][a]}}),emit:function(b,a){this._listeners=this._listeners||{};if(b in this._listeners){if(this._listeners[b]["*"]){var c=
this._listeners[b]["*"],d=c.length,g;for(g=0;g<d;g++)c[g].apply(this,Array.prototype.slice.call(arguments,1))}if(a instanceof Array&&a[0]&&a[0][this._primaryKey]){var c=this._listeners[b],e,h,d=a.length;for(g=0;g<d;g++)if(c[a[g][this._primaryKey]])for(e=c[a[g][this._primaryKey]].length,h=0;h<e;h++)c[a[g][this._primaryKey]][h].apply(this,Array.prototype.slice.call(arguments,1))}}return this}},_synth:{},addModule:function(b,a){this.modules[b]=a},inherit:function(b,a){for(var c in a)a.hasOwnProperty(c)&&
(b[c]=a[c])},synthesize:function(b,a,c){this._synth[a]=this._synth[a]||function(b){return void 0!==b?(this["_"+a]=b,this):this["_"+a]};if(c){var d=this;b[a]=function(){var b=this.$super,e;this.$super=d._synth[a];e=c.apply(this,arguments);this.$super=b;return e}}else b[a]=this._synth[a]},overload:e,chainReactor:h("./ChainReactor")};m.exports=h},{"./ChainReactor":2}],18:[function(h,m,e){var k,c,b,a;e=h("./Shared");var f=function(b,a,c){this.init.apply(this,arguments)};f.prototype.init=function(b,a,
c){this._name=b;this._groups=[];this._listeners={};this._querySettings={query:a,options:c};this._debug={};this._privateData=new k("__FDB__view_privateData_"+this._name)};e.addModule("View",f);e.inherit(f.prototype,e.chainReactor);k=h("./Collection");CollectionGroup=h("./CollectionGroup");a=h("./ReactorIO");c=k.prototype.init;h=e.modules.Core;b=h.prototype.init;e.synthesize(f.prototype,"name");f.prototype.debug=e.common.debug;f.prototype.insert=function(){this._from.insert.apply(this._from,arguments)};
f.prototype.update=function(){this._from.update.apply(this._from,arguments)};f.prototype.updateById=function(){this._from.updateById.apply(this._from,arguments)};f.prototype.remove=function(){this._from.remove.apply(this._from,arguments)};f.prototype.find=function(b,a){return this.publicData().find(b,a)};f.prototype.link=function(b,a){var c=this.publicData();this.debug()&&console.log('ForerunnerDB.View: Setting up data binding on view "'+this.name()+'" in underlying (internal) view collection "'+
c.name()+'" for output target: '+b);return c.link(b,a)};f.prototype.unlink=function(b,a){var c=this.publicData();this.debug()&&console.log('ForerunnerDB.View: Removing data binding on view "'+this.name()+'" in underlying (internal) view collection "'+c.name()+'" for output target: '+b);return c.unlink(b,a)};f.prototype.decouple=e.common.decouple;f.prototype.from=function(b){var c=this;if(void 0!==b){"string"===typeof b&&(b=this._db.collection(b));this._from=b;this._io=new a(b,this,function(b){var a,
d,e;if("insert"===b.type){if(c._querySettings.query){a=b.data;if(a instanceof Array)for(d=[],b=0;b<a.length;b++)c._privateData._match(a[b],c._querySettings.query,"and")&&(d.push(a[b]),e=!0);else c._privateData._match(a,c._querySettings.query,"and")&&(d=a,e=!0);e&&this.chainSend("insert",d);return!0}return!1}if("update"===b.type){if(c._querySettings.query&&(d=c._privateData.diff(c._from.subset(c._querySettings.query,c._querySettings.options)),d.insert.length||d.remove.length)){d.insert.length&&this.chainSend("insert",
d.insert);if(d.update.length)for(a=c._privateData.primaryKey(),b=0;b<d.update.length;b++)e={},e[a]=d.update[b][a],this.chainSend("update",{query:e,update:d.update[b]});d.remove.length&&this.chainSend("remove",d.remove);return!0}return!1}});var e=b.find(this._querySettings.query,this._querySettings.options);this._transformPrimaryKey(b.primaryKey());this._transformInsert(e);this._privateData.primaryKey(b.primaryKey());this._privateData.insert(e)}return this};f.prototype._chainHandler=function(b){var a,
c,e,f;switch(b.type){case "setData":this.debug()&&console.log('ForerunnerDB.View: Setting data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');b.data=this.decouple(b.data);this._transformSetData(b.data);this._privateData.setData(b.data);break;case "insert":this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');b.data=this.decouple(b.data);
b.data instanceof Array||(b.data=[b.data]);a=this._privateData._data.length;this._transformInsert(b.data,a);this._privateData._insertHandle(b.data,a);this._refreshSort(b.data);break;case "update":this.debug()&&console.log('ForerunnerDB.View: Updating some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');this._privateData.primaryKey();b=this._privateData.update(b.data.query,b.data.update,b.data.options);this._refreshSort(b);if(this._transformEnabled&&
this._transformIn)for(a=this._publicData.primaryKey(),f=0;f<b.length;f++)c={},e=b[f],c[a]=e[a],this._transformUpdate(c,e);break;case "remove":this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"'),this._transformRemove(b.data.query,b.options),this._privateData.remove(b.data.query,b.options)}};f.prototype._refreshSort=function(b){if(this._querySettings.options&&this._querySettings.options.$orderBy){var a,
c,e,f;b||(b=this._privateData._data);a=[].concat(this._privateData._data);a=this._privateData.sort(this._querySettings.options.$orderBy,a);a.sort(function(b,c){return a.indexOf(b)-a.indexOf(c)});for(f=0;f<b.length;f++)c=this._privateData._data.indexOf(b[f]),e=a.indexOf(b[f]),c!==e&&this._privateData._updateSpliceMove(this._privateData._data,c,e)}};f.prototype.on=function(){this._privateData.on.apply(this._privateData,arguments)};f.prototype.off=function(){this._privateData.off.apply(this._privateData,
arguments)};f.prototype.emit=function(){this._privateData.emit.apply(this._privateData,arguments)};f.prototype.drop=function(){return this._from?((this.debug()||this._db&&this._db.debug())&&console.log("ForerunnerDB.View: Dropping view "+this._name),this._io.drop(),this._privateData.drop(),!0):!1};f.prototype.db=function(b){return void 0!==b?(this._db=b,this.privateData().db(b),this.publicData().db(b),this):this._db};f.prototype.primaryKey=function(){return this._privateData.primaryKey()};f.prototype.queryData=
function(b,a,c){void 0!==b&&(this._querySettings.query=b);void 0!==a&&(this._querySettings.options=a);return void 0!==b||void 0!==a?(void 0!==c&&!0!==c||this.refresh(),this):this._querySettings};f.prototype.queryAdd=function(b,a,c){var e=this._querySettings.query,f;if(void 0!==b)for(f in b)b.hasOwnProperty(f)&&(void 0===e[f]||void 0!==e[f]&&a)&&(e[f]=b[f]);void 0!==c&&!0!==c||this.refresh()};f.prototype.queryRemove=function(b,a){var c=this._querySettings.query,e;if(void 0!==b)for(e in b)b.hasOwnProperty(e)&&
delete c[e];void 0!==a&&!0!==a||this.refresh()};f.prototype.query=function(b,a){return void 0!==b?(this._querySettings.query=b,void 0!==a&&!0!==a||this.refresh(),this):this._querySettings.query};f.prototype.queryOptions=function(b,a){return void 0!==b?(this._querySettings.options=b,void 0===b.$decouple&&(b.$decouple=!0),void 0!==a&&!0!==a||this.refresh(),this):this._querySettings.options};f.prototype.refresh=function(){if(this._from){var b=this.publicData();this._privateData.remove();b.remove();this._privateData.insert(this._from.find(this._querySettings.query,
this._querySettings.options));if(b._linked){var a=this._privateData.find();jQuery.observable(b._data).refresh(a)}}return this};f.prototype.count=function(){return this._privateData&&this._privateData._data?this._privateData._data.length:0};f.prototype.transform=function(b){return void 0!==b?("object"===typeof b?(void 0!==b.enabled&&(this._transformEnabled=b.enabled),void 0!==b.dataIn&&(this._transformIn=b.dataIn),void 0!==b.dataOut&&(this._transformOut=b.dataOut)):this._transformEnabled=!1===b?!1:
!0,this._transformPrimaryKey(this.privateData().primaryKey()),this._transformSetData(this.privateData().find()),this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};f.prototype.privateData=function(){return this._privateData};f.prototype.publicData=function(){return this._transformEnabled?this._publicData:this._privateData};f.prototype._transformSetData=function(b){this._transformEnabled&&(this._publicData=new k("__FDB__view_publicData_"+this._name),this._publicData.db(this._privateData._db),
this._publicData.transform({enabled:!0,dataIn:this._transformIn,dataOut:this._transformOut}),this._publicData.setData(b))};f.prototype._transformInsert=function(b,a){this._transformEnabled&&this._publicData&&this._publicData.insert(b,a)};f.prototype._transformUpdate=function(b,a,c){this._transformEnabled&&this._publicData&&this._publicData.update(b,a,c)};f.prototype._transformRemove=function(b,a){this._transformEnabled&&this._publicData&&this._publicData.remove(b,a)};f.prototype._transformPrimaryKey=
function(b){this._transformEnabled&&this._publicData&&this._publicData.primaryKey(b)};k.prototype.init=function(){this._views=[];c.apply(this,arguments)};k.prototype.view=function(b,a,c){if(this._db&&this._db._views){if(this._db._views[b])throw"Cannot create a view using this collection because one with this name already exists: "+b;b=(new f(b,a,c)).db(this._db)._addCollection(this);this._views=this._views||[];this._views.push(b);return b}};k.prototype._addView=CollectionGroup.prototype._addView=
function(b){void 0!==b&&this._views.push(b);return this};k.prototype._removeView=CollectionGroup.prototype._removeView=function(b){void 0!==b&&(b=this._views.indexOf(b),-1<b&&this._views.splice(b,1));return this};h.prototype.init=function(){this._views={};b.apply(this,arguments)};h.prototype.view=function(b){this._views[b]||(this.debug()||this._db&&this._db.debug())&&console.log("Core.View: Creating view "+b);this._views[b]=this._views[b]||(new f(b)).db(this);return this._views[b]};h.prototype.viewExists=
function(b){return Boolean(this._views[b])};h.prototype.views=function(){var b=[],a;for(a in this._views)this._views.hasOwnProperty(a)&&b.push({name:a,count:this._views[a].count()});return b};m.exports=f},{"./Collection":3,"./CollectionGroup":4,"./ReactorIO":16,"./Shared":17}],19:[function(h,m,e){window.jQuery&&(this.jQuery=window.jQuery,function(){(function(e,c,b){function a(b){return b}function f(b){debugger;return b}function d(b){ba=(xa._dbgMode=b)?"Unavailable (nested view): use #getIndex()":
"";Ba("dbg",Ha.dbg=na.dbg=b?f:a)}function g(b){this.name=(s.link?"JsViews":"JsRender")+" Error";this.message=b||this.name}function h(b,a){for(var c in a)b[c]=a[c];return b}function m(b){return"function"===typeof b}function sa(b,a,c){if(!P.rTag||b)x=b?b.charAt(0):x,S=b?b.charAt(1):S,M=a?a.charAt(0):M,I=a?a.charAt(1):I,O=c||O,b="\\"+x+"(\\"+O+")?\\"+S,a="\\"+M+"\\"+I,C="(?:(?:(\\w+(?=[\\/\\s\\"+M+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+M+"]|\\"+M+"(?!\\"+I+"))*?)",P.rTag=
C+")",C=RegExp(b+C+"(\\/)?|(?:\\/(\\w+)))"+a,"g"),pa=RegExp("<.*>|([^\\\\]|^)[{}]|"+b+".*"+a);return[x,S,M,I,O]}function Ja(a,c){c||(c=a,a=b);var d,e,f,g;f=this;d=!c||"root"===c;if(a){if(g=f.type===c?f:b,!g)if(d=f.views,f._.useKey)for(e in d){if(g=d[e].get(a,c))break}else for(e=0,f=d.length;!g&&e<f;e++)g=d[e].get(a,c)}else if(d)for(;f.parent.parent;)g=f=f.parent;else for(;f&&!g;)g=f.type===c?f:b,f=f.parent;return g}function fa(){var a=this.get("item");return a?a.index:b}function X(){return this.index}
function Y(a){var c,d=this,f=d.linkCtx,g=(d.ctx||{})[a];g===b&&f&&f.ctx&&(g=f.ctx[a]);g===b&&(g=Ha[a]);g&&m(g)&&!g._wrp&&(c=function(){return g.apply(this&&this!==e?this:d,arguments)},c._wrp=1,h(c,g));return c||g}function n(a,c,d){var e,f,g=+d===d&&d,h=c.linkCtx;g&&(d=(g=c.tmpl.bnds[g-1])(c.data,c,G));e=d.args[0];if(a||g){e=h&&h.tag;e||(e={_:{inline:!h,bnd:g},tagName:":",cvt:a,flow:!0,tagCtx:d,_is:"tag"},h&&(h.tag=e,e.linkCtx=h,d.ctx=F(d.ctx,h.view.ctx)),P._lnk(e));for(f in d.props)Na.test(f)&&(e[f]=
d.props[f]);d.view=c;e.ctx=d.ctx||{};delete d.ctx;c._.tag=e;e=q(e,e.convert||"true"!==a&&a)[0];e=g&&c._.onRender?c._.onRender(e,c,g):e;c._.tag=b}return e!=b?e:""}function q(b,a){var c=b.tagCtx,d=c.view,e=c.args;a=a&&(""+a===a?d.getRsc("converters",a)||la("Unknown converter: '"+a+"'"):a);e=e.length||c.index?a?e.slice():e:[d.data];a&&(a.depends&&(b.depends=P.getDeps(b.depends,b,a.depends,a)),e[0]=a.apply(b,e));return e}function p(a,c){for(var e,d=this;e===b&&d;)e=(e=d.tmpl[a])&&e[c],d=d.parent;return e||
G[a][c]}function l(a,c,e,d,f){var g,k,r,l,D,m,u,t,s,p,z,H="",n=+d===d&&d,C=c.linkCtx||0,w=c.ctx,x=e||c.tmpl;"tag"===a._is&&(g=a,a=g.tagName,d=g.tagCtxs);g=g||C.tag;n&&(d=(t=x.bnds[n-1])(c.data,c,G));m=d.length;for(D=0;D<m;D++){D||e&&g||(s=c.getRsc("tags",a)||la("Unknown tag: {{"+a+"}}"));k=d[D];C.tag||(u=k.tmpl,u=k.content=u&&x.tmpls[u-1],h(k,{tmpl:(g?g:s).template||u,render:U,index:D,view:c,ctx:F(k.ctx,w)}));if(e=k.props.tmpl)e=""+e===e?c.getRsc("templates",e)||Da(e):e,k.tmpl=e;g||(s._ctr?(g=new s._ctr,
p=!!g.init,g.attr=g.attr||s.attr||b):P._lnk(g={render:s.render}),g._={inline:!C},C&&(C.attr=g.attr=C.attr||g.attr,C.tag=g,g.linkCtx=C),(g._.bnd=t||C.fn)?g._.arrVws={}:g.dataBoundOnly&&la("{^{"+a+"}} tag must be data-bound"),g.tagName=a,g.parent=l=w&&w.tag,g._is="tag",g._def=s,g.tagCtxs=d);if(!D)for(z in u=k.props)Na.test(z)&&(g[z]=u[z]);k.tag=g;g.dataMap&&g.tagCtxs&&(k.map=g.tagCtxs[D].map);g.flow||(u=k.ctx=k.ctx||{},k=g.parents=u.parentTags=w&&F(u.parentTags,w.parentTags)||{},l&&(k[l.tagName]=l),
u.tag=g)}c._.tag=g;g.rendering={};for(D=0;D<m;D++){k=g.tagCtx=g.tagCtxs[D];u=k.props;a=q(g,g.convert);if(d=u.dataMap||g.dataMap)if(a.length||u.dataMap){l=k.map;if(!l||l.src!==a[0]||f)l&&l.src&&l.unmap(),l=k.map=d.map(a[0],u);a=[l.tgt]}g.ctx=k.ctx;!D&&p&&(d=g.template,g.init(k,C,g.ctx),p=b,g.template!==d&&(g._.tmpl=g.template));l=b;if(d=g.render)l=d.apply(g,a);a=a.length?a:[c];l=l!==b?l:k.render(a[0],!0)||(f?b:"");H=H?H+(l||""):l}delete g.rendering;g.tagCtx=g.tagCtxs[0];g.ctx=g.tagCtx.ctx;g._.inline&&
(r=g.attr)&&r!==N&&(H="text"===r?na.html(H):"");return n&&c._.onRender?c._.onRender(H,c,n):H}function Z(b,a,c,e,d,f,g,h){var k="array"===a,r={key:0,useKey:k?0:1,id:""+La++,onRender:h,bnds:{}};this.data=e;this.tmpl=d;this.content=g;this.views=k?[]:{};this.parent=c;this.type=a;this._=r;this.linked=!!h;c?(a=c.views,e=c._,e.useKey?(a[r.key="_"+e.useKey++]=this,this.index=ba,this.getIndex=fa,f=e.tag,r.bnd=k&&(!f||!!f._.bnd&&f)):a.splice(r.key=this.index=f,0,this),this.ctx=b||c.ctx):this.ctx=b}function E(b){var a,
c,e,d,f,g;for(a in K)if(d=K[a],(f=d.compile)&&(c=b[a+"s"]))for(e in c)(d=c[e]=f(e,c[e],b))&&(g=P.onStore[a])&&g(e,d,f)}function aa(a,c,e){m(c)?c={depends:c.depends,render:c}:(c.baseTag&&(c.flow=!!c.flow,c=h(h({},c.baseTag),c)),(a=c.template)!==b&&(c.template=""+a===a?Da[a]||Da(a):a),!1!==c.init&&(a=c._ctr=function(){},(a.prototype=c).constructor=a));e&&(c._parentTmpl=e);return c}function ma(a,d,f,g){function h(d){if(""+d===d||0<d.nodeType){try{l=0<d.nodeType?d:!pa.test(d)&&c&&c(e.document).find(d)[0]}catch(r){}l&&
(d=Da[a=a||l.getAttribute(V)],d||(a=a||"_"+Q++,l.setAttribute(V,a),d=Da[a]=ma(a,l.innerHTML,f,g)),l=b);return d}}var r,l;d=d||"";r=h(d);g=g||(d.markup?d:{});g.tmplName=a;f&&(g._parentTmpl=f);!r&&d.markup&&(r=h(d.markup))&&r.fn&&(r.debug!==d.debug||r.allowCode!==d.allowCode)&&(r=r.markup);if(r!==b)return a&&!f&&(w[a]=function(){return d.render.apply(d,arguments)}),r.fn||d.fn?r.fn&&(d=a&&a!==r.tmplName?F(g,r):r):(d=Ma(r,g),Fa(r.replace(y,"\\$&"),d)),E(g),d}function oa(b){function a(c,d){this.tgt=b.getTgt(c,
d)}m(b)&&(b={getTgt:b});b.baseMap&&(b=h(h({},b.baseMap),b));b.map=function(b,c){return new a(b,c)};return b}function Ma(b,a){var c,d=xa.wrapMap||{},e=h({markup:b,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:ta},a);a.htmlTag||(c=ca.exec(b),e.htmlTag=c?c[1].toLowerCase():"");(c=d[e.htmlTag])&&c!==d.div&&(e.markup=s.trim(e.markup));return e}function qa(a,c){function d(f,g,h){var k,r,l;if(f&&"object"===typeof f&&!f.nodeType&&!f.markup&&!f.getTgt){for(r in f)d(r,f[r],g);return G}g===b&&(g=f,
f=b);f&&""+f!==f&&(h=g,g=f,f=b);l=h?h[e]=h[e]||{}:d;r=c.compile;null===g?f&&delete l[f]:(g=r?g=r(f,g,h):g,f&&(l[f]=g));r&&g&&(g._is=a);g&&(k=P.onStore[a])&&k(f,g,r);return g}var e=a+"s";G[e]=d;K[a]=c}function ra(b,a){var c=this.jquery&&(this[0]||la('Unknown template: "'+this.selector+'"')),d=c.getAttribute(V);return ta.call(d?Da[d]:Da(c),b,a)}function ya(b,a,c){if(xa._dbgMode)try{return b.fn(a,c,G)}catch(d){return la(d,c)}return b.fn(a,c,G)}function ta(b,a,c,d,e,f){return d||!this.fn._nvw||s.isArray(b)?
U.call(this,b,a,c,d,e,f):ya(this,b,{tmpl:this})}function U(a,c,d,e,f,g){var h,k,r,l,D,u,m,t,p;r=this;var z="";!!c===c&&(d=c,c=b);!0===f&&(h=!0,f=0);r.tag?(u=r,r=r.tag,k=r._,D=r.tagName,t=k.tmpl||u.tmpl,p=r.attr&&r.attr!==N,c=F(c,r.ctx),m=u.content,!1===u.props.link&&(c=c||{},c.link=!1),e=e||u.view,a=arguments.length?a:e):t=r;if(t&&(!e&&a&&"view"===a._is&&(e=a),e&&(m=m||e.content,g=g||e._.onRender,a===e&&(a=e.data),c=F(c,e.ctx)),e&&e.data!==b||((c=c||{}).root=a),t.fn||(t=Da[t]||Da(t)),t)){u=g=!1!==
(c&&c.link)&&!p&&g;!0===g&&(u=b,g=e._.onRender);c=t.helpers?F(t.helpers,c):c;if(s.isArray(a)&&!d)for(l=h?e:f!==b&&e||new Z(c,"array",e,a,t,f,m,g),h=0,k=a.length;h<k;h++)r=a[h],D=new Z(c,"item",l,r,t,(f||0)+h,m,g),r=ya(t,r,D),z+=l._.onRender?l._.onRender(r,D):r;else{if(e||!t.fn._nvw)l=h?e:new Z(c,D||"data",e,a,t,f,m,g),k&&!r.flow&&(l.tag=r);z+=ya(t,a,l)}return u?u(z,l):z}return""}function la(b,a,c){c=xa.onError(b,a,c);if(""+b===b)throw new P.Err(c);return!a.linkCtx&&a.linked?na.html(c):c}function ga(b){la("Syntax error\n"+
b)}function Fa(b,a,c,d){function e(a){(a-=F)&&t.push(b.substr(F,a).replace(ja,"\\n"))}function f(a){a&&ga('Unmatched or missing tag: "{{/'+a+'}}" in template:\n'+b)}var g,h,k,l=a&&a.allowCode,u=[],F=0,m=[],t=u,s=[,,u];c&&(b=x+b+I);f(m[0]&&m[0][2].pop()[0]);b.replace(C,function(g,D,u,p,z,H,n,q,C,w,x,G){H&&(z=":",p=N);w=w||c;D=(D||c)&&[];var y="",A="",ha="",ua="",ka="",Ka="",Oa="",Xa="";n=!w&&!z&&!n;u=u||(C=C||"#data",z);e(G);F=G+g.length;q?l&&t.push(["*","\n"+C.replace(ia,"$1")+"\n"]):u?("else"===
u&&(R.test(C)&&ga('for "{{else if expr}}" use "{{else expr}}"'),D=s[7],s[8]=b.substring(s[8],G),s=m.pop(),t=s[2],n=!0),C&&r(C.replace(ja," "),D,a).replace(J,function(b,a,c,d,e,f,g,h){g?(A+=f+",",ua+="'"+h+"',"):c?(ha+=d+f+",",Ka+=d+"'"+h+"',"):a?Oa+=f:("trigger"===e&&(Xa+=f),y+=d+f+",",ka+=d+"'"+h+"',",k=k||Na.test(e));return""}).slice(0,-1),h=[u,p||!!d||k||"",n&&[],[ua.slice(0,-1),ka.slice(0,-1),Ka.slice(0,-1)],[A.slice(0,-1),y.slice(0,-1),ha.slice(0,-1)],Oa,Xa,D||0],t.push(h),n&&(m.push(s),s=h,
s[8]=F)):x&&(f(x!==s[0]&&"else"!==s[0]&&x),s[8]=b.substring(s[8],G),s=m.pop());f(!s&&x);t=s[2]});e(b.length);(F=u[u.length-1])&&f(""+F!==F&&+F[8]===F[8]&&F[0]);c?(g=D(u,b,c),g.paths=u[0][7]):g=D(u,a);g._nvw&&(g._nvw=!/[~#]/.test(b));return g}function Ia(b,a){return"\n\t"+(a?a+":{":"")+"args:["+b[0]+"]"+(b[1]||!a?",\n\tprops:{"+b[1]+"}":"")+(b[2]?",\n\tctx:{"+b[2]+"}":"")}function r(b,a,c){var d,e,f,g,h,r=0,k=c?c.links:a&&(a.links=a.links||{}),l={},D={0:-1},u=0;return(b+(c?" ":"")).replace(/\)\^/g,
").").replace(Ga,function(F,m,t,s,z,p,H,n,C,q,w,x,G,y,E,A,ha,ua,ka,Ka){function Oa(b,c,g,A,ha,h,ua,ka){return g&&(a&&("linkTo"===d&&(e=a._jsvto=a._jsvto||[],e.push(z)),d&&!f||a.push(z.slice(c.length))),"."!==g)?(b=(A?'view.hlp("'+A+'")':ha?"view":"data")+(ka?(h?"."+h:A?"":ha?"":"."+g)+(ua||""):(ka=A?"":ha?h||"":g,"")),b+=ka?"."+ka:"",c+("view.data"===b.slice(0,9)?b.slice(5):b)):b}p=p||"";t=t||m||x;z=z||C;q=q||ha||"";if(!H||h||g)return!a||!A||h||g||d&&!f&&!e||(A=D[u],Ka.length-1>ka-A&&(A=Ka.slice(A,
ka+1),A=S+":"+A+M,H=k[A],H||(k[A]=1,k[A]=H=Fa(A,c||a,!0),H.paths.push({_jsvOb:H})),1!==H&&(e||a).push({_jsvOb:H}))),h?(h=!G,h?F:'"'):g?(g=!y,g?F:'"'):(t?(u++,D[u]=ka++,t):"")+(ua?u?"":(r=Ka.slice(r,ka),d?(d=f=e=!1,"\b"):"\b,")+r+(r=ka+F.length,"\b"):n?(u&&ga(b),d=z,f=s,r=ka+F.length,z+":"):z?z.split("^").join(".").replace(W,Oa)+(q?(l[++u]=!0,"."!==z.charAt(0)&&(D[u]=ka),q):p):p?p:E?(l[u--]=!1,E)+(q?(l[++u]=!0,q):""):w?(l[u]||ga(b),","):m?"":(h=G,g=y,'"'));ga(b)})}function D(b,a,d){var e,f,g,h,r,k,
l,u,F,m,t,s,z,p,H,n,q,C,w,x,G,y,E,M,I=0,A="",ha={},ua=b.length;""+a===a?(H=d?'data-link="'+a.replace(ja," ").slice(1,-1)+'"':a,a=0):(H=a.tmplName||"unnamed",a.allowCode&&(ha.allowCode=!0),a.debug&&(ha.debug=!0),t=a.bnds,p=a.tmpls);for(e=0;e<ua;e++)if(f=b[e],""+f===f)A+='\n+"'+f+'"';else if(g=f[0],"*"===g)A+=";\n"+f[1]+"\nret=ret";else{h=f[1];C=f[2];r=Ia(f[3],"params")+"},"+Ia(z=f[4]);E=f[5];M=f[6];w=f[8];(G="else"===g)||(I=0,t&&(s=f[7])&&(I=t.push(s)));(f=":"===g)?h&&(g=h===N?">":h+g):(C&&(n=Ma(w,
ha),n.tmplName=H+"/"+g,D(C,n),p.push(n)),G||(q=g,x=A,A=""),n=(n=b[e+1])&&"else"===n[0]);G=E?";\ntry{\nret+=":"\n+";if(f&&(s||M||h&&h!==N)){y="return {"+r+"};";E&&(y="try {\n"+y+"\n}catch(e){return {error: j._err(e,view,"+E+")}}\n");y=new Function("data,view,j,u"," // "+H+" "+I+" "+g+"\n"+y);y.paths=s;y._tag=g;if(d)return y;m=1}A+=f?(d?(E?"\ntry{\n":"")+"return ":G)+(m?(m=0,F=u=!0,'c("'+h+'",view,'+(s?(t[I-1]=y,I):"{"+r+"}")+")"):">"===g?(l=!0,"h("+z[0]+")"):"((v="+z[0]+')!=null?v:"")'):(F=k=!0,"\n{view:view,tmpl:"+
(C?p.length:"0")+","+r+"},");if(q&&!n){A="["+A.slice(0,-1)+"]";if(d||s)if(A=new Function("data,view,j,u"," // "+H+" "+I+" "+q+"\nreturn "+A+";"),s&&((t[I-1]=A).paths=s),A._tag=g,d)return A;A=x+G+'t("'+q+'",view,this,'+(I||A)+")";q=s=0}E&&(F=!0,A+=";\n}catch(e){ret"+(d?"urn ":"+=")+"j._err(e,view,"+E+");}\n"+(d?"":"ret=ret"))}A="// "+H+"\nj=j||"+(c?"jQuery.":"jsviews.")+"views;var v"+(k?",t=j._tag":"")+(u?",c=j._cnvt":"")+(l?",h=j.converters.html":"")+(d?";\n":',ret=""\n')+(ha.debug?"debugger;":"")+
A+(d?"\n":";\nreturn ret;");try{A=new Function("data,view,j,u",A)}catch(ka){ga("Compiled template code:\n\n"+A+'\n: "'+ka.message+'"')}a&&(a.fn=A);F||(A._nvw=!0);return A}function F(b,a){return b&&b!==a?a?h(h({},a),b):b:a&&h({},a)}function u(b){return da[b]||(da[b]="&#"+b.charCodeAt(0)+";")}function z(b){var a,c,d=[];if("object"===typeof b)for(a in b)(c=b[a])&&c.toJSON&&!c.toJSON()||m(c)||d.push({key:a,prop:c});return d}function H(b){return null!=b?ea.test(b)&&(""+b).replace(va,u)||b:""}if(!(c&&c.render||
e.jsviews)){var s,t,C,pa,ba,x="{",S="{",M="}",I="}",O="^",W=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,Ga=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^|\s*$)|[)\]])([([]?))|(\s+)/g,ja=/[ \t]*(\r\n|\n|\r)/g,ia=/\\(['"])/g,y=/['"\\]/g,J=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,
R=/^if\s/,ca=/<(\w+)[>\s]/,ea=/[\x00`><\"'&]/,Na=/^on[A-Z]|^convert(Back)?$/,va=/[\x00`><"'&]/g,Q=0,La=0,da={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},N="html",V="data-jsv-tmpl",w={},K={template:{compile:ma},tag:{compile:aa},helper:{},converter:{}},G={jsviews:"v1.0.0-beta",settings:function(b){h(xa,b);d(xa._dbgMode);xa.jsv&&xa.jsv()},sub:{View:Z,Err:g,tmplFn:Fa,cvt:q,parse:r,extend:h,syntaxErr:ga,onStore:{},_lnk:a},map:oa,_cnvt:n,_tag:l,_err:la};(g.prototype=
Error()).constructor=g;fa.depends=function(){return[this.get("item"),"index"]};X.depends=function(){return["index"]};Z.prototype={get:Ja,getIndex:X,getRsc:p,hlp:Y,_is:"view"};for(t in K)qa(t,K[t]);var Da=G.templates,na=G.converters,Ha=G.helpers,Ba=G.tags,P=G.sub,xa=G.settings;c?(s=c,s.fn.render=ra,s.observable&&(h(P,s.views.sub),G.map=s.views.map)):(s=e.jsviews={},s.isArray=Array&&Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)});s.render=w;s.views=G;s.templates=
Da=G.templates;xa({debugMode:d,delimiters:sa,onError:function(a,c,d){c&&(a=d===b?"{Error: "+a+"}":m(d)?d(a,c):d);return a==b?"":a},_dbgMode:!0});Ba({"else":function(){},"if":{render:function(b){return this.rendering.done||!b&&(arguments.length||!this.tagCtx.index)?"":(this.rendering.done=!0,this.selected=this.tagCtx.index,this.tagCtx.render(this.tagCtx.view,!0))},onUpdate:function(b,a,c){var d;for(b=0;(d=this.tagCtxs[b])&&d.args.length;b++)if(d=d.args[0],a=!d!==!c[b].args[0],!this.convert&&d||a)return a;
return!1},flow:!0},"for":{render:function(a){var c,d=this.tagCtx,e="",f=0;if(!this.rendering.done){if(c=!arguments.length)a=d.view.data;a!==b&&(e+=d.render(a,c),f+=s.isArray(a)?a.length:1);if(this.rendering.done=f)this.selected=d.index}return e},flow:!0},include:{flow:!0},"*":{render:a,flow:!0}});Ba("props",{baseTag:Ba["for"],dataMap:oa(z)});na({html:H,attr:H,url:function(a){return a!=b?encodeURI(""+a):null===a?a:""}});sa()}})(this,this.jQuery);(function(e,c,b){function a(b){return E(b)?new d(b):
new f(b)}function f(b){this._data=b;return this}function d(b){this._data=b;return this}function g(b,a){b=E(b)?b:[b];var c,d,e=a,f=e,h=b.length,k=[];for(c=0;c<h;c++)d=b[c],U(d)?k=k.concat(g(d.call(a,a),a)):""+d!==d?(a=f=d,f!==e&&k.push(e=f)):(f!==e&&k.push(e=f),k.push(d));return k}function h(b,a){var c,d;for(c in b){d=!0;break}d||delete ya[a]}function m(a,c){if(!a.data||!a.data.off){var d,e,f,g=c.oldValue,h=c.value,k=a.data,l=k.observeAll,p=!k.cb.noArray,n=k.paths;if(a.type===ra)(k.cb.array||k.cb).call(k,
a,c);else if(k.prop===c.path||"*"===k.prop)g=typeof g===ma&&(n[0]||p&&E(g))&&g,h=typeof(h=c.value)===ma&&(n[0]||p&&E(h))&&h,l?(d=l._path+"."+c.path,e=l.filter,f=[l.parents().slice()],g&&fa(p,l.ns,[g],n,k.cb,!0,e,f,d),h&&fa(p,l.ns,[h],n,k.cb,b,e,f,d)):(g&&fa(p,[g],n,k.cb,!0),h&&fa(p,[h],n,k.cb)),k.cb(a,c)}}function sa(){function d(b,a,e,f){var g,h=Fa(w),k=E(w)?[w]:w;b=ea?b+"."+ea:b;if(ba||f)h&&c(k).off(b,m);else{if(O=h&&c._data(w))for(M=(O=(O=O&&O.events)&&O[e?ra:qa])&&O.length;M--;)if((I=O[M].data)&&
I.cb._cId===x._cId&&I.ns===ea){if(e)return;("*"===a&&I.prop!==a||I.prop===t)&&c(w).off(b,m)}a=e?{}:{fullPath:n,paths:a?[a]:[],prop:t};a.ns=ea;a.cb=x;R&&(a.observeAll={_path:R,path:function(){g=J.length;return R.replace(/[[.]/g,function(b){g--;return"["===b?"["+c.inArray(J[g-1],J[g]):"."})},parents:function(){return J},filter:ca,ns:ea});c(k).on(b,null,a,m);ja&&(ja[c.data(w,"obId")||c.data(w,"obId",la++)]=w)}}function e(b,a){b._ob=W(b,V);var c=V;return function(d,e){var g=b._ob,h=a.length;typeof g===
ma&&(f(g,!0),(h||Q&&E(g))&&fa(Q,[g],a,x,W,!0));g=b._ob=W(b,c);typeof g===ma&&(f(g),(h||Q&&E(g))&&fa(Q,[g],a,x,W,[c]));x(d,e)}}function f(c,e,g,h){if(Q){var k=w,l=R;w=c;h&&(w=c[h],R+="."+h,ca&&(w=a._fltr(h,c,R,ca)));w&&(g||E(w))&&d(ra+".observe"+(x?".obs"+(S=x._cId=x._cId||ga++):""),b,!0,e);w=k;R=l}}var k,l,p,s,t,n,q,ba,x,S,M,I,O,W,aa,ja,ia,y,J,R,ca,ea,X,Y,Q=!1!=this,oa=1,da=ta,N=Array.apply(0,arguments);k=N.pop();var V=N.shift(),w=y=V,K=N.length;V+""===V&&Q&&(ea=V,V=w=y=N.shift(),K--);if(U(k))x=k;
else if(k+""===k&&(R=k,J=N.pop(),ca=N.pop(),k=N.pop(),K-=3),!0===k?ba=k:k&&(V=k,oa=0),k=N[K-1],K&&k===b||U(k))x=N.pop(),K--;K&&U(N[K-1])&&(W=x,x=N.pop(),K--);da+=ba?x?".obs"+x._cId:"":".obs"+(S=x._cId=x._cId||ga++);ba||(ja=ya[S]=ya[S]||{});X=ea&&ea.match(Ma)||[""];for(Y=X.length;Y--;)for(ea=X[Y],E(y)?f(y,ba,!0):ba&&0===K&&y&&d(da,""),k=ia=0;k<K;k++)if(n=N[k],""!==n){w=y;if(""+n===n){s=n.split("^");s[1]&&(ia=s[0].split(".").length,n=s.join("."),ia=n.split(".").length-ia);if(W&&(aa=W(n,y))){K+=aa.length-
1;Z.apply(N,[k--,1].concat(aa));continue}s=n.split(".")}else oa&&!U(n)&&(n._jsvOb&&(y=e(n,N.slice(k+1)),y.noArray=!Q,y._cId=x._cId,fa(Q,[V],N.slice(0,k),y,W),y=b,n=n._ob),w=n),y=n,s=[y];for(;w&&(t=s.shift())!==b;)if(typeof w===ma){if(""+t===t){if(""===t)continue;if(s.length<ia+1&&!w.nodeType){if(!ba&&(O=Fa(w)&&c._data(w))){M=(O=(O=O.events)&&O[qa])&&O.length;for(p=0;M--;)!(I=O[M].data)||I.cb!==x||I.ns!==ea||I.prop!==t&&"*"!==I.prop||((l=s.join("."))&&I.paths.push(l),p++);if(p){w=w[t];continue}}if("*"===
t){!ba&&O&&O.length&&d(da,"",!1,!0);U(w)?(q=w.depends)&&fa(Q,[q],x,ba||V):d(da,"");for(l in w)f(w,ba,b,l);break}else t&&d(da+"."+t,s.join("."))}R&&(R+="."+t);t=w[t]}if(U(t)){(q=t.depends)&&fa(Q,[w],g(q,w),x,W,ba||[V]);break}w=t}f(w,ba)}S&&h(ja,S);return{cbId:S,bnd:ja}}function Ja(){[].push.call(arguments,!0);return sa.apply(this,arguments)}function fa(){var b=[].concat.apply([],arguments);return sa.apply(b.shift(),b)}function X(b,a,c,d){b+""!==b&&(c=a,a=b,b="");n(b,this._data,a,c,[],"root",d)}function Y(b,
a,c){X.call(this,b,a,c,!0)}function n(c,d,e,f,g,h,k){function l(b,d){p=b.length;for(x=h+"[]";p--;)(S=a._fltr(p,b,x,f))&&n(c,S,e,f||"",g.slice(),x,d)}function m(b,a){h=b.data.observeAll._path;var d=g;g[0]!==b.target&&(g=g.slice(),g.unshift(b.target));switch(a.change){case "insert":l(a.items);break;case "remove":l(a.items,!0);break;case "refresh":l(a.oldItems,!0);l(b.target);break;case "set":x=h+"."+a.path,n(c,a.oldValue,e,0,g.slice(),x,!0),n(c,a.value,e,0,g.slice(),x)}e.apply(this,arguments);g=d}var p,
q,x,S;if(typeof d===ma){q=E(d)?"":"*";g.unshift(d);if(e){if(q||0!==f)m._cId=e._cId=e._cId||ga++,sa(c,d,q,m,k,f,g.slice(),h)}else sa(c,d,q,b,k,f,g.slice(),h);if(q)for(p in d)"_"!==p.charAt(0)&&p!==aa&&(x=h+"."+p,(S=a._fltr(p,d,x,f))&&n(c,S,e,f||0,g.slice(),x,k));else l(d,k)}}function q(b,a,c){return 0>c.indexOf(".")&&0>c.indexOf("[")&&a[b]}if(!c)throw"jsViews/jsObservable require jQuery";if(!c.observable){e=c.views=c.views||{jsviews:"v1.0.0-alpha",sub:{}};var p=e.sub,l=c.event.special,Z=[].splice,
E=c.isArray,aa=c.expando,ma="object",oa=parseInt,Ma=/\S+/g,qa=p.propChng=p.propChng||"propertyChange",ra=p.arrChng=p.arrChng||"arrayChange",ya=p._cbBnds=p._cbBnds||{},ta=qa+".observe",U=c.isFunction,la=1,ga=1,Fa=c.hasData,Ia={};p.getDeps=function(){var b=arguments;return function(){for(var a,c,d=[],e=b.length;e--;)a=b[e--],(c=b[e])&&(d=d.concat(U(c)?c(a,a):c));return d}};c.observable=a;a._fltr=function(b,a,c,d){(b=d&&U(d)?d(b,a,c):a[b])&&(b=U(b)?b.set&&b.call(a):b);return typeof b===ma&&b};a.Object=
f;a.Array=d;c.observe=a.observe=sa;c.unobserve=a.unobserve=Ja;a._apply=fa;f.prototype={_data:null,observeAll:X,unobserveAll:Y,data:function(){return this._data},setProperty:function(a,c,d){var e,g=this._data;a=a||"";if(g)if(E(a))for(e=a.length;e--;)c=a[e],this.setProperty(c.name,c.value,d===b||d);else if(""+a!==a)for(e in a)this.setProperty(e,a[e],c);else if(a!==aa){for(a=a.split(".");g&&1<a.length;)g=g[a.shift()];g&&this._setProperty(g,a[0],c,d)}return this},removeProperty:function(b){this.setProperty(b,
Ia);return this},_setProperty:function(a,c,d,e){var g,f,h,k=c?a[c]:a;U(k)&&k.set&&(f=k,g=!0===k.set?k:k.set,k=k.call(a));if(k!==d||e&&k!=d)if(!(k instanceof Date)||k>d||k<d)g?(g.call(a,d),d=f.call(a)):(h=d===Ia)?(delete a[c],d=b):c&&(a[c]=d),this._trigger(a,{change:"set",path:c,value:d,oldValue:k,remove:h})},_trigger:function(b,a){c(b).triggerHandler(qa,a)}};d.prototype={_data:null,observeAll:X,unobserveAll:Y,data:function(){return this._data},insert:function(b,a){var c=this._data;1===arguments.length&&
(a=b,b=c.length);b=oa(b);-1<b&&b<=c.length&&(a=E(a)?a:[a],a.length&&this._insert(b,a));return this},_insert:function(b,a){var c=this._data,d=c.length;Z.apply(c,[b,0].concat(a));this._trigger({change:"insert",index:b,items:a},d)},remove:function(a,c){var d;d=this._data;a===b&&(a=d.length-1);a=oa(a);c=c?oa(c):0===c?0:1;-1<c&&-1<a&&(d=d.slice(a,a+c),(c=d.length)&&this._remove(a,c,d));return this},_remove:function(b,a,c){var d=this._data,e=d.length;d.splice(b,a);this._trigger({change:"remove",index:b,
items:c},e)},move:function(b,a,c){c=c?oa(c):0===c?0:1;b=oa(b);a=oa(a);if(0<c&&-1<b&&-1<a&&b!==a){var d=this._data.slice(b,b+c);(c=d.length)&&this._move(b,a,c,d)}return this},_move:function(b,a,c,d){var e=this._data,g=e.length;e.splice(b,c);e.splice.apply(e,[a,0].concat(d));this._trigger({change:"move",oldIndex:b,index:a,items:d},g)},refresh:function(b){var a=this._data.slice();this._refresh(a,b);return this},_refresh:function(b,a){var c=this._data,d=c.length;Z.apply(c,[0,c.length].concat(a));this._trigger({change:"refresh",
oldItems:b},d)},_trigger:function(b,a){var d=this._data,e=d.length,d=c([d]);d.triggerHandler(ra,b);e!==a&&d.triggerHandler(qa,{change:"set",path:"length",value:e,oldValue:a})}};l[qa]=l[ra]={remove:function(b){var a,d,e,g,f=b.data;if(f&&(f.off=1,f=f.cb)&&(a=ya[f._cId])){b=c._data(this).events[b.type];for(e=b.length;e--&&!d;)d=(g=b[e].data)&&g.cb===f;d||(delete a[c.data(this,"obId")],h(a,f._cId))}}};e.map=function(d){function e(b,c,g){var f,h=this;this.src&&this.unmap();"object"===typeof b&&(h.src=
b,h.tgt=g||h.tgt||[],h.options=c||h.options,h.update(),d.obsSrc&&a(h.src).observeAll(h.obs=function(b,a){f||(f=1,d.obsSrc(h,b,a),f=0)},h.srcFlt),d.obsTgt&&a(h.tgt).observeAll(h.obt=function(b,a){f||(f=1,d.obsTgt(h,b,a),f=0)},h.tgtFlt))}(e.prototype={srcFlt:d.srcFlt||q,tgtFlt:d.tgtFlt||q,update:function(b){c.observable(this.tgt).refresh(d.getTgt(this.src,this.options=b||this.options))},unmap:function(){this.src&&(this.obs&&c.observable(this.src).unobserveAll(this.obs,this.srcFlt),this.obt&&c.observable(this.tgt).unobserveAll(this.obt,
this.tgtFlt),this.src=b)},map:e,_def:d}).constructor=e;U(d)&&(d={getTgt:d});d.baseMap&&(d=c.extend({},d.baseMap,d));d.map=function(b,a,c){return new e(b,a,c)};return d}}})(this,this.jQuery);(function(e,c,b){function a(a,d,e){var g,f,h,k,l,p,n,q,r,B=a.target,s=B._jsvBnd,v=/&(\d+)\+?/g;if(s)for(;h=v.exec(s);)if(h=Ca[h[1]])if(d=h.to){h=h.linkCtx;n=h.view;r=h.tag;p=c(B);l=n.hlp(K);q=n.hlp(G);f=m(B);g=Ra[f];e===b&&(e=ea(f)?f(B):g?p[g]():p.attr(f));g=d[1];d=d[0];g&&(k=ea(g)?g:n.getRsc("converters",g));
k&&(e=k.call(r,e));g=n.linkCtx;n.linkCtx=h;f={change:"change",oldValue:h._val,value:e};if(!(l&&!1===l.call(h,a,f)||r&&r.onBeforeChange&&!1===r.onBeforeChange(a,f)||e===b)&&(l=d[0],e!==b&&l)){l=l._jsvOb?l._ob:l;r&&(r._.chging=!0);Q(l).setProperty(d[2]||d[1],e);q&&q.call(h,a,f);if(r){if(r.onAfterChange)r.onAfterChange(a,f);delete r._.chging}h._val=e}n.linkCtx=g}}function f(a,e,g){var f,h,k,l=this.data,p=this.elem,n=this.convert;h=p.parentNode;var r=this.view,q=r.linkCtx,s=r.hlp(K);r.linkCtx=this;if(h&&
!(s&&e&&!1===s.call(this,a,e)||e&&"*"!==a.data.prop&&a.data.prop!==e.path)){e&&(this.eventArgs=e);if(e||this._initVal){delete this._initVal;h=g.call(r.tmpl,l,r,y);a:{var B=h,t=k=this.tag;f=this.attr||m(p,!0,n!==b);var v,u,w=t&&t.parentElem||this.elem;if(B!==b){u=c(w);f=t&&t.attr||f;ea(B)&&S(this.expr+": missing parens");"visible"===f&&(f="css-display");if(t=/^css-/.test(f)&&f.slice(4))v=c.style(w,t),+B===B&&(v=parseInt(v));else if("link"!==f){if("value"===f)w.type===Ha&&(v=u.prop(f=na));else if(f===
Ba)if(w.value===""+B)v=u.prop(na);else break a;v===b&&(v=(v=Ra[f])?u[v]():u.attr(f))}this._val=v}}if(h&&h.error!==b)h=h.error;else if(k){h=h[0]?h:[h];g=e&&k.onUpdate&&!1===k.onUpdate(a,e,h);ya(k,h);if(g||f===P){f===T&&k.onBeforeLink&&k.onBeforeLink();oa(k,k.tagCtx);fa(this,l,p);r.linkCtx=q;return}if(k._.chging)return;h=":"===k.tagName?y._cnvt(k.cvt,r,h[0]):y._tag(k,r,r.tmpl,h,!0)}else g._tag&&(h=(n=""===n?xa:n)?y._cnvt(n,r,h):y._tag(g._tag,r,r.tmpl,h,!0),k=this.tag,f=this.attr||f);d(h,this,f,k)&&
e&&(s=r.hlp(G))&&s.call(this,a,e);k&&oa(k,k.tagCtx)}fa(this,l,p);r.linkCtx=q}}function d(a,d,f,g){var h,l,m,p,n,q,s=a!==b,t=d.data,B=g&&g.parentElem||d.elem,u=c(B),v=d.view;q=d._val;var w=v.ctx,y=v.linkCtx,x=g||f===T;g&&(g.parentElem=g.parentElem||d.expr||g._elCnt?B:B.parentNode,l=g._prv,m=g._nxt);if(s){if(/^css-/.test(f))"visible"===d.attr&&(d=(B.currentStyle||eb.call(e,B,"")).display,a?(a=B._jsvd||d,a!==P||(a=bb[h=B.nodeName])||(d=ia.createElement(h),ia.body.appendChild(d),a=bb[h]=(d.currentStyle||
eb.call(e,d,"")).display,ia.body.removeChild(d))):(B._jsvd=d,a=P)),(x=x||q!==a)&&c.style(B,f.slice(4),a);else if("link"!==f){if(f===na)n=1,a=a&&"false"!==a;else if(f===Ba)if(B.value===""+a)a=!0,n=1,f=na;else{fa(d,t,B);return}else if("selected"===f||"disabled"===f||"multiple"===f||"readonly"===f)a=a&&"false"!==a?f:null;if(h=Ra[f])if(f===T){v.linkCtx=d;v.ctx=d.ctx;if(g&&g._.inline){f=g.nodes(!0);if(g._elCnt){if(l&&l!==m)r(l,m,B,g._tgId,"^",!0);else if(p=B._dfr)q=g._tgId+"^",h=p.indexOf("#"+q)+1,n=p.indexOf("/"+
q),h&&0<n&&(h+=q.length,n>h&&(B._dfr=p.slice(0,h)+p.slice(n),D(p.slice(h,n))));l=l?l.previousSibling:m?m.previousSibling:B.lastChild}c(f).remove();if(g&&g.onBeforeLink)g.onBeforeLink();p=v.link(v.data,B,l,m,a,g&&{tag:g._tgId,lazyLink:g.tagCtx.props.lazyLink})}else{s&&u.empty();if(g&&g.onBeforeLink)g.onBeforeLink();s&&(p=v.link(t,B,l,m,a,g&&{tag:g._tgId}))}v.linkCtx=y;v.ctx=w}else{if(x=x||q!==a)if("text"===f&&B.children&&!B.children[0])B.textContent!==b?B.textContent=a:B.innerText=null===a?"":a;else u[h](a)}else if(x=
x||q!==a)u[n?"prop":"attr"](f,a!==b||n?a:null);d._val=a}return p||x}if(f===T&&g&&g.onBeforeLink)g.onBeforeLink()}function g(b,a){var c=this.hlp(K),d=this.hlp(G);if(!c||!1!==c.call(this,b,a)){if(a){var c=a.index,e=a.items;switch(a.change){case "insert":this.addViews(c,e);break;case "remove":this.removeViews(c,e.length);break;case "move":this.refresh();break;case "refresh":this.refresh()}}d&&d.call(this,b,a)}}function h(a){var d,e=a.data,f=a._.bnd;if(!a._.useKey&&f){if(d=a._.bndArr)c([d[1]]).off(V,
d[0]),a._.bndArr=b;f!==!!f&&f._.inline?e?f._.arrVws[a._.id]=a:delete f._.arrVws[a._.id]:e&&(d=function(b){b.data&&b.data.off||g.apply(a,arguments)},c([e]).on(V,d),a._.bndArr=[d,e])}}function m(b,a,c){var d=b.nodeName.toLowerCase(),e=R.merge[d]||b.contentEditable===xa&&{to:T,from:T};return e?a?"input"===d&&b.type===Ba?Ba:e.to:e.from:a?c?"text":T:""}function sa(a,d,e,f,g,h,k){var l,m,p,n=a.parentElem,q=a._prv,s=a._nxt,t=a._elCnt;q&&q.parentNode!==n&&S("Missing parentNode");if(k)for(p in m=a.nodes(),
t&&q&&q!==s&&r(q,s,n,a._.id,"_",!0),a.removeViews(b,b,!0),f=s,t&&(q=q?q.previousSibling:s?s.previousSibling:n.lastChild),c(m).remove(),a._.bnds)U(p);else{if(d){l=f[d-1];if(!l)return!1;q=l._nxt}t?q=(f=q)?f.previousSibling:n.lastChild:f=q.nextSibling}d=e.render(g,h,a._.useKey&&k,a,k||d,!0);a.link(g,n,q,f,d,l)}function Ja(a,c,d){var e;d?(e="^`",c=c._.tag||{_:{inline:!0,bnd:d},tagCtx:{view:c},flow:!0},d=c._tgId,d||(Ca[d=cb++]=c,c._tgId=""+d)):(e="_`",ja[d=c._.id]=c);return"#"+d+e+(a!=b?a:"")+"/"+d+e}
function fa(a,c,d){var e,f=a.tag,g=a.convertBack,h=[],k=a._bndId||""+cb++,l=a._hdlr;delete a._bndId;f&&(h=f.depends||h,h=ea(h)?f.depends(f):h,e=f.linkedElem);if(!a._depends||""+a._depends!==""+h)if(a._depends&&Q._apply(!1,[c],a._depends,l,!0),c=Q._apply(!1,[c],a.fn.paths,h,l,a._ctxCb),c.elem=d,c.linkCtx=a,c._tgId=k,d._jsvBnd=d._jsvBnd||"",d._jsvBnd+="&"+k,a._depends=h,a.view._.bnds[k]=k,Ca[k]=c,e&&(c.to=[[],g]),(e||g!==b)&&ra(c,f&&f.convertBack||g),f){if(f.onAfterBind)f.onAfterBind(c);f.flow||f._.inline||
(d.setAttribute(da,(d.getAttribute(da)||"")+"#"+k+"^/"+k+"^"),f._tgId=""+k)}if(e&&e[0])for(f._.radio&&(e=e.children("input[type=radio]")),a=e.length;a--;)e[a]._jsvBnd=e[a]._jsvBnd||d._jsvBnd+"+",e[a]._jsvLnkdEl=f}function X(b,a,c,d,e,f,g){return Y(this,b,a,c,d,e,f,g)}function Y(d,e,f,g,h,k,l,m){if(d&&e){e=e.jquery?e:c(e);H||(H=ia.body,c(H).on(w,a).on("blur","[contenteditable]",a));for(var n,p,r,t,B,u,v,x=Ja,y=g&&"replace"===g.target,D=e.length;D--;)if(v=e[D],""+d===d)B=s(v),n=B.ctx,B.ctx=g,q(d,v,
B,f),B.ctx=n;else{k=k||s(v);if(d.markup!==b)!1===k.link&&(g=g||{},g.link=x=!1),y&&(u=v.parentNode),r=d.render(f,g,h,k,b,x),u?(l=v.previousSibling,m=v.nextSibling,c.cleanData([v],!0),u.removeChild(v),v=u):(l=m=b,c(v).empty());else if(!0!==d)break;if(v._dfr&&!m){t=E(v._dfr,1,db);n=0;for(p=t.length;n<p;n++)B=t[n],(B=ja[B.id])&&B.data!==b&&B.parent.removeViews(B._.key,b,!0);v._dfr=""}k.link(f,v,l,m,r,b,g)}}return e}function n(a,d,e,f,k,m,n,p){function r(a,c,d,e,f,g,h,A,l,ha,ua,m,ka){var n,p="";if(ka)return B=
0,a;v=A||l||"";e=e||ha;d=d||m;la&&!d&&(e||v||g)&&(la=b,za=pa.shift());if(e=e||d)B=0,la=b,fa&&(d||m?Wa[za]||/;svg;|;math;/.test(";"+pa.join(";")+";")||(n="'<"+za+".../"):Wa[e]?n="'</"+e:pa.length&&e===za||(n="Mismatch: '</"+e),n&&Ta(n+">' in:\n"+k)),qa=Aa,za=pa.shift(),Aa=Va[za],ha=ha?"</"+ha+">":"",qa&&(wa+=Ea,Ea="",Aa?wa+="-":(p=ha+Za+"@"+wa+Ya+(ua||""),wa=Fa.shift()));Aa?(g?Ea+=g:c=ha||m||"",v&&(c+=v,Ea&&(c+=" "+da+'="'+Ea+'"',Ea=""))):c=g?c+p+f+Za+g+Ya+h+v:p||a;B&&g&&Ta(" No {^{ tags within elem markup ("+
B+' ). Use data-link="..."');v&&(B=v,pa.unshift(za),za=v.slice(1),pa[0]&&pa[0]===jb[za]&&S("Parent of <tr> must be <tbody>"),la=Wa[za],(Aa=Va[za])&&!qa&&(Fa.unshift(wa),wa=""),qa=Aa,wa&&Aa&&(wa+="+"));return c}function t(a,c){var e,f,k,A,ua=[];if(a){"@"===a._tkns.charAt(0)&&(c=L.previousSibling,L.parentNode.removeChild(L),L=b);for(G=a.length;G--;){F=a[G];k=F.ch;if(e=F.path)for(C=e.length-1;f=e.charAt(C--);)"+"===f?"-"===e.charAt(C)?(C--,c=c.previousSibling):c=c.parentNode:c=c.lastChild;if("^"===k){if(v=
Ca[e=F.id]){f=c&&(!L||L.parentNode!==c);if(!L||f)v.parentElem=c;F.elCnt&&f&&(c._dfr=(F.open?"#":"/")+e+k+(c._dfr||""));ua.push([f?null:L,F])}}else if(z=ja[e=F.id])(z.parentElem||(z.parentElem=c||L&&L.parentNode||d,z._.onRender=Ja,z._.onArrayChange=g,h(z)),f=z.parentElem,F.open)?(z._elCnt=F.elCnt,c?c._dfr="#"+e+k+(c._dfr||""):(z._prv||(f._dfr=l(f._dfr,"#"+e+k)),z._prv=L)):(!c||L&&L.parentNode===c?L&&(z._nxt||(f._dfr=l(f._dfr,"/"+e+k)),z._nxt=L):(c._dfr="/"+e+k+(c._dfr||""),z._nxt=b),y=z.linkCtx,(A=
z.ctx&&z.ctx.onAfterCreate||Ia)&&A.call(y,z))}for(G=ua.length;G--;)ta.push(ua[G])}return!a||a.elCnt}function u(b){var a,c;if(b)for(G=b.length,C=0;C<G;C++)if(F=b[C],P.id)P.id=P.id!==F.id&&P.id;else if(c=v=Ca[F.id].linkCtx.tag,!v.flow){if(!Y){for(a=1;c=c.parent;)a++;ca=ca||a}!Y&&a!==ca||ba&&v.tagName!==ba||X.push(v)}}function w(){I=Ua?d.querySelectorAll(O):c(O,d).get();H=I.length;e&&e.innerHTML&&(N=Ua?e.querySelectorAll(O):c(O,e).get(),e=N.length?N[N.length-1]:e);for(D=ca=0;D<H;D++)if(L=I[D],e&&!ya)ya=
L===e;else if(f&&L===f)break;else L.parentNode&&Ha(E(L,b,X&&ob))&&!P&&L.getAttribute(M)&&ta.push([L]);va===Ga&&k===b&&d.getAttribute(M)&&ta.push([d]);aa(e,Aa);aa(f,Aa);if(!P){if(Aa&&wa+Ea&&(L=f,wa&&(f?t(E(wa+"+",1),f):t(E(wa,1),d)),t(E(Ea,1),d),f)){T=f.getAttribute(da);if(H=T.indexOf(sa)+1)T=T.slice(H+sa.length-1);f.setAttribute(da,Ea+T)}H=ta.length;for(D=0;D<H;D++)if(L=ta[D],J=L[1],L=L[0],J){if(v=Ca[J.id]){if(y=v.linkCtx)v=y.tag,v.linkCtx=y;J.open?(L&&(v.parentElem=L.parentNode,v._prv=L),v._elCnt=
J.elCnt,!v||v.onBeforeLink&&!1===v.onBeforeLink()||v._.bound||(v._.bound=!0,z=v.tagCtx.view,q(b,v._prv,z,a,J.id)),v._.linking=!0):(v._nxt=L,v._.linking&&(ea=v.tagCtx,z=ea.view,delete v._.linking,v._.bound||(v._.bound=!0,q(b,v._prv,z,a,J.id)),oa(v,ea)))}}else z=s(L),q(L.getAttribute(M),L,z,a,b,n)}ra&&ra.resolve()}var B,y,v,D,H,C,G,I,L,z,F,J,N,K,U,V,Q,X,Y,ba,ea,fa,ca,P,ga,Z,za,la,na,T,Aa,qa,Ea,sa,ya,ra,va=this,Ba=va._.id+"_",wa="",ta=[],pa=[],Fa=[],Ia=va.hlp(Da),Ha=t;m&&(ra=m.lazyLink&&c.Deferred(),
m.tmpl?U="/"+m._.id+"_":(P=m.get,m.tag&&(Ba=m.tag+"^",m=!0)),m=!0===m);P&&(Ha=u,X=P.tags,Y=P.deep,ba=P.name);d=d?""+d===d?c(d)[0]:d.jquery?d[0]:d:va.parentElem||ia.body;fa=!R.noValidate&&d.contentEditable!==xa;za=d.tagName.toLowerCase();Aa=!!Va[za];e=e&&ma(e,Aa);f=f&&ma(f,Aa)||null;if(k!=b){na=ga=ia.createElement("div");sa=Ea="";Z="http://www.w3.org/2000/svg"===d.namespaceURI?"svg_ns":(K=hb.exec(k))&&K[1]||"";x&&K&&K[2]&&S("Unsupported: "+K[2]);if(Aa){for(Q=f;Q&&!(V=E(Q));)Q=Q.nextSibling;if(T=V?
V._tkns:d._dfr){K=U||"";if(m||!U)K+="#"+Ba;C=T.indexOf(K);C+1&&(C+=K.length,sa=Ea=T.slice(0,C),T=T.slice(C),V?Q.setAttribute(da,T):d._dfr=T)}}la=b;k=(""+k).replace(lb,r);fa&&pa.length&&Ta("Mismatched '<"+za+"...>' in:\n"+k);if(p)return;ab.appendChild(ga);Z=W[Z]||W.div;m=Z[0];for(na.innerHTML=Z[1]+k+Z[2];m--;)na=na.lastChild;ab.removeChild(ga);for(ga=ia.createDocumentFragment();Z=na.firstChild;)ga.appendChild(Z);d.insertBefore(ga,f)}ra?setTimeout(w,0):w();return ra&&ra.promise()}function q(a,d,e,f,
g,h){var k,l,n,q,r,s,u,w;f=e.data===b?f||{}:e.data;if(g)h=Ca[g],h=h.linkCtx?h.linkCtx.tag:h,u=h.linkCtx||{data:f,elem:h._elCnt?h.parentElem:d,view:e,ctx:e.ctx,attr:T,fn:h._.bnd,tag:h,_bndId:g},p(u,u.fn);else if(a&&d)for(k=e.tmpl,n=m(d),a=c.trim(a).replace(ib,"\\$&"),a=a.slice(-1)!==pa?C+":"+a+(n?":":"")+pa:a,t.lastIndex=0;l=t.exec(a);)w=t.lastIndex,n=g?T:l[1],s=l[3],r=l[10],q=b,u={data:f,elem:d,view:e,ctx:h||e.ctx,attr:n,_initVal:!l[2]},l[6]&&(!n&&(q=/:([\w$]*)$/.exec(r))&&(q=q[1],q!==b&&(r=-q.length-
1,s=s.slice(0,r-1)+pa)),null===q&&(q=b),u.convert=l[5]||""),u.expr=n+s,(l=k.links[s])||(k.links[s]=l=J.tmplFn(s,k,!0,q)),u.fn=l,n||q===b||(u.convertBack=q),p(u,l),t.lastIndex=w}function p(b,a){function c(d,e){f.call(b,d,e,a)}c.noArray=!0;b._ctxCb=Fa(b.view);b._hdlr=c;c(!0)}function l(b,a){var c;return b?(c=b.indexOf(a),c+1?b.slice(0,c)+b.slice(c+a.length):b):""}function Z(b){return b&&(""+b===b?b:"SCRIPT"===b.tagName?b.type.slice(3):1===b.nodeType&&b.getAttribute(da)||"")}function E(b,a,c){function d(b,
a,c,g,h,k){f.push({elCnt:e,id:g,ch:h,open:a,close:c,path:k,token:b})}var e,f=[];if(a=a?b:Z(b))return f.elCnt=!b.type,e="@"===a.charAt(0)||!b.type,f._tkns=a,a.replace(c||pb,d),f}function aa(b,a){b&&("jsv"===b.type?b.parentNode.removeChild(b):a&&""===b.getAttribute(M)&&b.removeAttribute(M))}function ma(b,a){for(var c=b;a&&c&&1!==c.nodeType;)c=c.previousSibling;c&&(1!==c.nodeType?(c=ia.createElement("SCRIPT"),c.type="jsv",b.parentNode.insertBefore(c,b)):Z(c)||c.getAttribute(M)||c.setAttribute(M,""));
return c}function oa(a,d){var e,f,g,h,k,l,m;e=d.view;var n=a.linkCtx=a.linkCtx||{tag:a,data:e.data,view:e,ctx:e.ctx};if(a.onAfterLink)a.onAfterLink(d,n);if(f=(e=a.targetTag?a.targetTag.linkedElem:a.linkedElem)&&e[0]){if(g=a._.radio)e=e.children("input[type=radio]");if(g||!a._.chging){h=J.cvt(a,a.convert)[0];if(g||f!==n.elem){for(m=e.length;m--;){f=e[m];k=f._jsvLnkdEl;if(a._.inline&&(!k||k!==a&&k.targetTag!==a))for(f._jsvLnkdEl=a,k=n.elem?n.elem._jsvBnd:a._prv._jsvBnd,f._jsvBnd=k+"+",k=k.slice(1).split("&"),
l=k.length;l--;)ra(Ca[k[l]],a.convertBack);g&&(f[na]=h===f.value)}n._val=h}h!==b&&(g||f.value===b?f.contentEditable===xa&&(f.innerHTML=h):f.type===Ha?f[na]=h&&"false"!==h:e.val(h))}}if(f=f||":"===a.tagName&&n.elem)g=f._jsvTr,h=d.props.trigger,g!==h&&(f._jsvTr=h,e=e||c(f),qa(e,g,"off"),qa(e,h,"on"))}function Ma(b){setTimeout(function(){a(b)},0)}function qa(b,c,d){c&&b[d](!0===c?"keydown":c,!0===c?Ma:a)}function ra(b,a){var c,d,e,f,g,h=b.linkCtx,k=h.data,l=h.fn.paths;if(b){if(c=l._jsvto)l=c;for(d=l.length;d&&
""+(f=l[--d])!==f;);!f||h.tag&&!h.tag.tagCtx.args.length?b.to=[[],a]:(f=f.split("^").join("."),b.to="."===f.charAt(0)?[[g=l[d-1],f.slice(1)],a]:[h._ctxCb(e=d?l[0].split("^").join("."):f)||[k,e],a],c&&g&&(b.to[0][0]=h._ctxCb(g,k)))}}function ya(b,a){var d,e;d=b.tagCtx.view;var f=b.tagCtxs||[b.tagCtx],g=f.length,h=!a;for(a=a||b._.bnd.call(d.tmpl,(b.linkCtx||d).data,d,y);g--;)d=f[g],e=a[g],c.observable(d.props).setProperty(e.props),ca(d.ctx,e.ctx),d.args=e.args,h&&(d.tmpl=e.tmpl);return f}function ta(b){for(var a,
c,d=[],e=a=b.length;e--;)d.push(b[e]);for(e=a;e--;)if(a=d[e],a.parentNode){if(c=a._jsvBnd)for(c=c.slice(1).split("&"),a._jsvBnd="",b=c.length;b--;)U(c[b],a._jsvLnkdEl,a);D(Z(a)+(a._dfr||""))}}function U(a,d,e){var f,g,h,k=Ca[a];if(d)e===d.linkedElem[0]&&(delete e._jsvLnkdEl,delete d.linkedElem);else if(k){delete Ca[a];for(f in k.bnd)d=k.bnd[f],e=".obs"+k.cbId,c.isArray(d)?c([d]).off(V+e).off(N+e):c(d).off(N+e),delete k.bnd[f];if(f=k.linkCtx){if(d=f.tag){if(e=d.tagCtxs)for(g=e.length;g--;)(h=e[g].map)&&
h.unmap();if(g=(e=(h=d.linkedElem)&&h[0]||f.elem)&&e._jsvTr)qa(h||c(e),g,"off"),e._jsvTr=b;if(d.onDispose)d.onDispose();d._elCnt||(d._prv&&d._prv.parentNode.removeChild(d._prv),d._nxt&&d._nxt.parentNode.removeChild(d._nxt))}delete f.view._.bnds[a]}delete J._cbBnds[k.cbId]}}function la(d,e){d===b?(H&&(c(H).off(w,a).off("blur","[contenteditable]",a),H=b),d=!0,Ga.removeViews(),ta(ia.body.getElementsByTagName("*"))):e&&!0===d&&(e=e.jquery?e:c(e),e.each(function(){for(var a;(a=s(this,!0))&&a.parent;)a.parent.removeViews(a._.key,
b,!0);ta(this.getElementsByTagName("*"));ta([this])}));return e}function ga(b,a){return la(this,b,a)}function Fa(b){b=b||c.view();return function(a,c){var d,e,f=[c];if(b&&a){if(a._jsvOb)return a._jsvOb.call(b.tmpl,c,b,y);if("~"===a.charAt(0)){if("~tag"===a.slice(0,4)&&(e=b.ctx,"."===a.charAt(4)&&(d=a.slice(5).split("."),e=e.tag),d))return e?[e,d.join("."),c]:[];a=a.slice(1).split(".");if(c=b.hlp(a.shift()))a.length&&f.unshift(a.join(".")),f.unshift(c);return c?f:[]}if("#"===a.charAt(0))return"#data"===
a?[]:[b,a.replace(kb,""),c]}}}function Ia(b){return b.type===Ha?b[na]:b.value}function r(b,a,c,d,e,f){var g,h,k,m,n,p,q=0,r=b===a;if(b){k=E(b)||[];g=0;for(h=k.length;g<h;g++){m=k[g];p=m.id;if(p===d&&m.ch===e)if(f)h=0;else break;r||(n="_"===m.ch?ja[p]:Ca[p].linkCtx.tag,m.open?n._prv=a:m.close&&(n._nxt=a));q+=p.length+2}q&&b.setAttribute(da,b.getAttribute(da).slice(q));b=a?a.getAttribute(da):c._dfr;if(h=b.indexOf("/"+d+e)+1)b=k._tkns.slice(0,q)+b.slice(h+(f?-1:d.length+1));b&&(a?a.setAttribute(da,b):
c._dfr=b)}else c._dfr=l(c._dfr,"#"+d+e),f||a||(c._dfr=l(c._dfr,"/"+d+e))}function D(a){var c,d,e;if(e=E(a,1,mb))for(a=0,c=e.length;a<c;a++)d=e[a],"_"===d.ch?(d=ja[d.id])&&d.data!==b&&d.parent.removeViews(d._.key,b,!0):U(d.id)}function F(b,a,d){switch(d.change){case "set":b=b.tgt;for(a=b.length;a--&&b[a].key!==d.path;);-1===a?d.path&&c.observable(b).insert({key:d.path,prop:d.value}):d.remove?c.observable(b).remove(a):c.observable(b[a]).setProperty("prop",d.value)}}function u(b,a,d){b=b.src;switch(d.change){case "set":"prop"===
d.path?c.observable(b).setProperty(a.target.key,d.value):(c.observable(b).setProperty(d.oldValue,null),delete b[d.oldValue],c.observable(b).setProperty(d.value,a.target.prop));break;case "remove":a=d.items[0];c.observable(b).removeProperty(a.key);delete b[a.key];break;case "insert":a=d.items[0],a.key&&c.observable(b).setProperty(a.key,a.prop)}}function z(b,a,c){return 0>c.indexOf(".")&&a[b]}var H,s,t,C,pa,ba,x,S,M,I,O,W,Ga,ja,ia=e.document,y=c.views,J=y.sub,R=y.settings,ca=J.extend,ea=c.isFunction,
Na=y.converters,va=y.tags,Q=c.observable,La=Q.observe,da="data-jsv",N=J.propChng=J.propChng||"propertyChange",V=J.arrChng=J.arrChng||"arrayChange",w="change.jsv",K="onBeforeChange",G="onAfterChange",Da="onAfterCreate",na="checked",Ha="checkbox",Ba="radio",P="none",xa="true",Ya='">\x3c/script>',Za='<script type="jsv',Qa="script,["+da+"]",T="html",Ra={value:"val",input:"val",html:T,text:"text"},$a={from:"value",to:"value"},Sa=0,fb=c.cleanData,gb=R.delimiters,Ta=J.syntaxErr,hb=/<(?!script)(\w+)(?:[^>]*(on\w+)\s*=)?[^>]*>/,
ib=/['"\\]/g,ab=ia.createDocumentFragment(),Ua=ia.querySelector,Va={ol:1,ul:1,table:1,tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1,svg:1,svg_ns:1},jb={tr:"table"},Wa={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,param:1,source:1,track:1,wbr:1},bb={},Ca={},cb=1,kb=/^#(view\.?)?/,lb=/(^|(\/>)|<\/(\w+)>|)(\s*)([#\/]\d+[_^])`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|<\/(\w+)>(\s*)|(\/>)\s*|(>))/g,db=/(#)()(\d+)(_)/g,mb=/(#)()(\d+)([_^])/g,
nb=/(?:(#)|(\/))(\d+)(_)/g,ob=/(#)()(\d+)(\^)/g,pb=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g,eb=e.getComputedStyle;if(!c)throw"JsViews requires jQuery";if(!c.views)throw"JsViews requires JsRender";if(!c.observable)throw"JsViews requires jquery.observable";c.link||(I={contents:function(a,d){a!==!!a&&(d=a,a=b);var e,f=c(this.nodes());f[0]&&(e=d?f.filter(d):f,f=a&&d?e.add(f.find(d)):e);return f},nodes:function(b,a,c){var d=this._elCnt,e=!a&&d,f=[];a=a||this._prv;c=c||this._nxt;for(a=e?a===this._nxt?this.parentElem.lastSibling:
a:!1===this._.inline?a||this.linkCtx.elem.firstChild:a&&a.nextSibling;a&&(!c||a!==c);)(b||d||"SCRIPT"!==a.tagName)&&f.push(a),a=a.nextSibling;return f},childTags:function(a,c){a!==!!a&&(c=a,a=b);var d=this.link?this:this.tagCtx.view,e=this._prv,f=this._elCnt,g=[];e&&d.link(b,this.parentElem,f?e.previousSibling:e,this._nxt,b,{get:{tags:g,deep:a,name:c,id:f&&this._tgId}});return g},refresh:function(a){var c,e=this.linkCtx,f=this.tagCtx.view;this.disposed&&S("Removed tag");a===b&&(a=y._tag(this,f,f.tmpl,
ya(this),!0));a+""===a&&(c=this._.inline?T:e.attr||m(this.parentElem,!0),c=d(a,e,c,this));oa(this,this.tagCtx);return c||this},update:function(c){var d=this.linkedElem;d&&a({target:d[0]},b,c)}},J.onStore.template=function(a,b){b.link=X;b.unlink=ga;a&&(c.link[a]=function(){return X.apply(b,arguments)},c.unlink[a]=function(){return ga.apply(b,arguments)})},J.onStore.tag=function(a,b){J._lnk(b)},J._lnk=function(a){return ca(a,I)},J.viewInfos=E,(R.delimiters=function(){var a=gb.apply(y,arguments);C=a[1];
pa=a[2];ba=a[4];t=RegExp("(?:^|\\s*)([\\w-]*)(\\"+ba+")?(\\"+C+J.rTag+"\\"+pa+")","g");return this})(),ca(J._lnk(J.View.prototype),{addViews:function(a,b,c){var d,e=b.length,f=this.views;if(!this._.useKey&&e&&(c=this.tmpl)&&(d=f.length+e,!1!==sa(this,a,c,f,b,this.ctx)))for(a+=e;a<d;a++)Q(f[a]).setProperty("index",a);return this},removeViews:function(a,d,e){function f(a){var d,g,k,l,n,p=m[a];if(p&&p.link){a=p._.id;e||(n=p.nodes());p.removeViews(b,b,!0);p.data=b;k=p._prv;l=p._nxt;g=p.parentElem;e||
(p._elCnt&&r(k,l,g,a,"_"),c(n).remove());if(!p._elCnt)try{k.parentNode.removeChild(k),l.parentNode.removeChild(l)}catch(q){}h(p);for(d in p._.bnds)U(d);delete ja[a]}}var g,k,l=!this._.useKey,m=this.views;l&&(k=m.length);if(a===b)if(l){for(g=k;g--;)f(g);this.views=[]}else{for(g in m)f(g);this.views={}}else if(d===b&&(l?d=1:(f(a),delete m[a])),l&&d){for(g=a+d;g-- >a;)f(g);m.splice(a,d);if(k=m.length)for(;a<k;)Q(m[a]).setProperty("index",a++)}return this},refresh:function(a){var b=this.parent;b&&(sa(this,
this.index,this.tmpl,b.views,this.data,a,!0),h(this));return this},link:n}),ja={0:Ga=new J.View(b,"top")},Na.merge=function(a){var b,c=this.linkCtx._val||"",d=this.tagCtx.props.toggle;d&&(b=d.replace(/[\\^$.|?*+()[{]/g,"\\$&"),c=c.replace(RegExp("(\\s(?="+b+"$)|(\\s)|^)("+b+"(\\s|$))"),"$2"),a=c+(a?(c&&" ")+d:""));return a},va("on",{attr:P,onAfterLink:function(a,d){for(var e,f,g=0,h=a.args,k=a.props.data,l=a.view,m=a.props.context;!ea(e=h[g++]););f=h.slice(g);h=h.slice(0,g-1);m||(m=(m=/^(.*)[\.^][\w$]+$/.exec(a.params.args.slice(-f.length-
1)[0]))&&J.tmplFn("{:"+m[1]+"}",l.tmpl,!0)(d.data,l));if(e){if(this._evs)this.onDispose();c(d.elem).on(this._evs=h[0]||"click",this._sel=h[1],k==b?null:k,this._hlr=function(a){return e.apply(m||d.data,[].concat(f,a,{change:a.type,view:l,linkCtx:d}))})}},onDispose:function(){c(this.parentElem).off(this._evs,this._sel,this._hlr)},flow:!0}),ca(va["for"],{onArrayChange:function(a,b){var c,d=b.change;if(this.tagCtxs[1]&&("insert"===d&&a.target.length===b.items.length||"remove"===d&&!a.target.length||"refresh"===
d&&!b.oldItems.length!==!a.target.length))this.refresh();else for(c in this._.arrVws)c=this._.arrVws[c],c.data===a.target&&c._.onArrayChange.apply(c,arguments);a.done=!0},onAfterLink:function(){var a,b,d,e,f=this,g=f._ars||{},h=f.tagCtxs,k=h.length,l=f.selected||0;for(a=0;a<=l;a++)b=h[a],e=b.map?b.map.tgt:b.args.length?b.args[0]:b.view.data,(d=g[a])&&e!==d[0]&&(La(d[0],d[1],!0),delete g[a]),!g[a]&&c.isArray(e)&&(La(e,b=function(a,b){f.onArrayChange(a,b)}),g[a]=[e,b]);for(a=l+1;a<k;a++)if(d=g[a])La(d[0],
d[1],!0),delete g[a];f._ars=g},onDispose:function(){for(var a in this._ars)La(this._ars[a][0],this._ars[a][1],!0)}}),ca(va["for"],I),ca(va["if"],I),ca(va.include,I),va("props",{baseTag:va["for"],dataMap:y.map({getTgt:va.props.dataMap.getTgt,obsSrc:F,obsTgt:u,tgtFlt:z})}),ca(c,{view:y.view=s=function(a,d,e){d!==!!d&&(e=d,d=b);var f,g,h,k,l,m;m=0;l=ia.body;if(a&&a!==l&&1<Ga._.useKey&&(a=""+a===a?c(a)[0]:a.jquery?a[0]:a))if(d)for(m=Ua?a.querySelectorAll(Qa):c(Qa,a).get(),l=m.length,a=0;a<l;a++)for(f=
m[a],g=E(f,b,db),h=0,k=g.length;h<k;h++){if(f=g[h],f=ja[f.id])if(f=f&&e?f.get(!0,e):f)return f}else for(;a;){if(g=E(a,b,nb))for(l=g.length;l--;)if(f=g[l],f.open){if(1>m)return(f=ja[f.id])&&e?f.get(e):f||Ga;m--}else m++;a=a.previousSibling||a.parentNode}return d?b:Ga},link:y.link=Y,unlink:y.unlink=la,cleanData:function(a){a.length&&Sa&&ta(a);fb.apply(c,arguments)}}),y.utility={validate:function(a){try{Ga.link(b,ia.createElement("div"),b,b,a,b,b,1)}catch(c){return c.message}}},ca(c.fn,{link:function(a,
b,c,d,e,f,g){return Y(a,this,b,c,d,e,f,g)},unlink:function(a){return la(a,this)},view:function(a){return s(this[0],a)}}),c.each([T,"replaceWith","empty","remove"],function(a,b){var d=c.fn[b];c.fn[b]=function(){var a;Sa=1;try{a=d.apply(this,arguments)}finally{Sa=0}return a}}),ca(Ga,{tmpl:{links:{},tags:{}}}),Ga._.onRender=Ja,R({wrapMap:W={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>",
"</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],svg_ns:[1,"<svg>","</svg>"],div:jQuery.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},linkAttr:M="data-link",merge:{input:{from:Ia,to:"value"},textarea:$a,select:$a,optgroup:{to:"label"}},jsrDbgMode:R.debugMode,debugMode:function(a){R.jsrDbgMode(a);a?e._jsv={views:ja,bindings:Ca}:delete e._jsv},jsv:function(){R.debugMode(R._dbgMode);
M=R.linkAttr;S=y._err;O=Qa+",["+M+"]";x=R.noDomLevel0;W.optgroup=W.option;W.tbody=W.tfoot=W.colgroup=W.caption=W.thead;W.th=W.td}}))})(this,this.jQuery)}())},{}]},{},[1])(1)});
