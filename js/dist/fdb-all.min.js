!function(Pa){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=Pa();else if("function"==typeof define&&define.amd)define([],Pa);else{var h;"undefined"!=typeof window?h=window:"undefined"!=typeof global?h=global:"undefined"!=typeof self&&(h=self);h.ForerunnerDB=Pa()}}(function(){return function h(m,d,k){function c(a,e){if(!d[a]){if(!m[a]){var g="function"==typeof require&&require;if(!e&&g)return g(a,!0);if(b)return b(a,!0);g=Error("Cannot find module '"+a+"'");throw g.code="MODULE_NOT_FOUND",
g;}g=d[a]={exports:{}};m[a][0].call(g.exports,function(g){var b=m[a][1][g];return c(b?b:g)},g,g.exports,h,m,d,k)}return d[a].exports}for(var b="function"==typeof require&&require,a=0;a<k.length;a++)c(k[a]);return c}({1:[function(h,m,d){d=h("../lib/Core");h("../lib/CollectionGroup");h("../lib/View");h("../lib/Highcharts");h("../lib/Persist");h("../lib/Document");h("../lib/Overview");h("../lib/vendor/jsviews");m.exports=d},{"../lib/CollectionGroup":4,"../lib/Core":5,"../lib/Document":7,"../lib/Highcharts":8,
"../lib/Overview":13,"../lib/Persist":15,"../lib/View":18,"../lib/vendor/jsviews":19}],2:[function(h,m,d){m.exports={chain:function(k){this._chain=this._chain||[];-1===this._chain.indexOf(k)&&this._chain.push(k)},unChain:function(k){this._chain&&(k=this._chain.indexOf(k),-1<k&&this._chain.splice(k,1))},chainSend:function(k,c,b){if(this._chain){var a=this._chain,f=a.length,e;for(e=0;e<f;e++)a[e].chainReceive(this,k,c,b)}},chainReceive:function(k,c,b,a){k={sender:k,type:c,data:b,options:a};(!this._chainHandler||
this._chainHandler&&!this._chainHandler(k))&&this.chainSend(k.type,k.data,k.options)}}},{}],3:[function(h,m,d){var k,c,b,a,f;d=h("./Shared");var e=function(g){this.init.apply(this,arguments)};e.prototype.init=function(g){this._primaryKey="_id";this._primaryIndex=new c("primary");this._primaryCrc=new c("primaryCrc");this._crcLookup=new c("crcLookup");this._name=g;this._data=[];this._groups=[];this._metrics=new k;this._linked=0;this._deferQueue={insert:[],update:[],remove:[],upsert:[]};this._deferThreshold=
{insert:100,update:100,remove:100,upsert:100};this._deferTime={insert:1,update:1,remove:1,upsert:1};this._subsetOf(this)};d.addModule("Collection",e);d.inherit(e.prototype,d.chainReactor);k=h("./Metrics");c=h("./KeyValueStore");b=h("./Path");a=h("./Index");f=h("./Crc");h=d.modules.Core;e.prototype.debug=d.common.debug;e.prototype.crc=f;d.synthesize(e.prototype,"name");e.prototype.on=d.common.on;e.prototype.off=d.common.off;e.prototype.emit=d.common.emit;e.prototype.drop=function(){if(this._db&&this._db._collection&&
this._name){this.debug()&&console.log("Dropping collection "+this._name);this.emit("drop");delete this._db._collection[this._name];var g=[],b;for(b=0;b<this._groups.length;b++)g.push(this._groups[b]);for(b=0;b<g.length;b++)this._groups[b].removeCollection(this);return!0}return!1};e.prototype.primaryKey=function(g){return void 0!==g?(this._primaryKey!==g&&(this._primaryKey=g,this._primaryIndex.primaryKey(g),this._rebuildPrimaryKeyIndex()),this):this._primaryKey};e.prototype._onInsert=function(g,b){this.emit("insert",
g,b)};e.prototype._onUpdate=function(g){this.emit("update",g)};e.prototype._onRemove=function(g){this.emit("remove",g)};d.synthesize(e.prototype,"db");e.prototype.setData=function(g,b,a){if(g){var e=this._metrics.create("setData");e.start();b=b||{};b.$decouple=void 0!==b.$decouple?b.$decouple:!0;b.$decouple&&(g=this.decouple(g));g instanceof Array||(g=[g]);e.time("transformIn");g=this.transformIn(g);e.time("transformIn");var f=this._data;this._linked?this.remove():this._data=[];g.length&&(this._linked?
this.insert(g):this._data=this._data.concat(g));e.time("Rebuild Primary Key Index");this._rebuildPrimaryKeyIndex(b);e.time("Rebuild Primary Key Index");e.time("Resolve chains");this.chainSend("setData",g,{oldData:f});e.time("Resolve chains");e.stop();this.emit("setData",this._data,f)}a&&a(!1);return this};e.prototype._rebuildPrimaryKeyIndex=function(g){var b=g&&void 0!==g.ensureKeys?g.ensureKeys:!0;g=g&&void 0!==g.violationCheck?g.violationCheck:!0;var a,e,f,c=this._primaryIndex,k=this._primaryCrc,
d=this._crcLookup,h=this._primaryKey,q;c.truncate();k.truncate();d.truncate();a=this._data;for(e=a.length;e--;)if(f=a[e],b&&this._ensurePrimaryKey(f),g){if(!c.uniqueSet(f[h],f))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+f[this._primaryKey];}else q=JSON.stringify(f),c.set(f[h],f),k.set(f[h],q),d.set(q,f)};e.prototype._ensurePrimaryKey=function(g){void 0===g[this._primaryKey]&&(g[this._primaryKey]=
this.objectId())};e.prototype.truncate=function(){this.emit("truncate",this._data);this._data.length=0;this.deferEmit("change");return this};e.prototype.upsert=function(g,b){if(g){var a=this._deferQueue.upsert,e=this._deferThreshold.upsert,f={},c;if(g instanceof Array){if(g.length>e){this._deferQueue.upsert=a.concat(g);this.processQueue("upsert",b);return}f=[];for(a=0;a<g.length;a++)f.push(this.upsert(g[a]));b&&b();return f}g[this._primaryKey]?(c={},c[this._primaryKey]=g[this._primaryKey],this._primaryIndex.lookup(c)[0]?
f.op="update":f.op="insert"):f.op="insert";switch(f.op){case "insert":f.result=this.insert(g);break;case "update":f.result=this.update(c,g)}return f}b&&b()};e.prototype.update=function(g,b,a){b=this.decouple(b);b=this.transformIn(b);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var e=this,f=this._metrics.create("update"),c=this._primaryKey,k,d,h=function(f){if(b&&void 0!==b[c]&&b[c]!=f[c]){e._primaryIndex.unSet(f[c]);var k=e._updateObject(f,b,g,a,"");
if(e._primaryIndex.uniqueSet(f[c],f))return k;throw"Primary key violation in update! Key violated: "+f[c];}return e._updateObject(f,b,g,a,"")};f.start();f.time("Retrieve documents to update");k=this.find(g,{$decouple:!1});f.time("Retrieve documents to update");k.length&&(f.time("Update documents"),d=k.filter(h),f.time("Update documents"),d.length&&(f.time("Resolve chains"),this.chainSend("update",{query:g,update:b},a),f.time("Resolve chains"),this._onUpdate(d),this.deferEmit("change",{type:"update",
data:d})));f.stop();return d||[]};e.prototype.updateById=function(g,b){var a={};a[this._primaryKey]=g;return this.update(a,b)};e.prototype._updateObject=function(g,a,e,f,c,k){a=this.decouple(a);c=c||"";"."===c.substr(0,1)&&(c=c.substr(1,c.length-1));var d=!1,h=!1,n,q,p,l;for(l in a)if(a.hasOwnProperty(l)){n=!1;if("$"===l.substr(0,1))switch(l){case "$index":n=!0;break;default:n=!0,(h=this._updateObject(g,a[l],e,f,c,l))&&(d=!0)}if(this._isPositionalKey(l)&&(n=!0,l=l.substr(0,l.length-2),h=new b(c+"."+
l),g[l]&&g[l]instanceof Array&&g[l].length)){q=[];for(p=0;p<g[l].length;p++)this._match(g[l][p],h.value(e)[0])&&q.push(p);for(p=0;p<q.length;p++)(h=this._updateObject(g[l][q[p]],a[l+".$"],e,f,c+"."+l,k))&&(d=!0)}if(!n)if(k||"object"!==typeof a[l])switch(k){case "$inc":this._updateIncrement(g,l,a[l]);d=!0;break;case "$push":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array){if(void 0!==a[l].$position&&a[l].$each instanceof Array)for(h=a[l].$position,n=a[l].$each.length,p=0;p<n;p++)this._updateSplicePush(g[l],
h+p,a[l].$each[p]);else if(a[l].$each instanceof Array)for(n=a[l].$each.length,p=0;p<n;p++)this._updatePush(g[l],a[l].$each[p]);else this._updatePush(g[l],a[l]);d=!0}else throw"Cannot push to a key that is not an array! ("+l+")";break;case "$pull":if(g[l]instanceof Array){q=[];for(p=0;p<g[l].length;p++)this._match(g[l][p],a[l])&&q.push(p);for(n=q.length;n--;)this._updatePull(g[l],q[n]),d=!0}break;case "$pullAll":if(g[l]instanceof Array)if(a[l]instanceof Array){if(q=g[l],n=q.length,0<n)for(;n--;){for(h=
0;h<a[l].length;h++)q[n]===a[l][h]&&(this._updatePull(g[l],n),n--,d=!0);if(0>n)break}}else throw"Cannot pullAll without being given an array of values to pull! ("+l+")";break;case "$addToSet":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array){p=g[l];var m;q=p.length;var E;n=!0;m=f&&f.$addToSet;var ba;m&&m.key?(h=!1,ba=new b(m.key),E=ba.value(a[l])[0]):(E=JSON.stringify(a[l]),h=!0);for(m=0;m<q;m++)if(h){if(JSON.stringify(p[m])===E){n=!1;break}}else if(E===ba.value(p[m])[0]){n=!1;break}n&&(this._updatePush(g[l],
a[l]),d=!0)}else throw"Cannot addToSet on a key that is not an array! (undefined)!";break;case "$splicePush":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array)if(h=a.$index,void 0!==h)delete a.$index,h>g[l].length&&(h=g[l].length),this._updateSplicePush(g[l],h,a[l]),d=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+l+")";break;case "$move":if(g[l]instanceof Array)for(p=0;p<g[l].length;p++){if(this._match(g[l][p],a[l])){d=
a[l].$index;if(void 0!==d)this._updateSpliceMove(g[l],p,d),d=!0;else throw"Cannot move without a $index integer value!";break}}else throw"Cannot move on a key that is not an array! ("+l+")";break;case "$mul":this._updateMultiply(g,l,a[l]);d=!0;break;case "$rename":this._updateRename(g,l,a[l]);d=!0;break;case "$unset":this._updateUnset(g,l);d=!0;break;case "$pop":if(g[l]instanceof Array)this._updatePop(g[l],a[l])&&(d=!0);else throw"Cannot pop from a key that is not an array! ("+l+")";break;default:g[l]!==
a[l]&&(this._updateProperty(g,l,a[l]),d=!0)}else if(null!==g[l]&&"object"===typeof g[l])if(p=g[l]instanceof Array,q=a[l]instanceof Array,p||q)if(!q&&p)for(p=0;p<g[l].length;p++)(h=this._updateObject(g[l][p],a[l],e,f,c+"."+l,k))&&(d=!0);else g[l]!==a[l]&&(this._updateProperty(g,l,a[l]),d=!0);else(h=this._updateObject(g[l],a[l],e,f,c+"."+l,k))&&(d=!0);else g[l]!==a[l]&&(this._updateProperty(g,l,a[l]),d=!0)}return d};e.prototype._isPositionalKey=function(g){return".$"===g.substr(g.length-2,2)};e.prototype._updateProperty=
function(g,b,a){this._linked?(jQuery.observable(g).setProperty(b,a),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+b+'" for collection "'+this.name()+'"')):(g[b]=a,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+b+'" for collection "'+this.name()+'"'))};e.prototype._updateIncrement=function(g,b,a){this._linked?jQuery.observable(g).setProperty(b,g[b]+a):g[b]+=a};e.prototype._updateSpliceMove=function(g,b,a){this._linked?
(jQuery.observable(g).move(b,a),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+b+'" to "'+a+'" for collection "'+this.name()+'"')):(g.splice(a,0,g.splice(b,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+b+'" to "'+a+'" for collection "'+this.name()+'"'))};e.prototype._updateSplicePush=function(g,b,a){g.length>b?this._linked?jQuery.observable(g).insert(b,a):g.splice(b,0,a):this._linked?
jQuery.observable(g).insert(a):g.push(a)};e.prototype._updatePush=function(g,b){this._linked?jQuery.observable(g).insert(b):g.push(b)};e.prototype._updatePull=function(g,b){this._linked?jQuery.observable(g).remove(b):g.splice(b,1)};e.prototype._updateMultiply=function(g,b,a){this._linked?jQuery.observable(g).setProperty(b,g[b]*a):g[b]*=a};e.prototype._updateRename=function(g,b,a){var e=g[b];this._linked?(jQuery.observable(g).setProperty(a,e),jQuery.observable(g).removeProperty(b)):(g[a]=e,delete g[b])};
e.prototype._updateUnset=function(g,b){this._linked?jQuery.observable(g).removeProperty(b):delete g[b]};e.prototype._updatePop=function(g,b){var a,e=!1;0<g.length&&(this._linked?(1===b?a=g.length-1:-1===b&&(a=0),-1<a&&(jQuery.observable(arr).remove(a),e=!0)):1===b?(g.pop(),e=!0):-1===b&&(g.shift(),e=!0));return e};e.prototype.remove=function(g,b,a){var e,f;if(g instanceof Array){f=[];for(a=0;a<g.length;a++)f.push(this.remove(g[a],{noEmit:!0}));(!b||b&&!b.noEmit)&&this._onRemove(f);return f}a=this.find(g,
{$decouple:!1});if(a.length){for(f=0;f<a.length;f++)e=a[f],this._removeIndex(e),e=this._data.indexOf(e),this._linked?jQuery.observable(this._data).remove(e):this._data.splice(e,1);this.chainSend("remove",{query:g},b);(!b||b&&!b.noEmit)&&this._onRemove(a);this.deferEmit("change",{type:"remove",data:a})}return a};e.prototype.removeById=function(g){var b={};b[this._primaryKey]=g;return this.remove(b)};e.prototype.deferEmit=function(){var g=this,b;this._noEmitDefer||this._db&&(!this._db||this._db._noEmitDefer)?
this.emit.apply(this,arguments):(b=arguments,this._changeTimeout&&clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){g.debug()&&console.log("ForerunnerDB.Collection: Emitting "+b[0]);g.emit.apply(g,b)},100))};e.prototype.processQueue=function(g,b){var a=this._deferQueue[g],e=this._deferThreshold[g],f=this._deferTime[g];if(a.length){var c=this;a.length&&(a=a.length>e?a.splice(0,e):a.splice(0,a.length),this[g](a));setTimeout(function(){c.processQueue(g,b)},f)}else b&&b()};e.prototype.insert=
function(g,b,a){"function"===typeof b?(a=b,b=this._data.length):void 0===b&&(b=this._data.length);g=this.transformIn(g);return this._insertHandle(g,b,a)};e.prototype._insertHandle=function(g,b,a){var e=this._deferQueue.insert,f=this._deferThreshold.insert,c=[],k=[];if(g instanceof Array){if(g.length>f){this._deferQueue.insert=e.concat(g);this.processQueue("insert",a);return}for(f=0;f<g.length;f++)e=this._insert(g[f],b+f),!0===e?c.push(g[f]):k.push({doc:g[f],reason:e})}else e=this._insert(g,b),!0===
e?c.push(g):k.push({doc:g,reason:e});this.chainSend("insert",g,{index:b});this._onInsert(c,k);a&&a();this.deferEmit("change",{type:"insert",data:c});return{inserted:c,failed:k}};e.prototype._insert=function(g,b){if(g){var a;this._ensurePrimaryKey(g);if(a=this.insertIndexViolation(g))return"Index violation in index: "+a;this._insertIndex(g);b>this._data.length&&(b=this._data.length);this._linked?jQuery.observable(this._data).insert(b,g):this._data.splice(b,0,g);return!0}return"No document passed to insert"};
e.prototype._insertIndex=function(g){var b=this._indexByName,a,e=JSON.stringify(g);this._primaryIndex.uniqueSet(g[this._primaryKey],g);this._primaryCrc.uniqueSet(g[this._primaryKey],e);this._crcLookup.uniqueSet(e,g);for(a in b)b.hasOwnProperty(a)&&b[a].insert(g)};e.prototype._removeIndex=function(g){var b=this._indexByName,a,e=JSON.stringify(g);this._primaryIndex.unSet(g[this._primaryKey]);this._primaryCrc.unSet(g[this._primaryKey]);this._crcLookup.unSet(e);for(a in b)b.hasOwnProperty(a)&&b[a].remove(g)};
e.prototype.subset=function(g,b){var a=this.find(g,b);return(new e)._subsetOf(this).primaryKey(this._primaryKey).setData(a)};e.prototype.subsetOf=function(){return this.__subsetOf};e.prototype._subsetOf=function(g){this.__subsetOf=g;return this};e.prototype.distinct=function(g,a,e){a=this.find(a,e);g=new b(g);e={};var f=[],c,k;for(k=0;k<a.length;k++)(c=g.value(a[k])[0])&&!e[c]&&(e[c]=!0,f.push(c));return f};e.prototype.decouple=d.common.decouple;e.prototype.findById=function(g,b){var a={};a[this._primaryKey]=
g;return this.find(a,b)[0]};e.prototype.peek=function(g,b){var a=this._data,f=a.length,c,k,d=new e;if("string"===typeof g){for(c=0;c<f;c++)k=JSON.stringify(a[c]),-1<k.indexOf(g)&&d.insert(a[c]);return d.find({},b)}return this.find(g,b)};e.prototype.explain=function(b,a){return this.find(b,a).__fdbOp._data};e.prototype.find=function(g,a){g=g||{};a=a||{};a.$decouple=void 0!==a.$decouple?a.$decouple:!0;var e=this._metrics.create("find"),f=this,c,k=!0,d,h,n,q,p,l,m,E,ba,ma=[];h=function(a){return f._match(a,
g,"and")};e.start();if(g){e.time("analyseQuery");c=this._analyseQuery(g,a,e);e.time("analyseQuery");e.data("analysis",c);if(c.hasJoin&&c.queriesJoin){e.time("joinReferences");for(n=0;n<c.joinsOn.length;n++)p=c.joinsOn[n],q=new b(c.joinQueries[p]),q=q.value(g)[0],this._db.collection(c.joinsOn[n]).subset(q);e.time("joinReferences")}c.indexMatch.length&&(!a||a&&!a.$skipIndex)?(e.data("index.potential",c.indexMatch),e.data("index.used",c.indexMatch[0].index),e.time("indexLookup"),d=c.indexMatch[0].lookup,
e.time("indexLookup"),c.indexMatch[0].keyData.totalKeyCount===c.indexMatch[0].keyData.matchedKeyCount&&(k=!1)):e.flag("usedIndex",!1);k&&(d&&d.length?(c=d.length,e.time("tableScan: "+c),d=d.filter(h)):(c=this._data.length,e.time("tableScan: "+c),d=this._data.filter(h)),a.$orderBy&&(e.time("sort"),d=this.sort(a.$orderBy,d),e.time("sort")),e.time("tableScan: "+c));a.limit&&d&&d.length>a.limit&&(d.length=a.limit,e.data("limit",a.limit));a.$decouple&&(e.time("decouple"),d=this.decouple(d),e.time("decouple"),
e.data("flag.decouple",!0));if(a.join){for(h=0;h<a.join.length;h++)for(p in a.join[h])if(a.join[h].hasOwnProperty(p))for(E=p,c=this._db.collection(p),k=a.join[h][p],ba=0;ba<d.length;ba++){m={};q=n=!1;for(l in k)if(k.hasOwnProperty(l))if("$"===l.substr(0,1))switch(l){case "$as":E=k[l];break;case "$multi":n=k[l];break;case "$require":q=k[l];break;default:l.substr(0,3)}else m[l]=(new b(k[l])).value(d[ba])[0];m=c.find(m);!q||q&&m[0]?d[ba][E]=!1===n?m[0]:m:ma.push(d[ba])}e.data("flag.join",!0)}if(ma.length){e.time("removalQueue");
for(l=0;l<ma.length;l++)p=d.indexOf(ma[l]),-1<p&&d.splice(p,1);e.time("removalQueue")}if(a.transform){e.time("transform");for(l=0;l<d.length;l++)d.splice(l,1,a.transform(d[l]));e.time("transform");e.data("flag.transform",!0)}this._transformEnabled&&this._transformOut&&(e.time("transformOut"),d=this.transformOut(d),e.time("transformOut"));e.data("results",d.length);e.stop()}else e.stop(),d=[];d.__fdbOp=e;return d};e.prototype.indexOf=function(a){if(a=this.find(a,{$decouple:!1})[0])return this._data.indexOf(a)};
e.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this._transformEnabled=a.enabled),void 0!==a.dataIn&&(this._transformIn=a.dataIn),void 0!==a.dataOut&&(this._transformOut=a.dataOut)):this._transformEnabled=!1===a?!1:!0,this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};e.prototype.transformIn=function(a){if(this._transformEnabled&&this._transformIn){if(a instanceof Array){var b=[],e;for(e=0;e<a.length;e++)b[e]=
this._transformIn(a[e]);return b}return this._transformIn(a)}return a};e.prototype.transformOut=function(a){if(this._transformEnabled&&this._transformOut){if(a instanceof Array){var b=[],e;for(e=0;e<a.length;e++)b[e]=this._transformOut(a[e]);return b}return this._transformOut(a)}return a};e.prototype.sort=function(a,b){b=b||[];var e=[],f,c;for(f in a)a.hasOwnProperty(f)&&(c={},c[f]=a[f],c.___fdbKey=f,e.push(c));return 2>e.length?this._sort(a,b):this._bucketSort(e,b)};e.prototype._bucketSort=function(a,
b){var e=a.shift(),f,c,k=[];if(0<a.length){b=this._sort(e,b);f=this.bucket(e.___fdbKey,b);for(c in f)f.hasOwnProperty(c)&&(e=[].concat(a),k=k.concat(this._bucketSort(e,f[c])));return k}return this._sort(e,b)};e.prototype._sort=function(a,e){var f=new b,c=f.parse(a,!0)[0];f.path(c.path);return e.sort(1===c.value?function(a,b){var g=f.value(a)[0],e=f.value(b)[0];return"string"===typeof g&&"string"===typeof e?g.localeCompare(e):g>e?1:g<e?-1:0}:function(a,b){var g=f.value(a)[0],e=f.value(b)[0];return"string"===
typeof g&&"string"===typeof e?1===g.localeCompare(e)?-1:1:g>e?-1:g<e?1:0})};e.prototype.bucket=function(a,b){var e,f={};for(e=0;e<b.length;e++)f[b[e][a]]=f[b[e][a]]||[],f[b[e][a]].push(b[e]);return f};e.prototype._analyseQuery=function(a,e,f){var c={queriesOn:[this._name],indexMatch:[],hasJoin:!1,queriesJoin:!1,joinQueries:{},query:a,options:e},k,d=[],h=[],m,n,q,p,l;f.time("checkIndexes");void 0!==a[this._primaryKey]&&(f.time("checkIndexMatch: Primary Key"),m=new b,c.indexMatch.push({lookup:this._primaryIndex.lookup(a,
e),keyData:{matchedKeys:[this._primaryKey],matchedKeyCount:1,totalKeyCount:m.countKeys(a)},index:this._primaryIndex}),f.time("checkIndexMatch: Primary Key"));for(l in this._indexById)if(this._indexById.hasOwnProperty(l)&&(n=this._indexById[l],q=n.name(),f.time("checkIndexMatch: "+q),m=n.match(a,e),p=n.lookup(a,e),0<m.matchedKeyCount&&c.indexMatch.push({lookup:p,keyData:m,index:n}),f.time("checkIndexMatch: "+q),m.totalKeyCount===m.matchedKeyCount))break;f.time("checkIndexes");1<c.indexMatch.length&&
(f.time("findOptimalIndex"),c.indexMatch.sort(function(a,b){return a.keyData.totalKeyCount===a.keyData.matchedKeyCount?-1:b.keyData.totalKeyCount===b.keyData.matchedKeyCount?1:a.keyData.matchedKeyCount===b.keyData.matchedKeyCount?a.lookup.length-b.lookup.length:b.keyData.matchedKeyCount-a.keyData.matchedKeyCount}),f.time("findOptimalIndex"));if(e.join){c.hasJoin=!0;for(f=0;f<e.join.length;f++)for(k in e.join[f])e.join[f].hasOwnProperty(k)&&(d.push(k),"$as"in e.join[f][k]?h.push(e.join[f][k].$as):
h.push(k));for(k=0;k<h.length;k++)if(e=this._queryReferencesCollection(a,h[k],""))c.joinQueries[d[k]]=e,c.queriesJoin=!0;c.joinsOn=d;c.queriesOn=c.queriesOn.concat(d)}return c};e.prototype._queryReferencesCollection=function(a,b,e){for(var f in a)if(a.hasOwnProperty(f)){if(f===b)return e&&(e+="."),e+f;if("object"===typeof a[f])return e&&(e+="."),e+=f,this._queryReferencesCollection(a[f],b,e)}return!1};e.prototype._match=function(a,b,e){var f,c;f=typeof a;c=typeof b;var k=!0,d;if(!("string"!==f&&"number"!==
f||"string"!==c&&"number"!==c))a!==b&&(k=!1);else for(d in b)if(b.hasOwnProperty(d)){f=!1;if("$"===d.substr(0,1))switch(d){case "$gt":if(a>b[d]){if("or"===e)return!0}else k=!1;f=!0;break;case "$gte":if(a>=b[d]){if("or"===e)return!0}else k=!1;f=!0;break;case "$lt":if(a<b[d]){if("or"===e)return!0}else k=!1;f=!0;break;case "$lte":if(a<=b[d]){if("or"===e)return!0}else k=!1;f=!0;break;case "$exists":if(void 0===a!==b[d]){if("or"===e)return!0}else k=!1;f=!0;break;case "$or":f=!0;for(c=0;c<b[d].length;c++){if(this._match(a,
b[d][c],"and"))return!0;k=!1}break;case "$and":f=!0;for(c=0;c<b[d].length;c++)if(!this._match(a,b[d][c],"and"))return!1;break;case "$in":if(b[d]instanceof Array){f=b[d];c=f.length;var h,m=!1;for(h=0;h<c;h++)if(f[h]===a){m=!0;break}if(m){if("or"===e)return!0}else k=!1}else throw"Cannot use a $nin operator on a non-array key: "+d;f=!0;break;case "$nin":if(b[d]instanceof Array){f=b[d];c=f.length;m=!0;for(h=0;h<c;h++)if(f[h]===a){m=!1;break}if(m){if("or"===e)return!0}else k=!1}else throw"Cannot use a $nin operator on a non-array key: "+
d;f=!0;break;case "$ne":if(a!=b[d]){if("or"===e)return!0}else k=!1;f=!0}if(!f&&b[d]instanceof RegExp)if(f=!0,"object"===typeof a&&void 0!==a[d]&&b[d].test(a[d])){if("or"===e)return!0}else k=!1;if(!f)if("object"===typeof b[d])if(void 0!==a[d]){if(a[d]instanceof Array&&!(b[d]instanceof Array))for(f=!1,c=0;c<a[d].length&&!(f=this._match(a[d][c],b[d],void 0));c++);else if(!(a[d]instanceof Array)&&b[d]instanceof Array)for(f=!1,c=0;c<b[d].length&&!(f=this._match(a[d],b[d][c],void 0));c++);else f="object"===
typeof a?this._match(a[d],b[d],void 0):this._match(void 0,b[d],void 0);if(f){if("or"===e)return!0}else k=!1}else if(b[d]&&void 0!==b[d].$exists)if(f=this._match(void 0,b[d],void 0)){if("or"===e)return!0}else k=!1;else k=!1;else if(a&&a[d]===b[d]){if("or"===e)return!0}else if(a&&a[d]&&a[d]instanceof Array&&b[d]&&"object"!==typeof b[d]){f=!1;for(c=0;c<a[d].length&&!(f=this._match(a[d][c],b[d],void 0));c++);if(f){if("or"===e)return!0}else k=!1}else k=!1;if("and"===e&&!k)return!1}return k};e.prototype.count=
function(a,b){return a?this.find(a,b).length:this._data.length};e.prototype.link=function(a,b){if(window.jQuery){this._links=this._links||{};var e,f;b&&"object"===typeof b?b.template&&"string"===typeof b.template&&(e=this.objectId(b.template),f=b.template):e=b;if(!this._links[e]){if(jQuery(a).length){if(!jQuery.templates[e]){if(!f)if(f=jQuery(b),f.length)f=jQuery(f[0]).html();else throw"Unable to bind collection to target because template does not exist: "+b;jQuery.views.templates(e,f)}jQuery.templates[e].link(a,
this._data);this._links[e]=a;this._linked++;this.debug()&&console.log('ForerunnerDB.Collection: Added binding collection "'+this.name()+'" to output target: '+a);return this}throw'Cannot bind view data to output target selector "'+a+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+a+" with the template: "+e;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};e.prototype.unlink=function(a,b){if(window.jQuery){this._links=this._links||
{};var e;b&&"object"===typeof b?b.template&&"string"===typeof b.template&&(e=this.objectId(b.template)):e=b;if(this._links[e])return jQuery.templates[e].unlink(a),delete this._links[e],this._linked--,this.debug()&&console.log('ForerunnerDB.Collection: Removed binding collection "'+this.name()+'" to output target: '+a),this;console.log("Cannot remove link, one does not exist to the target: "+a+" with the template: "+b)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";return this};
e.prototype.findSub=function(a,e,f,c){var d=new b(e);a=this.find(a);var k=a.length,h,m,n=this._db.collection("__FDB_temp_"+this.objectId()),q={parents:k,subDocTotal:0,subDocs:[],pathFound:!1,err:""};for(h=0;h<k;h++)if(m=d.value(a[h])[0]){n.setData(m);m=n.find(f,c);if(c.returnFirst&&m.length)return m[0];q.subDocs.push(m);q.subDocTotal+=m.length;q.pathFound=!0}n.drop();if(c.noStats)return q.subDocs;q.pathFound||(q.err="No objects found in the parent documents with a matching path of: "+e);return q};
e.prototype.insertIndexViolation=function(a){var b,e=this._indexByName,f,c;if(this._primaryIndex.get(a[this._primaryKey]))b=this._primaryIndex;else for(f in e)if(e.hasOwnProperty(f)&&(c=e[f],c.unique()&&c.violation(a))){b=c;break}return b?b.name():!1};e.prototype.ensureIndex=function(b,e){this._indexByName=this._indexByName||{};this._indexById=this._indexById||{};var f=new a(b,e,this),c={start:(new Date).getTime()};if(this._indexByName[f.name()])return{err:"Index with that name already exists"};if(this._indexById[f.id()])return{err:"Index with those keys already exists"};
f.rebuild();this._indexByName[f.name()]=f;this._indexById[f.id()]=f;c.end=(new Date).getTime();c.total=c.end-c.start;this._lastOp={type:"ensureIndex",stats:{time:c}};return{index:f,id:f.id(),name:f.name(),state:f.state()}};e.prototype.index=function(a){if(this._indexByName)return this._indexByName[a]};e.prototype.lastOp=function(){return this._metrics.list()};e.prototype.objectId=d.common.objectId;e.prototype.diff=function(a){var b={insert:[],update:[],remove:[]},e=this.primaryKey(),f,c,d,k;if(e===
a.primaryKey()){for(f=a._data;f&&!(f instanceof Array);)a=f,f=a._data;k=f.length;for(c=0;c<k;c++)d=f[c],this._primaryIndex.get(d[e])?this._primaryCrc.get(d[e])!==a._primaryCrc.get(d[e])&&b.update.push(d):b.insert.push(d);f=this._data;k=f.length;for(c=0;c<k;c++)d=f[c],a._primaryIndex.get(d[e])||b.remove.push(d)}else throw"Collection diffing requires that both collections have the same primary key!";return b};h.prototype.collection=function(a,b){if(a)return this._collection[a]||this.debug()&&console.log("Creating collection "+
a),this._collection[a]=this._collection[a]||(new e(a)).db(this),void 0!==b&&this._collection[a].primaryKey(b),this._collection[a];throw"Cannot get collection with undefined name!";};h.prototype.collectionExists=function(a){return Boolean(this._collection[a])};h.prototype.collections=function(){var a=[],b;for(b in this._collection)this._collection.hasOwnProperty(b)&&a.push({name:b,count:this._collection[b].count()});return a};m.exports=e},{"./Crc":6,"./Index":9,"./KeyValueStore":10,"./Metrics":11,
"./Path":14,"./Shared":17}],4:[function(h,m,d){var k,c;d=h("./Shared");var b=function(){this.init.apply(this,arguments)};b.prototype.init=function(a){this._name=a;this._data=new c("__FDB__cg_data_"+this._name);this._collections=[];this._views=[]};d.addModule("CollectionGroup",b);d.inherit(b.prototype,d.chainReactor);c=h("./Collection");h=d.modules.Core;k=d.modules.Core.prototype.init;b.prototype.debug=d.common.debug;b.prototype.on=function(){this._data.on.apply(this._data,arguments)};b.prototype.off=
function(){this._data.off.apply(this._data,arguments)};b.prototype.emit=function(){this._data.emit.apply(this._data,arguments)};b.prototype.primaryKey=function(a){return void 0!==a?(this._primaryKey=a,this):this._primaryKey};d.synthesize(b.prototype,"db");b.prototype.addCollection=function(a){if(a&&-1===this._collections.indexOf(a)){if(this._collections.length){if(this._primaryKey!==a.primaryKey())throw"All collections in a collection group must have the same primary key!";}else this.primaryKey(a.primaryKey());
this._collections.push(a);a._groups.push(this);a.chain(this);this._data.insert(a.find())}return this};b.prototype.removeCollection=function(a){if(a){var b=this._collections.indexOf(a);-1!==b&&(a.unChain(this),this._collections.splice(b,1),b=a._groups.indexOf(this),-1!==b&&a._groups.splice(b,1));0===this._collections.length&&delete this._primaryKey}return this};b.prototype.decouple=d.common.decouple;b.prototype._chainHandler=function(a){switch(a.type){case "setData":a.data=this.decouple(a.data);this._data.remove(a.options.oldData);
this._data.insert(a.data);break;case "insert":a.data=this.decouple(a.data);this._data.insert(a.data);break;case "update":this._data.update(a.data.query,a.data.update,a.options);break;case "remove":this._data.remove(a.data.query,a.options)}};b.prototype.insert=function(){this._collectionsRun("insert",arguments)};b.prototype.update=function(){this._collectionsRun("update",arguments)};b.prototype.updateById=function(){this._collectionsRun("updateById",arguments)};b.prototype.remove=function(){this._collectionsRun("remove",
arguments)};b.prototype._collectionsRun=function(a,b){for(var e=0;e<this._collections.length;e++)this._collections[e][a].apply(this._collections[e],b)};b.prototype.find=function(a,b){return this._data.find(a,b)};b.prototype.removeById=function(a){for(var b=0;b<this._collections.length;b++)this._collections[b].removeById(a)};b.prototype.subset=function(a,b){var e=this.find(a,b);return(new c)._subsetOf(this).primaryKey(this._primaryKey).setData(e)};b.prototype.drop=function(){var a,b=[].concat(this._collections),
e=[].concat(this._views);this._debug&&console.log("Dropping collection group "+this._name);for(a=0;a<b.length;a++)this.removeCollection(b[a]);for(a=0;a<e.length;a++)this._removeView(e[a]);this.emit("drop");return!0};h.prototype.init=function(){this._collectionGroup={};k.apply(this,arguments)};h.prototype.collectionGroup=function(a){return a?(this._collectionGroup[a]=this._collectionGroup[a]||(new b(a)).db(this),this._collectionGroup[a]):this._collectionGroup};m.exports=b},{"./Collection":3,"./Shared":17}],
5:[function(h,m,d){var k,c;k=h("./Shared.js");d=function(){this.init.apply(this,arguments)};d.prototype.init=function(){this._collection={};this._debug={};this._version="1.2.7"};d.prototype.moduleLoaded=k.overload({string:function(b){if(void 0!==b){b=b.replace(/ /g,"");var a=b.split(","),f;for(f=0;f<a.length;f++)if(!k.modules[b])return!1;return!0}return!1},"string, function":function(b,a){if(void 0!==b){b=b.replace(/ /g,"");var f=b.split(","),e;for(e=0;e<f.length;e++)if(!k.modules[b])return!1;a()}},
"string, function, function":function(b,a,f){if(void 0!==b){b=b.replace(/ /g,"");var e=b.split(","),c;for(c=0;c<e.length;c++)if(!k.modules[b])return f(),!1;a()}}});d.moduleLoaded=d.prototype.moduleLoaded;d.shared=k;d.prototype.shared=k;k.addModule("Core",d);k.inherit(d.prototype,k.chainReactor);c=h("./Collection.js");h("./Metrics.js");h=h("./Crc.js");d.prototype._isServer=!1;d.prototype.isClient=function(){return!this._isServer};d.prototype.isServer=function(){return this._isServer};d.prototype.crc=
h;d.prototype.isClient=function(){return!this._isServer};d.prototype.isServer=function(){return this._isServer};d.prototype.decouple=k.common.decouple;d.prototype.debug=k.common.debug;d.prototype.arrayToCollection=function(b){return(new c).setData(b)};d.prototype.on=function(b,a){this._listeners=this._listeners||{};this._listeners[b]=this._listeners[b]||[];this._listeners[b].push(a);return this};d.prototype.off=function(b,a){if(b in this._listeners){var f=this._listeners[b],e=f.indexOf(a);-1<e&&f.splice(e,
1)}return this};d.prototype.emit=function(b,a){this._listeners=this._listeners||{};if(b in this._listeners){var f=this._listeners[b],e=f.length,c;for(c=0;c<e;c++)f[c].apply(this,Array.prototype.slice.call(arguments,1))}return this};d.prototype.objectId=k.common.objectId;d.prototype.peek=function(b){var a,f,e=[],c=typeof b;for(a in this._collection)this._collection.hasOwnProperty(a)&&(f=this._collection[a],e="string"===c?e.concat(f.peek(b)):e.concat(f.find(b)));return e};d.prototype.peekCat=function(b){var a,
f,e={},c,d=typeof b;for(a in this._collection)this._collection.hasOwnProperty(a)&&(f=this._collection[a],(c="string"===d?f.peek(b):f.find(b))&&c.length&&(e[f.name()]=c));return e};m.exports=d},{"./Collection.js":3,"./Crc.js":6,"./Metrics.js":11,"./Shared.js":17}],6:[function(h,m,d){var k=function(){var c=[],b,a,f;for(a=0;256>a;a++){b=a;for(f=0;8>f;f++)b=b&1?3988292384^b>>>1:b>>>1;c[a]=b}return c}();m.exports=function(c){var b=-1,a;for(a=0;a<c.length;a++)b=b>>>8^k[(b^c.charCodeAt(a))&255];return(b^
-1)>>>0}},{}],7:[function(h,m,d){var k,c;d=h("./Shared");var b=function(){this.init.apply(this,arguments)};b.prototype.init=function(a){this._name=a;this._data={}};d.addModule("Document",b);d.inherit(b.prototype,d.chainReactor);h=h("./Collection");k=d.modules.Core;c=d.modules.Core.prototype.init;d.synthesize(b.prototype,"db");d.synthesize(b.prototype,"name");b.prototype.setData=function(a){var b,e;if(a)if(a=this.decouple(a),this._linked){e={};for(b in this._data)"jQuery"!==b.substr(0,6)&&this._data.hasOwnProperty(b)&&
void 0===a[b]&&(e[b]=1);a.$unset=e;this._updateObject(this._data,a,{})}else this._data=a;return this};b.prototype.decouple=d.common.decouple;b.prototype.objectId=d.common.objectId;b.prototype.on=d.common.on;b.prototype.off=d.common.off;b.prototype.emit=d.common.emit;b.prototype.debug=d.common.debug;b.prototype.update=function(a,b,e){this._updateObject(this._data,b,a,e)};b.prototype._updateObject=h.prototype._updateObject;b.prototype._isPositionalKey=function(a){return".$"===a.substr(a.length-2,2)};
b.prototype._updateProperty=function(a,b,e){this._linked?(jQuery.observable(a).setProperty(b,e),this.debug()&&console.log('ForerunnerDB.Document: Setting data-bound document property "'+b+'" for collection "'+this.name()+'"')):(a[b]=e,this.debug()&&console.log('ForerunnerDB.Document: Setting non-data-bound document property "'+b+'" for collection "'+this.name()+'"'))};b.prototype._updateIncrement=function(a,b,e){this._linked?jQuery.observable(a).setProperty(b,a[b]+e):a[b]+=e};b.prototype._updateSpliceMove=
function(b,f,e){this._linked?(jQuery.observable(b).move(f,e),this.debug()&&console.log('ForerunnerDB.Document: Moving data-bound document array index from "'+f+'" to "'+e+'" for collection "'+this.name()+'"')):(b.splice(e,0,b.splice(f,1)[0]),this.debug()&&console.log('ForerunnerDB.Document: Moving non-data-bound document array index from "'+f+'" to "'+e+'" for collection "'+this.name()+'"'))};b.prototype._updateSplicePush=function(b,f,e){b.length>f?this._linked?jQuery.observable(b).insert(f,e):b.splice(f,
0,e):this._linked?jQuery.observable(b).insert(e):b.push(e)};b.prototype._updatePush=function(b,f){this._linked?jQuery.observable(b).insert(f):b.push(f)};b.prototype._updatePull=function(b,f){this._linked?jQuery.observable(b).remove(f):b.splice(f,1)};b.prototype._updateMultiply=function(b,f,e){this._linked?jQuery.observable(b).setProperty(f,b[f]*e):b[f]*=e};b.prototype._updateRename=function(b,f,e){var c=b[f];this._linked?(jQuery.observable(b).setProperty(e,c),jQuery.observable(b).removeProperty(f)):
(b[e]=c,delete b[f])};b.prototype._updateUnset=function(b,f){this._linked?jQuery.observable(b).removeProperty(f):delete b[f]};b.prototype._updatePop=function(b,f){var e,c=!1;0<b.length&&(this._linked?(1===f?e=b.length-1:-1===f&&(e=0),-1<e&&(jQuery.observable(arr).remove(e),c=!0)):1===f?(b.pop(),c=!0):-1===f&&(b.shift(),c=!0));return c};b.prototype.link=function(b,f){if(window.jQuery){this._links=this._links||{};this._linked||(this._linked=0);var e,c;f&&"object"===typeof f?f.template&&"string"===typeof f.template&&
(e=this.objectId(f.template),c=f.template):e=f;if(!this._links[e]){if(jQuery(b).length){if(!jQuery.templates[e]){if(!c)if(c=jQuery(f),c.length)c=jQuery(c[0]).html();else throw"Unable to bind document to target because template does not exist: "+f;jQuery.views.templates(e,c)}jQuery.templates[e].link(b,this._data);this._links[e]=b;this._linked++;this.debug()&&console.log('ForerunnerDB.Document: Added binding document "'+this.name()+'" to output target: '+b);return this}throw'Cannot bind view data to output target selector "'+
b+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+b+" with the template: "+e;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};b.prototype.unlink=function(b,f){if(window.jQuery){this._links=this._links||{};var e;f&&"object"===typeof f?f.template&&"string"===typeof f.template&&(e=this.objectId(f.template)):e=f;if(this._links[e])return jQuery.templates[e].unlink(b),delete this._links[e],this._linked--,this.debug()&&console.log('ForerunnerDB.Document: Removed binding document "'+
this.name()+'" to output target: '+b),this;console.log("Cannot remove link, one does not exist to the target: "+b+" with the template: "+f)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";};b.prototype.drop=function(){this._db&&this._name&&this._db&&this._db._document&&this._db._document[this._name]&&(delete this._db._document[this._name],this._data={})};k.prototype.init=function(){c.apply(this,arguments)};k.prototype.document=function(a){return a?(this._document=this._document||
{},this._document[a]=this._document[a]||(new b(a)).db(this),this._document[a]):this._document};m.exports=b},{"./Collection":3,"./Shared":17}],8:[function(h,m,d){var k;h=h("./Shared");var c=function(b,a){this.init.apply(this,arguments)};c.prototype.init=function(b,a){this._options=a;this._selector=$(this._options.selector);this._listeners={};this._collection=b;this._options.series=[];var f,e;switch(this._options.type){case "pie":this._selector.highcharts(this._options.chartOptions);this._chart=this._selector.highcharts();
f=this._collection.find();e={allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {y} ({point.percentage:.0f}%)",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}};f=this.pieDataFromCollectionData(f,this._options.keyField,this._options.valField);$.extend(e,this._options.seriesOptions);$.extend(e,{type:"pie",name:this._options.seriesName,data:f});this._chart.addSeries(e);break;case "line":f=this.lineDataFromCollectionData(this._options.seriesField,
this._options.keyField,this._options.valField,this._options.orderBy),this._options.chartOptions.xAxis=f.xAxis,this._options.chartOptions.series=f.series,this._selector.highcharts(this._options.chartOptions),this._chart=this._selector.highcharts()}this._hookEvents()};h=h.modules.Collection;k=h.prototype.init;c.prototype.pieDataFromCollectionData=function(b,a,f){var e=[],c;for(c=0;c<b.length;c++)e.push([b[c][a],b[c][f]]);return e};c.prototype.lineDataFromCollectionData=function(b,a,f,e){var c=this._collection.distinct(b),
d=[],k={categories:[]},h,m,S,Y,Z;for(Y=0;Y<c.length;Y++){h=c[Y];m={};m[b]=h;S=[];m=this._collection.find(m,{orderBy:e});for(Z=0;Z<m.length;Z++)k.categories.push(m[Z][a]),S.push(m[Z][f]);d.push({name:h,data:S})}return{xAxis:k,series:d}};c.prototype._hookEvents=function(){this._collection.on("change",this._changeListener);this._collection.on("drop",this._dropListener)};c.prototype._changeListener=function(){if("undefined"!==typeof this._collection&&this._chart){var b=this._collection.find();switch(this._options.type){case "pie":this._chart.series[0].setData(this.pieDataFromCollectionData(b,
this._options.keyField,this._options.valField));break;case "line":b=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,this._options.orderBy);this._chart.xAxis[0].setCategories(b.xAxis.categories);for(var a=0;a<b.series.length;a++)this._chart.series[a].setData(b.series[a].data)}}};c.prototype._dropListener=function(){this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener)};c.prototype.drop=function(){this._chart.destroy();
this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener);delete this._collection._highcharts[this._options.selector];delete this._chart;delete this._options;delete this._collection;return this};h.prototype.init=function(){this._highcharts={};k.apply(this,arguments)};h.prototype.chart=function(b){this._highcharts[b.selector]||(this._highcharts[b.selector]=new c(this,b));return this._highcharts[b.selector]};h.prototype.dropChart=function(b){this._highcharts[b]&&
this._highcharts[b].drop()};m.exports=c},{"./Shared":17}],9:[function(h,m,d){d=h("./Shared");var k=h("./Path");h=function(){this.init.apply(this,arguments)};h.prototype.init=function(c,b,a){this._crossRef={};this._size=0;this._id=this._itemKeyHash(c,c);this.data({});this.unique(b&&b.unique?b.unique:!1);void 0!==c&&this.keys(c);void 0!==a&&this.collection(a);this.name(b&&b.name?b.name:this._id)};d.addModule("Index",h);d.inherit(h.prototype,d.chainReactor);h.prototype.id=function(){return this._id};
h.prototype.state=function(){return this._state};h.prototype.size=function(){return this._size};h.prototype.data=function(c){return void 0!==c?(this._data=c,this):this._data};d.synthesize(h.prototype,"name");h.prototype.collection=function(c){return void 0!==c?(this._collection=c,this):this._collection};h.prototype.keys=function(c){return void 0!==c?(this._keys=c,this._keyCount=(new k).parse(this._keys).length,this):this._keys};h.prototype.type=function(c){return void 0!==c?(this._type=c,this):this._type};
h.prototype.unique=function(c){return void 0!==c?(this._unique=c,this):this._unique};h.prototype.rebuild=function(){if(this._collection){var c=this._collection.subset({},{$decouple:!1,$orderBy:this._keys}).find(),b,a=c.length;this._data={};this._unique&&(this._uniqueLookup={});for(b=0;b<a;b++)this.insert(c[b])}this._state={name:this._name,keys:this._keys,indexSize:this._size,built:new Date,updated:new Date,ok:!0}};h.prototype.insert=function(c,b){var a,f;this._unique&&(a=this._itemHash(c,this._keys),
this._uniqueLookup[a]=c);a=this._itemHashArr(c,this._keys);for(f=0;f<a.length;f++)this.pushToPathValue(a[f],c)};h.prototype.remove=function(c,b){var a,f;this._unique&&(a=this._itemHash(c,this._keys),delete this._uniqueLookup[a]);a=this._itemHashArr(c,this._keys);for(f=0;f<a.length;f++)this.pullFromPathValue(a[f],c)};h.prototype.violation=function(c){c=this._itemHash(c,this._keys);return Boolean(this._uniqueLookup[c])};h.prototype.hashViolation=function(c){return Boolean(this._uniqueLookup[c])};h.prototype.pushToPathValue=
function(c,b){var a=this._data[c]=this._data[c]||[];-1===a.indexOf(b)&&(a.push(b),this._size++,this.pushToCrossRef(b,a))};h.prototype.pullFromPathValue=function(c,b){var a=this._data[c],f;f=a.indexOf(b);-1<f&&(a.splice(f,1),this._size--,this.pullFromCrossRef(b,a));a.length||delete this._data[c]};h.prototype.pull=function(c){var b=c[this._collection.primaryKey()],a=this._crossRef[b],f,e=a.length,g;for(f=0;f<e;f++)g=a[f],this._pullFromArray(g,c);this._size--;delete this._crossRef[b]};h.prototype._pullFromArray=
function(c,b){for(var a=c.length;a--;)c[a]===b&&c.splice(a,1)};h.prototype.pushToCrossRef=function(c,b){var a=c[this._collection.primaryKey()];this._crossRef[a]=this._crossRef[a]||[];a=this._crossRef[a];-1===a.indexOf(b)&&a.push(b)};h.prototype.pullFromCrossRef=function(c,b){var a=c[this._collection.primaryKey()];delete this._crossRef[a]};h.prototype.lookup=function(c){return this._data[this._itemHash(c,this._keys)]||[]};h.prototype.match=function(c,b){return(new k).countObjectPaths(this._keys,c)};
h.prototype._itemHash=function(c,b){var a=new k,f,e="",g;f=a.parse(b);for(g=0;g<f.length;g++)e&&(e+="_"),e+=a.value(c,f[g].path).join(":");return e};h.prototype._itemKeyHash=function(c,b){var a=new k,f,e="",g;f=a.parse(b);for(g=0;g<f.length;g++)e&&(e+="_"),e+=a.keyValue(c,f[g].path);return e};h.prototype._itemHashArr=function(c,b){var a=new k,f,e=[],g,d,h,m;f=a.parse(b);for(h=0;h<f.length;h++)for(g=a.value(c,f[h].path),d=0;d<g.length;d++)if(0===h)e.push(g[d]);else for(m=0;m<e.length;m++)e[m]=e[m]+
"_"+g[d];return e};m.exports=h},{"./Path":14,"./Shared":17}],10:[function(h,m,d){h=h("./Shared");d=function(d){this.init.apply(this,arguments)};d.prototype.init=function(d){this._name=d;this._data={};this._primaryKey="_id"};h.addModule("KeyValueStore",d);h.inherit(d.prototype,h.chainReactor);h.synthesize(d.prototype,"name");d.prototype.primaryKey=function(d){return void 0!==d?(this._primaryKey=d,this):this._primaryKey};d.prototype.truncate=function(){this._data={};return this};d.prototype.set=function(d,
c){this._data[d]=c?c:!0;return this};d.prototype.get=function(d){return this._data[d]};d.prototype.lookup=function(d){d=d[this._primaryKey];var c,b,a,f;if(d instanceof Array){b=d.length;f=[];for(c=0;c<b;c++)(a=this._data[d[c]])&&f.push(a);return f}if(d instanceof RegExp){f=[];for(c in this._data)this._data.hasOwnProperty(c)&&d.test(c)&&f.push(this._data[c]);return f}if("object"===typeof d){if(d.$ne){f=[];for(c in this._data)this._data.hasOwnProperty(c)&&c!==d.$ne&&f.push(this._data[c]);return f}if(d.$in&&
d.$in instanceof Array){f=[];for(c in this._data)this._data.hasOwnProperty(c)&&-1<d.$in.indexOf(c)&&f.push(this._data[c]);return f}if(d.$nin&&d.$nin instanceof Array){f=[];for(c in this._data)this._data.hasOwnProperty(c)&&-1===d.$nin.indexOf(c)&&f.push(this._data[c]);return f}if(d.$or&&d.$or instanceof Array){f=[];for(c=0;c<d.$or.length;c++)f=f.concat(this.lookup(d.$or[c]));return f}}else return a=this._data[d],void 0!==a?[a]:[]};d.prototype.unSet=function(d){delete this._data[d];return this};d.prototype.uniqueSet=
function(d,c){return void 0===this._data[d]?(this._data[d]=c,!0):!1};m.exports=d},{"./Shared":17}],11:[function(h,m,d){d=h("./Shared");var k=h("./Operation");h=function(){this.init.apply(this,arguments)};h.prototype.init=function(){this._data=[]};d.addModule("Metrics",h);d.inherit(h.prototype,d.chainReactor);h.prototype.create=function(c){c=new k(c);this._enabled&&this._data.push(c);return c};h.prototype.start=function(){this._enabled=!0;return this};h.prototype.stop=function(){this._enabled=!1;return this};
h.prototype.clear=function(){this._data=[];return this};h.prototype.list=function(){return this._data};m.exports=h},{"./Operation":12,"./Shared":17}],12:[function(h,m,d){d=h("./Shared");var k=h("./Path");h=function(c){this.pathSolver=new k;this.counter=0;this.init.apply(this,arguments)};h.prototype.init=function(c){this._data={operation:c,index:{potential:[],used:!1},steps:[],time:{startMs:0,stopMs:0,totalMs:0,process:{}},flag:{},log:[]}};d.addModule("Operation",h);d.inherit(h.prototype,d.chainReactor);
h.prototype.start=function(){this._data.time.startMs=(new Date).getTime()};h.prototype.log=function(c){if(c){var b=0<this._log.length?this._data.log[this._data.log.length-1].time:0;c={event:c,time:(new Date).getTime(),delta:0};this._data.log.push(c);b&&(c.delta=c.time-b);return this}return this._data.log};h.prototype.time=function(c){if(void 0!==c){var b=this._data.time.process,b=b[c]=b[c]||{};b.startMs?(b.stopMs=(new Date).getTime(),b.totalMs=b.stopMs-b.startMs,b.stepObj.totalMs=b.totalMs,delete b.stepObj):
(b.startMs=(new Date).getTime(),b.stepObj={name:c},this._data.steps.push(b.stepObj));return this}return this._data.time};h.prototype.flag=function(c,b){if(void 0!==c&&void 0!==b)this._data.flag[c]=b;else return void 0!==c?this._data.flag[c]:this._data.flag};h.prototype.data=function(c,b,a){return void 0!==b?(this.pathSolver.set(this._data,c,b),this):this.pathSolver.get(this._data,c)};h.prototype.pushData=function(c,b,a){this.pathSolver.push(this._data,c,b)};h.prototype.stop=function(){this._data.time.stopMs=
(new Date).getTime();this._data.time.totalMs=this._data.time.stopMs-this._data.time.startMs};m.exports=h},{"./Path":14,"./Shared":17}],13:[function(h,m,d){var k,c,b;d=h("./Shared");var a=function(){this.init.apply(this,arguments)};a.prototype.init=function(a){this._name=a;this._data=new b("__FDB__dc_data_"+this._name);this._collData=new c;this._collections=[]};d.addModule("Overview",a);d.inherit(a.prototype,d.chainReactor);c=h("./Collection");b=h("./Document");h=d.modules.Core;k=d.modules.Core.prototype.init;
d.synthesize(a.prototype,"db");d.synthesize(a.prototype,"name");d.synthesize(a.prototype,"query",function(b){var a=this.$super(b);void 0!==b&&this._refresh();return a});d.synthesize(a.prototype,"queryOptions",function(b){var a=this.$super(b);void 0!==b&&this._refresh();return a});d.synthesize(a.prototype,"reduce",function(b){var a=this.$super(b);void 0!==b&&this._refresh();return a});a.prototype.debug=d.common.debug;a.prototype.objectId=d.common.objectId;a.prototype.from=function(b){void 0!==b&&("string"===
typeof b&&(b=this._db.collection(b)),this._addCollection(b));return this};a.prototype.find=function(){return this._collData.find.apply(this._collData,arguments)};a.prototype.count=function(){return this._collData.count.apply(this._collData,arguments)};a.prototype._addCollection=function(b){-1===this._collections.indexOf(b)&&(this._collections.push(b),b.chain(this),this._refresh());return this};a.prototype._removeCollection=function(b){-1<this._collections.indexOf(b)&&(this._collections.splice(b,1),
b.unChain(this),this._refresh());return this};a.prototype._refresh=function(){if(this._collections&&this._collections[0]){this._collData.primaryKey(this._collections[0].primaryKey());var b=[],a;for(a=0;a<this._collections.length;a++)b=b.concat(this._collections[a].find(this._query,this._queryOptions));this._collData.setData(b)}this._reduce&&(b=this._reduce(),this._data.setData(b))};a.prototype._chainHandler=function(b){switch(b.type){case "setData":case "insert":case "update":case "remove":this._refresh()}};
a.prototype.link=function(b,a){this._data.link.apply(this._data,arguments);this._refresh()};a.prototype.unlink=function(b,a){this._data.unlink.apply(this._data,arguments);this._refresh()};h.prototype.init=function(){this._overview={};k.apply(this,arguments)};h.prototype.overview=function(b){return b?(this._overview[b]=this._overview[b]||(new a(b)).db(this),this._overview[b]):this._overview};m.exports=a},{"./Collection":3,"./Document":7,"./Shared":17}],14:[function(h,m,d){h=h("./Shared");d=function(d){this.init.apply(this,
arguments)};d.prototype.init=function(d){d&&this.path(d)};h.addModule("Path",d);h.inherit(d.prototype,h.chainReactor);d.prototype.path=function(d){return void 0!==d?(this._path=this.clean(d),this._pathParts=this._path.split("."),this):this._path};d.prototype.hasObjectPaths=function(d,c){var b=!0,a;for(a in d)if(d.hasOwnProperty(a)&&(void 0===c[a]||"object"===typeof d[a]&&(b=this.hasObjectPaths(d[a],c[a]),!b)))return!1;return b};d.prototype.countKeys=function(d){var c=0,b;for(b in d)d.hasOwnProperty(b)&&
void 0!==d[b]&&("object"!==typeof d[b]?c++:c+=this.countKeys(d[b]));return c};d.prototype.countObjectPaths=function(d,c){var b,a={},f=0,e=0,g;for(g in c)c.hasOwnProperty(g)&&("object"===typeof c[g]?(b=this.countObjectPaths(d[g],c[g]),a[g]=b.matchedKeys,e+=b.totalKeyCount,f+=b.matchedKeyCount):(e++,d&&d[g]&&"object"!==typeof d[g]?(a[g]=!0,f++):a[g]=!1));return{matchedKeys:a,matchedKeyCount:f,totalKeyCount:e}};d.prototype.parse=function(d,c){var b=[],a="",f,e,g;for(e in d)if(d.hasOwnProperty(e))if(a=
e,"object"===typeof d[e])if(c)for(f=this.parse(d[e],c),g=0;g<f.length;g++)b.push({path:a+"."+f[g].path,value:f[g].value});else for(f=this.parse(d[e]),g=0;g<f.length;g++)b.push({path:a+"."+f[g].path});else c?b.push({path:a,value:d[e]}):b.push({path:a});return b};d.prototype.parseArr=function(d,c){c=c||{};return this._parseArr(d,"",[],c)};d.prototype._parseArr=function(d,c,b,a){var f,e="";c=c||"";b=b||[];for(f in d)d.hasOwnProperty(f)&&(!a.ignore||a.ignore&&!a.ignore.test(f))&&(e=c?c+"."+f:f,"object"===
typeof d[f]?this._parseArr(d[f],e,b,a):b.push(e));return b};d.prototype.value=function(d,c){if(void 0!==d&&"object"===typeof d){var b,a,f,e,g=[],h;void 0!==c&&(c=this.clean(c),b=c.split("."));b=b||this._pathParts;a=b.length;f=d;for(h=0;h<a;h++){f=f[b[h]];if(e instanceof Array){for(a=0;a<e.length;a++)g=g.concat(this.value(e,a+"."+b[h]));return g}if(!f||"object"!==typeof f)break;e=f}return[f]}return[]};d.prototype.set=function(d,c,b){if(void 0!==d&&void 0!==c){var a;c=this.clean(c);c=c.split(".");a=
c.shift();c.length?(d[a]=d[a]||{},this.set(d[a],c.join("."),b)):d[a]=b}return d};d.prototype.get=function(d,c){return this.value(d,c)[0]};d.prototype.push=function(d,c,b){if(void 0!==d&&void 0!==c){var a;c=this.clean(c);c=c.split(".");a=c.shift();if(c.length)d[a]=d[a]||{},this.set(d[a],c.join("."),b);else if(d[a]=d[a]||[],d[a]instanceof Array)d[a].push(b);else throw"Cannot push to a path whose endpoint is not an array!";}return d};d.prototype.keyValue=function(d,c){var b,a,f,e,g;void 0!==c&&(c=this.clean(c),
b=c.split("."));b=b||this._pathParts;a=b.length;f=d;for(g=0;g<a;g++)if(f=f[b[g]],!f||"object"!==typeof f){e=b[g]+":"+f;break}return e};d.prototype.clean=function(d){"."===d.substr(0,1)&&(d=d.substr(1,d.length-1));return d};m.exports=d},{"./Shared":17}],15:[function(h,m,d){d=h("./Shared");var k,c,b,a;a=function(){this.init.apply(this,arguments)};a.prototype.init=function(b){b.isClient()&&void 0!==Storage&&this.mode("localStorage")};d.addModule("Persist",a);d.inherit(a.prototype,d.chainReactor);d=d.modules.Core;
k=h("./Collection");c=k.prototype.drop;h("./CollectionGroup");b=d.prototype.init;a.prototype.mode=function(b){return void 0!==b?(this._mode=b,this):this._mode};a.prototype.save=function(b,a,c){switch(this.mode()){case "localStorage":a="object"===typeof a?"json::fdb::"+JSON.stringify(a):"raw::fdb::"+a;try{localStorage.setItem(b,a)}catch(d){if(c)c(d);else throw d;break}if(c)c(!1);else return!1;break;default:if(c)c("No data handler.");else throw"No data handler.";}};a.prototype.load=function(b,a){var c,
d;switch(this.mode()){case "localStorage":try{c=localStorage.getItem(b)}catch(h){a(h,null)}if(c){c=c.split("::fdb::");switch(c[0]){case "json":d=JSON.parse(c[1]);break;case "raw":d=c[1]}if(a)a(!1,d);else return d}break;default:if(a)a("No data handler or unrecognised data type.");else throw"No data handler or unrecognised data type.";}};a.prototype.drop=function(b,a){switch(this.mode()){case "localStorage":try{localStorage.removeItem(b)}catch(c){a&&a(c)}a&&a(!1);break;default:a&&a("No data handler or unrecognised data type.")}};
k.prototype.drop=function(b){if(b)if(this._name)if(this._db)this._db.persist.drop(this._name);else return callback&&callback("Cannot drop a collection's persistent storage when the collection is not attached to a database!"),"Cannot drop a collection's persistent storage when the collection is not attached to a database!";else return callback&&callback("Cannot drop a collection's persistent storage when no name assigned to collection!"),"Cannot drop a collection's persistent storage when no name assigned to collection!";
c.apply(this)};k.prototype.save=function(b){if(this._name)if(this._db)this._db.persist.save(this._name,this._data,b);else return b&&b("Cannot save a collection that is not attached to a database!"),"Cannot save a collection that is not attached to a database!";else return b&&b("Cannot save a collection with no assigned name!"),"Cannot save a collection with no assigned name!"};k.prototype.load=function(b){var a=this;if(this._name)if(this._db)this._db.persist.load(this._name,function(c,d){if(c)return b&&
b(c),c;d&&a.setData(d);b&&b(!1)});else return b&&b("Cannot load a collection that is not attached to a database!"),"Cannot load a collection that is not attached to a database!";else return b&&b("Cannot load a collection with no assigned name!"),"Cannot load a collection with no assigned name!"};d.prototype.init=function(){this.persist=new a(this);b.apply(this,arguments)};m.exports=a},{"./Collection":3,"./CollectionGroup":4,"./Shared":17}],16:[function(h,m,d){h=h("./Shared");d=function(d,c,b){if(d&&
c&&b){this._reactorIn=d;this._reactorOut=c;this._chainHandler=b;if(!d.chain||!c.chainReceive)throw"ReactorIO requires passed in and out objects to implement the ChainReactor mixin!";d.chain(this);this.chain(c)}else throw"ReactorIO requires an in, out and process argument to instantiate!";};d.prototype.drop=function(){this._reactorIn.unChain(this);this.unChain(this._reactorOut);delete this._reactorIn;delete this._reactorOut;delete this._chainHandler};h.addModule("ReactorIO",d);h.inherit(d.prototype,
h.chainReactor);m.exports=d},{"./Shared":17}],17:[function(h,m,d){var k=0,c=function(b){var a=[],f,e=["string","object","number","function","undefined"],d;if(-1<b.indexOf("*"))for(d=0;d<e.length;d++)f=b.replace("*",e[d]),a=a.concat(c(f));else a.push(b);return a};d=function(b){if(b){var a,f,e,d,h;if(!(b instanceof Array)){e={};for(a in b)if(b.hasOwnProperty(a))if(d=a.replace(/ /g,""),-1===d.indexOf("*"))e[d]=b[a];else for(h=c(d),d=0;d<h.length;d++)e[h[d]]||(e[h[d]]=b[a]);b=e}return function(){if(b instanceof
Array)for(f=b.length,a=0;a<f;a++){if(b[a].length===arguments.length)return b[a].apply(this,arguments)}else{var e=[],c;for(a=0;a<arguments.length;a++)e.push(typeof arguments[a]);c=e.join(",");if(b[c])return b[c].apply(this,arguments);for(a=e.length;0<=a;a--)if(c=e.slice(0,a).join(","),b[c+",..."])return b[c+",..."].apply(this,arguments)}throw"Overloaded method does not have a matching signature for the passed arguments!";}}return function(){}};h={modules:{},common:{decouple:function(b){if(void 0!==
b)return JSON.parse(JSON.stringify(b))},objectId:function(b){var a=Math.pow(10,17);if(b){var c=0,e=b.length,d;for(d=0;d<e;d++)c+=b.charCodeAt(d)*a;b=c.toString(16)}else k++,b=(k+(Math.random()*a+Math.random()*a+Math.random()*a+Math.random()*a)).toString(16);return b},debug:new d([function(){return this._debug&&this._debug.all},function(b){return void 0!==b?"boolean"===typeof b?(this._debug=this._debug||{},this._debug.all=b,this.chainSend("debug",this._debug),this):this._debug&&this._debug[b]||this._db&&
this._db._debug&&this._db._debug[b]||this._debug&&this._debug.all:this._debug&&this._debug.all},function(b,a){return void 0!==b?void 0!==a?(this._debug=this._debug||{},this._debug[b]=a,this.chainSend("debug",this._debug),this):this._debug&&this._debug[a]||this._db&&this._db._debug&&this._db._debug[b]:this._debug&&this._debug.all}]),on:new d({"string, function":function(b,a){this._listeners=this._listeners||{};this._listeners[b]=this._listeners[b]||{};this._listeners[b]["*"]=this._listeners[b]["*"]||
[];this._listeners[b]["*"].push(a);return this},"string, *, function":function(b,a,c){this._listeners=this._listeners||{};this._listeners[b]=this._listeners[b]||{};this._listeners[b][a]=this._listeners[b][a]||[];this._listeners[b][a].push(c);return this}}),off:new d({string:function(b){this._listeners&&this._listeners[b]&&b in this._listeners&&delete this._listeners[b];return this},"string, function":function(b,a){var c,e;"string"===typeof a?this._listeners&&this._listeners[b]&&this._listeners[b][a]&&
delete this._listeners[b][a]:b in this._listeners&&(c=this._listeners[b]["*"],e=c.indexOf(a),-1<e&&c.splice(e,1));return this},"string, *, function":function(b,a,c){this._listeners&&b in this._listeners&&a in this.listeners[b]&&(b=this._listeners[b][a],c=b.indexOf(c),-1<c&&b.splice(c,1))},"string, *":function(b,a){this._listeners&&b in this._listeners&&a in this._listeners[b]&&delete this._listeners[b][a]}}),emit:function(b,a){this._listeners=this._listeners||{};if(b in this._listeners){if(this._listeners[b]["*"]){var c=
this._listeners[b]["*"],e=c.length,d;for(d=0;d<e;d++)c[d].apply(this,Array.prototype.slice.call(arguments,1))}if(a instanceof Array&&a[0]&&a[0][this._primaryKey]){var c=this._listeners[b],h,k,e=a.length;for(d=0;d<e;d++)if(c[a[d][this._primaryKey]])for(h=c[a[d][this._primaryKey]].length,k=0;k<h;k++)c[a[d][this._primaryKey]][k].apply(this,Array.prototype.slice.call(arguments,1))}}return this}},_synth:{},addModule:function(b,a){this.modules[b]=a},inherit:function(b,a){for(var c in a)a.hasOwnProperty(c)&&
(b[c]=a[c])},synthesize:function(b,a,c){this._synth[a]=this._synth[a]||function(b){return void 0!==b?(this["_"+a]=b,this):this["_"+a]};if(c){var e=this;b[a]=function(){var b=this.$super,d;this.$super=e._synth[a];d=c.apply(this,arguments);this.$super=b;return d}}else b[a]=this._synth[a]},overload:d,chainReactor:h("./ChainReactor")};m.exports=h},{"./ChainReactor":2}],18:[function(h,m,d){var k,c,b,a;d=h("./Shared");var f=function(b,a,c){this.init.apply(this,arguments)};f.prototype.init=function(b,a,
c){this._name=b;this._groups=[];this._listeners={};this._querySettings={query:a,options:c};this._debug={};this._privateData=new k("__FDB__view_privateData_"+this._name)};d.addModule("View",f);d.inherit(f.prototype,d.chainReactor);k=h("./Collection");CollectionGroup=h("./CollectionGroup");a=h("./ReactorIO");c=k.prototype.init;h=d.modules.Core;b=h.prototype.init;d.synthesize(f.prototype,"name");f.prototype.debug=d.common.debug;f.prototype.insert=function(){this._from.insert.apply(this._from,arguments)};
f.prototype.update=function(){this._from.update.apply(this._from,arguments)};f.prototype.updateById=function(){this._from.updateById.apply(this._from,arguments)};f.prototype.remove=function(){this._from.remove.apply(this._from,arguments)};f.prototype.find=function(b,a){return this.publicData().find(b,a)};f.prototype.link=function(b,a){var c=this.publicData();this.debug()&&console.log('ForerunnerDB.View: Setting up data binding on view "'+this.name()+'" in underlying (internal) view collection "'+
c.name()+'" for output target: '+b);c.link(b,a);return this};f.prototype.unlink=function(b,a){var c=this.publicData();this.debug()&&console.log('ForerunnerDB.View: Removing data binding on view "'+this.name()+'" in underlying (internal) view collection "'+c.name()+'" for output target: '+b);c.unlink(b,a);return this};f.prototype.decouple=d.common.decouple;f.prototype.from=function(b){var c=this;if(void 0!==b){"string"===typeof b&&(b=this._db.collection(b));this._from=b;this._io=new a(b,this,function(b){var a,
e,d;if("insert"===b.type){if(c._querySettings.query){a=b.data;if(a instanceof Array)for(e=[],b=0;b<a.length;b++)c._privateData._match(a[b],c._querySettings.query,"and")&&(e.push(a[b]),d=!0);else c._privateData._match(a,c._querySettings.query,"and")&&(e=a,d=!0);d&&this.chainSend("insert",e);return!0}return!1}if("update"===b.type){if(c._querySettings.query&&(e=c._privateData.diff(c._from.subset(c._querySettings.query,c._querySettings.options)),e.insert.length||e.remove.length)){e.insert.length&&this.chainSend("insert",
e.insert);if(e.update.length)for(a=c._privateData.primaryKey(),b=0;b<e.update.length;b++)d={},d[a]=e.update[b][a],this.chainSend("update",{query:d,update:e.update[b]});e.remove.length&&this.chainSend("remove",e.remove);return!0}return!1}});var d=b.find(this._querySettings.query,this._querySettings.options);this._transformPrimaryKey(b.primaryKey());this._transformInsert(d);this._privateData.primaryKey(b.primaryKey());this._privateData.insert(d)}return this};f.prototype.ensureIndex=function(){return this._privateData.ensureIndex.apply(this._privateData,
arguments)};f.prototype._chainHandler=function(b){var a,c,d,f;switch(b.type){case "setData":this.debug()&&console.log('ForerunnerDB.View: Setting data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');b.data=this.decouple(b.data);this._transformSetData(b.data);this._privateData.setData(b.data);break;case "insert":this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+
this._privateData.name()+'"');b.data=this.decouple(b.data);b.data instanceof Array||(b.data=[b.data]);a=this._privateData._data.length;this._transformInsert(b.data,a);this._privateData._insertHandle(b.data,a);this._refreshSort(b.data);break;case "update":this.debug()&&console.log('ForerunnerDB.View: Updating some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');this._privateData.primaryKey();b=this._privateData.update(b.data.query,b.data.update,
b.data.options);this._refreshSort(b);if(this._transformEnabled&&this._transformIn)for(a=this._publicData.primaryKey(),f=0;f<b.length;f++)c={},d=b[f],c[a]=d[a],this._transformUpdate(c,d);break;case "remove":this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"'),this._transformRemove(b.data.query,b.options),this._privateData.remove(b.data.query,b.options)}};f.prototype._refreshSort=function(){if(this._querySettings.options&&
this._querySettings.options.$orderBy){var b=this;this._refreshSortDebounce&&clearTimeout(this._refreshSortDebounce);this._refreshSortDebounce=setTimeout(function(){b._refreshSortAction()},10)}};f.prototype._refreshSortAction=function(){var b,a,c,d;delete this._refreshSortDebounce;b=this._privateData.find({},{$orderBy:this._querySettings.options.$orderBy,$decouple:!1});for(d=0;d<b.length;d++)a=this._privateData._data.indexOf(b[d]),c=b.indexOf(b[d]),a!==c&&this._privateData._updateSpliceMove(this._privateData._data,
a,c)};f.prototype.on=function(){this._privateData.on.apply(this._privateData,arguments)};f.prototype.off=function(){this._privateData.off.apply(this._privateData,arguments)};f.prototype.emit=function(){this._privateData.emit.apply(this._privateData,arguments)};f.prototype.drop=function(){return this._from?((this.debug()||this._db&&this._db.debug())&&console.log("ForerunnerDB.View: Dropping view "+this._name),this._io.drop(),this._privateData.drop(),!0):!1};f.prototype.db=function(b){return void 0!==
b?(this._db=b,this.privateData().db(b),this.publicData().db(b),this):this._db};f.prototype.primaryKey=function(){return this._privateData.primaryKey()};f.prototype.queryData=function(b,a,c){void 0!==b&&(this._querySettings.query=b);void 0!==a&&(this._querySettings.options=a);return void 0!==b||void 0!==a?(void 0!==c&&!0!==c||this.refresh(),this):this._querySettings};f.prototype.queryAdd=function(b,a,c){var d=this._querySettings.query,f;if(void 0!==b)for(f in b)b.hasOwnProperty(f)&&(void 0===d[f]||
void 0!==d[f]&&a)&&(d[f]=b[f]);void 0!==c&&!0!==c||this.refresh()};f.prototype.queryRemove=function(b,a){var c=this._querySettings.query,d;if(void 0!==b)for(d in b)b.hasOwnProperty(d)&&delete c[d];void 0!==a&&!0!==a||this.refresh()};f.prototype.query=function(b,a){return void 0!==b?(this._querySettings.query=b,void 0!==a&&!0!==a||this.refresh(),this):this._querySettings.query};f.prototype.queryOptions=function(b,a){return void 0!==b?(this._querySettings.options=b,void 0===b.$decouple&&(b.$decouple=
!0),void 0!==a&&!0!==a||this.refresh(),this):this._querySettings.options};f.prototype.refresh=function(){if(this._from){var b=this.publicData();this._privateData.remove();b.remove();this._privateData.insert(this._from.find(this._querySettings.query,this._querySettings.options));if(b._linked){var a=this._privateData.find();jQuery.observable(b._data).refresh(a)}}return this};f.prototype.count=function(){return this._privateData&&this._privateData._data?this._privateData._data.length:0};f.prototype.transform=
function(b){return void 0!==b?("object"===typeof b?(void 0!==b.enabled&&(this._transformEnabled=b.enabled),void 0!==b.dataIn&&(this._transformIn=b.dataIn),void 0!==b.dataOut&&(this._transformOut=b.dataOut)):this._transformEnabled=!1===b?!1:!0,this._transformPrimaryKey(this.privateData().primaryKey()),this._transformSetData(this.privateData().find()),this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};f.prototype.privateData=function(){return this._privateData};
f.prototype.publicData=function(){return this._transformEnabled?this._publicData:this._privateData};f.prototype._transformSetData=function(b){this._transformEnabled&&(this._publicData=new k("__FDB__view_publicData_"+this._name),this._publicData.db(this._privateData._db),this._publicData.transform({enabled:!0,dataIn:this._transformIn,dataOut:this._transformOut}),this._publicData.setData(b))};f.prototype._transformInsert=function(b,a){this._transformEnabled&&this._publicData&&this._publicData.insert(b,
a)};f.prototype._transformUpdate=function(b,a,c){this._transformEnabled&&this._publicData&&this._publicData.update(b,a,c)};f.prototype._transformRemove=function(b,a){this._transformEnabled&&this._publicData&&this._publicData.remove(b,a)};f.prototype._transformPrimaryKey=function(b){this._transformEnabled&&this._publicData&&this._publicData.primaryKey(b)};k.prototype.init=function(){this._views=[];c.apply(this,arguments)};k.prototype.view=function(b,a,c){if(this._db&&this._db._views){if(this._db._views[b])throw"Cannot create a view using this collection because one with this name already exists: "+
b;b=(new f(b,a,c)).db(this._db)._addCollection(this);this._views=this._views||[];this._views.push(b);return b}};k.prototype._addView=CollectionGroup.prototype._addView=function(b){void 0!==b&&this._views.push(b);return this};k.prototype._removeView=CollectionGroup.prototype._removeView=function(b){void 0!==b&&(b=this._views.indexOf(b),-1<b&&this._views.splice(b,1));return this};h.prototype.init=function(){this._views={};b.apply(this,arguments)};h.prototype.view=function(b){this._views[b]||(this.debug()||
this._db&&this._db.debug())&&console.log("Core.View: Creating view "+b);this._views[b]=this._views[b]||(new f(b)).db(this);return this._views[b]};h.prototype.viewExists=function(b){return Boolean(this._views[b])};h.prototype.views=function(){var b=[],a;for(a in this._views)this._views.hasOwnProperty(a)&&b.push({name:a,count:this._views[a].count()});return b};m.exports=f},{"./Collection":3,"./CollectionGroup":4,"./ReactorIO":16,"./Shared":17}],19:[function(h,m,d){window.jQuery&&(this.jQuery=window.jQuery,
function(){(function(d,c,b){function a(b){return b}function f(b){debugger;return b}function e(b){ca=(xa._dbgMode=b)?"Unavailable (nested view): use #getIndex()":"";Ba("dbg",Ha.dbg=na.dbg=b?f:a)}function g(b){this.name=(s.link?"JsViews":"JsRender")+" Error";this.message=b||this.name}function h(b,a){for(var c in a)b[c]=a[c];return b}function m(b){return"function"===typeof b}function sa(b,a,c){if(!P.rTag||b)x=b?b.charAt(0):x,T=b?b.charAt(1):T,M=a?a.charAt(0):M,I=a?a.charAt(1):I,N=c||N,b="\\"+x+"(\\"+
N+")?\\"+T,a="\\"+M+"\\"+I,C="(?:(?:(\\w+(?=[\\/\\s\\"+M+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+M+"]|\\"+M+"(?!\\"+I+"))*?)",P.rTag=C+")",C=RegExp(b+C+"(\\/)?|(?:\\/(\\w+)))"+a,"g"),pa=RegExp("<.*>|([^\\\\]|^)[{}]|"+b+".*"+a);return[x,T,M,I,N]}function Ja(a,c){c||(c=a,a=b);var d,e,f,g;f=this;d=!c||"root"===c;if(a){if(g=f.type===c?f:b,!g)if(d=f.views,f._.useKey)for(e in d){if(g=d[e].get(a,c))break}else for(e=0,f=d.length;!g&&e<f;e++)g=d[e].get(a,c)}else if(d)for(;f.parent.parent;)g=
f=f.parent;else for(;f&&!g;)g=f.type===c?f:b,f=f.parent;return g}function S(){var a=this.get("item");return a?a.index:b}function Y(){return this.index}function Z(a){var c,e=this,f=e.linkCtx,g=(e.ctx||{})[a];g===b&&f&&f.ctx&&(g=f.ctx[a]);g===b&&(g=Ha[a]);g&&m(g)&&!g._wrp&&(c=function(){return g.apply(this&&this!==d?this:e,arguments)},c._wrp=1,h(c,g));return c||g}function n(a,c,d){var e,f,g=+d===d&&d,h=c.linkCtx;g&&(d=(g=c.tmpl.bnds[g-1])(c.data,c,F));e=d.args[0];if(a||g){e=h&&h.tag;e||(e={_:{inline:!h,
bnd:g},tagName:":",cvt:a,flow:!0,tagCtx:d,_is:"tag"},h&&(h.tag=e,e.linkCtx=h,d.ctx=K(d.ctx,h.view.ctx)),P._lnk(e));for(f in d.props)Na.test(f)&&(e[f]=d.props[f]);d.view=c;e.ctx=d.ctx||{};delete d.ctx;c._.tag=e;e=q(e,e.convert||"true"!==a&&a)[0];e=g&&c._.onRender?c._.onRender(e,c,g):e;c._.tag=b}return e!=b?e:""}function q(b,a){var c=b.tagCtx,d=c.view,e=c.args;a=a&&(""+a===a?d.getRsc("converters",a)||la("Unknown converter: '"+a+"'"):a);e=e.length||c.index?a?e.slice():e:[d.data];a&&(a.depends&&(b.depends=
P.getDeps(b.depends,b,a.depends,a)),e[0]=a.apply(b,e));return e}function p(a,c){for(var d,e=this;d===b&&e;)d=(d=e.tmpl[a])&&d[c],e=e.parent;return d||F[a][c]}function l(a,c,d,e,f){var g,k,r,l,D,m,u,t,s,p,z,G="",n=+e===e&&e,C=c.linkCtx||0,w=c.ctx,x=d||c.tmpl;"tag"===a._is&&(g=a,a=g.tagName,e=g.tagCtxs);g=g||C.tag;n&&(e=(t=x.bnds[n-1])(c.data,c,F));m=e.length;for(D=0;D<m;D++){D||d&&g||(s=c.getRsc("tags",a)||la("Unknown tag: {{"+a+"}}"));k=e[D];C.tag||(u=k.tmpl,u=k.content=u&&x.tmpls[u-1],h(k,{tmpl:(g?
g:s).template||u,render:V,index:D,view:c,ctx:K(k.ctx,w)}));if(d=k.props.tmpl)d=""+d===d?c.getRsc("templates",d)||Da(d):d,k.tmpl=d;g||(s._ctr?(g=new s._ctr,p=!!g.init,g.attr=g.attr||s.attr||b):P._lnk(g={render:s.render}),g._={inline:!C},C&&(C.attr=g.attr=C.attr||g.attr,C.tag=g,g.linkCtx=C),(g._.bnd=t||C.fn)?g._.arrVws={}:g.dataBoundOnly&&la("{^{"+a+"}} tag must be data-bound"),g.tagName=a,g.parent=l=w&&w.tag,g._is="tag",g._def=s,g.tagCtxs=e);if(!D)for(z in u=k.props)Na.test(z)&&(g[z]=u[z]);k.tag=g;
g.dataMap&&g.tagCtxs&&(k.map=g.tagCtxs[D].map);g.flow||(u=k.ctx=k.ctx||{},k=g.parents=u.parentTags=w&&K(u.parentTags,w.parentTags)||{},l&&(k[l.tagName]=l),u.tag=g)}c._.tag=g;g.rendering={};for(D=0;D<m;D++){k=g.tagCtx=g.tagCtxs[D];u=k.props;a=q(g,g.convert);if(e=u.dataMap||g.dataMap)if(a.length||u.dataMap){l=k.map;if(!l||l.src!==a[0]||f)l&&l.src&&l.unmap(),l=k.map=e.map(a[0],u);a=[l.tgt]}g.ctx=k.ctx;!D&&p&&(e=g.template,g.init(k,C,g.ctx),p=b,g.template!==e&&(g._.tmpl=g.template));l=b;if(e=g.render)l=
e.apply(g,a);a=a.length?a:[c];l=l!==b?l:k.render(a[0],!0)||(f?b:"");G=G?G+(l||""):l}delete g.rendering;g.tagCtx=g.tagCtxs[0];g.ctx=g.tagCtx.ctx;g._.inline&&(r=g.attr)&&r!==L&&(G="text"===r?na.html(G):"");return n&&c._.onRender?c._.onRender(G,c,n):G}function aa(b,a,c,d,e,f,g,h){var k="array"===a,r={key:0,useKey:k?0:1,id:""+La++,onRender:h,bnds:{}};this.data=d;this.tmpl=e;this.content=g;this.views=k?[]:{};this.parent=c;this.type=a;this._=r;this.linked=!!h;c?(a=c.views,d=c._,d.useKey?(a[r.key="_"+d.useKey++]=
this,this.index=ca,this.getIndex=S,f=d.tag,r.bnd=k&&(!f||!!f._.bnd&&f)):a.splice(r.key=this.index=f,0,this),this.ctx=b||c.ctx):this.ctx=b}function E(b){var a,c,d,e,f,g;for(a in O)if(e=O[a],(f=e.compile)&&(c=b[a+"s"]))for(d in c)(e=c[d]=f(d,c[d],b))&&(g=P.onStore[a])&&g(d,e,f)}function ba(a,c,d){m(c)?c={depends:c.depends,render:c}:(c.baseTag&&(c.flow=!!c.flow,c=h(h({},c.baseTag),c)),(a=c.template)!==b&&(c.template=""+a===a?Da[a]||Da(a):a),!1!==c.init&&(a=c._ctr=function(){},(a.prototype=c).constructor=
a));d&&(c._parentTmpl=d);return c}function ma(a,e,f,g){function h(e){if(""+e===e||0<e.nodeType){try{l=0<e.nodeType?e:!pa.test(e)&&c&&c(d.document).find(e)[0]}catch(r){}l&&(e=Da[a=a||l.getAttribute(Q)],e||(a=a||"_"+X++,l.setAttribute(Q,a),e=Da[a]=ma(a,l.innerHTML,f,g)),l=b);return e}}var r,l;e=e||"";r=h(e);g=g||(e.markup?e:{});g.tmplName=a;f&&(g._parentTmpl=f);!r&&e.markup&&(r=h(e.markup))&&r.fn&&(r.debug!==e.debug||r.allowCode!==e.allowCode)&&(r=r.markup);if(r!==b)return a&&!f&&(w[a]=function(){return e.render.apply(e,
arguments)}),r.fn||e.fn?r.fn&&(e=a&&a!==r.tmplName?K(g,r):r):(e=Ma(r,g),Fa(r.replace(y,"\\$&"),e)),E(g),e}function oa(b){function a(c,e){this.tgt=b.getTgt(c,e)}m(b)&&(b={getTgt:b});b.baseMap&&(b=h(h({},b.baseMap),b));b.map=function(b,c){return new a(b,c)};return b}function Ma(b,a){var c,e=xa.wrapMap||{},d=h({markup:b,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:ta},a);a.htmlTag||(c=da.exec(b),d.htmlTag=c?c[1].toLowerCase():"");(c=e[d.htmlTag])&&c!==e.div&&(d.markup=s.trim(d.markup));return d}
function qa(a,c){function e(f,g,h){var k,r,l;if(f&&"object"===typeof f&&!f.nodeType&&!f.markup&&!f.getTgt){for(r in f)e(r,f[r],g);return F}g===b&&(g=f,f=b);f&&""+f!==f&&(h=g,g=f,f=b);l=h?h[d]=h[d]||{}:e;r=c.compile;null===g?f&&delete l[f]:(g=r?g=r(f,g,h):g,f&&(l[f]=g));r&&g&&(g._is=a);g&&(k=P.onStore[a])&&k(f,g,r);return g}var d=a+"s";F[d]=e;O[a]=c}function ra(b,a){var c=this.jquery&&(this[0]||la('Unknown template: "'+this.selector+'"')),e=c.getAttribute(Q);return ta.call(e?Da[e]:Da(c),b,a)}function ya(b,
a,c){if(xa._dbgMode)try{return b.fn(a,c,F)}catch(e){return la(e,c)}return b.fn(a,c,F)}function ta(b,a,c,e,d,f){return e||!this.fn._nvw||s.isArray(b)?V.call(this,b,a,c,e,d,f):ya(this,b,{tmpl:this})}function V(a,c,e,d,f,g){var h,k,r,l,D,u,m,t,p;r=this;var z="";!!c===c&&(e=c,c=b);!0===f&&(h=!0,f=0);r.tag?(u=r,r=r.tag,k=r._,D=r.tagName,t=k.tmpl||u.tmpl,p=r.attr&&r.attr!==L,c=K(c,r.ctx),m=u.content,!1===u.props.link&&(c=c||{},c.link=!1),d=d||u.view,a=arguments.length?a:d):t=r;if(t&&(!d&&a&&"view"===a._is&&
(d=a),d&&(m=m||d.content,g=g||d._.onRender,a===d&&(a=d.data),c=K(c,d.ctx)),d&&d.data!==b||((c=c||{}).root=a),t.fn||(t=Da[t]||Da(t)),t)){u=g=!1!==(c&&c.link)&&!p&&g;!0===g&&(u=b,g=d._.onRender);c=t.helpers?K(t.helpers,c):c;if(s.isArray(a)&&!e)for(l=h?d:f!==b&&d||new aa(c,"array",d,a,t,f,m,g),h=0,k=a.length;h<k;h++)r=a[h],D=new aa(c,"item",l,r,t,(f||0)+h,m,g),r=ya(t,r,D),z+=l._.onRender?l._.onRender(r,D):r;else{if(d||!t.fn._nvw)l=h?d:new aa(c,D||"data",d,a,t,f,m,g),k&&!r.flow&&(l.tag=r);z+=ya(t,a,l)}return u?
u(z,l):z}return""}function la(b,a,c){c=xa.onError(b,a,c);if(""+b===b)throw new P.Err(c);return!a.linkCtx&&a.linked?na.html(c):c}function ga(b){la("Syntax error\n"+b)}function Fa(b,a,c,d){function e(a){(a-=m)&&t.push(b.substr(m,a).replace(ja,"\\n"))}function f(a){a&&ga('Unmatched or missing tag: "{{/'+a+'}}" in template:\n'+b)}var g,h,k,l=a&&a.allowCode,u=[],m=0,K=[],t=u,s=[,,u];c&&(b=x+b+I);f(K[0]&&K[0][2].pop()[0]);b.replace(C,function(g,D,u,p,z,G,n,q,C,w,x,F){G&&(z=":",p=L);w=w||c;D=(D||c)&&[];
var y="",A="",ha="",ua="",ka="",Ka="",Oa="",Xa="";n=!w&&!z&&!n;u=u||(C=C||"#data",z);e(F);m=F+g.length;q?l&&t.push(["*","\n"+C.replace(ia,"$1")+"\n"]):u?("else"===u&&(R.test(C)&&ga('for "{{else if expr}}" use "{{else expr}}"'),D=s[7],s[8]=b.substring(s[8],F),s=K.pop(),t=s[2],n=!0),C&&r(C.replace(ja," "),D,a).replace(H,function(b,a,c,d,e,f,g,h){g?(A+=f+",",ua+="'"+h+"',"):c?(ha+=d+f+",",Ka+=d+"'"+h+"',"):a?Oa+=f:("trigger"===e&&(Xa+=f),y+=d+f+",",ka+=d+"'"+h+"',",k=k||Na.test(e));return""}).slice(0,
-1),h=[u,p||!!d||k||"",n&&[],[ua.slice(0,-1),ka.slice(0,-1),Ka.slice(0,-1)],[A.slice(0,-1),y.slice(0,-1),ha.slice(0,-1)],Oa,Xa,D||0],t.push(h),n&&(K.push(s),s=h,s[8]=m)):x&&(f(x!==s[0]&&"else"!==s[0]&&x),s[8]=b.substring(s[8],F),s=K.pop());f(!s&&x);t=s[2]});e(b.length);(m=u[u.length-1])&&f(""+m!==m&&+m[8]===m[8]&&m[0]);c?(g=D(u,b,c),g.paths=u[0][7]):g=D(u,a);g._nvw&&(g._nvw=!/[~#]/.test(b));return g}function Ia(b,a){return"\n\t"+(a?a+":{":"")+"args:["+b[0]+"]"+(b[1]||!a?",\n\tprops:{"+b[1]+"}":"")+
(b[2]?",\n\tctx:{"+b[2]+"}":"")}function r(b,a,c){var d,e,f,g,h,r=0,k=c?c.links:a&&(a.links=a.links||{}),l={},D={0:-1},u=0;return(b+(c?" ":"")).replace(/\)\^/g,").").replace(Ga,function(m,K,t,s,z,p,G,n,C,q,w,x,F,y,E,A,ha,ua,ka,Ka){function Oa(b,c,g,A,ha,h,ua,ka){return g&&(a&&("linkTo"===d&&(e=a._jsvto=a._jsvto||[],e.push(z)),d&&!f||a.push(z.slice(c.length))),"."!==g)?(b=(A?'view.hlp("'+A+'")':ha?"view":"data")+(ka?(h?"."+h:A?"":ha?"":"."+g)+(ua||""):(ka=A?"":ha?h||"":g,"")),b+=ka?"."+ka:"",c+("view.data"===
b.slice(0,9)?b.slice(5):b)):b}p=p||"";t=t||K||x;z=z||C;q=q||ha||"";if(!G||h||g)return!a||!A||h||g||d&&!f&&!e||(A=D[u],Ka.length-1>ka-A&&(A=Ka.slice(A,ka+1),A=T+":"+A+M,G=k[A],G||(k[A]=1,k[A]=G=Fa(A,c||a,!0),G.paths.push({_jsvOb:G})),1!==G&&(e||a).push({_jsvOb:G}))),h?(h=!F,h?m:'"'):g?(g=!y,g?m:'"'):(t?(u++,D[u]=ka++,t):"")+(ua?u?"":(r=Ka.slice(r,ka),d?(d=f=e=!1,"\b"):"\b,")+r+(r=ka+m.length,"\b"):n?(u&&ga(b),d=z,f=s,r=ka+m.length,z+":"):z?z.split("^").join(".").replace(W,Oa)+(q?(l[++u]=!0,"."!==z.charAt(0)&&
(D[u]=ka),q):p):p?p:E?(l[u--]=!1,E)+(q?(l[++u]=!0,q):""):w?(l[u]||ga(b),","):K?"":(h=F,g=y,'"'));ga(b)})}function D(b,a,d){var e,f,g,h,r,k,l,u,m,K,t,s,z,p,G,n,q,C,w,x,F,y,E,M,I=0,A="",ha={},ua=b.length;""+a===a?(G=d?'data-link="'+a.replace(ja," ").slice(1,-1)+'"':a,a=0):(G=a.tmplName||"unnamed",a.allowCode&&(ha.allowCode=!0),a.debug&&(ha.debug=!0),t=a.bnds,p=a.tmpls);for(e=0;e<ua;e++)if(f=b[e],""+f===f)A+='\n+"'+f+'"';else if(g=f[0],"*"===g)A+=";\n"+f[1]+"\nret=ret";else{h=f[1];C=f[2];r=Ia(f[3],"params")+
"},"+Ia(z=f[4]);E=f[5];M=f[6];w=f[8];(F="else"===g)||(I=0,t&&(s=f[7])&&(I=t.push(s)));(f=":"===g)?h&&(g=h===L?">":h+g):(C&&(n=Ma(w,ha),n.tmplName=G+"/"+g,D(C,n),p.push(n)),F||(q=g,x=A,A=""),n=(n=b[e+1])&&"else"===n[0]);F=E?";\ntry{\nret+=":"\n+";if(f&&(s||M||h&&h!==L)){y="return {"+r+"};";E&&(y="try {\n"+y+"\n}catch(e){return {error: j._err(e,view,"+E+")}}\n");y=new Function("data,view,j,u"," // "+G+" "+I+" "+g+"\n"+y);y.paths=s;y._tag=g;if(d)return y;K=1}A+=f?(d?(E?"\ntry{\n":"")+"return ":F)+(K?
(K=0,m=u=!0,'c("'+h+'",view,'+(s?(t[I-1]=y,I):"{"+r+"}")+")"):">"===g?(l=!0,"h("+z[0]+")"):"((v="+z[0]+')!=null?v:"")'):(m=k=!0,"\n{view:view,tmpl:"+(C?p.length:"0")+","+r+"},");if(q&&!n){A="["+A.slice(0,-1)+"]";if(d||s)if(A=new Function("data,view,j,u"," // "+G+" "+I+" "+q+"\nreturn "+A+";"),s&&((t[I-1]=A).paths=s),A._tag=g,d)return A;A=x+F+'t("'+q+'",view,this,'+(I||A)+")";q=s=0}E&&(m=!0,A+=";\n}catch(e){ret"+(d?"urn ":"+=")+"j._err(e,view,"+E+");}\n"+(d?"":"ret=ret"))}A="// "+G+"\nj=j||"+(c?"jQuery.":
"jsviews.")+"views;var v"+(k?",t=j._tag":"")+(u?",c=j._cnvt":"")+(l?",h=j.converters.html":"")+(d?";\n":',ret=""\n')+(ha.debug?"debugger;":"")+A+(d?"\n":";\nreturn ret;");try{A=new Function("data,view,j,u",A)}catch(ka){ga("Compiled template code:\n\n"+A+'\n: "'+ka.message+'"')}a&&(a.fn=A);m||(A._nvw=!0);return A}function K(b,a){return b&&b!==a?a?h(h({},a),b):b:a&&h({},a)}function u(b){return ea[b]||(ea[b]="&#"+b.charCodeAt(0)+";")}function z(b){var a,c,d=[];if("object"===typeof b)for(a in b)(c=b[a])&&
c.toJSON&&!c.toJSON()||m(c)||d.push({key:a,prop:c});return d}function G(b){return null!=b?fa.test(b)&&(""+b).replace(va,u)||b:""}if(!(c&&c.render||d.jsviews)){var s,t,C,pa,ca,x="{",T="{",M="}",I="}",N="^",W=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,Ga=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^|\s*$)|[)\]])([([]?))|(\s+)/g,
ja=/[ \t]*(\r\n|\n|\r)/g,ia=/\\(['"])/g,y=/['"\\]/g,H=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,R=/^if\s/,da=/<(\w+)[>\s]/,fa=/[\x00`><\"'&]/,Na=/^on[A-Z]|^convert(Back)?$/,va=/[\x00`><"'&]/g,X=0,La=0,ea={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},L="html",Q="data-jsv-tmpl",w={},O={template:{compile:ma},tag:{compile:ba},helper:{},converter:{}},F={jsviews:"v1.0.0-beta",settings:function(b){h(xa,b);e(xa._dbgMode);xa.jsv&&xa.jsv()},
sub:{View:aa,Err:g,tmplFn:Fa,cvt:q,parse:r,extend:h,syntaxErr:ga,onStore:{},_lnk:a},map:oa,_cnvt:n,_tag:l,_err:la};(g.prototype=Error()).constructor=g;S.depends=function(){return[this.get("item"),"index"]};Y.depends=function(){return["index"]};aa.prototype={get:Ja,getIndex:Y,getRsc:p,hlp:Z,_is:"view"};for(t in O)qa(t,O[t]);var Da=F.templates,na=F.converters,Ha=F.helpers,Ba=F.tags,P=F.sub,xa=F.settings;c?(s=c,s.fn.render=ra,s.observable&&(h(P,s.views.sub),F.map=s.views.map)):(s=d.jsviews={},s.isArray=
Array&&Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)});s.render=w;s.views=F;s.templates=Da=F.templates;xa({debugMode:e,delimiters:sa,onError:function(a,c,d){c&&(a=d===b?"{Error: "+a+"}":m(d)?d(a,c):d);return a==b?"":a},_dbgMode:!0});Ba({"else":function(){},"if":{render:function(b){return this.rendering.done||!b&&(arguments.length||!this.tagCtx.index)?"":(this.rendering.done=!0,this.selected=this.tagCtx.index,this.tagCtx.render(this.tagCtx.view,!0))},onUpdate:function(b,
a,c){var d;for(b=0;(d=this.tagCtxs[b])&&d.args.length;b++)if(d=d.args[0],a=!d!==!c[b].args[0],!this.convert&&d||a)return a;return!1},flow:!0},"for":{render:function(a){var c,d=this.tagCtx,e="",f=0;if(!this.rendering.done){if(c=!arguments.length)a=d.view.data;a!==b&&(e+=d.render(a,c),f+=s.isArray(a)?a.length:1);if(this.rendering.done=f)this.selected=d.index}return e},flow:!0},include:{flow:!0},"*":{render:a,flow:!0}});Ba("props",{baseTag:Ba["for"],dataMap:oa(z)});na({html:G,attr:G,url:function(a){return a!=
b?encodeURI(""+a):null===a?a:""}});sa()}})(this,this.jQuery);(function(d,c,b){function a(b){return E(b)?new e(b):new f(b)}function f(b){this._data=b;return this}function e(b){this._data=b;return this}function g(b,a){b=E(b)?b:[b];var c,d,e=a,f=e,h=b.length,k=[];for(c=0;c<h;c++)d=b[c],V(d)?k=k.concat(g(d.call(a,a),a)):""+d!==d?(a=f=d,f!==e&&k.push(e=f)):(f!==e&&k.push(e=f),k.push(d));return k}function h(b,a){var c,d;for(c in b){d=!0;break}d||delete ya[a]}function m(a,c){if(!a.data||!a.data.off){var d,
e,f,g=c.oldValue,h=c.value,k=a.data,l=k.observeAll,p=!k.cb.noArray,n=k.paths;if(a.type===ra)(k.cb.array||k.cb).call(k,a,c);else if(k.prop===c.path||"*"===k.prop)g=typeof g===ma&&(n[0]||p&&E(g))&&g,h=typeof(h=c.value)===ma&&(n[0]||p&&E(h))&&h,l?(d=l._path+"."+c.path,e=l.filter,f=[l.parents().slice()],g&&S(p,l.ns,[g],n,k.cb,!0,e,f,d),h&&S(p,l.ns,[h],n,k.cb,b,e,f,d)):(g&&S(p,[g],n,k.cb,!0),h&&S(p,[h],n,k.cb)),k.cb(a,c)}}function sa(){function d(b,a,e,f){var g,h=Fa(w),k=E(w)?[w]:w;b=fa?b+"."+fa:b;if(ca||
f)h&&c(k).off(b,m);else{if(N=h&&c._data(w))for(M=(N=(N=N&&N.events)&&N[e?ra:qa])&&N.length;M--;)if((I=N[M].data)&&I.cb._cId===x._cId&&I.ns===fa){if(e)return;("*"===a&&I.prop!==a||I.prop===t)&&c(w).off(b,m)}a=e?{}:{fullPath:n,paths:a?[a]:[],prop:t};a.ns=fa;a.cb=x;R&&(a.observeAll={_path:R,path:function(){g=H.length;return R.replace(/[[.]/g,function(b){g--;return"["===b?"["+c.inArray(H[g-1],H[g]):"."})},parents:function(){return H},filter:da,ns:fa});c(k).on(b,null,a,m);ja&&(ja[c.data(w,"obId")||c.data(w,
"obId",la++)]=w)}}function e(b,a){b._ob=W(b,Q);var c=Q;return function(d,e){var g=b._ob,h=a.length;typeof g===ma&&(f(g,!0),(h||X&&E(g))&&S(X,[g],a,x,W,!0));g=b._ob=W(b,c);typeof g===ma&&(f(g),(h||X&&E(g))&&S(X,[g],a,x,W,[c]));x(d,e)}}function f(c,e,g,h){if(X){var k=w,l=R;w=c;h&&(w=c[h],R+="."+h,da&&(w=a._fltr(h,c,R,da)));w&&(g||E(w))&&d(ra+".observe"+(x?".obs"+(T=x._cId=x._cId||ga++):""),b,!0,e);w=k;R=l}}var k,l,p,s,t,n,q,ca,x,T,M,I,N,W,ba,ja,ia,y,H,R,da,fa,Y,Z,X=!1!=this,oa=1,ea=ta,L=Array.apply(0,
arguments);k=L.pop();var Q=L.shift(),w=y=Q,O=L.length;Q+""===Q&&X&&(fa=Q,Q=w=y=L.shift(),O--);if(V(k))x=k;else if(k+""===k&&(R=k,H=L.pop(),da=L.pop(),k=L.pop(),O-=3),!0===k?ca=k:k&&(Q=k,oa=0),k=L[O-1],O&&k===b||V(k))x=L.pop(),O--;O&&V(L[O-1])&&(W=x,x=L.pop(),O--);ea+=ca?x?".obs"+x._cId:"":".obs"+(T=x._cId=x._cId||ga++);ca||(ja=ya[T]=ya[T]||{});Y=fa&&fa.match(Ma)||[""];for(Z=Y.length;Z--;)for(fa=Y[Z],E(y)?f(y,ca,!0):ca&&0===O&&y&&d(ea,""),k=ia=0;k<O;k++)if(n=L[k],""!==n){w=y;if(""+n===n){s=n.split("^");
s[1]&&(ia=s[0].split(".").length,n=s.join("."),ia=n.split(".").length-ia);if(W&&(ba=W(n,y))){O+=ba.length-1;aa.apply(L,[k--,1].concat(ba));continue}s=n.split(".")}else oa&&!V(n)&&(n._jsvOb&&(y=e(n,L.slice(k+1)),y.noArray=!X,y._cId=x._cId,S(X,[Q],L.slice(0,k),y,W),y=b,n=n._ob),w=n),y=n,s=[y];for(;w&&(t=s.shift())!==b;)if(typeof w===ma){if(""+t===t){if(""===t)continue;if(s.length<ia+1&&!w.nodeType){if(!ca&&(N=Fa(w)&&c._data(w))){M=(N=(N=N.events)&&N[qa])&&N.length;for(p=0;M--;)!(I=N[M].data)||I.cb!==
x||I.ns!==fa||I.prop!==t&&"*"!==I.prop||((l=s.join("."))&&I.paths.push(l),p++);if(p){w=w[t];continue}}if("*"===t){!ca&&N&&N.length&&d(ea,"",!1,!0);V(w)?(q=w.depends)&&S(X,[q],x,ca||Q):d(ea,"");for(l in w)f(w,ca,b,l);break}else t&&d(ea+"."+t,s.join("."))}R&&(R+="."+t);t=w[t]}if(V(t)){(q=t.depends)&&S(X,[w],g(q,w),x,W,ca||[Q]);break}w=t}f(w,ca)}T&&h(ja,T);return{cbId:T,bnd:ja}}function Ja(){[].push.call(arguments,!0);return sa.apply(this,arguments)}function S(){var b=[].concat.apply([],arguments);return sa.apply(b.shift(),
b)}function Y(b,a,c,d){b+""!==b&&(c=a,a=b,b="");n(b,this._data,a,c,[],"root",d)}function Z(b,a,c){Y.call(this,b,a,c,!0)}function n(c,d,e,f,g,h,k){function l(b,d){p=b.length;for(x=h+"[]";p--;)(T=a._fltr(p,b,x,f))&&n(c,T,e,f||"",g.slice(),x,d)}function m(b,a){h=b.data.observeAll._path;var d=g;g[0]!==b.target&&(g=g.slice(),g.unshift(b.target));switch(a.change){case "insert":l(a.items);break;case "remove":l(a.items,!0);break;case "refresh":l(a.oldItems,!0);l(b.target);break;case "set":x=h+"."+a.path,
n(c,a.oldValue,e,0,g.slice(),x,!0),n(c,a.value,e,0,g.slice(),x)}e.apply(this,arguments);g=d}var p,q,x,T;if(typeof d===ma){q=E(d)?"":"*";g.unshift(d);if(e){if(q||0!==f)m._cId=e._cId=e._cId||ga++,sa(c,d,q,m,k,f,g.slice(),h)}else sa(c,d,q,b,k,f,g.slice(),h);if(q)for(p in d)"_"!==p.charAt(0)&&p!==ba&&(x=h+"."+p,(T=a._fltr(p,d,x,f))&&n(c,T,e,f||0,g.slice(),x,k));else l(d,k)}}function q(b,a,c){return 0>c.indexOf(".")&&0>c.indexOf("[")&&a[b]}if(!c)throw"jsViews/jsObservable require jQuery";if(!c.observable){d=
c.views=c.views||{jsviews:"v1.0.0-alpha",sub:{}};var p=d.sub,l=c.event.special,aa=[].splice,E=c.isArray,ba=c.expando,ma="object",oa=parseInt,Ma=/\S+/g,qa=p.propChng=p.propChng||"propertyChange",ra=p.arrChng=p.arrChng||"arrayChange",ya=p._cbBnds=p._cbBnds||{},ta=qa+".observe",V=c.isFunction,la=1,ga=1,Fa=c.hasData,Ia={};p.getDeps=function(){var b=arguments;return function(){for(var a,c,d=[],e=b.length;e--;)a=b[e--],(c=b[e])&&(d=d.concat(V(c)?c(a,a):c));return d}};c.observable=a;a._fltr=function(b,a,
c,d){(b=d&&V(d)?d(b,a,c):a[b])&&(b=V(b)?b.set&&b.call(a):b);return typeof b===ma&&b};a.Object=f;a.Array=e;c.observe=a.observe=sa;c.unobserve=a.unobserve=Ja;a._apply=S;f.prototype={_data:null,observeAll:Y,unobserveAll:Z,data:function(){return this._data},setProperty:function(a,c,d){var e,f=this._data;a=a||"";if(f)if(E(a))for(e=a.length;e--;)c=a[e],this.setProperty(c.name,c.value,d===b||d);else if(""+a!==a)for(e in a)this.setProperty(e,a[e],c);else if(a!==ba){for(a=a.split(".");f&&1<a.length;)f=f[a.shift()];
f&&this._setProperty(f,a[0],c,d)}return this},removeProperty:function(b){this.setProperty(b,Ia);return this},_setProperty:function(a,c,d,e){var f,g,h,k=c?a[c]:a;V(k)&&k.set&&(g=k,f=!0===k.set?k:k.set,k=k.call(a));if(k!==d||e&&k!=d)if(!(k instanceof Date)||k>d||k<d)f?(f.call(a,d),d=g.call(a)):(h=d===Ia)?(delete a[c],d=b):c&&(a[c]=d),this._trigger(a,{change:"set",path:c,value:d,oldValue:k,remove:h})},_trigger:function(b,a){c(b).triggerHandler(qa,a)}};e.prototype={_data:null,observeAll:Y,unobserveAll:Z,
data:function(){return this._data},insert:function(b,a){var c=this._data;1===arguments.length&&(a=b,b=c.length);b=oa(b);-1<b&&b<=c.length&&(a=E(a)?a:[a],a.length&&this._insert(b,a));return this},_insert:function(b,a){var c=this._data,d=c.length;aa.apply(c,[b,0].concat(a));this._trigger({change:"insert",index:b,items:a},d)},remove:function(a,c){var d;d=this._data;a===b&&(a=d.length-1);a=oa(a);c=c?oa(c):0===c?0:1;-1<c&&-1<a&&(d=d.slice(a,a+c),(c=d.length)&&this._remove(a,c,d));return this},_remove:function(b,
a,c){var d=this._data,e=d.length;d.splice(b,a);this._trigger({change:"remove",index:b,items:c},e)},move:function(b,a,c){c=c?oa(c):0===c?0:1;b=oa(b);a=oa(a);if(0<c&&-1<b&&-1<a&&b!==a){var d=this._data.slice(b,b+c);(c=d.length)&&this._move(b,a,c,d)}return this},_move:function(b,a,c,d){var e=this._data,f=e.length;e.splice(b,c);e.splice.apply(e,[a,0].concat(d));this._trigger({change:"move",oldIndex:b,index:a,items:d},f)},refresh:function(b){var a=this._data.slice();this._refresh(a,b);return this},_refresh:function(b,
a){var c=this._data,d=c.length;aa.apply(c,[0,c.length].concat(a));this._trigger({change:"refresh",oldItems:b},d)},_trigger:function(b,a){var d=this._data,e=d.length,d=c([d]);d.triggerHandler(ra,b);e!==a&&d.triggerHandler(qa,{change:"set",path:"length",value:e,oldValue:a})}};l[qa]=l[ra]={remove:function(b){var a,d,e,f,g=b.data;if(g&&(g.off=1,g=g.cb)&&(a=ya[g._cId])){b=c._data(this).events[b.type];for(e=b.length;e--&&!d;)d=(f=b[e].data)&&f.cb===g;d||(delete a[c.data(this,"obId")],h(a,g._cId))}}};d.map=
function(d){function e(b,c,f){var g,h=this;this.src&&this.unmap();"object"===typeof b&&(h.src=b,h.tgt=f||h.tgt||[],h.options=c||h.options,h.update(),d.obsSrc&&a(h.src).observeAll(h.obs=function(b,a){g||(g=1,d.obsSrc(h,b,a),g=0)},h.srcFlt),d.obsTgt&&a(h.tgt).observeAll(h.obt=function(b,a){g||(g=1,d.obsTgt(h,b,a),g=0)},h.tgtFlt))}(e.prototype={srcFlt:d.srcFlt||q,tgtFlt:d.tgtFlt||q,update:function(b){c.observable(this.tgt).refresh(d.getTgt(this.src,this.options=b||this.options))},unmap:function(){this.src&&
(this.obs&&c.observable(this.src).unobserveAll(this.obs,this.srcFlt),this.obt&&c.observable(this.tgt).unobserveAll(this.obt,this.tgtFlt),this.src=b)},map:e,_def:d}).constructor=e;V(d)&&(d={getTgt:d});d.baseMap&&(d=c.extend({},d.baseMap,d));d.map=function(b,a,c){return new e(b,a,c)};return d}}})(this,this.jQuery);(function(d,c,b){function a(a,d,e){var f,g,h,k,l,p,n,q,r,B=a.target,s=B._jsvBnd,v=/&(\d+)\+?/g;if(s)for(;h=v.exec(s);)if(h=Ca[h[1]])if(d=h.to){h=h.linkCtx;n=h.view;r=h.tag;p=c(B);l=n.hlp(O);
q=n.hlp(F);g=m(B);f=Ra[g];e===b&&(e=fa(g)?g(B):f?p[f]():p.attr(g));f=d[1];d=d[0];f&&(k=fa(f)?f:n.getRsc("converters",f));k&&(e=k.call(r,e));f=n.linkCtx;n.linkCtx=h;g={change:"change",oldValue:h._val,value:e};if(!(l&&!1===l.call(h,a,g)||r&&r.onBeforeChange&&!1===r.onBeforeChange(a,g)||e===b)&&(l=d[0],e!==b&&l)){l=l._jsvOb?l._ob:l;r&&(r._.chging=!0);X(l).setProperty(d[2]||d[1],e);q&&q.call(h,a,g);if(r){if(r.onAfterChange)r.onAfterChange(a,g);delete r._.chging}h._val=e}n.linkCtx=f}}function f(a,d,f){var g,
h,k,l=this.data,p=this.elem,n=this.convert;h=p.parentNode;var r=this.view,q=r.linkCtx,s=r.hlp(O);r.linkCtx=this;if(h&&!(s&&d&&!1===s.call(this,a,d)||d&&"*"!==a.data.prop&&a.data.prop!==d.path)){d&&(this.eventArgs=d);if(d||this._initVal){delete this._initVal;h=f.call(r.tmpl,l,r,y);a:{var B=h,t=k=this.tag;g=this.attr||m(p,!0,n!==b);var v,u,w=t&&t.parentElem||this.elem;if(B!==b){u=c(w);g=t&&t.attr||g;fa(B)&&T(this.expr+": missing parens");"visible"===g&&(g="css-display");if(t=/^css-/.test(g)&&g.slice(4))v=
c.style(w,t),+B===B&&(v=parseInt(v));else if("link"!==g){if("value"===g)w.type===Ha&&(v=u.prop(g=na));else if(g===Ba)if(w.value===""+B)v=u.prop(na);else break a;v===b&&(v=(v=Ra[g])?u[v]():u.attr(g))}this._val=v}}if(h&&h.error!==b)h=h.error;else if(k){h=h[0]?h:[h];f=d&&k.onUpdate&&!1===k.onUpdate(a,d,h);ya(k,h);if(f||g===P){g===U&&k.onBeforeLink&&k.onBeforeLink();oa(k,k.tagCtx);S(this,l,p);r.linkCtx=q;return}if(k._.chging)return;h=":"===k.tagName?y._cnvt(k.cvt,r,h[0]):y._tag(k,r,r.tmpl,h,!0)}else f._tag&&
(h=(n=""===n?xa:n)?y._cnvt(n,r,h):y._tag(f._tag,r,r.tmpl,h,!0),k=this.tag,g=this.attr||g);e(h,this,g,k)&&d&&(s=r.hlp(F))&&s.call(this,a,d);k&&oa(k,k.tagCtx)}S(this,l,p);r.linkCtx=q}}function e(a,e,f,g){var h,l,m,p,n,q,s=a!==b,t=e.data,B=g&&g.parentElem||e.elem,u=c(B),v=e.view;q=e._val;var w=v.ctx,y=v.linkCtx,x=g||f===U;g&&(g.parentElem=g.parentElem||e.expr||g._elCnt?B:B.parentNode,l=g._prv,m=g._nxt);if(s){if(/^css-/.test(f))"visible"===e.attr&&(e=(B.currentStyle||eb.call(d,B,"")).display,a?(a=B._jsvd||
e,a!==P||(a=bb[h=B.nodeName])||(e=ia.createElement(h),ia.body.appendChild(e),a=bb[h]=(e.currentStyle||eb.call(d,e,"")).display,ia.body.removeChild(e))):(B._jsvd=e,a=P)),(x=x||q!==a)&&c.style(B,f.slice(4),a);else if("link"!==f){if(f===na)n=1,a=a&&"false"!==a;else if(f===Ba)if(B.value===""+a)a=!0,n=1,f=na;else{S(e,t,B);return}else if("selected"===f||"disabled"===f||"multiple"===f||"readonly"===f)a=a&&"false"!==a?f:null;if(h=Ra[f])if(f===U){v.linkCtx=e;v.ctx=e.ctx;if(g&&g._.inline){f=g.nodes(!0);if(g._elCnt){if(l&&
l!==m)r(l,m,B,g._tgId,"^",!0);else if(p=B._dfr)q=g._tgId+"^",h=p.indexOf("#"+q)+1,n=p.indexOf("/"+q),h&&0<n&&(h+=q.length,n>h&&(B._dfr=p.slice(0,h)+p.slice(n),D(p.slice(h,n))));l=l?l.previousSibling:m?m.previousSibling:B.lastChild}c(f).remove();if(g&&g.onBeforeLink)g.onBeforeLink();p=v.link(v.data,B,l,m,a,g&&{tag:g._tgId,lazyLink:g.tagCtx.props.lazyLink})}else{s&&u.empty();if(g&&g.onBeforeLink)g.onBeforeLink();s&&(p=v.link(t,B,l,m,a,g&&{tag:g._tgId}))}v.linkCtx=y;v.ctx=w}else{if(x=x||q!==a)if("text"===
f&&B.children&&!B.children[0])B.textContent!==b?B.textContent=a:B.innerText=null===a?"":a;else u[h](a)}else if(x=x||q!==a)u[n?"prop":"attr"](f,a!==b||n?a:null);e._val=a}return p||x}if(f===U&&g&&g.onBeforeLink)g.onBeforeLink()}function g(b,a){var c=this.hlp(O),d=this.hlp(F);if(!c||!1!==c.call(this,b,a)){if(a){var c=a.index,e=a.items;switch(a.change){case "insert":this.addViews(c,e);break;case "remove":this.removeViews(c,e.length);break;case "move":this.refresh();break;case "refresh":this.refresh()}}d&&
d.call(this,b,a)}}function h(a){var d,e=a.data,f=a._.bnd;if(!a._.useKey&&f){if(d=a._.bndArr)c([d[1]]).off(Q,d[0]),a._.bndArr=b;f!==!!f&&f._.inline?e?f._.arrVws[a._.id]=a:delete f._.arrVws[a._.id]:e&&(d=function(b){b.data&&b.data.off||g.apply(a,arguments)},c([e]).on(Q,d),a._.bndArr=[d,e])}}function m(b,a,c){var d=b.nodeName.toLowerCase(),e=R.merge[d]||b.contentEditable===xa&&{to:U,from:U};return e?a?"input"===d&&b.type===Ba?Ba:e.to:e.from:a?c?"text":U:""}function sa(a,d,e,f,g,h,k){var l,m,p,n=a.parentElem,
q=a._prv,s=a._nxt,t=a._elCnt;q&&q.parentNode!==n&&T("Missing parentNode");if(k)for(p in m=a.nodes(),t&&q&&q!==s&&r(q,s,n,a._.id,"_",!0),a.removeViews(b,b,!0),f=s,t&&(q=q?q.previousSibling:s?s.previousSibling:n.lastChild),c(m).remove(),a._.bnds)V(p);else{if(d){l=f[d-1];if(!l)return!1;q=l._nxt}t?q=(f=q)?f.previousSibling:n.lastChild:f=q.nextSibling}d=e.render(g,h,a._.useKey&&k,a,k||d,!0);a.link(g,n,q,f,d,l)}function Ja(a,c,d){var e;d?(e="^`",c=c._.tag||{_:{inline:!0,bnd:d},tagCtx:{view:c},flow:!0},
d=c._tgId,d||(Ca[d=cb++]=c,c._tgId=""+d)):(e="_`",ja[d=c._.id]=c);return"#"+d+e+(a!=b?a:"")+"/"+d+e}function S(a,c,d){var e,f=a.tag,g=a.convertBack,h=[],k=a._bndId||""+cb++,l=a._hdlr;delete a._bndId;f&&(h=f.depends||h,h=fa(h)?f.depends(f):h,e=f.linkedElem);if(!a._depends||""+a._depends!==""+h)if(a._depends&&X._apply(!1,[c],a._depends,l,!0),c=X._apply(!1,[c],a.fn.paths,h,l,a._ctxCb),c.elem=d,c.linkCtx=a,c._tgId=k,d._jsvBnd=d._jsvBnd||"",d._jsvBnd+="&"+k,a._depends=h,a.view._.bnds[k]=k,Ca[k]=c,e&&(c.to=
[[],g]),(e||g!==b)&&ra(c,f&&f.convertBack||g),f){if(f.onAfterBind)f.onAfterBind(c);f.flow||f._.inline||(d.setAttribute(ea,(d.getAttribute(ea)||"")+"#"+k+"^/"+k+"^"),f._tgId=""+k)}if(e&&e[0])for(f._.radio&&(e=e.children("input[type=radio]")),a=e.length;a--;)e[a]._jsvBnd=e[a]._jsvBnd||d._jsvBnd+"+",e[a]._jsvLnkdEl=f}function Y(b,a,c,d,e,f,g){return Z(this,b,a,c,d,e,f,g)}function Z(d,e,f,g,h,k,l,m){if(d&&e){e=e.jquery?e:c(e);G||(G=ia.body,c(G).on(w,a).on("blur","[contenteditable]",a));for(var n,p,r,
t,B,u,v,x=Ja,y=g&&"replace"===g.target,D=e.length;D--;)if(v=e[D],""+d===d)B=s(v),n=B.ctx,B.ctx=g,q(d,v,B,f),B.ctx=n;else{k=k||s(v);if(d.markup!==b)!1===k.link&&(g=g||{},g.link=x=!1),y&&(u=v.parentNode),r=d.render(f,g,h,k,b,x),u?(l=v.previousSibling,m=v.nextSibling,c.cleanData([v],!0),u.removeChild(v),v=u):(l=m=b,c(v).empty());else if(!0!==d)break;if(v._dfr&&!m){t=E(v._dfr,1,db);n=0;for(p=t.length;n<p;n++)B=t[n],(B=ja[B.id])&&B.data!==b&&B.parent.removeViews(B._.key,b,!0);v._dfr=""}k.link(f,v,l,m,
r,b,g)}}return e}function n(a,d,e,f,k,m,n,p){function r(a,c,d,e,f,g,h,A,l,ha,ua,m,ka){var n,p="";if(ka)return B=0,a;v=A||l||"";e=e||ha;d=d||m;la&&!d&&(e||v||g)&&(la=b,za=pa.shift());if(e=e||d)B=0,la=b,fa&&(d||m?Wa[za]||/;svg;|;math;/.test(";"+pa.join(";")+";")||(n="'<"+za+".../"):Wa[e]?n="'</"+e:pa.length&&e===za||(n="Mismatch: '</"+e),n&&Ta(n+">' in:\n"+k)),qa=Aa,za=pa.shift(),Aa=Va[za],ha=ha?"</"+ha+">":"",qa&&(wa+=Ea,Ea="",Aa?wa+="-":(p=ha+Za+"@"+wa+Ya+(ua||""),wa=Fa.shift()));Aa?(g?Ea+=g:c=ha||
m||"",v&&(c+=v,Ea&&(c+=" "+ea+'="'+Ea+'"',Ea=""))):c=g?c+p+f+Za+g+Ya+h+v:p||a;B&&g&&Ta(" No {^{ tags within elem markup ("+B+' ). Use data-link="..."');v&&(B=v,pa.unshift(za),za=v.slice(1),pa[0]&&pa[0]===jb[za]&&T("Parent of <tr> must be <tbody>"),la=Wa[za],(Aa=Va[za])&&!qa&&(Fa.unshift(wa),wa=""),qa=Aa,wa&&Aa&&(wa+="+"));return c}function t(a,c){var e,f,k,A,ua=[];if(a){"@"===a._tkns.charAt(0)&&(c=J.previousSibling,J.parentNode.removeChild(J),J=b);for(F=a.length;F--;){H=a[F];k=H.ch;if(e=H.path)for(C=
e.length-1;f=e.charAt(C--);)"+"===f?"-"===e.charAt(C)?(C--,c=c.previousSibling):c=c.parentNode:c=c.lastChild;if("^"===k){if(v=Ca[e=H.id]){f=c&&(!J||J.parentNode!==c);if(!J||f)v.parentElem=c;H.elCnt&&f&&(c._dfr=(H.open?"#":"/")+e+k+(c._dfr||""));ua.push([f?null:J,H])}}else if(z=ja[e=H.id])(z.parentElem||(z.parentElem=c||J&&J.parentNode||d,z._.onRender=Ja,z._.onArrayChange=g,h(z)),f=z.parentElem,H.open)?(z._elCnt=H.elCnt,c?c._dfr="#"+e+k+(c._dfr||""):(z._prv||(f._dfr=l(f._dfr,"#"+e+k)),z._prv=J)):(!c||
J&&J.parentNode===c?J&&(z._nxt||(f._dfr=l(f._dfr,"/"+e+k)),z._nxt=J):(c._dfr="/"+e+k+(c._dfr||""),z._nxt=b),y=z.linkCtx,(A=z.ctx&&z.ctx.onAfterCreate||Ia)&&A.call(y,z))}for(F=ua.length;F--;)ta.push(ua[F])}return!a||a.elCnt}function u(b){var a,c;if(b)for(F=b.length,C=0;C<F;C++)if(H=b[C],P.id)P.id=P.id!==H.id&&P.id;else if(c=v=Ca[H.id].linkCtx.tag,!v.flow){if(!Y){for(a=1;c=c.parent;)a++;da=da||a}!Y&&a!==da||Z&&v.tagName!==Z||X.push(v)}}function w(){I=Ua?d.querySelectorAll(N):c(N,d).get();G=I.length;
e&&e.innerHTML&&(O=Ua?e.querySelectorAll(N):c(N,e).get(),e=O.length?O[O.length-1]:e);for(D=da=0;D<G;D++)if(J=I[D],e&&!ya)ya=J===e;else if(f&&J===f)break;else J.parentNode&&Ha(E(J,b,X&&ob))&&!P&&J.getAttribute(M)&&ta.push([J]);va===Ga&&k===b&&d.getAttribute(M)&&ta.push([d]);ba(e,Aa);ba(f,Aa);if(!P){if(Aa&&wa+Ea&&(J=f,wa&&(f?t(E(wa+"+",1),f):t(E(wa,1),d)),t(E(Ea,1),d),f)){U=f.getAttribute(ea);if(G=U.indexOf(sa)+1)U=U.slice(G+sa.length-1);f.setAttribute(ea,Ea+U)}G=ta.length;for(D=0;D<G;D++)if(J=ta[D],
L=J[1],J=J[0],L){if(v=Ca[L.id]){if(y=v.linkCtx)v=y.tag,v.linkCtx=y;L.open?(J&&(v.parentElem=J.parentNode,v._prv=J),v._elCnt=L.elCnt,!v||v.onBeforeLink&&!1===v.onBeforeLink()||v._.bound||(v._.bound=!0,z=v.tagCtx.view,q(b,v._prv,z,a,L.id)),v._.linking=!0):(v._nxt=J,v._.linking&&(ca=v.tagCtx,z=ca.view,delete v._.linking,v._.bound||(v._.bound=!0,q(b,v._prv,z,a,L.id)),oa(v,ca)))}}else z=s(J),q(J.getAttribute(M),J,z,a,b,n)}ra&&ra.resolve()}var B,y,v,D,G,C,F,I,J,z,H,L,O,K,S,V,Q,X,Y,Z,ca,fa,da,P,ga,aa,za,
la,na,U,Aa,qa,Ea,sa,ya,ra,va=this,Ba=va._.id+"_",wa="",ta=[],pa=[],Fa=[],Ia=va.hlp(Da),Ha=t;m&&(ra=m.lazyLink&&c.Deferred(),m.tmpl?S="/"+m._.id+"_":(P=m.get,m.tag&&(Ba=m.tag+"^",m=!0)),m=!0===m);P&&(Ha=u,X=P.tags,Y=P.deep,Z=P.name);d=d?""+d===d?c(d)[0]:d.jquery?d[0]:d:va.parentElem||ia.body;fa=!R.noValidate&&d.contentEditable!==xa;za=d.tagName.toLowerCase();Aa=!!Va[za];e=e&&ma(e,Aa);f=f&&ma(f,Aa)||null;if(k!=b){na=ga=ia.createElement("div");sa=Ea="";aa="http://www.w3.org/2000/svg"===d.namespaceURI?
"svg_ns":(K=hb.exec(k))&&K[1]||"";x&&K&&K[2]&&T("Unsupported: "+K[2]);if(Aa){for(Q=f;Q&&!(V=E(Q));)Q=Q.nextSibling;if(U=V?V._tkns:d._dfr){K=S||"";if(m||!S)K+="#"+Ba;C=U.indexOf(K);C+1&&(C+=K.length,sa=Ea=U.slice(0,C),U=U.slice(C),V?Q.setAttribute(ea,U):d._dfr=U)}}la=b;k=(""+k).replace(lb,r);fa&&pa.length&&Ta("Mismatched '<"+za+"...>' in:\n"+k);if(p)return;ab.appendChild(ga);aa=W[aa]||W.div;m=aa[0];for(na.innerHTML=aa[1]+k+aa[2];m--;)na=na.lastChild;ab.removeChild(ga);for(ga=ia.createDocumentFragment();aa=
na.firstChild;)ga.appendChild(aa);d.insertBefore(ga,f)}ra?setTimeout(w,0):w();return ra&&ra.promise()}function q(a,d,e,f,g,h){var k,l,n,q,r,s,u,w;f=e.data===b?f||{}:e.data;if(g)h=Ca[g],h=h.linkCtx?h.linkCtx.tag:h,u=h.linkCtx||{data:f,elem:h._elCnt?h.parentElem:d,view:e,ctx:e.ctx,attr:U,fn:h._.bnd,tag:h,_bndId:g},p(u,u.fn);else if(a&&d)for(k=e.tmpl,n=m(d),a=c.trim(a).replace(ib,"\\$&"),a=a.slice(-1)!==pa?C+":"+a+(n?":":"")+pa:a,t.lastIndex=0;l=t.exec(a);)w=t.lastIndex,n=g?U:l[1],s=l[3],r=l[10],q=b,
u={data:f,elem:d,view:e,ctx:h||e.ctx,attr:n,_initVal:!l[2]},l[6]&&(!n&&(q=/:([\w$]*)$/.exec(r))&&(q=q[1],q!==b&&(r=-q.length-1,s=s.slice(0,r-1)+pa)),null===q&&(q=b),u.convert=l[5]||""),u.expr=n+s,(l=k.links[s])||(k.links[s]=l=H.tmplFn(s,k,!0,q)),u.fn=l,n||q===b||(u.convertBack=q),p(u,l),t.lastIndex=w}function p(b,a){function c(d,e){f.call(b,d,e,a)}c.noArray=!0;b._ctxCb=Fa(b.view);b._hdlr=c;c(!0)}function l(b,a){var c;return b?(c=b.indexOf(a),c+1?b.slice(0,c)+b.slice(c+a.length):b):""}function aa(b){return b&&
(""+b===b?b:"SCRIPT"===b.tagName?b.type.slice(3):1===b.nodeType&&b.getAttribute(ea)||"")}function E(b,a,c){function d(b,a,c,g,h,k){f.push({elCnt:e,id:g,ch:h,open:a,close:c,path:k,token:b})}var e,f=[];if(a=a?b:aa(b))return f.elCnt=!b.type,e="@"===a.charAt(0)||!b.type,f._tkns=a,a.replace(c||pb,d),f}function ba(b,a){b&&("jsv"===b.type?b.parentNode.removeChild(b):a&&""===b.getAttribute(M)&&b.removeAttribute(M))}function ma(b,a){for(var c=b;a&&c&&1!==c.nodeType;)c=c.previousSibling;c&&(1!==c.nodeType?
(c=ia.createElement("SCRIPT"),c.type="jsv",b.parentNode.insertBefore(c,b)):aa(c)||c.getAttribute(M)||c.setAttribute(M,""));return c}function oa(a,d){var e,f,g,h,k,l,m;e=d.view;var n=a.linkCtx=a.linkCtx||{tag:a,data:e.data,view:e,ctx:e.ctx};if(a.onAfterLink)a.onAfterLink(d,n);if(f=(e=a.targetTag?a.targetTag.linkedElem:a.linkedElem)&&e[0]){if(g=a._.radio)e=e.children("input[type=radio]");if(g||!a._.chging){h=H.cvt(a,a.convert)[0];if(g||f!==n.elem){for(m=e.length;m--;){f=e[m];k=f._jsvLnkdEl;if(a._.inline&&
(!k||k!==a&&k.targetTag!==a))for(f._jsvLnkdEl=a,k=n.elem?n.elem._jsvBnd:a._prv._jsvBnd,f._jsvBnd=k+"+",k=k.slice(1).split("&"),l=k.length;l--;)ra(Ca[k[l]],a.convertBack);g&&(f[na]=h===f.value)}n._val=h}h!==b&&(g||f.value===b?f.contentEditable===xa&&(f.innerHTML=h):f.type===Ha?f[na]=h&&"false"!==h:e.val(h))}}if(f=f||":"===a.tagName&&n.elem)g=f._jsvTr,h=d.props.trigger,g!==h&&(f._jsvTr=h,e=e||c(f),qa(e,g,"off"),qa(e,h,"on"))}function Ma(b){setTimeout(function(){a(b)},0)}function qa(b,c,d){c&&b[d](!0===
c?"keydown":c,!0===c?Ma:a)}function ra(b,a){var c,d,e,f,g,h=b.linkCtx,k=h.data,l=h.fn.paths;if(b){if(c=l._jsvto)l=c;for(d=l.length;d&&""+(f=l[--d])!==f;);!f||h.tag&&!h.tag.tagCtx.args.length?b.to=[[],a]:(f=f.split("^").join("."),b.to="."===f.charAt(0)?[[g=l[d-1],f.slice(1)],a]:[h._ctxCb(e=d?l[0].split("^").join("."):f)||[k,e],a],c&&g&&(b.to[0][0]=h._ctxCb(g,k)))}}function ya(b,a){var d,e;d=b.tagCtx.view;var f=b.tagCtxs||[b.tagCtx],g=f.length,h=!a;for(a=a||b._.bnd.call(d.tmpl,(b.linkCtx||d).data,d,
y);g--;)d=f[g],e=a[g],c.observable(d.props).setProperty(e.props),da(d.ctx,e.ctx),d.args=e.args,h&&(d.tmpl=e.tmpl);return f}function ta(b){for(var a,c,d=[],e=a=b.length;e--;)d.push(b[e]);for(e=a;e--;)if(a=d[e],a.parentNode){if(c=a._jsvBnd)for(c=c.slice(1).split("&"),a._jsvBnd="",b=c.length;b--;)V(c[b],a._jsvLnkdEl,a);D(aa(a)+(a._dfr||""))}}function V(a,d,e){var f,g,h,k=Ca[a];if(d)e===d.linkedElem[0]&&(delete e._jsvLnkdEl,delete d.linkedElem);else if(k){delete Ca[a];for(f in k.bnd)d=k.bnd[f],e=".obs"+
k.cbId,c.isArray(d)?c([d]).off(Q+e).off(L+e):c(d).off(L+e),delete k.bnd[f];if(f=k.linkCtx){if(d=f.tag){if(e=d.tagCtxs)for(g=e.length;g--;)(h=e[g].map)&&h.unmap();if(g=(e=(h=d.linkedElem)&&h[0]||f.elem)&&e._jsvTr)qa(h||c(e),g,"off"),e._jsvTr=b;if(d.onDispose)d.onDispose();d._elCnt||(d._prv&&d._prv.parentNode.removeChild(d._prv),d._nxt&&d._nxt.parentNode.removeChild(d._nxt))}delete f.view._.bnds[a]}delete H._cbBnds[k.cbId]}}function la(d,e){d===b?(G&&(c(G).off(w,a).off("blur","[contenteditable]",a),
G=b),d=!0,Ga.removeViews(),ta(ia.body.getElementsByTagName("*"))):e&&!0===d&&(e=e.jquery?e:c(e),e.each(function(){for(var a;(a=s(this,!0))&&a.parent;)a.parent.removeViews(a._.key,b,!0);ta(this.getElementsByTagName("*"));ta([this])}));return e}function ga(b,a){return la(this,b,a)}function Fa(b){b=b||c.view();return function(a,c){var d,e,f=[c];if(b&&a){if(a._jsvOb)return a._jsvOb.call(b.tmpl,c,b,y);if("~"===a.charAt(0)){if("~tag"===a.slice(0,4)&&(e=b.ctx,"."===a.charAt(4)&&(d=a.slice(5).split("."),
e=e.tag),d))return e?[e,d.join("."),c]:[];a=a.slice(1).split(".");if(c=b.hlp(a.shift()))a.length&&f.unshift(a.join(".")),f.unshift(c);return c?f:[]}if("#"===a.charAt(0))return"#data"===a?[]:[b,a.replace(kb,""),c]}}}function Ia(b){return b.type===Ha?b[na]:b.value}function r(b,a,c,d,e,f){var g,h,k,m,n,p,q=0,r=b===a;if(b){k=E(b)||[];g=0;for(h=k.length;g<h;g++){m=k[g];p=m.id;if(p===d&&m.ch===e)if(f)h=0;else break;r||(n="_"===m.ch?ja[p]:Ca[p].linkCtx.tag,m.open?n._prv=a:m.close&&(n._nxt=a));q+=p.length+
2}q&&b.setAttribute(ea,b.getAttribute(ea).slice(q));b=a?a.getAttribute(ea):c._dfr;if(h=b.indexOf("/"+d+e)+1)b=k._tkns.slice(0,q)+b.slice(h+(f?-1:d.length+1));b&&(a?a.setAttribute(ea,b):c._dfr=b)}else c._dfr=l(c._dfr,"#"+d+e),f||a||(c._dfr=l(c._dfr,"/"+d+e))}function D(a){var c,d,e;if(e=E(a,1,mb))for(a=0,c=e.length;a<c;a++)d=e[a],"_"===d.ch?(d=ja[d.id])&&d.data!==b&&d.parent.removeViews(d._.key,b,!0):V(d.id)}function K(b,a,d){switch(d.change){case "set":b=b.tgt;for(a=b.length;a--&&b[a].key!==d.path;);
-1===a?d.path&&c.observable(b).insert({key:d.path,prop:d.value}):d.remove?c.observable(b).remove(a):c.observable(b[a]).setProperty("prop",d.value)}}function u(b,a,d){b=b.src;switch(d.change){case "set":"prop"===d.path?c.observable(b).setProperty(a.target.key,d.value):(c.observable(b).setProperty(d.oldValue,null),delete b[d.oldValue],c.observable(b).setProperty(d.value,a.target.prop));break;case "remove":a=d.items[0];c.observable(b).removeProperty(a.key);delete b[a.key];break;case "insert":a=d.items[0],
a.key&&c.observable(b).setProperty(a.key,a.prop)}}function z(b,a,c){return 0>c.indexOf(".")&&a[b]}var G,s,t,C,pa,ca,x,T,M,I,N,W,Ga,ja,ia=d.document,y=c.views,H=y.sub,R=y.settings,da=H.extend,fa=c.isFunction,Na=y.converters,va=y.tags,X=c.observable,La=X.observe,ea="data-jsv",L=H.propChng=H.propChng||"propertyChange",Q=H.arrChng=H.arrChng||"arrayChange",w="change.jsv",O="onBeforeChange",F="onAfterChange",Da="onAfterCreate",na="checked",Ha="checkbox",Ba="radio",P="none",xa="true",Ya='">\x3c/script>',
Za='<script type="jsv',Qa="script,["+ea+"]",U="html",Ra={value:"val",input:"val",html:U,text:"text"},$a={from:"value",to:"value"},Sa=0,fb=c.cleanData,gb=R.delimiters,Ta=H.syntaxErr,hb=/<(?!script)(\w+)(?:[^>]*(on\w+)\s*=)?[^>]*>/,ib=/['"\\]/g,ab=ia.createDocumentFragment(),Ua=ia.querySelector,Va={ol:1,ul:1,table:1,tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1,svg:1,svg_ns:1},jb={tr:"table"},Wa={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,
param:1,source:1,track:1,wbr:1},bb={},Ca={},cb=1,kb=/^#(view\.?)?/,lb=/(^|(\/>)|<\/(\w+)>|)(\s*)([#\/]\d+[_^])`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|<\/(\w+)>(\s*)|(\/>)\s*|(>))/g,db=/(#)()(\d+)(_)/g,mb=/(#)()(\d+)([_^])/g,nb=/(?:(#)|(\/))(\d+)(_)/g,ob=/(#)()(\d+)(\^)/g,pb=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g,eb=d.getComputedStyle;if(!c)throw"JsViews requires jQuery";if(!c.views)throw"JsViews requires JsRender";if(!c.observable)throw"JsViews requires jquery.observable";c.link||(I={contents:function(a,
d){a!==!!a&&(d=a,a=b);var e,f=c(this.nodes());f[0]&&(e=d?f.filter(d):f,f=a&&d?e.add(f.find(d)):e);return f},nodes:function(b,a,c){var d=this._elCnt,e=!a&&d,f=[];a=a||this._prv;c=c||this._nxt;for(a=e?a===this._nxt?this.parentElem.lastSibling:a:!1===this._.inline?a||this.linkCtx.elem.firstChild:a&&a.nextSibling;a&&(!c||a!==c);)(b||d||"SCRIPT"!==a.tagName)&&f.push(a),a=a.nextSibling;return f},childTags:function(a,c){a!==!!a&&(c=a,a=b);var d=this.link?this:this.tagCtx.view,e=this._prv,f=this._elCnt,g=
[];e&&d.link(b,this.parentElem,f?e.previousSibling:e,this._nxt,b,{get:{tags:g,deep:a,name:c,id:f&&this._tgId}});return g},refresh:function(a){var c,d=this.linkCtx,f=this.tagCtx.view;this.disposed&&T("Removed tag");a===b&&(a=y._tag(this,f,f.tmpl,ya(this),!0));a+""===a&&(c=this._.inline?U:d.attr||m(this.parentElem,!0),c=e(a,d,c,this));oa(this,this.tagCtx);return c||this},update:function(c){var d=this.linkedElem;d&&a({target:d[0]},b,c)}},H.onStore.template=function(a,b){b.link=Y;b.unlink=ga;a&&(c.link[a]=
function(){return Y.apply(b,arguments)},c.unlink[a]=function(){return ga.apply(b,arguments)})},H.onStore.tag=function(a,b){H._lnk(b)},H._lnk=function(a){return da(a,I)},H.viewInfos=E,(R.delimiters=function(){var a=gb.apply(y,arguments);C=a[1];pa=a[2];ca=a[4];t=RegExp("(?:^|\\s*)([\\w-]*)(\\"+ca+")?(\\"+C+H.rTag+"\\"+pa+")","g");return this})(),da(H._lnk(H.View.prototype),{addViews:function(a,b,c){var d,e=b.length,f=this.views;if(!this._.useKey&&e&&(c=this.tmpl)&&(d=f.length+e,!1!==sa(this,a,c,f,b,
this.ctx)))for(a+=e;a<d;a++)X(f[a]).setProperty("index",a);return this},removeViews:function(a,d,e){function f(a){var d,g,k,l,n,p=m[a];if(p&&p.link){a=p._.id;e||(n=p.nodes());p.removeViews(b,b,!0);p.data=b;k=p._prv;l=p._nxt;g=p.parentElem;e||(p._elCnt&&r(k,l,g,a,"_"),c(n).remove());if(!p._elCnt)try{k.parentNode.removeChild(k),l.parentNode.removeChild(l)}catch(q){}h(p);for(d in p._.bnds)V(d);delete ja[a]}}var g,k,l=!this._.useKey,m=this.views;l&&(k=m.length);if(a===b)if(l){for(g=k;g--;)f(g);this.views=
[]}else{for(g in m)f(g);this.views={}}else if(d===b&&(l?d=1:(f(a),delete m[a])),l&&d){for(g=a+d;g-- >a;)f(g);m.splice(a,d);if(k=m.length)for(;a<k;)X(m[a]).setProperty("index",a++)}return this},refresh:function(a){var b=this.parent;b&&(sa(this,this.index,this.tmpl,b.views,this.data,a,!0),h(this));return this},link:n}),ja={0:Ga=new H.View(b,"top")},Na.merge=function(a){var b,c=this.linkCtx._val||"",d=this.tagCtx.props.toggle;d&&(b=d.replace(/[\\^$.|?*+()[{]/g,"\\$&"),c=c.replace(RegExp("(\\s(?="+b+
"$)|(\\s)|^)("+b+"(\\s|$))"),"$2"),a=c+(a?(c&&" ")+d:""));return a},va("on",{attr:P,onAfterLink:function(a,d){for(var e,f,g=0,h=a.args,k=a.props.data,l=a.view,m=a.props.context;!fa(e=h[g++]););f=h.slice(g);h=h.slice(0,g-1);m||(m=(m=/^(.*)[\.^][\w$]+$/.exec(a.params.args.slice(-f.length-1)[0]))&&H.tmplFn("{:"+m[1]+"}",l.tmpl,!0)(d.data,l));if(e){if(this._evs)this.onDispose();c(d.elem).on(this._evs=h[0]||"click",this._sel=h[1],k==b?null:k,this._hlr=function(a){return e.apply(m||d.data,[].concat(f,a,
{change:a.type,view:l,linkCtx:d}))})}},onDispose:function(){c(this.parentElem).off(this._evs,this._sel,this._hlr)},flow:!0}),da(va["for"],{onArrayChange:function(a,b){var c,d=b.change;if(this.tagCtxs[1]&&("insert"===d&&a.target.length===b.items.length||"remove"===d&&!a.target.length||"refresh"===d&&!b.oldItems.length!==!a.target.length))this.refresh();else for(c in this._.arrVws)c=this._.arrVws[c],c.data===a.target&&c._.onArrayChange.apply(c,arguments);a.done=!0},onAfterLink:function(){var a,b,d,
e,f=this,g=f._ars||{},h=f.tagCtxs,k=h.length,l=f.selected||0;for(a=0;a<=l;a++)b=h[a],e=b.map?b.map.tgt:b.args.length?b.args[0]:b.view.data,(d=g[a])&&e!==d[0]&&(La(d[0],d[1],!0),delete g[a]),!g[a]&&c.isArray(e)&&(La(e,b=function(a,b){f.onArrayChange(a,b)}),g[a]=[e,b]);for(a=l+1;a<k;a++)if(d=g[a])La(d[0],d[1],!0),delete g[a];f._ars=g},onDispose:function(){for(var a in this._ars)La(this._ars[a][0],this._ars[a][1],!0)}}),da(va["for"],I),da(va["if"],I),da(va.include,I),va("props",{baseTag:va["for"],dataMap:y.map({getTgt:va.props.dataMap.getTgt,
obsSrc:K,obsTgt:u,tgtFlt:z})}),da(c,{view:y.view=s=function(a,d,e){d!==!!d&&(e=d,d=b);var f,g,h,k,l,m;m=0;l=ia.body;if(a&&a!==l&&1<Ga._.useKey&&(a=""+a===a?c(a)[0]:a.jquery?a[0]:a))if(d)for(m=Ua?a.querySelectorAll(Qa):c(Qa,a).get(),l=m.length,a=0;a<l;a++)for(f=m[a],g=E(f,b,db),h=0,k=g.length;h<k;h++){if(f=g[h],f=ja[f.id])if(f=f&&e?f.get(!0,e):f)return f}else for(;a;){if(g=E(a,b,nb))for(l=g.length;l--;)if(f=g[l],f.open){if(1>m)return(f=ja[f.id])&&e?f.get(e):f||Ga;m--}else m++;a=a.previousSibling||
a.parentNode}return d?b:Ga},link:y.link=Z,unlink:y.unlink=la,cleanData:function(a){a.length&&Sa&&ta(a);fb.apply(c,arguments)}}),y.utility={validate:function(a){try{Ga.link(b,ia.createElement("div"),b,b,a,b,b,1)}catch(c){return c.message}}},da(c.fn,{link:function(a,b,c,d,e,f,g){return Z(a,this,b,c,d,e,f,g)},unlink:function(a){return la(a,this)},view:function(a){return s(this[0],a)}}),c.each([U,"replaceWith","empty","remove"],function(a,b){var d=c.fn[b];c.fn[b]=function(){var a;Sa=1;try{a=d.apply(this,
arguments)}finally{Sa=0}return a}}),da(Ga,{tmpl:{links:{},tags:{}}}),Ga._.onRender=Ja,R({wrapMap:W={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],svg_ns:[1,"<svg>","</svg>"],div:jQuery.support.htmlSerialize?
[0,"",""]:[1,"X<div>","</div>"]},linkAttr:M="data-link",merge:{input:{from:Ia,to:"value"},textarea:$a,select:$a,optgroup:{to:"label"}},jsrDbgMode:R.debugMode,debugMode:function(a){R.jsrDbgMode(a);a?d._jsv={views:ja,bindings:Ca}:delete d._jsv},jsv:function(){R.debugMode(R._dbgMode);M=R.linkAttr;T=y._err;N=Qa+",["+M+"]";x=R.noDomLevel0;W.optgroup=W.option;W.tbody=W.tfoot=W.colgroup=W.caption=W.thead;W.th=W.td}}))})(this,this.jQuery)}())},{}]},{},[1])(1)});
