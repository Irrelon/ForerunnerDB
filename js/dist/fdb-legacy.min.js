!function(Oa){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=Oa();else if("function"==typeof define&&define.amd)define([],Oa);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self);e.ForerunnerDB=Oa()}}(function(){return function e(m,h,k){function a(b,d){if(!h[b]){if(!m[b]){var g="function"==typeof require&&require;if(!d&&g)return g(b,!0);if(c)return c(b,!0);g=Error("Cannot find module '"+b+"'");throw g.code="MODULE_NOT_FOUND",
g;}g=h[b]={exports:{}};m[b][0].call(g.exports,function(g){var c=m[b][1][g];return a(c?c:g)},g,g.exports,e,m,h,k)}return h[b].exports}for(var c="function"==typeof require&&require,d=0;d<k.length;d++)a(k[d]);return a}({1:[function(e,m,h){h=e("../lib/Core");e("../lib/CollectionGroup");e("../lib/View");e("../lib/OldView");e("../lib/OldView.Bind");e("../lib/Highcharts");e("../lib/Persist");e("../lib/Document");e("../lib/Overview");e("../lib/vendor/jsviews");m.exports=h},{"../lib/CollectionGroup":3,"../lib/Core":4,
"../lib/Document":6,"../lib/Highcharts":7,"../lib/OldView":12,"../lib/OldView.Bind":11,"../lib/Overview":14,"../lib/Persist":16,"../lib/View":18,"../lib/vendor/jsviews":19}],2:[function(e,m,h){var k,a,c,d,b;h=e("./Shared");var f=function(g){this.init.apply(this,arguments)};f.prototype.init=function(g){this._primaryKey="_id";this._primaryIndex=new a("primary");this._primaryCrc=new a("primaryCrc");this._crcLookup=new a("crcLookup");this._name=g;this._data=[];this._groups=[];this._metrics=new k;this._linked=
0;this._deferQueue={insert:[],update:[],remove:[],upsert:[]};this._deferThreshold={insert:100,update:100,remove:100,upsert:100};this._deferTime={insert:1,update:1,remove:1,upsert:1};this._subsetOf(this)};h.addModule("Collection",f);h.inherit(f.prototype,h.chainSystem);k=e("./Metrics");a=e("./KeyValueStore");c=e("./Path");d=e("./Index");b=e("./Crc");e=h.modules.Core;f.prototype.debug=h.common.debug;f.prototype.crc=b;h.synthesize(f.prototype,"name");f.prototype.on=h.common.on;f.prototype.off=h.common.off;
f.prototype.emit=h.common.emit;f.prototype.drop=function(){if(this._db&&this._db._collection&&this._name){this.debug()&&console.log("Dropping collection "+this._name);this.emit("drop");delete this._db._collection[this._name];var g=[],b;for(b=0;b<this._groups.length;b++)g.push(this._groups[b]);for(b=0;b<g.length;b++)this._groups[b].removeCollection(this);return!0}return!1};f.prototype.primaryKey=function(g){return void 0!==g?(this._primaryKey!==g&&(this._primaryKey=g,this._primaryIndex.primaryKey(g),
this._rebuildPrimaryKeyIndex()),this):this._primaryKey};f.prototype._onInsert=function(g,b){this.emit("insert",g,b)};f.prototype._onUpdate=function(g){this.emit("update",g)};f.prototype._onRemove=function(g){this.emit("remove",g)};h.synthesize(f.prototype,"db");f.prototype.setData=function(g,b,c){if(g){var a=this._metrics.create("setData");a.start();b=b||{};b.$decouple=void 0!==b.$decouple?b.$decouple:!0;b.$decouple&&(g=this.decouple(g));g instanceof Array||(g=[g]);a.time("transformIn");g=this.transformIn(g);
a.time("transformIn");var d=this._data;this._linked?this.remove():this._data=[];g.length&&(this._linked?this.insert(g):this._data=this._data.concat(g));a.time("Rebuild Primary Key Index");this._rebuildPrimaryKeyIndex(b);a.time("Rebuild Primary Key Index");a.time("Resolve chains");this.chainSend("setData",g,{oldData:d});a.time("Resolve chains");a.stop();this.emit("setData",this._data,d)}c&&c(!1);return this};f.prototype._rebuildPrimaryKeyIndex=function(g){var b=g&&void 0!==g.ensureKeys?g.ensureKeys:
!0;g=g&&void 0!==g.violationCheck?g.violationCheck:!0;var a,c,d,f=this._primaryIndex,e=this._primaryCrc,k=this._crcLookup,h=this._primaryKey,p;f.truncate();e.truncate();k.truncate();a=this._data;for(c=a.length;c--;)if(d=a[c],b&&this._ensurePrimaryKey(d),g){if(!f.uniqueSet(d[h],d))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+d[this._primaryKey];}else p=JSON.stringify(d),f.set(d[h],d),e.set(d[h],p),
k.set(p,d)};f.prototype._ensurePrimaryKey=function(g){void 0===g[this._primaryKey]&&(g[this._primaryKey]=this.objectId())};f.prototype.truncate=function(){this.emit("truncate",this._data);this._data.length=0;this.deferEmit("change");return this};f.prototype.upsert=function(g,b){if(g){var a=this._deferQueue.upsert,c=this._deferThreshold.upsert,d={},f;if(g instanceof Array){if(g.length>c){this._deferQueue.upsert=a.concat(g);this.processQueue("upsert",b);return}d=[];for(a=0;a<g.length;a++)d.push(this.upsert(g[a]));
b&&b();return d}g[this._primaryKey]?(f={},f[this._primaryKey]=g[this._primaryKey],this.count(f)?d.op="update":d.op="insert"):d.op="insert";switch(d.op){case "insert":d.result=this.insert(g);break;case "update":d.result=this.update(f,g)}return d}b&&b()};f.prototype.update=function(g,b,a){b=this.decouple(b);b=this.transformIn(b);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var d=this,c=this._metrics.create("update"),f=this._primaryKey,e,k,h=function(c){if(b&&
void 0!==b[f]&&b[f]!=c[f]){d._primaryIndex.unSet(c[f]);var e=d._updateObject(c,b,g,a,"");if(d._primaryIndex.uniqueSet(c[f],c))return e;throw"Primary key violation in update! Key violated: "+c[f];}return d._updateObject(c,b,g,a,"")};c.start();c.time("Retrieve documents to update");e=this.find(g,{$decouple:!1});c.time("Retrieve documents to update");e.length&&(c.time("Update documents"),k=e.filter(h),c.time("Update documents"),k.length&&(c.time("Resolve chains"),this.chainSend("update",{query:g,update:b},
a),c.time("Resolve chains"),this._onUpdate(k),this.deferEmit("change",{type:"update",data:k})));c.stop();return k||[]};f.prototype.updateById=function(g,b){var c={};c[this._primaryKey]=g;return this.update(c,b)};f.prototype._updateObject=function(g,b,a,d,f,e){b=this.decouple(b);f=f||"";"."===f.substr(0,1)&&(f=f.substr(1,f.length-1));var k=!1,h=!1,q,p,n,l;for(l in b)if(b.hasOwnProperty(l)){q=!1;if("$"===l.substr(0,1))switch(l){case "$index":break;default:q=!0,(h=this._updateObject(g,b[l],a,d,f,l))&&
(k=!0)}if(this._isPositionalKey(l)&&(q=!0,l=l.substr(0,l.length-2),h=new c(f+"."+l),g[l]&&g[l]instanceof Array&&g[l].length)){p=[];for(n=0;n<g[l].length;n++)this._match(g[l][n],h.value(a)[0])&&p.push(n);for(n=0;n<p.length;n++)(h=this._updateObject(g[l][p[n]],b[l+".$"],a,d,f+"."+l,e))&&(k=!0)}if(!q)if(e||"object"!==typeof b[l])switch(e){case "$inc":this._updateIncrement(g,l,b[l]);k=!0;break;case "$push":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array){if(void 0!==b[l].$position&&b[l].$each instanceof
Array)for(h=b[l].$position,q=b[l].$each.length,n=0;n<q;n++)this._updateSplicePush(g[l],h+n,b[l].$each[n]);else if(b[l].$each instanceof Array)for(q=b[l].$each.length,n=0;n<q;n++)this._updatePush(g[l],b[l].$each[n]);else this._updatePush(g[l],b[l]);k=!0}else throw"Cannot push to a key that is not an array! ("+l+")";break;case "$pull":if(g[l]instanceof Array){p=[];for(n=0;n<g[l].length;n++)this._match(g[l][n],b[l])&&p.push(n);for(q=p.length;q--;)this._updatePull(g[l],p[q]),k=!0}break;case "$pullAll":if(g[l]instanceof
Array)if(b[l]instanceof Array){if(p=g[l],q=p.length,0<q)for(;q--;){for(h=0;h<b[l].length;h++)p[q]===b[l][h]&&(this._updatePull(g[l],q),q--,k=!0);if(0>q)break}}else throw"Cannot pullAll without being given an array of values to pull! ("+l+")";break;case "$addToSet":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array){n=g[l];var m;p=n.length;var z;q=!0;m=d&&d.$addToSet;var da;m&&m.key?(h=!1,da=new c(m.key),z=da.value(b[l])[0]):(z=JSON.stringify(b[l]),h=!0);for(m=0;m<p;m++)if(h){if(JSON.stringify(n[m])===
z){q=!1;break}}else if(z===da.value(n[m])[0]){q=!1;break}q&&(this._updatePush(g[l],b[l]),k=!0)}else throw"Cannot addToSet on a key that is not an array! (undefined)!";break;case "$splicePush":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array)if(h=b.$index,void 0!==h)delete b.$index,this._updateSplicePush(g[l],h,b[l]),k=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+l+")";break;case "$move":if(g[l]instanceof Array)for(n=
0;n<g[l].length;n++){if(this._match(g[l][n],b[l])){k=b[l].$index;if(void 0!==k)this._updateSpliceMove(g[l],n,k),k=!0;else throw"Cannot move without a $index integer value!";break}}else throw"Cannot move on a key that is not an array! ("+l+")";break;case "$mul":this._updateMultiply(g,l,b[l]);k=!0;break;case "$rename":this._updateRename(g,l,b[l]);k=!0;break;case "$unset":this._updateUnset(g,l);k=!0;break;case "$pop":if(g[l]instanceof Array)this._updatePop(g[l],b[l])&&(k=!0);else throw"Cannot pop from a key that is not an array! ("+
l+")";break;default:g[l]!==b[l]&&(this._updateProperty(g,l,b[l]),k=!0)}else if(null!==g[l]&&"object"===typeof g[l])if(n=g[l]instanceof Array,p=b[l]instanceof Array,n||p)if(!p&&n)for(n=0;n<g[l].length;n++)(h=this._updateObject(g[l][n],b[l],a,d,f+"."+l,e))&&(k=!0);else g[l]!==b[l]&&(this._updateProperty(g,l,b[l]),k=!0);else(h=this._updateObject(g[l],b[l],a,d,f+"."+l,e))&&(k=!0);else g[l]!==b[l]&&(this._updateProperty(g,l,b[l]),k=!0)}return k};f.prototype._isPositionalKey=function(g){return".$"===g.substr(g.length-
2,2)};f.prototype._updateProperty=function(g,b,c){this._linked?(jQuery.observable(g).setProperty(b,c),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+b+'" for collection "'+this.name()+'"')):(g[b]=c,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+b+'" for collection "'+this.name()+'"'))};f.prototype._updateIncrement=function(g,b,c){this._linked?jQuery.observable(g).setProperty(b,g[b]+c):g[b]+=c};f.prototype._updateSpliceMove=
function(g,b,c){this._linked?(jQuery.observable(g).move(b,c),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+b+'" to "'+c+'" for collection "'+this.name()+'"')):(g.splice(c,0,g.splice(b,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+b+'" to "'+c+'" for collection "'+this.name()+'"'))};f.prototype._updateSplicePush=function(g,b,c){g.length>b?this._linked?jQuery.observable(g).insert(b,c):
g.splice(b,0,c):this._linked?jQuery.observable(g).insert(c):g.push(c)};f.prototype._updatePush=function(g,b){this._linked?jQuery.observable(g).insert(b):g.push(b)};f.prototype._updatePull=function(g,b){this._linked?jQuery.observable(g).remove(b):g.splice(b,1)};f.prototype._updateMultiply=function(g,b,c){this._linked?jQuery.observable(g).setProperty(b,g[b]*c):g[b]*=c};f.prototype._updateRename=function(g,b,c){var a=g[b];this._linked?(jQuery.observable(g).setProperty(c,a),jQuery.observable(g).removeProperty(b)):
(g[c]=a,delete g[b])};f.prototype._updateUnset=function(g,b){this._linked?jQuery.observable(g).removeProperty(b):delete g[b]};f.prototype._updatePop=function(g,b){var c,a=!1;0<g.length&&(this._linked?(1===b?c=g.length-1:-1===b&&(c=0),-1<c&&(jQuery.observable(arr).remove(c),a=!0)):1===b?(g.pop(),a=!0):-1===b&&(g.shift(),a=!0));return a};f.prototype.remove=function(g,b,c){var a,d;if(g instanceof Array){d=[];for(c=0;c<g.length;c++)d.push(this.remove(g[c],{noEmit:!0}));(!b||b&&!b.noEmit)&&this._onRemove(d);
return d}c=this.find(g,{$decouple:!1});if(c.length){for(d=0;d<c.length;d++)a=c[d],this._removeIndex(a),a=this._data.indexOf(a),this._linked?jQuery.observable(this._data).remove(a):this._data.splice(a,1);this.chainSend("remove",{query:g},b);(!b||b&&!b.noEmit)&&this._onRemove(c);this.deferEmit("change",{type:"remove",data:c})}return c};f.prototype.removeById=function(g){var b={};b[this._primaryKey]=g;return this.remove(b)};f.prototype.deferEmit=function(){var g=this,b;this._noEmitDefer||this._db&&(!this._db||
this._db._noEmitDefer)?this.emit.apply(this,arguments):(b=arguments,this._changeTimeout&&clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){g.debug()&&console.log("ForerunnerDB.Collection: Emitting "+b[0]);g.emit.apply(g,b)},100))};f.prototype.processQueue=function(g,b){var c=this._deferQueue[g],a=this._deferThreshold[g],d=this._deferTime[g];if(c.length){var f=this;c.length&&(c=c.length>a?c.splice(0,a):c.splice(0,c.length),this[g](c));setTimeout(function(){f.processQueue(g,
b)},d)}else b&&b()};f.prototype.insert=function(g,b,c){"function"===typeof b?(c=b,b=this._data.length):void 0===b&&(b=this._data.length);g=this.transformIn(g);return this._insertHandle(g,b,c)};f.prototype._insertHandle=function(g,b,c){var a=this._deferQueue.insert,d=this._deferThreshold.insert,f=[],k=[];if(g instanceof Array){if(g.length>d){this._deferQueue.insert=a.concat(g);this.processQueue("insert",c);return}for(d=0;d<g.length;d++)a=this._insert(g[d],b+d),!0===a?f.push(g[d]):k.push({doc:g[d],
reason:a})}else a=this._insert(g,b),!0===a?f.push(g):k.push({doc:g,reason:a});this.chainSend("insert",g,{index:b});this._onInsert(f,k);c&&c();this.deferEmit("change",{type:"insert",data:f});return{inserted:f,failed:k}};f.prototype._insert=function(g,b){if(g){var c;this._ensurePrimaryKey(g);if(c=this.insertIndexViolation(g))return"Index violation in index: "+c;this._insertIndex(g);this._linked?jQuery.observable(this._data).insert(b,g):this._data.splice(b,0,g);return!0}return"No document passed to insert"};
f.prototype._insertIndex=function(g){var b=this._indexByName,c,a=JSON.stringify(g);this._primaryIndex.uniqueSet(g[this._primaryKey],g);this._primaryCrc.uniqueSet(g[this._primaryKey],a);this._crcLookup.uniqueSet(a,g);for(c in b)b.hasOwnProperty(c)&&b[c].insert(g)};f.prototype._removeIndex=function(g){var b=this._indexByName,c,a=JSON.stringify(g);this._primaryIndex.unSet(g[this._primaryKey]);this._primaryCrc.unSet(g[this._primaryKey]);this._crcLookup.unSet(a);for(c in b)b.hasOwnProperty(c)&&b[c].remove(g)};
f.prototype.subset=function(g,b){var c=this.find(g,b);return(new f)._subsetOf(this).primaryKey(this._primaryKey).setData(c)};f.prototype.subsetOf=function(){return this.__subsetOf};f.prototype._subsetOf=function(g){this.__subsetOf=g;return this};f.prototype.distinct=function(g,b,a){b=this.find(b,a);g=new c(g);a={};var d=[],f,k;for(k=0;k<b.length;k++)(f=g.value(b[k])[0])&&!a[f]&&(a[f]=!0,d.push(f));return d};f.prototype.decouple=h.common.decouple;f.prototype.findById=function(g,b){var c={};c[this._primaryKey]=
g;return this.find(c,b)[0]};f.prototype.peek=function(g,b){var c=this._data,a=c.length,d,k,e=new f;if("string"===typeof g){for(d=0;d<a;d++)k=JSON.stringify(c[d]),-1<k.indexOf(g)&&e.insert(c[d]);return e.find({},b)}return this.find(g,b)};f.prototype.explain=function(g,b){return this.find(g,b).__fdbOp._data};f.prototype.find=function(g,b){g=g||{};b=b||{};b.$decouple=void 0!==b.$decouple?b.$decouple:!0;var a=this._metrics.create("find"),d=this,f,k=!0,e,h,q,p,n,l,m,z,da,oa=[];h=function(b){return d._match(b,
g,"and")};a.start();if(g){a.time("analyseQuery");f=this._analyseQuery(g,b,a);a.time("analyseQuery");a.data("analysis",f);if(f.hasJoin&&f.queriesJoin){a.time("joinReferences");for(q=0;q<f.joinsOn.length;q++)n=f.joinsOn[q],p=new c(f.joinQueries[n]),p=p.value(g)[0],this._db.collection(f.joinsOn[q]).subset(p);a.time("joinReferences")}f.indexMatch.length&&(!b||b&&!b.$skipIndex)?(a.data("index.potential",f.indexMatch),a.data("index.used",f.indexMatch[0].index),a.time("indexLookup"),e=f.indexMatch[0].lookup,
a.time("indexLookup"),f.indexMatch[0].keyData.totalKeyCount===f.indexMatch[0].keyData.matchedKeyCount&&(k=!1)):a.flag("usedIndex",!1);k&&(e&&e.length?(f=e.length,a.time("tableScan: "+f),e=e.filter(h)):(f=this._data.length,a.time("tableScan: "+f),e=this._data.filter(h)),b.$orderBy&&(a.time("sort"),e=this.sort(b.$orderBy,e),a.time("sort")),a.time("tableScan: "+f));b.limit&&e&&e.length>b.limit&&(e.length=b.limit,a.data("limit",b.limit));b.$decouple&&(a.time("decouple"),e=this.decouple(e),a.time("decouple"),
a.data("flag.decouple",!0));if(b.join){for(h=0;h<b.join.length;h++)for(n in b.join[h])if(b.join[h].hasOwnProperty(n))for(z=n,f=this._db.collection(n),k=b.join[h][n],da=0;da<e.length;da++){m={};p=q=!1;for(l in k)if(k.hasOwnProperty(l))if("$"===l.substr(0,1))switch(l){case "$as":z=k[l];break;case "$multi":q=k[l];break;case "$require":p=k[l];break;default:l.substr(0,3)}else m[l]=(new c(k[l])).value(e[da])[0];m=f.find(m);!p||p&&m[0]?e[da][z]=!1===q?m[0]:m:oa.push(e[da])}a.data("flag.join",!0)}if(oa.length){a.time("removalQueue");
for(l=0;l<oa.length;l++)n=e.indexOf(oa[l]),-1<n&&e.splice(n,1);a.time("removalQueue")}if(b.transform){a.time("transform");for(l=0;l<e.length;l++)e.splice(l,1,b.transform(e[l]));a.time("transform");a.data("flag.transform",!0)}this._transformEnabled&&this._transformOut&&(a.time("transformOut"),e=this.transformOut(e),a.time("transformOut"));a.data("results",e.length);a.stop()}else a.stop(),e=[];e.__fdbOp=a;return e};f.prototype.indexOf=function(b){if(b=this.find(b,{$decouple:!1})[0])return this._data.indexOf(b)};
f.prototype.transform=function(b){return void 0!==b?("object"===typeof b?(void 0!==b.enabled&&(this._transformEnabled=b.enabled),void 0!==b.dataIn&&(this._transformIn=b.dataIn),void 0!==b.dataOut&&(this._transformOut=b.dataOut)):this._transformEnabled=!1===b?!1:!0,this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};f.prototype.transformIn=function(b){if(this._transformEnabled&&this._transformIn){if(b instanceof Array){var c=[],a;for(a=0;a<b.length;a++)c[a]=
this._transformIn(b[a]);return c}return this._transformIn(b)}return b};f.prototype.transformOut=function(b){if(this._transformEnabled&&this._transformOut){if(b instanceof Array){var c=[],a;for(a=0;a<b.length;a++)c[a]=this._transformOut(b[a]);return c}return this._transformOut(b)}return b};f.prototype.sort=function(b,c){c=c||[];var a=[],d,f;for(d in b)b.hasOwnProperty(d)&&(f={},f[d]=b[d],f.___fdbKey=d,a.push(f));return 2>a.length?this._sort(b,c):this._bucketSort(a,c)};f.prototype._bucketSort=function(b,
c){var a=b.shift(),d,f,k=[];if(0<b.length){c=this._sort(a,c);d=this.bucket(a.___fdbKey,c);for(f in d)d.hasOwnProperty(f)&&(a=[].concat(b),k=k.concat(this._bucketSort(a,d[f])));return k}return this._sort(a,c)};f.prototype._sort=function(b,a){var d=new c,f=d.parse(b,!0)[0];d.path(f.path);return a.sort(1===f.value?function(b,g){var a=d.value(b)[0],c=d.value(g)[0];return"string"===typeof a&&"string"===typeof c?a.localeCompare(c):a>c?1:a<c?-1:0}:function(b,g){var a=d.value(b)[0],c=d.value(g)[0];return"string"===
typeof a&&"string"===typeof c?1===a.localeCompare(c)?-1:1:a>c?-1:a<c?1:0})};f.prototype.bucket=function(b,a){var c,d={};for(c=0;c<a.length;c++)d[a[c][b]]=d[a[c][b]]||[],d[a[c][b]].push(a[c]);return d};f.prototype._analyseQuery=function(b,a,d){var f={queriesOn:[this._name],indexMatch:[],hasJoin:!1,queriesJoin:!1,joinQueries:{},query:b,options:a},k,e=[],h=[],m,q,p,n,l;d.time("checkIndexes");void 0!==b[this._primaryKey]&&(d.time("checkIndexMatch: Primary Key"),m=new c,f.indexMatch.push({lookup:this._primaryIndex.lookup(b,
a),keyData:{matchedKeys:[this._primaryKey],matchedKeyCount:1,totalKeyCount:m.countKeys(b)},index:this._primaryIndex}),d.time("checkIndexMatch: Primary Key"));for(l in this._indexById)if(this._indexById.hasOwnProperty(l)&&(q=this._indexById[l],p=q.name(),d.time("checkIndexMatch: "+p),m=q.match(b,a),n=q.lookup(b,a),0<m.matchedKeyCount&&f.indexMatch.push({lookup:n,keyData:m,index:q}),d.time("checkIndexMatch: "+p),m.totalKeyCount===m.matchedKeyCount))break;d.time("checkIndexes");1<f.indexMatch.length&&
(d.time("findOptimalIndex"),f.indexMatch.sort(function(b,g){return b.keyData.totalKeyCount===b.keyData.matchedKeyCount?-1:g.keyData.totalKeyCount===g.keyData.matchedKeyCount?1:b.keyData.matchedKeyCount===g.keyData.matchedKeyCount?b.lookup.length-g.lookup.length:g.keyData.matchedKeyCount-b.keyData.matchedKeyCount}),d.time("findOptimalIndex"));if(a.join){f.hasJoin=!0;for(d=0;d<a.join.length;d++)for(k in a.join[d])a.join[d].hasOwnProperty(k)&&(e.push(k),"$as"in a.join[d][k]?h.push(a.join[d][k].$as):
h.push(k));for(k=0;k<h.length;k++)if(a=this._queryReferencesCollection(b,h[k],""))f.joinQueries[e[k]]=a,f.queriesJoin=!0;f.joinsOn=e;f.queriesOn=f.queriesOn.concat(e)}return f};f.prototype._queryReferencesCollection=function(b,a,c){for(var d in b)if(b.hasOwnProperty(d)){if(d===a)return c&&(c+="."),c+d;if("object"===typeof b[d])return c&&(c+="."),c+=d,this._queryReferencesCollection(b[d],a,c)}return!1};f.prototype._match=function(b,a,c){var d,f;d=typeof b;f=typeof a;var k=!0,e;if(!("string"!==d&&"number"!==
d||"string"!==f&&"number"!==f))b!==a&&(k=!1);else for(e in a)if(a.hasOwnProperty(e)){d=!1;if("$"===e.substr(0,1))switch(e){case "$gt":if(b>a[e]){if("or"===c)return!0}else k=!1;d=!0;break;case "$gte":if(b>=a[e]){if("or"===c)return!0}else k=!1;d=!0;break;case "$lt":if(b<a[e]){if("or"===c)return!0}else k=!1;d=!0;break;case "$lte":if(b<=a[e]){if("or"===c)return!0}else k=!1;d=!0;break;case "$exists":if(void 0===b!==a[e]){if("or"===c)return!0}else k=!1;d=!0;break;case "$or":d=!0;for(f=0;f<a[e].length;f++){if(this._match(b,
a[e][f],"and"))return!0;k=!1}break;case "$and":d=!0;for(f=0;f<a[e].length;f++)if(!this._match(b,a[e][f],"and"))return!1;break;case "$in":if(a[e]instanceof Array){d=a[e];f=d.length;var h,m=!1;for(h=0;h<f;h++)if(d[h]===b){m=!0;break}if(m){if("or"===c)return!0}else k=!1}else throw"Cannot use a $nin operator on a non-array key: "+e;d=!0;break;case "$nin":if(a[e]instanceof Array){d=a[e];f=d.length;m=!0;for(h=0;h<f;h++)if(d[h]===b){m=!1;break}if(m){if("or"===c)return!0}else k=!1}else throw"Cannot use a $nin operator on a non-array key: "+
e;d=!0;break;case "$ne":if(b!=a[e]){if("or"===c)return!0}else k=!1;d=!0}if(!d&&a[e]instanceof RegExp)if(d=!0,"object"===typeof b&&void 0!==b[e]&&a[e].test(b[e])){if("or"===c)return!0}else k=!1;if(!d)if("object"===typeof a[e])if(void 0!==b[e]){if(b[e]instanceof Array&&!(a[e]instanceof Array))for(d=!1,f=0;f<b[e].length&&!(d=this._match(b[e][f],a[e],void 0));f++);else if(!(b[e]instanceof Array)&&a[e]instanceof Array)for(d=!1,f=0;f<a[e].length&&!(d=this._match(b[e],a[e][f],void 0));f++);else d="object"===
typeof b?this._match(b[e],a[e],void 0):this._match(void 0,a[e],void 0);if(d){if("or"===c)return!0}else k=!1}else if(a[e]&&void 0!==a[e].$exists)if(d=this._match(void 0,a[e],void 0)){if("or"===c)return!0}else k=!1;else k=!1;else if(b&&b[e]===a[e]){if("or"===c)return!0}else if(b&&b[e]&&b[e]instanceof Array&&a[e]&&"object"!==typeof a[e]){d=!1;for(f=0;f<b[e].length&&!(d=this._match(b[e][f],a[e],void 0));f++);if(d){if("or"===c)return!0}else k=!1}else k=!1;if("and"===c&&!k)return!1}return k};f.prototype.count=
function(b,a){return b?this.find(b,a).length:this._data.length};f.prototype.link=function(b,a){if(window.jQuery){this._links=this._links||{};var c,d;a&&"object"===typeof a?a.template&&"string"===typeof a.template&&(c=this.objectId(a.template),d=a.template):c=a;if(!this._links[c]){if(jQuery(b).length){if(!jQuery.templates[c]){if(!d)if(d=jQuery(a),d.length)d=jQuery(d[0]).html();else throw"Unable to bind collection to target because template does not exist: "+a;jQuery.views.templates(c,d)}jQuery.templates[c].link(b,
this._data);this._links[c]=b;this._linked++;this.debug()&&console.log('ForerunnerDB.Collection: Added binding collection "'+this.name()+'" to output target: '+b);return this}throw'Cannot bind view data to output target selector "'+b+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+b+" with the template: "+c;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};f.prototype.unlink=function(b,a){if(window.jQuery){this._links=this._links||
{};var c;a&&"object"===typeof a?a.template&&"string"===typeof a.template&&(c=this.objectId(a.template)):c=a;if(this._links[c])return jQuery.templates[c].unlink(b),delete this._links[c],this._linked--,this.debug()&&console.log('ForerunnerDB.Collection: Removed binding collection "'+this.name()+'" to output target: '+b),this;console.log("Cannot remove link, one does not exist to the target: "+b+" with the template: "+a)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";};
f.prototype.findSub=function(b,a,d,f){var e=new c(a);b=this.find(b);var k=b.length,h,m,q=this._db.collection("__FDB_temp_"+this.objectId()),p={parents:k,subDocTotal:0,subDocs:[],pathFound:!1,err:""};for(h=0;h<k;h++)if(m=e.value(b[h])[0]){q.setData(m);m=q.find(d,f);if(f.returnFirst&&m.length)return m[0];p.subDocs.push(m);p.subDocTotal+=m.length;p.pathFound=!0}q.drop();if(f.noStats)return p.subDocs;p.pathFound||(p.err="No objects found in the parent documents with a matching path of: "+a);return p};
f.prototype.insertIndexViolation=function(b){var a,c=this._indexByName,d,f;if(this._primaryIndex.get(b[this._primaryKey]))a=this._primaryIndex;else for(d in c)if(c.hasOwnProperty(d)&&(f=c[d],f.unique()&&f.violation(b))){a=f;break}return a?a.name():!1};f.prototype.ensureIndex=function(b,a){this._indexByName=this._indexByName||{};this._indexById=this._indexById||{};var c=new d(b,a,this),f={start:(new Date).getTime()};if(this._indexByName[c.name()])return{err:"Index with that name already exists"};if(this._indexById[c.id()])return{err:"Index with those keys already exists"};
c.rebuild();this._indexByName[c.name()]=c;this._indexById[c.id()]=c;f.end=(new Date).getTime();f.total=f.end-f.start;this._lastOp={type:"ensureIndex",stats:{time:f}};return{index:c,id:c.id(),name:c.name(),state:c.state()}};f.prototype.index=function(b){if(this._indexByName)return this._indexByName[b]};f.prototype.lastOp=function(){return this._metrics.list()};f.prototype.objectId=h.common.objectId;f.prototype.diff=function(b){var a={insert:[],update:[],remove:[]},c=this.primaryKey(),d,f,e,k;if(c===
b.primaryKey()){d=b._data;k=d.length;for(f=0;f<k;f++)e=d[f],this._primaryIndex.get(e[c])?this._primaryCrc.get(e[c])!==b._primaryCrc.get(e[c])&&a.update.push(e):a.insert.push(e);d=this._data;k=d.length;for(f=0;f<k;f++)e=d[f],b._primaryIndex.get(e[c])||a.remove.push(e)}return a};e.prototype.collection=function(b,a){if(b)return this._collection[b]||this.debug()&&console.log("Creating collection "+b),this._collection[b]=this._collection[b]||(new f(b)).db(this),void 0!==a&&this._collection[b].primaryKey(a),
this._collection[b];throw"Cannot get collection with undefined name!";};e.prototype.collectionExists=function(b){return Boolean(this._collection[b])};e.prototype.collections=function(){var b=[],a;for(a in this._collection)this._collection.hasOwnProperty(a)&&b.push({name:a,count:this._collection[a].count()});return b};m.exports=f},{"./Crc":5,"./Index":8,"./KeyValueStore":9,"./Metrics":10,"./Path":15,"./Shared":17}],3:[function(e,m,h){var k,a;h=e("./Shared");var c=function(){this.init.apply(this,arguments)};
c.prototype.init=function(c){this._name=c;this._data=new a("__FDB__cg_data_"+this._name);this._collections=[];this._views=[]};h.addModule("CollectionGroup",c);h.inherit(c.prototype,h.chainSystem);a=e("./Collection");e=h.modules.Core;k=h.modules.Core.prototype.init;c.prototype.debug=h.common.debug;c.prototype.on=function(){this._data.on.apply(this._data,arguments)};c.prototype.off=function(){this._data.off.apply(this._data,arguments)};c.prototype.emit=function(){this._data.emit.apply(this._data,arguments)};
c.prototype.primaryKey=function(a){return void 0!==a?(this._primaryKey=a,this):this._primaryKey};h.synthesize(c.prototype,"db");c.prototype.addCollection=function(a){if(a&&-1===this._collections.indexOf(a)){if(this._collections.length){if(this._primaryKey!==a.primaryKey())throw"All collections in a collection group must have the same primary key!";}else this.primaryKey(a.primaryKey());this._collections.push(a);a._groups.push(this);a.chain(this);this._data.insert(a.find())}return this};c.prototype.removeCollection=
function(a){if(a){var b=this._collections.indexOf(a);-1!==b&&(a.unChain(this),this._collections.splice(b,1),b=a._groups.indexOf(this),-1!==b&&a._groups.splice(b,1));0===this._collections.length&&delete this._primaryKey}return this};c.prototype.decouple=h.common.decouple;c.prototype._chainHandler=function(a,b,c,g){switch(b){case "setData":c=this.decouple(c);this._data.remove(g.oldData);this._data.insert(c);break;case "insert":c=this.decouple(c);this._data.insert(c);break;case "update":this._data.update(c.query,
c.update,g);break;case "remove":this._data.remove(c.query,g)}};c.prototype.insert=function(){this._collectionsRun("insert",arguments)};c.prototype.update=function(){this._collectionsRun("update",arguments)};c.prototype.updateById=function(){this._collectionsRun("updateById",arguments)};c.prototype.remove=function(){this._collectionsRun("remove",arguments)};c.prototype._collectionsRun=function(a,b){for(var c=0;c<this._collections.length;c++)this._collections[c][a].apply(this._collections[c],b)};c.prototype.find=
function(a,b){return this._data.find(a,b)};c.prototype.removeById=function(a){for(var b=0;b<this._collections.length;b++)this._collections[b].removeById(a)};c.prototype.subset=function(c,b){var f=this.find(c,b);return(new a)._subsetOf(this).primaryKey(this._primaryKey).setData(f)};c.prototype.drop=function(){var a,b=[].concat(this._collections),c=[].concat(this._views);this._debug&&console.log("Dropping collection group "+this._name);for(a=0;a<b.length;a++)this.removeCollection(b[a]);for(a=0;a<c.length;a++)this._removeView(c[a]);
this.emit("drop");return!0};e.prototype.init=function(){this._collectionGroup={};k.apply(this,arguments)};e.prototype.collectionGroup=function(a){return a?(this._collectionGroup[a]=this._collectionGroup[a]||(new c(a)).db(this),this._collectionGroup[a]):this._collectionGroup};m.exports=c},{"./Collection":2,"./Shared":17}],4:[function(e,m,h){var k;h=e("./Shared.js");var a=function(){this.init.apply(this,arguments)};a.prototype.init=function(){this._collection={};this._debug={};this._version="1.2.7"};
a.shared=h;a.prototype.shared=h;h.addModule("Core",a);h.inherit(a.prototype,h.chainSystem);k=e("./Collection.js");e("./Metrics.js");e=e("./Crc.js");a.prototype._isServer=!1;a.prototype.isClient=function(){return!this._isServer};a.prototype.isServer=function(){return this._isServer};a.prototype.crc=e;a.prototype.isClient=function(){return!this._isServer};a.prototype.isServer=function(){return this._isServer};a.prototype.decouple=h.common.decouple;a.prototype.debug=h.common.debug;a.prototype.arrayToCollection=
function(a){return(new k).setData(a)};a.prototype.on=function(a,d){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||[];this._listeners[a].push(d);return this};a.prototype.off=function(a,d){if(a in this._listeners){var b=this._listeners[a],f=b.indexOf(d);-1<f&&b.splice(f,1)}return this};a.prototype.emit=function(a,d){this._listeners=this._listeners||{};if(a in this._listeners){var b=this._listeners[a],f=b.length,g;for(g=0;g<f;g++)b[g].apply(this,Array.prototype.slice.call(arguments,
1))}return this};a.prototype.objectId=h.common.objectId;a.prototype.peek=function(a){var d,b,f=[],g=typeof a;for(d in this._collection)this._collection.hasOwnProperty(d)&&(b=this._collection[d],f="string"===g?f.concat(b.peek(a)):f.concat(b.find(a)));return f};a.prototype.peekCat=function(a){var d,b,f={},g,e=typeof a;for(d in this._collection)this._collection.hasOwnProperty(d)&&(b=this._collection[d],(g="string"===e?b.peek(a):b.find(a))&&g.length&&(f[b.name()]=g));return f};m.exports=a},{"./Collection.js":2,
"./Crc.js":5,"./Metrics.js":10,"./Shared.js":17}],5:[function(e,m,h){var k=function(){var a=[],c,d,b;for(d=0;256>d;d++){c=d;for(b=0;8>b;b++)c=c&1?3988292384^c>>>1:c>>>1;a[d]=c}return a}();m.exports=function(a){var c=-1,d;for(d=0;d<a.length;d++)c=c>>>8^k[(c^a.charCodeAt(d))&255];return(c^-1)>>>0}},{}],6:[function(e,m,h){var k,a;h=e("./Shared");var c=function(){this.init.apply(this,arguments)};c.prototype.init=function(a){this._name=a;this._data={}};h.addModule("Document",c);h.inherit(c.prototype,h.chainSystem);
e=e("./Collection");k=h.modules.Core;a=h.modules.Core.prototype.init;h.synthesize(c.prototype,"db");h.synthesize(c.prototype,"name");c.prototype.setData=function(a){var b,c;if(a)if(a=this.decouple(a),this._linked){c={};for(b in this._data)"jQuery"!==b.substr(0,6)&&this._data.hasOwnProperty(b)&&void 0===a[b]&&(c[b]=1);a.$unset=c;this._updateObject(this._data,a,{})}else this._data=a;return this};c.prototype.decouple=h.common.decouple;c.prototype.objectId=h.common.objectId;c.prototype.on=h.common.on;
c.prototype.off=h.common.off;c.prototype.emit=h.common.emit;c.prototype.debug=h.common.debug;c.prototype.update=function(a,b,c){this._updateObject(this._data,b,a,c)};c.prototype._updateObject=e.prototype._updateObject;c.prototype._isPositionalKey=function(a){return".$"===a.substr(a.length-2,2)};c.prototype._updateProperty=function(a,b,c){this._linked?(jQuery.observable(a).setProperty(b,c),this.debug()&&console.log('ForerunnerDB.Document: Setting data-bound document property "'+b+'" for collection "'+
this.name()+'"')):(a[b]=c,this.debug()&&console.log('ForerunnerDB.Document: Setting non-data-bound document property "'+b+'" for collection "'+this.name()+'"'))};c.prototype._updateIncrement=function(a,b,c){this._linked?jQuery.observable(a).setProperty(b,a[b]+c):a[b]+=c};c.prototype._updateSpliceMove=function(a,b,c){this._linked?(jQuery.observable(a).move(b,c),this.debug()&&console.log('ForerunnerDB.Document: Moving data-bound document array index from "'+b+'" to "'+c+'" for collection "'+this.name()+
'"')):(a.splice(c,0,a.splice(b,1)[0]),this.debug()&&console.log('ForerunnerDB.Document: Moving non-data-bound document array index from "'+b+'" to "'+c+'" for collection "'+this.name()+'"'))};c.prototype._updateSplicePush=function(a,b,c){a.length>b?this._linked?jQuery.observable(a).insert(b,c):a.splice(b,0,c):this._linked?jQuery.observable(a).insert(c):a.push(c)};c.prototype._updatePush=function(a,b){this._linked?jQuery.observable(a).insert(b):a.push(b)};c.prototype._updatePull=function(a,b){this._linked?
jQuery.observable(a).remove(b):a.splice(b,1)};c.prototype._updateMultiply=function(a,b,c){this._linked?jQuery.observable(a).setProperty(b,a[b]*c):a[b]*=c};c.prototype._updateRename=function(a,b,c){var g=a[b];this._linked?(jQuery.observable(a).setProperty(c,g),jQuery.observable(a).removeProperty(b)):(a[c]=g,delete a[b])};c.prototype._updateUnset=function(a,b){this._linked?jQuery.observable(a).removeProperty(b):delete a[b]};c.prototype._updatePop=function(a,b){var c,g=!1;0<a.length&&(this._linked?(1===
b?c=a.length-1:-1===b&&(c=0),-1<c&&(jQuery.observable(arr).remove(c),g=!0)):1===b?(a.pop(),g=!0):-1===b&&(a.shift(),g=!0));return g};c.prototype.link=function(a,b){if(window.jQuery){this._links=this._links||{};this._linked||(this._linked=0);var c,g;b&&"object"===typeof b?b.template&&"string"===typeof b.template&&(c=this.objectId(b.template),g=b.template):c=b;if(!this._links[c]){if(jQuery(a).length){if(!jQuery.templates[c]){if(!g)if(g=jQuery(b),g.length)g=jQuery(g[0]).html();else throw"Unable to bind document to target because template does not exist: "+
b;jQuery.views.templates(c,g)}jQuery.templates[c].link(a,this._data);this._links[c]=a;this._linked++;this.debug()&&console.log('ForerunnerDB.Document: Added binding document "'+this.name()+'" to output target: '+a);return this}throw'Cannot bind view data to output target selector "'+a+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+a+" with the template: "+c;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};c.prototype.unlink=
function(a,b){if(window.jQuery){this._links=this._links||{};var c;b&&"object"===typeof b?b.template&&"string"===typeof b.template&&(c=this.objectId(b.template)):c=b;if(this._links[c])return jQuery.templates[c].unlink(a),delete this._links[c],this._linked--,this.debug()&&console.log('ForerunnerDB.Document: Removed binding document "'+this.name()+'" to output target: '+a),this;console.log("Cannot remove link, one does not exist to the target: "+a+" with the template: "+b)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";
};c.prototype.drop=function(){this._db&&this._name&&this._db&&this._db._document&&this._db._document[this._name]&&(delete this._db._document[this._name],this._data={})};k.prototype.init=function(){a.apply(this,arguments)};k.prototype.document=function(a){return a?(this._document=this._document||{},this._document[a]=this._document[a]||(new c(a)).db(this),this._document[a]):this._document};m.exports=c},{"./Collection":2,"./Shared":17}],7:[function(e,m,h){var k;e=e("./Shared");var a=function(a,d){this.init.apply(this,
arguments)};a.prototype.init=function(a,d){this._options=d;this._selector=$(this._options.selector);this._listeners={};this._collection=a;this._options.series=[];var b,f;switch(this._options.type){case "pie":this._selector.highcharts(this._options.chartOptions);this._chart=this._selector.highcharts();b=this._collection.find();f={allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {y} ({point.percentage:.0f}%)",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||
"black"}}};b=this.pieDataFromCollectionData(b,this._options.keyField,this._options.valField);$.extend(f,this._options.seriesOptions);$.extend(f,{type:"pie",name:this._options.seriesName,data:b});this._chart.addSeries(f);break;case "line":b=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,this._options.orderBy),this._options.chartOptions.xAxis=b.xAxis,this._options.chartOptions.series=b.series,this._selector.highcharts(this._options.chartOptions),
this._chart=this._selector.highcharts()}this._hookEvents()};e=e.modules.Collection;k=e.prototype.init;a.prototype.pieDataFromCollectionData=function(a,d,b){var f=[],g;for(g=0;g<a.length;g++)f.push([a[g][d],a[g][b]]);return f};a.prototype.lineDataFromCollectionData=function(a,d,b,f){var g=this._collection.distinct(a),e=[],k={categories:[]},h,m,S,aa,ba;for(aa=0;aa<g.length;aa++){h=g[aa];m={};m[a]=h;S=[];m=this._collection.find(m,{orderBy:f});for(ba=0;ba<m.length;ba++)k.categories.push(m[ba][d]),S.push(m[ba][b]);
e.push({name:h,data:S})}return{xAxis:k,series:e}};a.prototype._hookEvents=function(){this._collection.on("change",this._changeListener);this._collection.on("drop",this._dropListener)};a.prototype._changeListener=function(){if("undefined"!==typeof this._collection&&this._chart){var a=this._collection.find();switch(this._options.type){case "pie":this._chart.series[0].setData(this.pieDataFromCollectionData(a,this._options.keyField,this._options.valField));break;case "line":a=this.lineDataFromCollectionData(this._options.seriesField,
this._options.keyField,this._options.valField,this._options.orderBy);this._chart.xAxis[0].setCategories(a.xAxis.categories);for(var d=0;d<a.series.length;d++)this._chart.series[d].setData(a.series[d].data)}}};a.prototype._dropListener=function(){this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener)};a.prototype.drop=function(){this._chart.destroy();this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener);delete this._collection._highcharts[this._options.selector];
delete this._chart;delete this._options;delete this._collection;return this};e.prototype.init=function(){this._highcharts={};k.apply(this,arguments)};e.prototype.chart=function(c){this._highcharts[c.selector]||(this._highcharts[c.selector]=new a(this,c));return this._highcharts[c.selector]};e.prototype.dropChart=function(a){this._highcharts[a]&&this._highcharts[a].drop()};m.exports=a},{"./Shared":17}],8:[function(e,m,h){h=e("./Shared");var k=e("./Path");e=function(){this.init.apply(this,arguments)};
e.prototype.init=function(a,c,d){this._crossRef={};this._size=0;this._id=this._itemKeyHash(a,a);this.data({});this.unique(c&&c.unique?c.unique:!1);void 0!==a&&this.keys(a);void 0!==d&&this.collection(d);this.name(c&&c.name?c.name:this._id)};h.addModule("Index",e);h.inherit(e.prototype,h.chainSystem);e.prototype.id=function(){return this._id};e.prototype.state=function(){return this._state};e.prototype.size=function(){return this._size};e.prototype.data=function(a){return void 0!==a?(this._data=a,
this):this._data};h.synthesize(e.prototype,"name");e.prototype.collection=function(a){return void 0!==a?(this._collection=a,this):this._collection};e.prototype.keys=function(a){return void 0!==a?(this._keys=a,this._keyCount=(new k).parse(this._keys).length,this):this._keys};e.prototype.type=function(a){return void 0!==a?(this._type=a,this):this._type};e.prototype.unique=function(a){return void 0!==a?(this._unique=a,this):this._unique};e.prototype.rebuild=function(){if(this._collection){var a=this._collection.subset({},
{$decouple:!1,$orderBy:this._keys}).find(),c,d=a.length;this._data={};this._unique&&(this._uniqueLookup={});for(c=0;c<d;c++)this.insert(a[c])}this._state={name:this._name,keys:this._keys,indexSize:this._size,built:new Date,updated:new Date,ok:!0}};e.prototype.insert=function(a,c){var d,b;this._unique&&(d=this._itemHash(a,this._keys),this._uniqueLookup[d]=a);d=this._itemHashArr(a,this._keys);for(b=0;b<d.length;b++)this.pushToPathValue(d[b],a)};e.prototype.remove=function(a,c){var d,b;this._unique&&
(d=this._itemHash(a,this._keys),delete this._uniqueLookup[d]);d=this._itemHashArr(a,this._keys);for(b=0;b<d.length;b++)this.pullFromPathValue(d[b],a)};e.prototype.violation=function(a){a=this._itemHash(a,this._keys);return Boolean(this._uniqueLookup[a])};e.prototype.hashViolation=function(a){return Boolean(this._uniqueLookup[a])};e.prototype.pushToPathValue=function(a,c){var d=this._data[a]=this._data[a]||[];-1===d.indexOf(c)&&(d.push(c),this._size++,this.pushToCrossRef(c,d))};e.prototype.pullFromPathValue=
function(a,c){var d=this._data[a],b;b=d.indexOf(c);-1<b&&(d.splice(b,1),this._size--,this.pullFromCrossRef(c,d));d.length||delete this._data[a]};e.prototype.pull=function(a){var c=a[this._collection.primaryKey()],d=this._crossRef[c],b,f=d.length,g;for(b=0;b<f;b++)g=d[b],this._pullFromArray(g,a);this._size--;delete this._crossRef[c]};e.prototype._pullFromArray=function(a,c){for(var d=a.length;d--;)a[d]===c&&a.splice(d,1)};e.prototype.pushToCrossRef=function(a,c){var d=a[this._collection.primaryKey()];
this._crossRef[d]=this._crossRef[d]||[];d=this._crossRef[d];-1===d.indexOf(c)&&d.push(c)};e.prototype.pullFromCrossRef=function(a,c){var d=a[this._collection.primaryKey()];delete this._crossRef[d]};e.prototype.lookup=function(a){return this._data[this._itemHash(a,this._keys)]||[]};e.prototype.match=function(a,c){return(new k).countObjectPaths(this._keys,a)};e.prototype._itemHash=function(a,c){var d=new k,b,f="",g;b=d.parse(c);for(g=0;g<b.length;g++)f&&(f+="_"),f+=d.value(a,b[g].path).join(":");return f};
e.prototype._itemKeyHash=function(a,c){var d=new k,b,f="",g;b=d.parse(c);for(g=0;g<b.length;g++)f&&(f+="_"),f+=d.keyValue(a,b[g].path);return f};e.prototype._itemHashArr=function(a,c){var d=new k,b,f=[],g,e,h,m;b=d.parse(c);for(h=0;h<b.length;h++)for(g=d.value(a,b[h].path),e=0;e<g.length;e++)if(0===h)f.push(g[e]);else for(m=0;m<f.length;m++)f[m]=f[m]+"_"+g[e];return f};m.exports=e},{"./Path":15,"./Shared":17}],9:[function(e,m,h){e=e("./Shared");h=function(e){this.init.apply(this,arguments)};h.prototype.init=
function(e){this._name=e;this._data={};this._primaryKey="_id"};e.addModule("KeyValueStore",h);e.inherit(h.prototype,e.chainSystem);e.synthesize(h.prototype,"name");h.prototype.primaryKey=function(e){return void 0!==e?(this._primaryKey=e,this):this._primaryKey};h.prototype.truncate=function(){this._data={};return this};h.prototype.set=function(e,a){this._data[e]=a?a:!0;return this};h.prototype.get=function(e){return this._data[e]};h.prototype.lookup=function(e){e=e[this._primaryKey];var a,c,d,b;if(e instanceof
Array){c=e.length;b=[];for(a=0;a<c;a++)(d=this._data[e[a]])&&b.push(d);return b}if(e instanceof RegExp){b=[];for(a in this._data)this._data.hasOwnProperty(a)&&e.test(a)&&b.push(this._data[a]);return b}if("object"===typeof e){if(e.$ne){b=[];for(a in this._data)this._data.hasOwnProperty(a)&&a!==e.$ne&&b.push(this._data[a]);return b}if(e.$in&&e.$in instanceof Array){b=[];for(a in this._data)this._data.hasOwnProperty(a)&&-1<e.$in.indexOf(a)&&b.push(this._data[a]);return b}if(e.$nin&&e.$nin instanceof
Array){b=[];for(a in this._data)this._data.hasOwnProperty(a)&&-1===e.$nin.indexOf(a)&&b.push(this._data[a]);return b}if(e.$or&&e.$or instanceof Array){b=[];for(a=0;a<e.$or.length;a++)b=b.concat(this.lookup(e.$or[a]));return b}}else return d=this._data[e],void 0!==d?[d]:[]};h.prototype.unSet=function(e){delete this._data[e];return this};h.prototype.uniqueSet=function(e,a){return void 0===this._data[e]?(this._data[e]=a,!0):!1};m.exports=h},{"./Shared":17}],10:[function(e,m,h){h=e("./Shared");var k=
e("./Operation");e=function(){this.init.apply(this,arguments)};e.prototype.init=function(){this._data=[]};h.addModule("Metrics",e);h.inherit(e.prototype,h.chainSystem);e.prototype.create=function(a){a=new k(a);this._enabled&&this._data.push(a);return a};e.prototype.start=function(){this._enabled=!0;return this};e.prototype.stop=function(){this._enabled=!1;return this};e.prototype.clear=function(){this._data=[];return this};e.prototype.list=function(){return this._data};m.exports=e},{"./Operation":13,
"./Shared":17}],11:[function(e,m,h){var k;e=e("./Shared").modules.OldView;k=e.prototype.init;e.prototype.init=function(){var a=this;this._binds=[];this._renderEnd=this._renderStart=0;this._deferQueue={insert:[],update:[],remove:[],upsert:[],_bindInsert:[],_bindUpdate:[],_bindRemove:[],_bindUpsert:[]};this._deferThreshold={insert:100,update:100,remove:100,upsert:100,_bindInsert:100,_bindUpdate:100,_bindRemove:100,_bindUpsert:100};this._deferTime={insert:100,update:1,remove:1,upsert:1,_bindInsert:100,
_bindUpdate:1,_bindRemove:1,_bindUpsert:1};k.apply(this,arguments);this.on("insert",function(c,d){a._bindEvent("insert",c,d)});this.on("update",function(c,d){a._bindEvent("update",c,d)});this.on("remove",function(c,d){a._bindEvent("remove",c,d)});this.on("change",a._bindChange)};e.prototype.bind=function(a,c){if(c&&c.template)this._binds[a]=c;else throw"Cannot bind data to element, missing options information!";return this};e.prototype.unBind=function(a){delete this._binds[a];return this};e.prototype.isBound=
function(a){return Boolean(this._binds[a])};e.prototype.bindSortDom=function(a,c){var d=$(a),b,f,g;this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sorting data in DOM...",c);for(b=0;b<c.length;b++)f=c[b],g=d.find("#"+f[this._primaryKey]),g.length?0===b?(this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sort, moving to index 0...",g),d.prepend(g)):(this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sort, moving to index "+b+"...",g),g.insertAfter(d.children(":eq("+(b-1)+")"))):this.debug()&&
console.log("ForerunnerDB.OldView.Bind: Warning, element for array item not found!",f)};e.prototype.bindRefresh=function(a){var c=this._binds,d,b;a||(a={data:this.find()});for(d in c)c.hasOwnProperty(d)&&(b=c[d],this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sorting DOM..."),this.bindSortDom(d,a.data),b.afterOperation&&b.afterOperation(),b.refresh&&b.refresh())};e.prototype.bindRender=function(a,c){var d=this._binds[a],b=$(a),f,g,e=$("<ul></ul>"),k;if(d){f=this._data.find();for(k=0;k<f.length;k++)g=
f[k],d.template(g,function(a){e.append(a)});c?c(a,e.html()):b.append(e.html())}};e.prototype.processQueue=function(a,c){var d=this._deferQueue[a],b=this._deferThreshold[a],f=this._deferTime[a];if(d.length){var g=this;d.length&&(d=d.length>b?d.splice(0,b):d.splice(0,d.length),this._bindEvent(a,d,[]));setTimeout(function(){g.processQueue(a,c)},f)}else c&&c(),this.emit("bindQueueComplete")};e.prototype._bindEvent=function(a,c,d){var b=this._binds,f=this.find({}),g,e;for(e in b)if(b.hasOwnProperty(e))switch(g=
b[e].reduce?this.find(b[e].reduce.query,b[e].reduce.options):f,a){case "insert":this._bindInsert(e,b[e],c,d,g);break;case "update":this._bindUpdate(e,b[e],c,d,g);break;case "remove":this._bindRemove(e,b[e],c,d,g)}};e.prototype._bindChange=function(a){this.debug()&&console.log("ForerunnerDB.OldView.Bind: Bind data change, refreshing bind...",a);this.bindRefresh(a)};e.prototype._bindInsert=function(a,c,d,b,f){var g=$(a),e;for(e=0;e<d.length;e++)a=g.find("#"+d[e][this._primaryKey]),a.length||c.template(d[e],
function(a,b,d,f){return function(a){c.insert?c.insert(a,b,d,f):c.prependInsert?g.prepend(a):g.append(a);c.afterInsert&&c.afterInsert(a,b,d,f)}}(a,d[e],b,f))};e.prototype._bindUpdate=function(a,c,d,b,f){var g=$(a);for(b=0;b<d.length;b++)a=g.find("#"+d[b][this._primaryKey]),c.template(d[b],function(a,b){return function(d){c.update?c.update(d,b,f,a.length?"update":"append"):a.length?a.replaceWith(d):c.prependUpdate?g.prepend(d):g.append(d);c.afterUpdate&&c.afterUpdate(d,b,f)}}(a,d[b]))};e.prototype._bindRemove=
function(a,c,d,b,f){a=$(a);var g;for(g=0;g<d.length;g++)b=a.find("#"+d[g][this._primaryKey]),b.length&&(c.beforeRemove?c.beforeRemove(b,d[g],f,function(a,b,g){return function(){c.remove?c.remove(a,b,g):(a.remove(),c.afterRemove&&c.afterRemove(a,b,g))}}(b,d[g],f)):c.remove?c.remove(b,d[g],f):(b.remove(),c.afterRemove&&c.afterRemove(b,d[g],f)))}},{"./Shared":17}],12:[function(e,m,h){var k,a,c,d,b;h=e("./Shared");var f=function(){this.init.apply(this,arguments)};f.prototype.init=function(a){var b=this;
this._name=a;this._groups=[];this._listeners={};this._query={query:{},options:{}};this._onFromSetData=function(){b._onSetData.apply(b,arguments)};this._onFromInsert=function(){b._onInsert.apply(b,arguments)};this._onFromUpdate=function(){b._onUpdate.apply(b,arguments)};this._onFromRemove=function(){b._onRemove.apply(b,arguments)};this._onFromChange=function(){b.debug()&&console.log("ForerunnerDB.OldView: Received change");b._onChange.apply(b,arguments)}};h.modules.OldView=f;k=e("./CollectionGroup");
a=e("./Collection");c=a.prototype.init;d=k.prototype.init;e=h.modules.Core;b=e.prototype.init;f.prototype.on=h.common.on;f.prototype.off=h.common.off;f.prototype.emit=h.common.emit;f.prototype.drop=function(){return(this._db||this._from)&&this._name?(this.debug()&&console.log("ForerunnerDB.OldView: Dropping view "+this._name),this.emit("drop"),this._db&&delete this._db._oldViews[this._name],this._from&&delete this._from._oldViews[this._name],!0):!1};f.prototype.debug=function(){return!1};f.prototype.db=
function(a){return void 0!==a?(this._db=a,this):this._db};f.prototype.from=function(a){if(void 0!==a){if("string"===typeof a)if(this._db.collectionExists(a))a=this._db.collection(a);else throw"Invalid collection in view.from() call.";this._from!==a&&(this._from&&this.removeFrom(),this.addFrom(a));return this}return this._from};f.prototype.addFrom=function(a){if(this._from=a)return this._from.on("setData",this._onFromSetData),this._from.on("change",this._onFromChange),this._from._addOldView(this),
this._primaryKey=this._from._primaryKey,this.refresh(),this;throw"Cannot determine collection type in view.from()";};f.prototype.removeFrom=function(){this._from.off("setData",this._onFromSetData);this._from.off("change",this._onFromChange);this._from._removeOldView(this)};f.prototype.primaryKey=function(){if(this._from)return this._from.primaryKey()};f.prototype.queryData=function(a,b,c){void 0!==a&&(this._query.query=a);void 0!==b&&(this._query.options=b);return void 0!==a||void 0!==b?(void 0!==
c&&!0!==c||this.refresh(),this):this._query};f.prototype.queryAdd=function(a,b,c){var d=this._query.query,f;if(void 0!==a)for(f in a)a.hasOwnProperty(f)&&(void 0===d[f]||void 0!==d[f]&&b)&&(d[f]=a[f]);void 0!==c&&!0!==c||this.refresh()};f.prototype.queryRemove=function(a,b){var c=this._query.query,d;if(void 0!==a)for(d in a)a.hasOwnProperty(d)&&delete c[d];void 0!==b&&!0!==b||this.refresh()};f.prototype.query=function(a,b){return void 0!==a?(this._query.query=a,void 0!==b&&!0!==b||this.refresh(),
this):this._query.query};f.prototype.queryOptions=function(a,b){return void 0!==a?(this._query.options=a,void 0!==b&&!0!==b||this.refresh(),this):this._query.options};f.prototype.refresh=function(a){if(this._from){var b=this._data,c,d,f,e,k,h=[],m=[],p=[],n;this.debug()&&(console.log("ForerunnerDB.OldView: Refreshing view "+this._name),console.log("ForerunnerDB.OldView: Existing data: "+("undefined"!==typeof this._data)),"undefined"!==typeof this._data&&console.log("ForerunnerDB.OldView: Current data rows: "+
this._data.find().length));this._query?(this.debug()&&console.log("ForerunnerDB.OldView: View has query and options, getting subset..."),this._data=this._from.subset(this._query.query,this._query.options)):this._query.options?(this.debug()&&console.log("ForerunnerDB.OldView: View has options, getting subset..."),this._data=this._from.subset({},this._query.options)):(this.debug()&&console.log("ForerunnerDB.OldView: View has no query or options, getting subset..."),this._data=this._from.subset({}));
if(!a&&b)if(this.debug()&&console.log("ForerunnerDB.OldView: Refresh not forced, old data detected..."),d=this._data,b.subsetOf()===d.subsetOf()){this.debug()&&console.log("ForerunnerDB.OldView: Old and new data are from same collection...");f=d.find();a=b.find();e=d._primaryKey;for(n=0;n<f.length;n++)k=f[n],c={},c[e]=k[e],(c=b.find(c)[0])?JSON.stringify(c)!==JSON.stringify(k)&&m.push(k):h.push(k);for(n=0;n<a.length;n++)k=a[n],c={},c[e]=k[e],d.find(c)[0]||p.push(k);this.debug()&&(console.log("ForerunnerDB.OldView: Removed "+
p.length+" rows"),console.log("ForerunnerDB.OldView: Inserted "+h.length+" rows"),console.log("ForerunnerDB.OldView: Updated "+m.length+" rows"));h.length&&this._onInsert(h,[]);m.length&&this._onUpdate(m,[]);p.length&&this._onRemove(p,[])}else this.debug()&&console.log("ForerunnerDB.OldView: Old and new data are from different collections..."),p=b.find(),p.length&&this._onRemove(p),h=d.find(),h.length&&this._onInsert(h);else this.debug()&&console.log("ForerunnerDB.OldView: Forcing data update",f),
this._data=this._from.subset(this._query.query,this._query.options),f=this._data.find(),this.debug()&&console.log("ForerunnerDB.OldView: Emitting change event with data",f),this._onInsert(f,[]);this.debug()&&console.log("ForerunnerDB.OldView: Emitting change");this.emit("change")}return this};f.prototype.count=function(){return this._data&&this._data._data?this._data._data.length:0};f.prototype.find=function(){return this._data?(this.debug()&&console.log("ForerunnerDB.OldView: Finding data in view collection...",
this._data),this._data.find.apply(this._data,arguments)):[]};f.prototype.insert=function(){return this._from?this._from.insert.apply(this._from,arguments):[]};f.prototype.update=function(){return this._from?this._from.update.apply(this._from,arguments):[]};f.prototype.remove=function(){return this._from?this._from.remove.apply(this._from,arguments):[]};f.prototype._onSetData=function(a,b){this.emit("remove",b,[]);this.emit("insert",a,[])};f.prototype._onInsert=function(a,b){this.emit("insert",a,b)};
f.prototype._onUpdate=function(a,b){this.emit("update",a,b)};f.prototype._onRemove=function(a,b){this.emit("remove",a,b)};f.prototype._onChange=function(){this.debug()&&console.log("ForerunnerDB.OldView: Refreshing data");this.refresh()};a.prototype.init=function(){this._oldViews=[];c.apply(this,arguments)};a.prototype._addOldView=function(a){void 0!==a&&(this._oldViews[a._name]=a);return this};a.prototype._removeOldView=function(a){void 0!==a&&delete this._oldViews[a._name];return this};k.prototype.init=
function(){this._oldViews=[];d.apply(this,arguments)};k.prototype._addOldView=function(a){void 0!==a&&(this._oldViews[a._name]=a);return this};k.prototype._removeOldView=function(a){void 0!==a&&delete this._oldViews[a._name];return this};e.prototype.init=function(){this._oldViews={};b.apply(this,arguments)};e.prototype.oldView=function(a){this._oldViews[a]||this.debug()&&console.log("ForerunnerDB.OldView: Creating view "+a);this._oldViews[a]=this._oldViews[a]||(new f(a)).db(this);return this._oldViews[a]};
e.prototype.oldViewExists=function(a){return Boolean(this._oldViews[a])};e.prototype.oldViews=function(){var a=[],b;for(b in this._oldViews)this._oldViews.hasOwnProperty(b)&&a.push({name:b,count:this._oldViews[b].count()});return a};m.exports=f},{"./Collection":2,"./CollectionGroup":3,"./Shared":17}],13:[function(e,m,h){h=e("./Shared");var k=e("./Path");e=function(a){this.pathSolver=new k;this.counter=0;this.init.apply(this,arguments)};e.prototype.init=function(a){this._data={operation:a,index:{potential:[],
used:!1},steps:[],time:{startMs:0,stopMs:0,totalMs:0,process:{}},flag:{},log:[]}};h.addModule("Operation",e);h.inherit(e.prototype,h.chainSystem);e.prototype.start=function(){this._data.time.startMs=(new Date).getTime()};e.prototype.log=function(a){if(a){var c=0<this._log.length?this._data.log[this._data.log.length-1].time:0;a={event:a,time:(new Date).getTime(),delta:0};this._data.log.push(a);c&&(a.delta=a.time-c);return this}return this._data.log};e.prototype.time=function(a){if(void 0!==a){var c=
this._data.time.process,c=c[a]=c[a]||{};c.startMs?(c.stopMs=(new Date).getTime(),c.totalMs=c.stopMs-c.startMs,c.stepObj.totalMs=c.totalMs,delete c.stepObj):(c.startMs=(new Date).getTime(),c.stepObj={name:a},this._data.steps.push(c.stepObj));return this}return this._data.time};e.prototype.flag=function(a,c){if(void 0!==a&&void 0!==c)this._data.flag[a]=c;else return void 0!==a?this._data.flag[a]:this._data.flag};e.prototype.data=function(a,c,d){return void 0!==c?(this.pathSolver.set(this._data,a,c),
this):this.pathSolver.get(this._data,a)};e.prototype.pushData=function(a,c,d){this.pathSolver.push(this._data,a,c)};e.prototype.stop=function(){this._data.time.stopMs=(new Date).getTime();this._data.time.totalMs=this._data.time.stopMs-this._data.time.startMs};m.exports=e},{"./Path":15,"./Shared":17}],14:[function(e,m,h){var k,a,c;h=e("./Shared");var d=function(){this.init.apply(this,arguments)};d.prototype.init=function(b){this._name=b;this._data=new c("__FDB__dc_data_"+this._name);this._collData=
new a;this._collections=[]};h.addModule("Overview",d);h.inherit(d.prototype,h.chainSystem);a=e("./Collection");c=e("./Document");e=h.modules.Core;k=h.modules.Core.prototype.init;h.synthesize(d.prototype,"db");h.synthesize(d.prototype,"name");h.synthesize(d.prototype,"query");h.synthesize(d.prototype,"queryOptions");h.synthesize(d.prototype,"reduce");d.prototype.debug=h.common.debug;d.prototype.objectId=h.common.objectId;d.prototype.from=function(a){void 0!==a&&("string"===typeof a&&(a=this._db.collection(a)),
this._addCollection(a));return this};d.prototype.find=function(){return this._collData.find.apply(this._collData,arguments)};d.prototype._addCollection=function(a){-1===this._collections.indexOf(a)&&(this._collections.push(a),a.chain(this),this._refresh());return this};d.prototype._removeCollection=function(a){-1<this._collections.indexOf(a)&&(this._collections.splice(a,1),a.unChain(this),this._refresh());return this};d.prototype._refresh=function(){if(this._collections&&this._collections[0]){this._collData.primaryKey(this._collections[0].primaryKey());
var a=[],c;for(c=0;c<this._collections.length;c++)a=a.concat(this._collections[c].find(this._query,this._queryOptions));this._collData.setData(a)}this._reduce&&(a=this._reduce(),this._data.setData(a))};d.prototype._chainHandler=function(a,c,d,e){switch(c){case "setData":case "insert":case "update":case "remove":this._refresh()}};d.prototype.link=function(a,c){this._data.link.apply(this._data,arguments);this._refresh()};d.prototype.unlink=function(a,c){this._data.unlink.apply(this._data,arguments);
this._refresh()};e.prototype.init=function(){this._overview={};k.apply(this,arguments)};e.prototype.overview=function(a){return a?(this._overview[a]=this._overview[a]||(new d(a)).db(this),this._overview[a]):this._overview};m.exports=d},{"./Collection":2,"./Document":6,"./Shared":17}],15:[function(e,m,h){e=e("./Shared");h=function(e){this.init.apply(this,arguments)};h.prototype.init=function(e){e&&this.path(e)};e.addModule("Path",h);e.inherit(h.prototype,e.chainSystem);h.prototype.path=function(e){return void 0!==
e?(this._path=this.clean(e),this._pathParts=this._path.split("."),this):this._path};h.prototype.hasObjectPaths=function(e,a){var c=!0,d;for(d in e)if(e.hasOwnProperty(d)&&(void 0===a[d]||"object"===typeof e[d]&&(c=this.hasObjectPaths(e[d],a[d]),!c)))return!1;return c};h.prototype.countKeys=function(e){var a=0,c;for(c in e)e.hasOwnProperty(c)&&void 0!==e[c]&&("object"!==typeof e[c]?a++:a+=this.countKeys(e[c]));return a};h.prototype.countObjectPaths=function(e,a){var c,d={},b=0,f=0,g;for(g in a)a.hasOwnProperty(g)&&
("object"===typeof a[g]?(c=this.countObjectPaths(e[g],a[g]),d[g]=c.matchedKeys,f+=c.totalKeyCount,b+=c.matchedKeyCount):(f++,e&&e[g]&&"object"!==typeof e[g]?(d[g]=!0,b++):d[g]=!1));return{matchedKeys:d,matchedKeyCount:b,totalKeyCount:f}};h.prototype.parse=function(e,a){var c=[],d="",b,f,g;for(f in e)if(e.hasOwnProperty(f))if(d=f,"object"===typeof e[f])if(a)for(b=this.parse(e[f],a),g=0;g<b.length;g++)c.push({path:d+"."+b[g].path,value:b[g].value});else for(b=this.parse(e[f]),g=0;g<b.length;g++)c.push({path:d+
"."+b[g].path});else a?c.push({path:d,value:e[f]}):c.push({path:d});return c};h.prototype.parseArr=function(e,a){a=a||{};return this._parseArr(e,"",[],a)};h.prototype._parseArr=function(e,a,c,d){var b,f="";a=a||"";c=c||[];for(b in e)e.hasOwnProperty(b)&&(!d.ignore||d.ignore&&!d.ignore.test(b))&&(f=a?a+"."+b:b,"object"===typeof e[b]?this._parseArr(e[b],f,c,d):c.push(f));return c};h.prototype.value=function(e,a){if(void 0!==e&&"object"===typeof e){var c,d,b,f,g=[],h;void 0!==a&&(a=this.clean(a),c=a.split("."));
c=c||this._pathParts;d=c.length;b=e;for(h=0;h<d;h++){b=b[c[h]];if(f instanceof Array){for(d=0;d<f.length;d++)g=g.concat(this.value(f,d+"."+c[h]));return g}if(!b||"object"!==typeof b)break;f=b}return[b]}return[]};h.prototype.set=function(e,a,c){if(void 0!==e&&void 0!==a){var d;a=this.clean(a);a=a.split(".");d=a.shift();a.length?(e[d]=e[d]||{},this.set(e[d],a.join("."),c)):e[d]=c}return e};h.prototype.get=function(e,a){return this.value(e,a)[0]};h.prototype.push=function(e,a,c){if(void 0!==e&&void 0!==
a){var d;a=this.clean(a);a=a.split(".");d=a.shift();if(a.length)e[d]=e[d]||{},this.set(e[d],a.join("."),c);else if(e[d]=e[d]||[],e[d]instanceof Array)e[d].push(c);else throw"Cannot push to a path whose endpoint is not an array!";}return e};h.prototype.keyValue=function(e,a){var c,d,b,f,g;void 0!==a&&(a=this.clean(a),c=a.split("."));c=c||this._pathParts;d=c.length;b=e;for(g=0;g<d;g++)if(b=b[c[g]],!b||"object"!==typeof b){f=c[g]+":"+b;break}return f};h.prototype.clean=function(e){"."===e.substr(0,1)&&
(e=e.substr(1,e.length-1));return e};m.exports=h},{"./Shared":17}],16:[function(e,m,h){h=e("./Shared");var k,a,c,d;d=function(){this.init.apply(this,arguments)};d.prototype.init=function(a){a.isClient()&&void 0!==Storage&&this.mode("localStorage")};h.addModule("Persist",d);h.inherit(d.prototype,h.chainSystem);h=h.modules.Core;k=e("./Collection");a=k.prototype.drop;e("./CollectionGroup");c=h.prototype.init;d.prototype.mode=function(a){return void 0!==a?(this._mode=a,this):this._mode};d.prototype.save=
function(a,c,d){switch(this.mode()){case "localStorage":c="object"===typeof c?"json::fdb::"+JSON.stringify(c):"raw::fdb::"+c;try{localStorage.setItem(a,c)}catch(e){d&&d(e)}d&&d(!1)}d&&d("No data handler.")};d.prototype.load=function(a,c){var d,e;switch(this.mode()){case "localStorage":try{d=localStorage.getItem(a)}catch(h){c(h,null)}if(d){d=d.split("::fdb::");switch(d[0]){case "json":e=JSON.parse(d[1]);break;case "raw":e=d[1]}c&&c(!1,e)}}c&&c("No data handler or unrecognised data type.")};d.prototype.drop=
function(a,c){switch(this.mode()){case "localStorage":try{localStorage.removeItem(a)}catch(d){c&&c(d)}c&&c(!1)}c&&c("No data handler or unrecognised data type.")};k.prototype.drop=function(b){if(b)if(this._name)if(this._db)this._db.persist.drop(this._name);else return callback&&callback("Cannot drop a collection's persistent storage when the collection is not attached to a database!"),"Cannot drop a collection's persistent storage when the collection is not attached to a database!";else return callback&&
callback("Cannot drop a collection's persistent storage when no name assigned to collection!"),"Cannot drop a collection's persistent storage when no name assigned to collection!";a.apply(this)};k.prototype.save=function(a){if(this._name)if(this._db)this._db.persist.save(this._name,this._data);else return a&&a("Cannot save a collection that is not attached to a database!"),"Cannot save a collection that is not attached to a database!";else return a&&a("Cannot save a collection with no assigned name!"),
"Cannot save a collection with no assigned name!"};k.prototype.load=function(a){var c=this;if(this._name)if(this._db)this._db.persist.load(this._name,function(d,e){if(d)return a&&a(d),d;e&&c.setData(e);a&&a(!1)});else return a&&a("Cannot load a collection that is not attached to a database!"),"Cannot load a collection that is not attached to a database!";else return a&&a("Cannot load a collection with no assigned name!"),"Cannot load a collection with no assigned name!"};h.prototype.init=function(){this.persist=
new d(this);c.apply(this,arguments)};m.exports=d},{"./Collection":2,"./CollectionGroup":3,"./Shared":17}],17:[function(e,m,h){var k=0;e=function(a){if(a){var c,d=a.length;return function(){for(c=0;c<d;c++)if(a[c].length===arguments.length)return a[c].apply(this,arguments);return null}}return function(){}};e={modules:{},common:{decouple:function(a){return JSON.parse(JSON.stringify(a))},objectId:function(a){var c=Math.pow(10,17);if(a){var d=0,b=a.length,e;for(e=0;e<b;e++)d+=a.charCodeAt(e)*c;a=d.toString(16)}else k++,
a=(k+(Math.random()*c+Math.random()*c+Math.random()*c+Math.random()*c)).toString(16);return a},debug:new e([function(){return this._debug&&this._debug.all},function(a){return void 0!==a?"boolean"===typeof a?(this._debug=this._debug||{},this._debug.all=a,this.chainSend("debug",this._debug),this):this._debug&&this._debug[a]||this._db&&this._db._debug&&this._db._debug[a]||this._debug&&this._debug.all:this._debug&&this._debug.all},function(a,c){return void 0!==a?void 0!==c?(this._debug=this._debug||{},
this._debug[a]=c,this.chainSend("debug",this._debug),this):this._debug&&this._debug[c]||this._db&&this._db._debug&&this._db._debug[a]:this._debug&&this._debug.all}]),on:new e([function(a,c){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||{};this._listeners[a]["*"]=this._listeners[a]["*"]||[];this._listeners[a]["*"].push(c);return this},function(a,c,d){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||{};this._listeners[a][c]=this._listeners[a][c]||
[];this._listeners[a][c].push(d);return this}]),off:new e([function(a){this._listeners&&this._listeners[a]&&a in this._listeners&&delete this._listeners[a];return this},function(a,c){var d,b;"string"===typeof c?this._listeners&&this._listeners[a]&&this._listeners[a][c]&&delete this._listeners[a][c]:a in this._listeners&&(d=this._listeners[a]["*"],b=d.indexOf(c),-1<b&&d.splice(b,1));return this},function(a,c,d){this._listeners&&a in this._listeners&&(a=this._listeners[a][c],d=a.indexOf(d),-1<d&&a.splice(d,
1))}]),emit:function(a,c){this._listeners=this._listeners||{};if(a in this._listeners){if(this._listeners[a]["*"]){var d=this._listeners[a]["*"],b=d.length,e;for(e=0;e<b;e++)d[e].apply(this,Array.prototype.slice.call(arguments,1))}if(c instanceof Array&&c[0]&&c[0][this._primaryKey]){var d=this._listeners[a],g,h,b=c.length;for(e=0;e<b;e++)if(d[c[e][this._primaryKey]])for(g=d[c[e][this._primaryKey]].length,h=0;h<g;h++)d[c[e][this._primaryKey]][h].apply(this,Array.prototype.slice.call(arguments,1))}}return this}},
_synth:{},addModule:function(a,c){this.modules[a]=c},inherit:function(a,c){for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])},synthesize:function(a,c){this._synth[c]=this._synth[c]||function(a){return void 0!==a?(this["_"+c]=a,this):this["_"+c]};a[c]=this._synth[c]},overload:e,chainSystem:{chain:function(a){this._chain=this._chain||[];-1===this._chain.indexOf(a)&&this._chain.push(a)},unChain:function(a){this._chain&&(a=this._chain.indexOf(a),-1<a&&this._chain.splice(a,1))},chainSend:function(a,c,d){if(this._chain){var b=
this._chain,e=b.length,g;for(g=0;g<e;g++)b[g].chainReceive(this,a,c,d)}},chainReceive:function(a,c,d,b){(!this._chainHandler||this._chainHandler&&!this._chainHandler(a,c,d,b))&&this.chainSend(c,d,b)}}};m.exports=e},{}],18:[function(e,m,h){var k,a,c;h=e("./Shared");var d=function(a,c,d){this.init.apply(this,arguments)};d.prototype.init=function(a,c,d){this._name=a;this._collections=[];this._groups=[];this._listeners={};this._querySettings={query:c,options:d};this._debug={};this._privateData=new k("__FDB__view_privateData_"+
this._name)};h.addModule("View",d);h.inherit(d.prototype,h.chainSystem);k=e("./Collection");CollectionGroup=e("./CollectionGroup");a=k.prototype.init;e=h.modules.Core;c=e.prototype.init;h.synthesize(d.prototype,"name");d.prototype.debug=h.common.debug;d.prototype.insert=function(){this._collectionsRun("insert",arguments)};d.prototype.update=function(){this._collectionsRun("update",arguments)};d.prototype.updateById=function(){this._collectionsRun("updateById",arguments)};d.prototype.remove=function(){this._collectionsRun("remove",
arguments)};d.prototype._collectionsRun=function(a,c){for(var d=0;d<this._collections.length;d++)this._collections[d][a].apply(this._collections[d],c)};d.prototype.find=function(a,c){return this.publicData().find(a,c)};d.prototype.link=function(a,c){var d=this.publicData();this.debug()&&console.log('ForerunnerDB.View: Setting up data binding on view "'+this.name()+'" in underlying (internal) view collection "'+d.name()+'" for output target: '+a);return d.link(a,c)};d.prototype.unlink=function(a,c){var d=
this.publicData();this.debug()&&console.log('ForerunnerDB.View: Removing data binding on view "'+this.name()+'" in underlying (internal) view collection "'+d.name()+'" for output target: '+a);return d.unlink(a,c)};d.prototype.decouple=h.common.decouple;d.prototype.from=function(a){void 0!==a&&("string"===typeof a&&(a=this._db.collection(a)),this._addCollection(a));return this};d.prototype._addCollection=function(a){if(-1===this._collections.indexOf(a)){this._collections.push(a);a.chain(this);var c=
a.find(this._querySettings.query,this._querySettings.options);this._transformPrimaryKey(a.primaryKey());this._transformInsert(c);this._privateData.primaryKey(a.primaryKey());this._privateData.insert(c)}return this};d.prototype._removeCollection=function(a){-1<this._collections.indexOf(a)&&(this._collections.splice(a,1),a.unChain(this),this._privateData.remove(a.find(this._querySettings.query,this._querySettings.options)));return this};d.prototype._chainHandler=function(a,c,d,e){var h,k;switch(c){case "setData":this.debug()&&
console.log('ForerunnerDB.View: Setting data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');d=this.decouple(d);this._transformSetData(d);this._privateData.setData(d);break;case "insert":this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');d=this.decouple(d);if(this._querySettings.options&&this._querySettings.options.$orderBy)if(h=[].concat(this._privateData._data),
(a=d instanceof Array)?h=h.concat(d):h.push(d),h=this._privateData.sort(this._querySettings.options.$orderBy,h),a)for(d.sort(function(a,c){return h.indexOf(a)-h.indexOf(c)}),a=0;a<d.length;a++)c=h.indexOf(d[a]),this._transformInsert(d,c),this._privateData._insertHandle(d,c);else c=h.indexOf(d),this._transformInsert(d,c),this._privateData._insertHandle(d,c);else c=e&&e.index?e.index:this._privateData._data.length,this._transformInsert(d,c),this._privateData._insertHandle(d,c);break;case "update":this.debug()&&
console.log('ForerunnerDB.View: Updating some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');d=this._privateData.update(d.query,d.update,d.options);if(this._querySettings.options&&this._querySettings.options.$orderBy)for(h=[].concat(this._privateData._data),h=this._privateData.sort(this._querySettings.options.$orderBy,h),d.sort(function(a,c){return h.indexOf(a)-h.indexOf(c)}),a=0;a<d.length;a++)e=this._privateData._data.indexOf(d[a]),c=h.indexOf(d[a]),
this._privateData._updateSpliceMove(this._privateData._data,e,c);if(this._transformEnabled&&this._transformIn)for(c=this._publicData.primaryKey(),a=0;a<d.length;a++)e={},k=d[a],e[c]=k[c],this._transformUpdate(e,k);break;case "remove":this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"'),this._transformRemove(d.query,e),this._privateData.remove(d.query,e)}};d.prototype.on=function(){this._privateData.on.apply(this._privateData,
arguments)};d.prototype.off=function(){this._privateData.off.apply(this._privateData,arguments)};d.prototype.emit=function(){this._privateData.emit.apply(this._privateData,arguments)};d.prototype.drop=function(){if(this._collections&&this._collections.length){(this.debug()||this._db&&this._db.debug())&&console.log("ForerunnerDB.View: Dropping view "+this._name);for(var a=this._collections.length;a--;)this._removeCollection(this._collections[a]);this._privateData.drop();return!0}return!1};d.prototype.db=
function(a){return void 0!==a?(this._db=a,this.privateData().db(a),this.publicData().db(a),this):this._db};d.prototype.primaryKey=function(){return this._privateData.primaryKey()};d.prototype.queryData=function(a,c,d){void 0!==a&&(this._querySettings.query=a);void 0!==c&&(this._querySettings.options=c);return void 0!==a||void 0!==c?(void 0!==d&&!0!==d||this.refresh(),this):this._querySettings};d.prototype.queryAdd=function(a,c,d){var e=this._querySettings.query,h;if(void 0!==a)for(h in a)a.hasOwnProperty(h)&&
(void 0===e[h]||void 0!==e[h]&&c)&&(e[h]=a[h]);void 0!==d&&!0!==d||this.refresh()};d.prototype.queryRemove=function(a,c){var d=this._querySettings.query,e;if(void 0!==a)for(e in a)a.hasOwnProperty(e)&&delete d[e];void 0!==c&&!0!==c||this.refresh()};d.prototype.query=function(a,c){return void 0!==a?(this._querySettings.query=a,void 0!==c&&!0!==c||this.refresh(),this):this._querySettings.query};d.prototype.queryOptions=function(a,c){return void 0!==a?(this._querySettings.options=a,void 0===a.$decouple&&
(a.$decouple=!0),void 0!==c&&!0!==c||this.refresh(),this):this._querySettings.options};d.prototype.refresh=function(){var a,c=this.publicData(),d;this._privateData.remove();c.remove();for(d=0;d<this._collections.length;d++)a=this._collections[d],this._privateData.insert(a.find(this._querySettings.query,this._querySettings.options));a=this._privateData.find({},this._querySettings.options);c._linked?jQuery.observable(c._data).refresh(a):(this._privateData._data.length=0,this._privateData._data=this._privateData._data.concat(a));
return this};d.prototype.count=function(){return this._privateData&&this._privateData._data?this._privateData._data.length:0};d.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this._transformEnabled=a.enabled),void 0!==a.dataIn&&(this._transformIn=a.dataIn),void 0!==a.dataOut&&(this._transformOut=a.dataOut)):this._transformEnabled=!1===a?!1:!0,this._transformPrimaryKey(this.privateData().primaryKey()),this._transformSetData(this.privateData().find()),this):
{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};d.prototype.privateData=function(){return this._privateData};d.prototype.publicData=function(){return this._transformEnabled?this._publicData:this._privateData};d.prototype._transformSetData=function(a){this._transformEnabled&&(this._publicData=new k("__FDB__view_publicData_"+this._name),this._publicData.db(this._privateData._db),this._publicData.transform({enabled:!0,dataIn:this._transformIn,dataOut:this._transformOut}),
this._publicData.setData(a))};d.prototype._transformInsert=function(a,c){this._transformEnabled&&this._publicData&&this._publicData.insert(a,c)};d.prototype._transformUpdate=function(a,c,d){this._transformEnabled&&this._publicData&&this._publicData.update(a,c,d)};d.prototype._transformRemove=function(a,c){this._transformEnabled&&this._publicData&&this._publicData.remove(a,c)};d.prototype._transformPrimaryKey=function(a){this._transformEnabled&&this._publicData&&this._publicData.primaryKey(a)};k.prototype.init=
function(){this._views=[];a.apply(this,arguments)};k.prototype.view=function(a,c,e){if(this._db&&this._db._views){if(this._db._views[a])throw"Cannot create a view using this collection because one with this name already exists: "+a;a=(new d(a,c,e)).db(this._db)._addCollection(this);this._views=this._views||[];this._views.push(a);return a}};k.prototype._addView=CollectionGroup.prototype._addView=function(a){void 0!==a&&this._views.push(a);return this};k.prototype._removeView=CollectionGroup.prototype._removeView=
function(a){void 0!==a&&(a=this._views.indexOf(a),-1<a&&this._views.splice(a,1));return this};e.prototype.init=function(){this._views={};c.apply(this,arguments)};e.prototype.view=function(a){this._views[a]||(this.debug()||this._db&&this._db.debug())&&console.log("Core.View: Creating view "+a);this._views[a]=this._views[a]||(new d(a)).db(this);return this._views[a]};e.prototype.viewExists=function(a){return Boolean(this._views[a])};e.prototype.views=function(){var a=[],c;for(c in this._views)this._views.hasOwnProperty(c)&&
a.push({name:c,count:this._views[c].count()});return a};m.exports=d},{"./Collection":2,"./CollectionGroup":3,"./Shared":17}],19:[function(e,m,h){window.jQuery&&(this.jQuery=window.jQuery,function(){(function(e,a,c){function d(a){return a}function b(a){debugger;return a}function f(a){ea=(ya._dbgMode=a)?"Unavailable (nested view): use #getIndex()":"";Ca("dbg",Ia.dbg=T.dbg=a?b:d)}function g(a){this.name=(H.link?"JsViews":"JsRender")+" Error";this.message=a||this.name}function h(a,c){for(var b in c)a[b]=
c[b];return a}function m(a){return"function"===typeof a}function ta(a,c,b){if(!P.rTag||a)v=a?a.charAt(0):v,U=a?a.charAt(1):U,M=c?c.charAt(0):M,E=c?c.charAt(1):E,N=b||N,a="\\"+v+"(\\"+N+")?\\"+U,c="\\"+M+"\\"+E,F="(?:(?:(\\w+(?=[\\/\\s\\"+M+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+M+"]|\\"+M+"(?!\\"+E+"))*?)",P.rTag=F+")",F=RegExp(a+F+"(\\/)?|(?:\\/(\\w+)))"+c,"g"),ma=RegExp("<.*>|([^\\\\]|^)[{}]|"+a+".*"+c);return[v,U,M,E,N]}function Ja(a,b){b||(b=a,a=c);var d,e,g,f;g=this;
d=!b||"root"===b;if(a){if(f=g.type===b?g:c,!f)if(d=g.views,g._.useKey)for(e in d){if(f=d[e].get(a,b))break}else for(e=0,g=d.length;!f&&e<g;e++)f=d[e].get(a,b)}else if(d)for(;g.parent.parent;)f=g=g.parent;else for(;g&&!f;)f=g.type===b?g:c,g=g.parent;return f}function S(){var a=this.get("item");return a?a.index:c}function aa(){return this.index}function ba(a){var b,d=this,g=d.linkCtx,f=(d.ctx||{})[a];f===c&&g&&g.ctx&&(f=g.ctx[a]);f===c&&(f=Ia[a]);f&&m(f)&&!f._wrp&&(b=function(){return f.apply(this&&
this!==e?this:d,arguments)},b._wrp=1,h(b,f));return b||f}function q(a,b,d){var e,g,f=+d===d&&d,h=b.linkCtx;f&&(d=(f=b.tmpl.bnds[f-1])(b.data,b,C));e=d.args[0];if(a||f){e=h&&h.tag;e||(e={_:{inline:!h,bnd:f},tagName:":",cvt:a,flow:!0,tagCtx:d,_is:"tag"},h&&(h.tag=e,e.linkCtx=h,d.ctx=K(d.ctx,h.view.ctx)),P._lnk(e));for(g in d.props)Ma.test(g)&&(e[g]=d.props[g]);d.view=b;e.ctx=d.ctx||{};delete d.ctx;b._.tag=e;e=p(e,e.convert||"true"!==a&&a)[0];e=f&&b._.onRender?b._.onRender(e,b,f):e;b._.tag=c}return e!=
c?e:""}function p(a,c){var b=a.tagCtx,d=b.view,e=b.args;c=c&&(""+c===c?d.getRsc("converters",c)||na("Unknown converter: '"+c+"'"):c);e=e.length||b.index?c?e.slice():e:[d.data];c&&(c.depends&&(a.depends=P.getDeps(a.depends,a,c.depends,c)),e[0]=c.apply(a,e));return e}function n(a,b){for(var d,e=this;d===c&&e;)d=(d=e.tmpl[a])&&d[b],e=e.parent;return d||C[a][b]}function l(a,b,d,e,g){var f,k,r,l,D,m,w,n,s,H,I,A="",q=+e===e&&e,F=b.linkCtx||0,t=b.ctx,v=d||b.tmpl;"tag"===a._is&&(f=a,a=f.tagName,e=f.tagCtxs);
f=f||F.tag;q&&(e=(n=v.bnds[q-1])(b.data,b,C));m=e.length;for(D=0;D<m;D++){D||d&&f||(s=b.getRsc("tags",a)||na("Unknown tag: {{"+a+"}}"));k=e[D];F.tag||(w=k.tmpl,w=k.content=w&&v.tmpls[w-1],h(k,{tmpl:(f?f:s).template||w,render:V,index:D,view:b,ctx:K(k.ctx,t)}));if(d=k.props.tmpl)d=""+d===d?b.getRsc("templates",d)||Ea(d):d,k.tmpl=d;f||(s._ctr?(f=new s._ctr,H=!!f.init,f.attr=f.attr||s.attr||c):P._lnk(f={render:s.render}),f._={inline:!F},F&&(F.attr=f.attr=F.attr||f.attr,F.tag=f,f.linkCtx=F),(f._.bnd=n||
F.fn)?f._.arrVws={}:f.dataBoundOnly&&na("{^{"+a+"}} tag must be data-bound"),f.tagName=a,f.parent=l=t&&t.tag,f._is="tag",f._def=s,f.tagCtxs=e);if(!D)for(I in w=k.props)Ma.test(I)&&(f[I]=w[I]);k.tag=f;f.dataMap&&f.tagCtxs&&(k.map=f.tagCtxs[D].map);f.flow||(w=k.ctx=k.ctx||{},k=f.parents=w.parentTags=t&&K(w.parentTags,t.parentTags)||{},l&&(k[l.tagName]=l),w.tag=f)}b._.tag=f;f.rendering={};for(D=0;D<m;D++){k=f.tagCtx=f.tagCtxs[D];w=k.props;a=p(f,f.convert);if(e=w.dataMap||f.dataMap)if(a.length||w.dataMap){l=
k.map;if(!l||l.src!==a[0]||g)l&&l.src&&l.unmap(),l=k.map=e.map(a[0],w);a=[l.tgt]}f.ctx=k.ctx;!D&&H&&(e=f.template,f.init(k,F,f.ctx),H=c,f.template!==e&&(f._.tmpl=f.template));l=c;if(e=f.render)l=e.apply(f,a);a=a.length?a:[b];l=l!==c?l:k.render(a[0],!0)||(g?c:"");A=A?A+(l||""):l}delete f.rendering;f.tagCtx=f.tagCtxs[0];f.ctx=f.tagCtx.ctx;f._.inline&&(r=f.attr)&&r!==L&&(A="text"===r?T.html(A):"");return q&&b._.onRender?b._.onRender(A,b,q):A}function ca(a,c,b,d,e,f,g,h){var k="array"===c,r={key:0,useKey:k?
0:1,id:""+Ha++,onRender:h,bnds:{}};this.data=d;this.tmpl=e;this.content=g;this.views=k?[]:{};this.parent=b;this.type=c;this._=r;this.linked=!!h;b?(c=b.views,d=b._,d.useKey?(c[r.key="_"+d.useKey++]=this,this.index=ea,this.getIndex=S,f=d.tag,r.bnd=k&&(!f||!!f._.bnd&&f)):c.splice(r.key=this.index=f,0,this),this.ctx=a||b.ctx):this.ctx=a}function z(a){var c,b,d,e,f,g;for(c in O)if(e=O[c],(f=e.compile)&&(b=a[c+"s"]))for(d in b)(e=b[d]=f(d,b[d],a))&&(g=P.onStore[c])&&g(d,e,f)}function da(a,b,d){m(b)?b={depends:b.depends,
render:b}:(b.baseTag&&(b.flow=!!b.flow,b=h(h({},b.baseTag),b)),(a=b.template)!==c&&(b.template=""+a===a?Ea[a]||Ea(a):a),!1!==b.init&&(a=b._ctr=function(){},(a.prototype=b).constructor=a));d&&(b._parentTmpl=d);return b}function oa(b,d,f,g){function h(d){if(""+d===d||0<d.nodeType){try{l=0<d.nodeType?d:!ma.test(d)&&a&&a(e.document).find(d)[0]}catch(r){}l&&(d=Ea[b=b||l.getAttribute(Q)],d||(b=b||"_"+Z++,l.setAttribute(Q,b),d=Ea[b]=oa(b,l.innerHTML,f,g)),l=c);return d}}var r,l;d=d||"";r=h(d);g=g||(d.markup?
d:{});g.tmplName=b;f&&(g._parentTmpl=f);!r&&d.markup&&(r=h(d.markup))&&r.fn&&(r.debug!==d.debug||r.allowCode!==d.allowCode)&&(r=r.markup);if(r!==c)return b&&!f&&(t[b]=function(){return d.render.apply(d,arguments)}),r.fn||d.fn?r.fn&&(d=b&&b!==r.tmplName?K(g,r):r):(d=La(r,g),ra(r.replace(x,"\\$&"),d)),z(g),d}function pa(a){function c(b,d){this.tgt=a.getTgt(b,d)}m(a)&&(a={getTgt:a});a.baseMap&&(a=h(h({},a.baseMap),a));a.map=function(a,b){return new c(a,b)};return a}function La(a,c){var b,d=ya.wrapMap||
{},e=h({markup:a,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:ua},c);c.htmlTag||(b=fa.exec(a),e.htmlTag=b?b[1].toLowerCase():"");(b=d[e.htmlTag])&&b!==d.div&&(e.markup=H.trim(e.markup));return e}function W(a,b){function d(f,g,h){var k,r,l;if(f&&"object"===typeof f&&!f.nodeType&&!f.markup&&!f.getTgt){for(r in f)d(r,f[r],g);return C}g===c&&(g=f,f=c);f&&""+f!==f&&(h=g,g=f,f=c);l=h?h[e]=h[e]||{}:d;r=b.compile;null===g?f&&delete l[f]:(g=r?g=r(f,g,h):g,f&&(l[f]=g));r&&g&&(g._is=a);g&&(k=P.onStore[a])&&
k(f,g,r);return g}var e=a+"s";C[e]=d;O[a]=b}function sa(a,c){var b=this.jquery&&(this[0]||na('Unknown template: "'+this.selector+'"')),d=b.getAttribute(Q);return ua.call(d?Ea[d]:Ea(b),a,c)}function za(a,c,b){if(ya._dbgMode)try{return a.fn(c,b,C)}catch(d){return na(d,b)}return a.fn(c,b,C)}function ua(a,c,b,d,e,f){return d||!this.fn._nvw||H.isArray(a)?V.call(this,a,c,b,d,e,f):za(this,a,{tmpl:this})}function V(a,b,d,e,f,g){var h,k,r,l,D,m,w,s,n;r=this;var I="";!!b===b&&(d=b,b=c);!0===f&&(h=!0,f=0);r.tag?
(m=r,r=r.tag,k=r._,D=r.tagName,s=k.tmpl||m.tmpl,n=r.attr&&r.attr!==L,b=K(b,r.ctx),w=m.content,!1===m.props.link&&(b=b||{},b.link=!1),e=e||m.view,a=arguments.length?a:e):s=r;if(s&&(!e&&a&&"view"===a._is&&(e=a),e&&(w=w||e.content,g=g||e._.onRender,a===e&&(a=e.data),b=K(b,e.ctx)),e&&e.data!==c||((b=b||{}).root=a),s.fn||(s=Ea[s]||Ea(s)),s)){m=g=!1!==(b&&b.link)&&!n&&g;!0===g&&(m=c,g=e._.onRender);b=s.helpers?K(s.helpers,b):b;if(H.isArray(a)&&!d)for(l=h?e:f!==c&&e||new ca(b,"array",e,a,s,f,w,g),h=0,k=
a.length;h<k;h++)r=a[h],D=new ca(b,"item",l,r,s,(f||0)+h,w,g),r=za(s,r,D),I+=l._.onRender?l._.onRender(r,D):r;else{if(e||!s.fn._nvw)l=h?e:new ca(b,D||"data",e,a,s,f,w,g),k&&!r.flow&&(l.tag=r);I+=za(s,a,l)}return m?m(I,l):I}return""}function na(a,c,b){b=ya.onError(a,c,b);if(""+a===a)throw new P.Err(b);return!c.linkCtx&&c.linked?T.html(b):b}function ia(a){na("Syntax error\n"+a)}function ra(a,c,b,d){function e(c){(c-=w)&&s.push(a.substr(w,c).replace(la,"\\n"))}function f(c){c&&ia('Unmatched or missing tag: "{{/'+
c+'}}" in template:\n'+a)}var g,h,k,l=c&&c.allowCode,m=[],w=0,K=[],s=m,n=[,,m];b&&(a=v+a+E);f(K[0]&&K[0][2].pop()[0]);a.replace(F,function(g,D,m,I,H,A,p,q,F,t,v,C){A&&(H=":",I=L);t=t||b;D=(D||b)&&[];var x="",B="",ja="",va="",X="",Ka="",Na="",Wa="";p=!t&&!H&&!p;m=m||(F=F||"#data",H);e(C);w=C+g.length;q?l&&s.push(["*","\n"+F.replace(ka,"$1")+"\n"]):m?("else"===m&&(R.test(F)&&ia('for "{{else if expr}}" use "{{else expr}}"'),D=n[7],n[8]=a.substring(n[8],C),n=K.pop(),s=n[2],p=!0),F&&r(F.replace(la," "),
D,c).replace(G,function(a,c,b,d,e,f,g,h){g?(B+=f+",",va+="'"+h+"',"):b?(ja+=d+f+",",Ka+=d+"'"+h+"',"):c?Na+=f:("trigger"===e&&(Wa+=f),x+=d+f+",",X+=d+"'"+h+"',",k=k||Ma.test(e));return""}).slice(0,-1),h=[m,I||!!d||k||"",p&&[],[va.slice(0,-1),X.slice(0,-1),Ka.slice(0,-1)],[B.slice(0,-1),x.slice(0,-1),ja.slice(0,-1)],Na,Wa,D||0],s.push(h),p&&(K.push(n),n=h,n[8]=w)):v&&(f(v!==n[0]&&"else"!==n[0]&&v),n[8]=a.substring(n[8],C),n=K.pop());f(!n&&v);s=n[2]});e(a.length);(w=m[m.length-1])&&f(""+w!==w&&+w[8]===
w[8]&&w[0]);b?(g=D(m,a,b),g.paths=m[0][7]):g=D(m,c);g._nvw&&(g._nvw=!/[~#]/.test(a));return g}function Ga(a,c){return"\n\t"+(c?c+":{":"")+"args:["+a[0]+"]"+(a[1]||!c?",\n\tprops:{"+a[1]+"}":"")+(a[2]?",\n\tctx:{"+a[2]+"}":"")}function r(a,c,b){var d,e,f,g,h,k=0,r=b?b.links:c&&(c.links=c.links||{}),l={},D={0:-1},m=0;return(a+(b?" ":"")).replace(/\)\^/g,").").replace(Fa,function(w,K,s,n,I,H,p,A,F,q,t,v,C,x,z,B,ja,va,X,Ka){function Na(a,b,g,B,ja,h,va,X){return g&&(c&&("linkTo"===d&&(e=c._jsvto=c._jsvto||
[],e.push(I)),d&&!f||c.push(I.slice(b.length))),"."!==g)?(a=(B?'view.hlp("'+B+'")':ja?"view":"data")+(X?(h?"."+h:B?"":ja?"":"."+g)+(va||""):(X=B?"":ja?h||"":g,"")),a+=X?"."+X:"",b+("view.data"===a.slice(0,9)?a.slice(5):a)):a}H=H||"";s=s||K||v;I=I||F;q=q||ja||"";if(!p||h||g)return!c||!B||h||g||d&&!f&&!e||(B=D[m],Ka.length-1>X-B&&(B=Ka.slice(B,X+1),B=U+":"+B+M,p=r[B],p||(r[B]=1,r[B]=p=ra(B,b||c,!0),p.paths.push({_jsvOb:p})),1!==p&&(e||c).push({_jsvOb:p}))),h?(h=!C,h?w:'"'):g?(g=!x,g?w:'"'):(s?(m++,
D[m]=X++,s):"")+(va?m?"":(k=Ka.slice(k,X),d?(d=f=e=!1,"\b"):"\b,")+k+(k=X+w.length,"\b"):A?(m&&ia(a),d=I,f=n,k=X+w.length,I+":"):I?I.split("^").join(".").replace(Y,Na)+(q?(l[++m]=!0,"."!==I.charAt(0)&&(D[m]=X),q):H):H?H:z?(l[m--]=!1,z)+(q?(l[++m]=!0,q):""):t?(l[m]||ia(a),","):K?"":(h=C,g=x,'"'));ia(a)})}function D(c,b,d){var e,f,g,h,k,r,l,m,w,K,s,n,I,H,p,A,q,F,t,v,C,x,z,M,E=0,B="",ja={},va=c.length;""+b===b?(p=d?'data-link="'+b.replace(la," ").slice(1,-1)+'"':b,b=0):(p=b.tmplName||"unnamed",b.allowCode&&
(ja.allowCode=!0),b.debug&&(ja.debug=!0),s=b.bnds,H=b.tmpls);for(e=0;e<va;e++)if(f=c[e],""+f===f)B+='\n+"'+f+'"';else if(g=f[0],"*"===g)B+=";\n"+f[1]+"\nret=ret";else{h=f[1];F=f[2];k=Ga(f[3],"params")+"},"+Ga(I=f[4]);z=f[5];M=f[6];t=f[8];(C="else"===g)||(E=0,s&&(n=f[7])&&(E=s.push(n)));(f=":"===g)?h&&(g=h===L?">":h+g):(F&&(A=La(t,ja),A.tmplName=p+"/"+g,D(F,A),H.push(A)),C||(q=g,v=B,B=""),A=(A=c[e+1])&&"else"===A[0]);C=z?";\ntry{\nret+=":"\n+";if(f&&(n||M||h&&h!==L)){x="return {"+k+"};";z&&(x="try {\n"+
x+"\n}catch(e){return {error: j._err(e,view,"+z+")}}\n");x=new Function("data,view,j,u"," // "+p+" "+E+" "+g+"\n"+x);x.paths=n;x._tag=g;if(d)return x;K=1}B+=f?(d?(z?"\ntry{\n":"")+"return ":C)+(K?(K=0,w=m=!0,'c("'+h+'",view,'+(n?(s[E-1]=x,E):"{"+k+"}")+")"):">"===g?(l=!0,"h("+I[0]+")"):"((v="+I[0]+')!=null?v:"")'):(w=r=!0,"\n{view:view,tmpl:"+(F?H.length:"0")+","+k+"},");if(q&&!A){B="["+B.slice(0,-1)+"]";if(d||n)if(B=new Function("data,view,j,u"," // "+p+" "+E+" "+q+"\nreturn "+B+";"),n&&((s[E-1]=
B).paths=n),B._tag=g,d)return B;B=v+C+'t("'+q+'",view,this,'+(E||B)+")";q=n=0}z&&(w=!0,B+=";\n}catch(e){ret"+(d?"urn ":"+=")+"j._err(e,view,"+z+");}\n"+(d?"":"ret=ret"))}B="// "+p+"\nj=j||"+(a?"jQuery.":"jsviews.")+"views;var v"+(r?",t=j._tag":"")+(m?",c=j._cnvt":"")+(l?",h=j.converters.html":"")+(d?";\n":',ret=""\n')+(ja.debug?"debugger;":"")+B+(d?"\n":";\nreturn ret;");try{B=new Function("data,view,j,u",B)}catch(X){ia("Compiled template code:\n\n"+B+'\n: "'+X.message+'"')}b&&(b.fn=B);w||(B._nvw=
!0);return B}function K(a,c){return a&&a!==c?c?h(h({},c),a):a:c&&h({},c)}function w(a){return ga[a]||(ga[a]="&#"+a.charCodeAt(0)+";")}function I(a){var c,b,d=[];if("object"===typeof a)for(c in a)(b=a[c])&&b.toJSON&&!b.toJSON()||m(b)||d.push({key:c,prop:b});return d}function A(a){return null!=a?ha.test(a)&&(""+a).replace(wa,w)||a:""}if(!(a&&a.render||e.jsviews)){var H,s,F,ma,ea,v="{",U="{",M="}",E="}",N="^",Y=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,
Fa=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^|\s*$)|[)\]])([([]?))|(\s+)/g,la=/[ \t]*(\r\n|\n|\r)/g,ka=/\\(['"])/g,x=/['"\\]/g,G=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,R=/^if\s/,fa=/<(\w+)[>\s]/,ha=/[\x00`><\"'&]/,Ma=/^on[A-Z]|^convert(Back)?$/,wa=/[\x00`><"'&]/g,Z=0,Ha=0,ga={"&":"&amp;","<":"&lt;",">":"&gt;",
"\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},L="html",Q="data-jsv-tmpl",t={},O={template:{compile:oa},tag:{compile:da},helper:{},converter:{}},C={jsviews:"v1.0.0-beta",settings:function(a){h(ya,a);f(ya._dbgMode);ya.jsv&&ya.jsv()},sub:{View:ca,Err:g,tmplFn:ra,cvt:p,parse:r,extend:h,syntaxErr:ia,onStore:{},_lnk:d},map:pa,_cnvt:q,_tag:l,_err:na};(g.prototype=Error()).constructor=g;S.depends=function(){return[this.get("item"),"index"]};aa.depends=function(){return["index"]};ca.prototype={get:Ja,
getIndex:aa,getRsc:n,hlp:ba,_is:"view"};for(s in O)W(s,O[s]);var Ea=C.templates,T=C.converters,Ia=C.helpers,Ca=C.tags,P=C.sub,ya=C.settings;a?(H=a,H.fn.render=sa,H.observable&&(h(P,H.views.sub),C.map=H.views.map)):(H=e.jsviews={},H.isArray=Array&&Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)});H.render=t;H.views=C;H.templates=Ea=C.templates;ya({debugMode:f,delimiters:ta,onError:function(a,b,d){b&&(a=d===c?"{Error: "+a+"}":m(d)?d(a,b):d);return a==c?"":a},_dbgMode:!0});
Ca({"else":function(){},"if":{render:function(a){return this.rendering.done||!a&&(arguments.length||!this.tagCtx.index)?"":(this.rendering.done=!0,this.selected=this.tagCtx.index,this.tagCtx.render(this.tagCtx.view,!0))},onUpdate:function(a,c,b){var d;for(a=0;(d=this.tagCtxs[a])&&d.args.length;a++)if(d=d.args[0],c=!d!==!b[a].args[0],!this.convert&&d||c)return c;return!1},flow:!0},"for":{render:function(a){var b,d=this.tagCtx,e="",f=0;if(!this.rendering.done){if(b=!arguments.length)a=d.view.data;a!==
c&&(e+=d.render(a,b),f+=H.isArray(a)?a.length:1);if(this.rendering.done=f)this.selected=d.index}return e},flow:!0},include:{flow:!0},"*":{render:d,flow:!0}});Ca("props",{baseTag:Ca["for"],dataMap:pa(I)});T({html:A,attr:A,url:function(a){return a!=c?encodeURI(""+a):null===a?a:""}});ta()}})(this,this.jQuery);(function(e,a,c){function d(a){return z(a)?new f(a):new b(a)}function b(a){this._data=a;return this}function f(a){this._data=a;return this}function g(a,c){a=z(a)?a:[a];var b,d,e=c,f=e,h=a.length,
k=[];for(b=0;b<h;b++)d=a[b],V(d)?k=k.concat(g(d.call(c,c),c)):""+d!==d?(c=f=d,f!==e&&k.push(e=f)):(f!==e&&k.push(e=f),k.push(d));return k}function h(a,c){var b,d;for(b in a){d=!0;break}d||delete za[c]}function m(a,b){if(!a.data||!a.data.off){var d,e,f,g=b.oldValue,h=b.value,k=a.data,l=k.observeAll,n=!k.cb.noArray,p=k.paths;if(a.type===sa)(k.cb.array||k.cb).call(k,a,b);else if(k.prop===b.path||"*"===k.prop)g=typeof g===oa&&(p[0]||n&&z(g))&&g,h=typeof(h=b.value)===oa&&(p[0]||n&&z(h))&&h,l?(d=l._path+
"."+b.path,e=l.filter,f=[l.parents().slice()],g&&S(n,l.ns,[g],p,k.cb,!0,e,f,d),h&&S(n,l.ns,[h],p,k.cb,c,e,f,d)):(g&&S(n,[g],p,k.cb,!0),h&&S(n,[h],p,k.cb)),k.cb(a,b)}}function ta(){function b(c,d,e,f){var g,h=ra(t),k=z(t)?[t]:t;c=ha?c+"."+ha:c;if(ea||f)h&&a(k).off(c,m);else{if(N=h&&a._data(t))for(M=(N=(N=N&&N.events)&&N[e?sa:W])&&N.length;M--;)if((E=N[M].data)&&E.cb._cId===v._cId&&E.ns===ha){if(e)return;("*"===d&&E.prop!==d||E.prop===s)&&a(t).off(c,m)}d=e?{}:{fullPath:q,paths:d?[d]:[],prop:s};d.ns=
ha;d.cb=v;R&&(d.observeAll={_path:R,path:function(){g=G.length;return R.replace(/[[.]/g,function(c){g--;return"["===c?"["+a.inArray(G[g-1],G[g]):"."})},parents:function(){return G},filter:fa,ns:ha});a(k).on(c,null,d,m);la&&(la[a.data(t,"obId")||a.data(t,"obId",na++)]=t)}}function e(a,c){a._ob=Y(a,Q);var b=Q;return function(d,e){var g=a._ob,h=c.length;typeof g===oa&&(f(g,!0),(h||Z&&z(g))&&S(Z,[g],c,v,Y,!0));g=a._ob=Y(a,b);typeof g===oa&&(f(g),(h||Z&&z(g))&&S(Z,[g],c,v,Y,[b]));v(d,e)}}function f(a,
e,g,h){if(Z){var k=t,l=R;t=a;h&&(t=a[h],R+="."+h,fa&&(t=d._fltr(h,a,R,fa)));t&&(g||z(t))&&b(sa+".observe"+(v?".obs"+(U=v._cId=v._cId||ia++):""),c,!0,e);t=k;R=l}}var k,l,n,p,s,q,ma,ea,v,U,M,E,N,Y,da,la,ka,x,G,R,fa,ha,aa,ba,Z=!1!=this,pa=1,ga=ua,L=Array.apply(0,arguments);k=L.pop();var Q=L.shift(),t=x=Q,O=L.length;Q+""===Q&&Z&&(ha=Q,Q=t=x=L.shift(),O--);if(V(k))v=k;else if(k+""===k&&(R=k,G=L.pop(),fa=L.pop(),k=L.pop(),O-=3),!0===k?ea=k:k&&(Q=k,pa=0),k=L[O-1],O&&k===c||V(k))v=L.pop(),O--;O&&V(L[O-1])&&
(Y=v,v=L.pop(),O--);ga+=ea?v?".obs"+v._cId:"":".obs"+(U=v._cId=v._cId||ia++);ea||(la=za[U]=za[U]||{});aa=ha&&ha.match(La)||[""];for(ba=aa.length;ba--;)for(ha=aa[ba],z(x)?f(x,ea,!0):ea&&0===O&&x&&b(ga,""),k=ka=0;k<O;k++)if(q=L[k],""!==q){t=x;if(""+q===q){p=q.split("^");p[1]&&(ka=p[0].split(".").length,q=p.join("."),ka=q.split(".").length-ka);if(Y&&(da=Y(q,x))){O+=da.length-1;ca.apply(L,[k--,1].concat(da));continue}p=q.split(".")}else pa&&!V(q)&&(q._jsvOb&&(x=e(q,L.slice(k+1)),x.noArray=!Z,x._cId=v._cId,
S(Z,[Q],L.slice(0,k),x,Y),x=c,q=q._ob),t=q),x=q,p=[x];for(;t&&(s=p.shift())!==c;)if(typeof t===oa){if(""+s===s){if(""===s)continue;if(p.length<ka+1&&!t.nodeType){if(!ea&&(N=ra(t)&&a._data(t))){M=(N=(N=N.events)&&N[W])&&N.length;for(n=0;M--;)!(E=N[M].data)||E.cb!==v||E.ns!==ha||E.prop!==s&&"*"!==E.prop||((l=p.join("."))&&E.paths.push(l),n++);if(n){t=t[s];continue}}if("*"===s){!ea&&N&&N.length&&b(ga,"",!1,!0);V(t)?(ma=t.depends)&&S(Z,[ma],v,ea||Q):b(ga,"");for(l in t)f(t,ea,c,l);break}else s&&b(ga+
"."+s,p.join("."))}R&&(R+="."+s);s=t[s]}if(V(s)){(ma=s.depends)&&S(Z,[t],g(ma,t),v,Y,ea||[Q]);break}t=s}f(t,ea)}U&&h(la,U);return{cbId:U,bnd:la}}function Ja(){[].push.call(arguments,!0);return ta.apply(this,arguments)}function S(){var a=[].concat.apply([],arguments);return ta.apply(a.shift(),a)}function aa(a,c,b,d){a+""!==a&&(b=c,c=a,a="");q(a,this._data,c,b,[],"root",d)}function ba(a,c,b){aa.call(this,a,c,b,!0)}function q(a,b,e,f,g,h,k){function l(c,b){n=c.length;for(v=h+"[]";n--;)(U=d._fltr(n,c,
v,f))&&q(a,U,e,f||"",g.slice(),v,b)}function m(c,b){h=c.data.observeAll._path;var d=g;g[0]!==c.target&&(g=g.slice(),g.unshift(c.target));switch(b.change){case "insert":l(b.items);break;case "remove":l(b.items,!0);break;case "refresh":l(b.oldItems,!0);l(c.target);break;case "set":v=h+"."+b.path,q(a,b.oldValue,e,0,g.slice(),v,!0),q(a,b.value,e,0,g.slice(),v)}e.apply(this,arguments);g=d}var n,p,v,U;if(typeof b===oa){p=z(b)?"":"*";g.unshift(b);if(e){if(p||0!==f)m._cId=e._cId=e._cId||ia++,ta(a,b,p,m,k,
f,g.slice(),h)}else ta(a,b,p,c,k,f,g.slice(),h);if(p)for(n in b)"_"!==n.charAt(0)&&n!==da&&(v=h+"."+n,(U=d._fltr(n,b,v,f))&&q(a,U,e,f||0,g.slice(),v,k));else l(b,k)}}function p(a,c,b){return 0>b.indexOf(".")&&0>b.indexOf("[")&&c[a]}if(!a)throw"jsViews/jsObservable require jQuery";if(!a.observable){e=a.views=a.views||{jsviews:"v1.0.0-alpha",sub:{}};var n=e.sub,l=a.event.special,ca=[].splice,z=a.isArray,da=a.expando,oa="object",pa=parseInt,La=/\S+/g,W=n.propChng=n.propChng||"propertyChange",sa=n.arrChng=
n.arrChng||"arrayChange",za=n._cbBnds=n._cbBnds||{},ua=W+".observe",V=a.isFunction,na=1,ia=1,ra=a.hasData,Ga={};n.getDeps=function(){var a=arguments;return function(){for(var c,b,d=[],e=a.length;e--;)c=a[e--],(b=a[e])&&(d=d.concat(V(b)?b(c,c):b));return d}};a.observable=d;d._fltr=function(a,c,b,d){(a=d&&V(d)?d(a,c,b):c[a])&&(a=V(a)?a.set&&a.call(c):a);return typeof a===oa&&a};d.Object=b;d.Array=f;a.observe=d.observe=ta;a.unobserve=d.unobserve=Ja;d._apply=S;b.prototype={_data:null,observeAll:aa,unobserveAll:ba,
data:function(){return this._data},setProperty:function(a,b,d){var e,f=this._data;a=a||"";if(f)if(z(a))for(e=a.length;e--;)b=a[e],this.setProperty(b.name,b.value,d===c||d);else if(""+a!==a)for(e in a)this.setProperty(e,a[e],b);else if(a!==da){for(a=a.split(".");f&&1<a.length;)f=f[a.shift()];f&&this._setProperty(f,a[0],b,d)}return this},removeProperty:function(a){this.setProperty(a,Ga);return this},_setProperty:function(a,b,d,e){var f,g,h,k=b?a[b]:a;V(k)&&k.set&&(g=k,f=!0===k.set?k:k.set,k=k.call(a));
if(k!==d||e&&k!=d)if(!(k instanceof Date)||k>d||k<d)f?(f.call(a,d),d=g.call(a)):(h=d===Ga)?(delete a[b],d=c):b&&(a[b]=d),this._trigger(a,{change:"set",path:b,value:d,oldValue:k,remove:h})},_trigger:function(c,b){a(c).triggerHandler(W,b)}};f.prototype={_data:null,observeAll:aa,unobserveAll:ba,data:function(){return this._data},insert:function(a,c){var b=this._data;1===arguments.length&&(c=a,a=b.length);a=pa(a);-1<a&&a<=b.length&&(c=z(c)?c:[c],c.length&&this._insert(a,c));return this},_insert:function(a,
c){var b=this._data,d=b.length;ca.apply(b,[a,0].concat(c));this._trigger({change:"insert",index:a,items:c},d)},remove:function(a,b){var d;d=this._data;a===c&&(a=d.length-1);a=pa(a);b=b?pa(b):0===b?0:1;-1<b&&-1<a&&(d=d.slice(a,a+b),(b=d.length)&&this._remove(a,b,d));return this},_remove:function(a,c,b){var d=this._data,e=d.length;d.splice(a,c);this._trigger({change:"remove",index:a,items:b},e)},move:function(a,c,b){b=b?pa(b):0===b?0:1;a=pa(a);c=pa(c);if(0<b&&-1<a&&-1<c&&a!==c){var d=this._data.slice(a,
a+b);(b=d.length)&&this._move(a,c,b,d)}return this},_move:function(a,b,c,d){var e=this._data,f=e.length;e.splice(a,c);e.splice.apply(e,[b,0].concat(d));this._trigger({change:"move",oldIndex:a,index:b,items:d},f)},refresh:function(a){var b=this._data.slice();this._refresh(b,a);return this},_refresh:function(a,b){var c=this._data,d=c.length;ca.apply(c,[0,c.length].concat(b));this._trigger({change:"refresh",oldItems:a},d)},_trigger:function(b,c){var d=this._data,e=d.length,d=a([d]);d.triggerHandler(sa,
b);e!==c&&d.triggerHandler(W,{change:"set",path:"length",value:e,oldValue:c})}};l[W]=l[sa]={remove:function(b){var c,d,e,f,g=b.data;if(g&&(g.off=1,g=g.cb)&&(c=za[g._cId])){b=a._data(this).events[b.type];for(e=b.length;e--&&!d;)d=(f=b[e].data)&&f.cb===g;d||(delete c[a.data(this,"obId")],h(c,g._cId))}}};e.map=function(b){function e(a,c,f){var g,h=this;this.src&&this.unmap();"object"===typeof a&&(h.src=a,h.tgt=f||h.tgt||[],h.options=c||h.options,h.update(),b.obsSrc&&d(h.src).observeAll(h.obs=function(a,
c){g||(g=1,b.obsSrc(h,a,c),g=0)},h.srcFlt),b.obsTgt&&d(h.tgt).observeAll(h.obt=function(a,c){g||(g=1,b.obsTgt(h,a,c),g=0)},h.tgtFlt))}(e.prototype={srcFlt:b.srcFlt||p,tgtFlt:b.tgtFlt||p,update:function(c){a.observable(this.tgt).refresh(b.getTgt(this.src,this.options=c||this.options))},unmap:function(){this.src&&(this.obs&&a.observable(this.src).unobserveAll(this.obs,this.srcFlt),this.obt&&a.observable(this.tgt).unobserveAll(this.obt,this.tgtFlt),this.src=c)},map:e,_def:b}).constructor=e;V(b)&&(b=
{getTgt:b});b.baseMap&&(b=a.extend({},b.baseMap,b));b.map=function(a,b,c){return new e(a,b,c)};return b}}})(this,this.jQuery);(function(e,a,c){function d(b,d,e){var f,g,h,k,l,n,p,q,r,y=b.target,s=y._jsvBnd,u=/&(\d+)\+?/g;if(s)for(;h=u.exec(s);)if(h=Da[h[1]])if(d=h.to){h=h.linkCtx;p=h.view;r=h.tag;n=a(y);l=p.hlp(O);q=p.hlp(C);g=m(y);f=Qa[g];e===c&&(e=ha(g)?g(y):f?n[f]():n.attr(g));f=d[1];d=d[0];f&&(k=ha(f)?f:p.getRsc("converters",f));k&&(e=k.call(r,e));f=p.linkCtx;p.linkCtx=h;g={change:"change",oldValue:h._val,
value:e};if(!(l&&!1===l.call(h,b,g)||r&&r.onBeforeChange&&!1===r.onBeforeChange(b,g)||e===c)&&(l=d[0],e!==c&&l)){l=l._jsvOb?l._ob:l;r&&(r._.chging=!0);Z(l).setProperty(d[2]||d[1],e);q&&q.call(h,b,g);if(r){if(r.onAfterChange)r.onAfterChange(b,g);delete r._.chging}h._val=e}p.linkCtx=f}}function b(b,d,e){var g,h,k,l=this.data,n=this.elem,p=this.convert;h=n.parentNode;var q=this.view,r=q.linkCtx,s=q.hlp(O);q.linkCtx=this;if(h&&!(s&&d&&!1===s.call(this,b,d)||d&&"*"!==b.data.prop&&b.data.prop!==d.path)){d&&
(this.eventArgs=d);if(d||this._initVal){delete this._initVal;h=e.call(q.tmpl,l,q,x);a:{var y=h,t=k=this.tag;g=this.attr||m(n,!0,p!==c);var u,v,w=t&&t.parentElem||this.elem;if(y!==c){v=a(w);g=t&&t.attr||g;ha(y)&&U(this.expr+": missing parens");"visible"===g&&(g="css-display");if(t=/^css-/.test(g)&&g.slice(4))u=a.style(w,t),+y===y&&(u=parseInt(u));else if("link"!==g){if("value"===g)w.type===Ia&&(u=v.prop(g=T));else if(g===Ca)if(w.value===""+y)u=v.prop(T);else break a;u===c&&(u=(u=Qa[g])?v[u]():v.attr(g))}this._val=
u}}if(h&&h.error!==c)h=h.error;else if(k){h=h[0]?h:[h];e=d&&k.onUpdate&&!1===k.onUpdate(b,d,h);za(k,h);if(e||g===P){g===qa&&k.onBeforeLink&&k.onBeforeLink();pa(k,k.tagCtx);S(this,l,n);q.linkCtx=r;return}if(k._.chging)return;h=":"===k.tagName?x._cnvt(k.cvt,q,h[0]):x._tag(k,q,q.tmpl,h,!0)}else e._tag&&(h=(p=""===p?ya:p)?x._cnvt(p,q,h):x._tag(e._tag,q,q.tmpl,h,!0),k=this.tag,g=this.attr||g);f(h,this,g,k)&&d&&(s=q.hlp(C))&&s.call(this,b,d);k&&pa(k,k.tagCtx)}S(this,l,n);q.linkCtx=r}}function f(b,d,f,g){var h,
l,m,n,p,q,s=b!==c,t=d.data,y=g&&g.parentElem||d.elem,v=a(y),u=d.view;q=d._val;var x=u.ctx,w=u.linkCtx,z=g||f===qa;g&&(g.parentElem=g.parentElem||d.expr||g._elCnt?y:y.parentNode,l=g._prv,m=g._nxt);if(s){if(/^css-/.test(f))"visible"===d.attr&&(d=(y.currentStyle||db.call(e,y,"")).display,b?(b=y._jsvd||d,b!==P||(b=ab[h=y.nodeName])||(d=ka.createElement(h),ka.body.appendChild(d),b=ab[h]=(d.currentStyle||db.call(e,d,"")).display,ka.body.removeChild(d))):(y._jsvd=d,b=P)),(z=z||q!==b)&&a.style(y,f.slice(4),
b);else if("link"!==f){if(f===T)p=1,b=b&&"false"!==b;else if(f===Ca)if(y.value===""+b)b=!0,p=1,f=T;else{S(d,t,y);return}else if("selected"===f||"disabled"===f||"multiple"===f||"readonly"===f)b=b&&"false"!==b?f:null;if(h=Qa[f])if(f===qa){u.linkCtx=d;u.ctx=d.ctx;if(g&&g._.inline){f=g.nodes(!0);if(g._elCnt){if(l&&l!==m)r(l,m,y,g._tgId,"^",!0);else if(n=y._dfr)q=g._tgId+"^",h=n.indexOf("#"+q)+1,p=n.indexOf("/"+q),h&&0<p&&(h+=q.length,p>h&&(y._dfr=n.slice(0,h)+n.slice(p),D(n.slice(h,p))));l=l?l.previousSibling:
m?m.previousSibling:y.lastChild}a(f).remove();if(g&&g.onBeforeLink)g.onBeforeLink();n=u.link(u.data,y,l,m,b,g&&{tag:g._tgId,lazyLink:g.tagCtx.props.lazyLink})}else{s&&v.empty();if(g&&g.onBeforeLink)g.onBeforeLink();s&&(n=u.link(t,y,l,m,b,g&&{tag:g._tgId}))}u.linkCtx=w;u.ctx=x}else{if(z=z||q!==b)if("text"===f&&y.children&&!y.children[0])y.textContent!==c?y.textContent=b:y.innerText=null===b?"":b;else v[h](b)}else if(z=z||q!==b)v[p?"prop":"attr"](f,b!==c||p?b:null);d._val=b}return n||z}if(f===qa&&g&&
g.onBeforeLink)g.onBeforeLink()}function g(a,b){var c=this.hlp(O),d=this.hlp(C);if(!c||!1!==c.call(this,a,b)){if(b){var c=b.index,e=b.items;switch(b.change){case "insert":this.addViews(c,e);break;case "remove":this.removeViews(c,e.length);break;case "move":this.refresh();break;case "refresh":this.refresh()}}d&&d.call(this,a,b)}}function h(b){var d,e=b.data,f=b._.bnd;if(!b._.useKey&&f){if(d=b._.bndArr)a([d[1]]).off(Q,d[0]),b._.bndArr=c;f!==!!f&&f._.inline?e?f._.arrVws[b._.id]=b:delete f._.arrVws[b._.id]:
e&&(d=function(a){a.data&&a.data.off||g.apply(b,arguments)},a([e]).on(Q,d),b._.bndArr=[d,e])}}function m(a,b,c){var d=a.nodeName.toLowerCase(),e=R.merge[d]||a.contentEditable===ya&&{to:qa,from:qa};return e?b?"input"===d&&a.type===Ca?Ca:e.to:e.from:b?c?"text":qa:""}function ta(b,d,e,g,f,h,k){var l,m,n,p=b.parentElem,q=b._prv,s=b._nxt,t=b._elCnt;q&&q.parentNode!==p&&U("Missing parentNode");if(k)for(n in m=b.nodes(),t&&q&&q!==s&&r(q,s,p,b._.id,"_",!0),b.removeViews(c,c,!0),g=s,t&&(q=q?q.previousSibling:
s?s.previousSibling:p.lastChild),a(m).remove(),b._.bnds)V(n);else{if(d){l=g[d-1];if(!l)return!1;q=l._nxt}t?q=(g=q)?g.previousSibling:p.lastChild:g=q.nextSibling}d=e.render(f,h,b._.useKey&&k,b,k||d,!0);b.link(f,p,q,g,d,l)}function Ja(a,b,d){var e;d?(e="^`",b=b._.tag||{_:{inline:!0,bnd:d},tagCtx:{view:b},flow:!0},d=b._tgId,d||(Da[d=bb++]=b,b._tgId=""+d)):(e="_`",la[d=b._.id]=b);return"#"+d+e+(a!=c?a:"")+"/"+d+e}function S(a,b,d){var e,g=a.tag,f=a.convertBack,h=[],k=a._bndId||""+bb++,l=a._hdlr;delete a._bndId;
g&&(h=g.depends||h,h=ha(h)?g.depends(g):h,e=g.linkedElem);if(!a._depends||""+a._depends!==""+h)if(a._depends&&Z._apply(!1,[b],a._depends,l,!0),b=Z._apply(!1,[b],a.fn.paths,h,l,a._ctxCb),b.elem=d,b.linkCtx=a,b._tgId=k,d._jsvBnd=d._jsvBnd||"",d._jsvBnd+="&"+k,a._depends=h,a.view._.bnds[k]=k,Da[k]=b,e&&(b.to=[[],f]),(e||f!==c)&&sa(b,g&&g.convertBack||f),g){if(g.onAfterBind)g.onAfterBind(b);g.flow||g._.inline||(d.setAttribute(ga,(d.getAttribute(ga)||"")+"#"+k+"^/"+k+"^"),g._tgId=""+k)}if(e&&e[0])for(g._.radio&&
(e=e.children("input[type=radio]")),a=e.length;a--;)e[a]._jsvBnd=e[a]._jsvBnd||d._jsvBnd+"+",e[a]._jsvLnkdEl=g}function aa(a,b,c,d,e,g,f){return ba(this,a,b,c,d,e,g,f)}function ba(b,e,g,f,h,k,l,m){if(b&&e){e=e.jquery?e:a(e);A||(A=ka.body,a(A).on(t,d).on("blur","[contenteditable]",d));for(var n,q,s,r,y,v,u,x=Ja,w=f&&"replace"===f.target,D=e.length;D--;)if(u=e[D],""+b===b)y=H(u),n=y.ctx,y.ctx=f,p(b,u,y,g),y.ctx=n;else{k=k||H(u);if(b.markup!==c)!1===k.link&&(f=f||{},f.link=x=!1),w&&(v=u.parentNode),
s=b.render(g,f,h,k,c,x),v?(l=u.previousSibling,m=u.nextSibling,a.cleanData([u],!0),v.removeChild(u),u=v):(l=m=c,a(u).empty());else if(!0!==b)break;if(u._dfr&&!m){r=z(u._dfr,1,cb);n=0;for(q=r.length;n<q;n++)y=r[n],(y=la[y.id])&&y.data!==c&&y.parent.removeViews(y._.key,c,!0);u._dfr=""}k.link(g,u,l,m,s,c,f)}}return e}function q(b,d,e,f,k,m,n,q){function s(a,b,d,e,f,g,h,B,l,ja,va,m,n){var X,p="";if(n)return y=0,a;u=B||l||"";e=e||ja;d=d||m;ma&&!d&&(e||u||g)&&(ma=c,Aa=ra.shift());if(e=e||d)y=0,ma=c,ha&&
(d||m?Va[Aa]||/;svg;|;math;/.test(";"+ra.join(";")+";")||(X="'<"+Aa+".../"):Va[e]?X="'</"+e:ra.length&&e===Aa||(X="Mismatch: '</"+e),X&&Sa(X+">' in:\n"+k)),qa=Ba,Aa=ra.shift(),Ba=Ua[Aa],ja=ja?"</"+ja+">":"",qa&&(xa+=W,W="",Ba?xa+="-":(p=ja+Ya+"@"+xa+Xa+(va||""),xa=Ga.shift()));Ba?(g?W+=g:b=ja||m||"",u&&(b+=u,W&&(b+=" "+ga+'="'+W+'"',W=""))):b=g?b+p+f+Ya+g+Xa+h+u:p||a;y&&g&&Sa(" No {^{ tags within elem markup ("+y+' ). Use data-link="..."');u&&(y=u,ra.unshift(Aa),Aa=u.slice(1),ra[0]&&ra[0]===ib[Aa]&&
U("Parent of <tr> must be <tbody>"),ma=Va[Aa],(Ba=Ua[Aa])&&!qa&&(Ga.unshift(xa),xa=""),qa=Ba,xa&&Ba&&(xa+="+"));return b}function r(a,b){var e,f,k,B,va=[];if(a){"@"===a._tkns.charAt(0)&&(b=J.previousSibling,J.parentNode.removeChild(J),J=c);for(E=a.length;E--;){G=a[E];k=G.ch;if(e=G.path)for(C=e.length-1;f=e.charAt(C--);)"+"===f?"-"===e.charAt(C)?(C--,b=b.previousSibling):b=b.parentNode:b=b.lastChild;if("^"===k){if(u=Da[e=G.id]){f=b&&(!J||J.parentNode!==b);if(!J||f)u.parentElem=b;G.elCnt&&f&&(b._dfr=
(G.open?"#":"/")+e+k+(b._dfr||""));va.push([f?null:J,G])}}else if(A=la[e=G.id])(A.parentElem||(A.parentElem=b||J&&J.parentNode||d,A._.onRender=Ja,A._.onArrayChange=g,h(A)),f=A.parentElem,G.open)?(A._elCnt=G.elCnt,b?b._dfr="#"+e+k+(b._dfr||""):(A._prv||(f._dfr=l(f._dfr,"#"+e+k)),A._prv=J)):(!b||J&&J.parentNode===b?J&&(A._nxt||(f._dfr=l(f._dfr,"/"+e+k)),A._nxt=J):(b._dfr="/"+e+k+(b._dfr||""),A._nxt=c),w=A.linkCtx,(B=A.ctx&&A.ctx.onAfterCreate||Ia)&&B.call(w,A))}for(E=va.length;E--;)ua.push(va[E])}return!a||
a.elCnt}function t(a){var b,c;if(a)for(E=a.length,C=0;C<E;C++)if(G=a[C],P.id)P.id=P.id!==G.id&&P.id;else if(c=u=Da[G.id].linkCtx.tag,!u.flow){if(!aa){for(b=1;c=c.parent;)b++;fa=fa||b}!aa&&b!==fa||ba&&u.tagName!==ba||Z.push(u)}}function x(){I=Ta?d.querySelectorAll(N):a(N,d).get();F=I.length;e&&e.innerHTML&&(O=Ta?e.querySelectorAll(N):a(N,e).get(),e=O.length?O[O.length-1]:e);for(D=fa=0;D<F;D++)if(J=I[D],e&&!za)za=J===e;else if(f&&J===f)break;else J.parentNode&&Ha(z(J,c,Z&&nb))&&!P&&J.getAttribute(M)&&
ua.push([J]);wa===Fa&&k===c&&d.getAttribute(M)&&ua.push([d]);da(e,Ba);da(f,Ba);if(!P){if(Ba&&xa+W&&(J=f,xa&&(f?r(z(xa+"+",1),f):r(z(xa,1),d)),r(z(W,1),d),f)){T=f.getAttribute(ga);if(F=T.indexOf(ta)+1)T=T.slice(F+ta.length-1);f.setAttribute(ga,W+T)}F=ua.length;for(D=0;D<F;D++)if(J=ua[D],L=J[1],J=J[0],L){if(u=Da[L.id]){if(w=u.linkCtx)u=w.tag,u.linkCtx=w;L.open?(J&&(u.parentElem=J.parentNode,u._prv=J),u._elCnt=L.elCnt,!u||u.onBeforeLink&&!1===u.onBeforeLink()||u._.bound||(u._.bound=!0,A=u.tagCtx.view,
p(c,u._prv,A,b,L.id)),u._.linking=!0):(u._nxt=J,u._.linking&&(ea=u.tagCtx,A=ea.view,delete u._.linking,u._.bound||(u._.bound=!0,p(c,u._prv,A,b,L.id)),pa(u,ea)))}}else A=H(J),p(J.getAttribute(M),J,A,b,c,n)}sa&&sa.resolve()}var y,w,u,D,F,C,E,I,J,A,G,L,O,K,S,V,Q,Z,aa,ba,ea,ha,fa,P,ia,ca,Aa,ma,na,T,Ba,qa,W,ta,za,sa,wa=this,Ca=wa._.id+"_",xa="",ua=[],ra=[],Ga=[],Ia=wa.hlp(Ea),Ha=r;m&&(sa=m.lazyLink&&a.Deferred(),m.tmpl?S="/"+m._.id+"_":(P=m.get,m.tag&&(Ca=m.tag+"^",m=!0)),m=!0===m);P&&(Ha=t,Z=P.tags,aa=
P.deep,ba=P.name);d=d?""+d===d?a(d)[0]:d.jquery?d[0]:d:wa.parentElem||ka.body;ha=!R.noValidate&&d.contentEditable!==ya;Aa=d.tagName.toLowerCase();Ba=!!Ua[Aa];e=e&&oa(e,Ba);f=f&&oa(f,Ba)||null;if(k!=c){na=ia=ka.createElement("div");ta=W="";ca="http://www.w3.org/2000/svg"===d.namespaceURI?"svg_ns":(K=gb.exec(k))&&K[1]||"";v&&K&&K[2]&&U("Unsupported: "+K[2]);if(Ba){for(Q=f;Q&&!(V=z(Q));)Q=Q.nextSibling;if(T=V?V._tkns:d._dfr){K=S||"";if(m||!S)K+="#"+Ca;C=T.indexOf(K);C+1&&(C+=K.length,ta=W=T.slice(0,
C),T=T.slice(C),V?Q.setAttribute(ga,T):d._dfr=T)}}ma=c;k=(""+k).replace(kb,s);ha&&ra.length&&Sa("Mismatched '<"+Aa+"...>' in:\n"+k);if(q)return;$a.appendChild(ia);ca=Y[ca]||Y.div;m=ca[0];for(na.innerHTML=ca[1]+k+ca[2];m--;)na=na.lastChild;$a.removeChild(ia);for(ia=ka.createDocumentFragment();ca=na.firstChild;)ia.appendChild(ca);d.insertBefore(ia,f)}sa?setTimeout(x,0):x();return sa&&sa.promise()}function p(b,d,e,f,g,h){var k,l,p,q,r,t,y,v;f=e.data===c?f||{}:e.data;if(g)h=Da[g],h=h.linkCtx?h.linkCtx.tag:
h,y=h.linkCtx||{data:f,elem:h._elCnt?h.parentElem:d,view:e,ctx:e.ctx,attr:qa,fn:h._.bnd,tag:h,_bndId:g},n(y,y.fn);else if(b&&d)for(k=e.tmpl,p=m(d),b=a.trim(b).replace(hb,"\\$&"),b=b.slice(-1)!==ma?F+":"+b+(p?":":"")+ma:b,s.lastIndex=0;l=s.exec(b);)v=s.lastIndex,p=g?qa:l[1],t=l[3],r=l[10],q=c,y={data:f,elem:d,view:e,ctx:h||e.ctx,attr:p,_initVal:!l[2]},l[6]&&(!p&&(q=/:([\w$]*)$/.exec(r))&&(q=q[1],q!==c&&(r=-q.length-1,t=t.slice(0,r-1)+ma)),null===q&&(q=c),y.convert=l[5]||""),y.expr=p+t,(l=k.links[t])||
(k.links[t]=l=G.tmplFn(t,k,!0,q)),y.fn=l,p||q===c||(y.convertBack=q),n(y,l),s.lastIndex=v}function n(a,c){function d(e,f){b.call(a,e,f,c)}d.noArray=!0;a._ctxCb=ra(a.view);a._hdlr=d;d(!0)}function l(a,b){var c;return a?(c=a.indexOf(b),c+1?a.slice(0,c)+a.slice(c+b.length):a):""}function ca(a){return a&&(""+a===a?a:"SCRIPT"===a.tagName?a.type.slice(3):1===a.nodeType&&a.getAttribute(ga)||"")}function z(a,b,c){function d(a,b,c,g,h,k){f.push({elCnt:e,id:g,ch:h,open:b,close:c,path:k,token:a})}var e,f=[];
if(b=b?a:ca(a))return f.elCnt=!a.type,e="@"===b.charAt(0)||!a.type,f._tkns=b,b.replace(c||ob,d),f}function da(a,b){a&&("jsv"===a.type?a.parentNode.removeChild(a):b&&""===a.getAttribute(M)&&a.removeAttribute(M))}function oa(a,b){for(var c=a;b&&c&&1!==c.nodeType;)c=c.previousSibling;c&&(1!==c.nodeType?(c=ka.createElement("SCRIPT"),c.type="jsv",a.parentNode.insertBefore(c,a)):ca(c)||c.getAttribute(M)||c.setAttribute(M,""));return c}function pa(b,d){var e,f,g,h,k,l,m;e=d.view;var n=b.linkCtx=b.linkCtx||
{tag:b,data:e.data,view:e,ctx:e.ctx};if(b.onAfterLink)b.onAfterLink(d,n);if(f=(e=b.targetTag?b.targetTag.linkedElem:b.linkedElem)&&e[0]){if(g=b._.radio)e=e.children("input[type=radio]");if(g||!b._.chging){h=G.cvt(b,b.convert)[0];if(g||f!==n.elem){for(m=e.length;m--;){f=e[m];k=f._jsvLnkdEl;if(b._.inline&&(!k||k!==b&&k.targetTag!==b))for(f._jsvLnkdEl=b,k=n.elem?n.elem._jsvBnd:b._prv._jsvBnd,f._jsvBnd=k+"+",k=k.slice(1).split("&"),l=k.length;l--;)sa(Da[k[l]],b.convertBack);g&&(f[T]=h===f.value)}n._val=
h}h!==c&&(g||f.value===c?f.contentEditable===ya&&(f.innerHTML=h):f.type===Ia?f[T]=h&&"false"!==h:e.val(h))}}if(f=f||":"===b.tagName&&n.elem)g=f._jsvTr,h=d.props.trigger,g!==h&&(f._jsvTr=h,e=e||a(f),W(e,g,"off"),W(e,h,"on"))}function La(a){setTimeout(function(){d(a)},0)}function W(a,b,c){b&&a[c](!0===b?"keydown":b,!0===b?La:d)}function sa(a,b){var c,d,e,f,g,h=a.linkCtx,k=h.data,l=h.fn.paths;if(a){if(c=l._jsvto)l=c;for(d=l.length;d&&""+(f=l[--d])!==f;);!f||h.tag&&!h.tag.tagCtx.args.length?a.to=[[],
b]:(f=f.split("^").join("."),a.to="."===f.charAt(0)?[[g=l[d-1],f.slice(1)],b]:[h._ctxCb(e=d?l[0].split("^").join("."):f)||[k,e],b],c&&g&&(a.to[0][0]=h._ctxCb(g,k)))}}function za(b,c){var d,e;d=b.tagCtx.view;var f=b.tagCtxs||[b.tagCtx],g=f.length,h=!c;for(c=c||b._.bnd.call(d.tmpl,(b.linkCtx||d).data,d,x);g--;)d=f[g],e=c[g],a.observable(d.props).setProperty(e.props),fa(d.ctx,e.ctx),d.args=e.args,h&&(d.tmpl=e.tmpl);return f}function ua(a){for(var b,c,d=[],e=b=a.length;e--;)d.push(a[e]);for(e=b;e--;)if(b=
d[e],b.parentNode){if(c=b._jsvBnd)for(c=c.slice(1).split("&"),b._jsvBnd="",a=c.length;a--;)V(c[a],b._jsvLnkdEl,b);D(ca(b)+(b._dfr||""))}}function V(b,d,e){var f,g,h,k=Da[b];if(d)e===d.linkedElem[0]&&(delete e._jsvLnkdEl,delete d.linkedElem);else if(k){delete Da[b];for(f in k.bnd)d=k.bnd[f],e=".obs"+k.cbId,a.isArray(d)?a([d]).off(Q+e).off(L+e):a(d).off(L+e),delete k.bnd[f];if(f=k.linkCtx){if(d=f.tag){if(e=d.tagCtxs)for(g=e.length;g--;)(h=e[g].map)&&h.unmap();if(g=(e=(h=d.linkedElem)&&h[0]||f.elem)&&
e._jsvTr)W(h||a(e),g,"off"),e._jsvTr=c;if(d.onDispose)d.onDispose();d._elCnt||(d._prv&&d._prv.parentNode.removeChild(d._prv),d._nxt&&d._nxt.parentNode.removeChild(d._nxt))}delete f.view._.bnds[b]}delete G._cbBnds[k.cbId]}}function na(b,e){b===c?(A&&(a(A).off(t,d).off("blur","[contenteditable]",d),A=c),b=!0,Fa.removeViews(),ua(ka.body.getElementsByTagName("*"))):e&&!0===b&&(e=e.jquery?e:a(e),e.each(function(){for(var a;(a=H(this,!0))&&a.parent;)a.parent.removeViews(a._.key,c,!0);ua(this.getElementsByTagName("*"));
ua([this])}));return e}function ia(a,b){return na(this,a,b)}function ra(b){b=b||a.view();return function(a,c){var d,e,f=[c];if(b&&a){if(a._jsvOb)return a._jsvOb.call(b.tmpl,c,b,x);if("~"===a.charAt(0)){if("~tag"===a.slice(0,4)&&(e=b.ctx,"."===a.charAt(4)&&(d=a.slice(5).split("."),e=e.tag),d))return e?[e,d.join("."),c]:[];a=a.slice(1).split(".");if(c=b.hlp(a.shift()))a.length&&f.unshift(a.join(".")),f.unshift(c);return c?f:[]}if("#"===a.charAt(0))return"#data"===a?[]:[b,a.replace(jb,""),c]}}}function Ga(a){return a.type===
Ia?a[T]:a.value}function r(a,b,c,d,e,f){var g,h,k,m,n,p,q=0,r=a===b;if(a){k=z(a)||[];g=0;for(h=k.length;g<h;g++){m=k[g];p=m.id;if(p===d&&m.ch===e)if(f)h=0;else break;r||(n="_"===m.ch?la[p]:Da[p].linkCtx.tag,m.open?n._prv=b:m.close&&(n._nxt=b));q+=p.length+2}q&&a.setAttribute(ga,a.getAttribute(ga).slice(q));a=b?b.getAttribute(ga):c._dfr;if(h=a.indexOf("/"+d+e)+1)a=k._tkns.slice(0,q)+a.slice(h+(f?-1:d.length+1));a&&(b?b.setAttribute(ga,a):c._dfr=a)}else c._dfr=l(c._dfr,"#"+d+e),f||b||(c._dfr=l(c._dfr,
"/"+d+e))}function D(a){var b,d,e;if(e=z(a,1,lb))for(a=0,b=e.length;a<b;a++)d=e[a],"_"===d.ch?(d=la[d.id])&&d.data!==c&&d.parent.removeViews(d._.key,c,!0):V(d.id)}function K(b,c,d){switch(d.change){case "set":b=b.tgt;for(c=b.length;c--&&b[c].key!==d.path;);-1===c?d.path&&a.observable(b).insert({key:d.path,prop:d.value}):d.remove?a.observable(b).remove(c):a.observable(b[c]).setProperty("prop",d.value)}}function w(b,c,d){b=b.src;switch(d.change){case "set":"prop"===d.path?a.observable(b).setProperty(c.target.key,
d.value):(a.observable(b).setProperty(d.oldValue,null),delete b[d.oldValue],a.observable(b).setProperty(d.value,c.target.prop));break;case "remove":c=d.items[0];a.observable(b).removeProperty(c.key);delete b[c.key];break;case "insert":c=d.items[0],c.key&&a.observable(b).setProperty(c.key,c.prop)}}function I(a,b,c){return 0>c.indexOf(".")&&b[a]}var A,H,s,F,ma,ea,v,U,M,E,N,Y,Fa,la,ka=e.document,x=a.views,G=x.sub,R=x.settings,fa=G.extend,ha=a.isFunction,Ma=x.converters,wa=x.tags,Z=a.observable,Ha=Z.observe,
ga="data-jsv",L=G.propChng=G.propChng||"propertyChange",Q=G.arrChng=G.arrChng||"arrayChange",t="change.jsv",O="onBeforeChange",C="onAfterChange",Ea="onAfterCreate",T="checked",Ia="checkbox",Ca="radio",P="none",ya="true",Xa='">\x3c/script>',Ya='<script type="jsv',Pa="script,["+ga+"]",qa="html",Qa={value:"val",input:"val",html:qa,text:"text"},Za={from:"value",to:"value"},Ra=0,eb=a.cleanData,fb=R.delimiters,Sa=G.syntaxErr,gb=/<(?!script)(\w+)(?:[^>]*(on\w+)\s*=)?[^>]*>/,hb=/['"\\]/g,$a=ka.createDocumentFragment(),
Ta=ka.querySelector,Ua={ol:1,ul:1,table:1,tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1,svg:1,svg_ns:1},ib={tr:"table"},Va={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,param:1,source:1,track:1,wbr:1},ab={},Da={},bb=1,jb=/^#(view\.?)?/,kb=/(^|(\/>)|<\/(\w+)>|)(\s*)([#\/]\d+[_^])`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|<\/(\w+)>(\s*)|(\/>)\s*|(>))/g,cb=/(#)()(\d+)(_)/g,lb=/(#)()(\d+)([_^])/g,mb=/(?:(#)|(\/))(\d+)(_)/g,nb=/(#)()(\d+)(\^)/g,
ob=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g,db=e.getComputedStyle;if(!a)throw"JsViews requires jQuery";if(!a.views)throw"JsViews requires JsRender";if(!a.observable)throw"JsViews requires jquery.observable";a.link||(E={contents:function(b,d){b!==!!b&&(d=b,b=c);var e,f=a(this.nodes());f[0]&&(e=d?f.filter(d):f,f=b&&d?e.add(f.find(d)):e);return f},nodes:function(a,b,c){var d=this._elCnt,e=!b&&d,f=[];b=b||this._prv;c=c||this._nxt;for(b=e?b===this._nxt?this.parentElem.lastSibling:b:!1===this._.inline?b||
this.linkCtx.elem.firstChild:b&&b.nextSibling;b&&(!c||b!==c);)(a||d||"SCRIPT"!==b.tagName)&&f.push(b),b=b.nextSibling;return f},childTags:function(a,b){a!==!!a&&(b=a,a=c);var d=this.link?this:this.tagCtx.view,e=this._prv,f=this._elCnt,g=[];e&&d.link(c,this.parentElem,f?e.previousSibling:e,this._nxt,c,{get:{tags:g,deep:a,name:b,id:f&&this._tgId}});return g},refresh:function(a){var b,d=this.linkCtx,e=this.tagCtx.view;this.disposed&&U("Removed tag");a===c&&(a=x._tag(this,e,e.tmpl,za(this),!0));a+""===
a&&(b=this._.inline?qa:d.attr||m(this.parentElem,!0),b=f(a,d,b,this));pa(this,this.tagCtx);return b||this},update:function(a){var b=this.linkedElem;b&&d({target:b[0]},c,a)}},G.onStore.template=function(b,c){c.link=aa;c.unlink=ia;b&&(a.link[b]=function(){return aa.apply(c,arguments)},a.unlink[b]=function(){return ia.apply(c,arguments)})},G.onStore.tag=function(a,b){G._lnk(b)},G._lnk=function(a){return fa(a,E)},G.viewInfos=z,(R.delimiters=function(){var a=fb.apply(x,arguments);F=a[1];ma=a[2];ea=a[4];
s=RegExp("(?:^|\\s*)([\\w-]*)(\\"+ea+")?(\\"+F+G.rTag+"\\"+ma+")","g");return this})(),fa(G._lnk(G.View.prototype),{addViews:function(a,b,c){var d,e=b.length,f=this.views;if(!this._.useKey&&e&&(c=this.tmpl)&&(d=f.length+e,!1!==ta(this,a,c,f,b,this.ctx)))for(a+=e;a<d;a++)Z(f[a]).setProperty("index",a);return this},removeViews:function(b,d,e){function f(b){var d,g,k,l,n,p=m[b];if(p&&p.link){b=p._.id;e||(n=p.nodes());p.removeViews(c,c,!0);p.data=c;k=p._prv;l=p._nxt;g=p.parentElem;e||(p._elCnt&&r(k,l,
g,b,"_"),a(n).remove());if(!p._elCnt)try{k.parentNode.removeChild(k),l.parentNode.removeChild(l)}catch(q){}h(p);for(d in p._.bnds)V(d);delete la[b]}}var g,k,l=!this._.useKey,m=this.views;l&&(k=m.length);if(b===c)if(l){for(g=k;g--;)f(g);this.views=[]}else{for(g in m)f(g);this.views={}}else if(d===c&&(l?d=1:(f(b),delete m[b])),l&&d){for(g=b+d;g-- >b;)f(g);m.splice(b,d);if(k=m.length)for(;b<k;)Z(m[b]).setProperty("index",b++)}return this},refresh:function(a){var b=this.parent;b&&(ta(this,this.index,
this.tmpl,b.views,this.data,a,!0),h(this));return this},link:q}),la={0:Fa=new G.View(c,"top")},Ma.merge=function(a){var b,c=this.linkCtx._val||"",d=this.tagCtx.props.toggle;d&&(b=d.replace(/[\\^$.|?*+()[{]/g,"\\$&"),c=c.replace(RegExp("(\\s(?="+b+"$)|(\\s)|^)("+b+"(\\s|$))"),"$2"),a=c+(a?(c&&" ")+d:""));return a},wa("on",{attr:P,onAfterLink:function(b,d){for(var e,f,g=0,h=b.args,k=b.props.data,l=b.view,m=b.props.context;!ha(e=h[g++]););f=h.slice(g);h=h.slice(0,g-1);m||(m=(m=/^(.*)[\.^][\w$]+$/.exec(b.params.args.slice(-f.length-
1)[0]))&&G.tmplFn("{:"+m[1]+"}",l.tmpl,!0)(d.data,l));if(e){if(this._evs)this.onDispose();a(d.elem).on(this._evs=h[0]||"click",this._sel=h[1],k==c?null:k,this._hlr=function(a){return e.apply(m||d.data,[].concat(f,a,{change:a.type,view:l,linkCtx:d}))})}},onDispose:function(){a(this.parentElem).off(this._evs,this._sel,this._hlr)},flow:!0}),fa(wa["for"],{onArrayChange:function(a,b){var c,d=b.change;if(this.tagCtxs[1]&&("insert"===d&&a.target.length===b.items.length||"remove"===d&&!a.target.length||"refresh"===
d&&!b.oldItems.length!==!a.target.length))this.refresh();else for(c in this._.arrVws)c=this._.arrVws[c],c.data===a.target&&c._.onArrayChange.apply(c,arguments);a.done=!0},onAfterLink:function(){var b,c,d,e,f=this,g=f._ars||{},h=f.tagCtxs,k=h.length,l=f.selected||0;for(b=0;b<=l;b++)c=h[b],e=c.map?c.map.tgt:c.args.length?c.args[0]:c.view.data,(d=g[b])&&e!==d[0]&&(Ha(d[0],d[1],!0),delete g[b]),!g[b]&&a.isArray(e)&&(Ha(e,c=function(a,b){f.onArrayChange(a,b)}),g[b]=[e,c]);for(b=l+1;b<k;b++)if(d=g[b])Ha(d[0],
d[1],!0),delete g[b];f._ars=g},onDispose:function(){for(var a in this._ars)Ha(this._ars[a][0],this._ars[a][1],!0)}}),fa(wa["for"],E),fa(wa["if"],E),fa(wa.include,E),wa("props",{baseTag:wa["for"],dataMap:x.map({getTgt:wa.props.dataMap.getTgt,obsSrc:K,obsTgt:w,tgtFlt:I})}),fa(a,{view:x.view=H=function(b,d,e){d!==!!d&&(e=d,d=c);var f,g,h,k,l,m;m=0;l=ka.body;if(b&&b!==l&&1<Fa._.useKey&&(b=""+b===b?a(b)[0]:b.jquery?b[0]:b))if(d)for(m=Ta?b.querySelectorAll(Pa):a(Pa,b).get(),l=m.length,b=0;b<l;b++)for(f=
m[b],g=z(f,c,cb),h=0,k=g.length;h<k;h++){if(f=g[h],f=la[f.id])if(f=f&&e?f.get(!0,e):f)return f}else for(;b;){if(g=z(b,c,mb))for(l=g.length;l--;)if(f=g[l],f.open){if(1>m)return(f=la[f.id])&&e?f.get(e):f||Fa;m--}else m++;b=b.previousSibling||b.parentNode}return d?c:Fa},link:x.link=ba,unlink:x.unlink=na,cleanData:function(b){b.length&&Ra&&ua(b);eb.apply(a,arguments)}}),x.utility={validate:function(a){try{Fa.link(c,ka.createElement("div"),c,c,a,c,c,1)}catch(b){return b.message}}},fa(a.fn,{link:function(a,
b,c,d,e,f,g){return ba(a,this,b,c,d,e,f,g)},unlink:function(a){return na(a,this)},view:function(a){return H(this[0],a)}}),a.each([qa,"replaceWith","empty","remove"],function(b,c){var d=a.fn[c];a.fn[c]=function(){var a;Ra=1;try{a=d.apply(this,arguments)}finally{Ra=0}return a}}),fa(Fa,{tmpl:{links:{},tags:{}}}),Fa._.onRender=Ja,R({wrapMap:Y={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,
"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],svg_ns:[1,"<svg>","</svg>"],div:jQuery.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},linkAttr:M="data-link",merge:{input:{from:Ga,to:"value"},textarea:Za,select:Za,optgroup:{to:"label"}},jsrDbgMode:R.debugMode,debugMode:function(a){R.jsrDbgMode(a);a?e._jsv={views:la,bindings:Da}:delete e._jsv},jsv:function(){R.debugMode(R._dbgMode);
M=R.linkAttr;U=x._err;N=Pa+",["+M+"]";v=R.noDomLevel0;Y.optgroup=Y.option;Y.tbody=Y.tfoot=Y.colgroup=Y.caption=Y.thead;Y.th=Y.td}}))})(this,this.jQuery)}())},{}]},{},[1])(1)});
