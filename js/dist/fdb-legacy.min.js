!function(C){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=C();else if("function"==typeof define&&define.amd)define([],C);else{var d;"undefined"!=typeof window?d=window:"undefined"!=typeof global?d=global:"undefined"!=typeof self&&(d=self);d.ForerunnerDB=C()}}(function(){return function d(n,h,c){function a(b,k){if(!h[b]){if(!n[b]){var e="function"==typeof require&&require;if(!k&&e)return e(b,!0);if(g)return g(b,!0);e=Error("Cannot find module '"+b+"'");throw e.code="MODULE_NOT_FOUND",
e;}e=h[b]={exports:{}};n[b][0].call(e.exports,function(e){var u=n[b][1][e];return a(u?u:e)},e,e.exports,d,n,h,c)}return h[b].exports}for(var g="function"==typeof require&&require,b=0;b<c.length;b++)a(c[b]);return a}({1:[function(d,n,h){h=d("../lib/Core");d("../lib/CollectionGroup");d("../lib/View");d("../lib/Highchart");d("../lib/Persist");d("../lib/Document");d("../lib/Overview");d("../lib/OldView");d("../lib/OldView.Bind");n.exports=h},{"../lib/CollectionGroup":4,"../lib/Core":5,"../lib/Document":7,
"../lib/Highchart":8,"../lib/OldView":19,"../lib/OldView.Bind":18,"../lib/Overview":22,"../lib/Persist":24,"../lib/View":27}],2:[function(d,n,h){h=d("./Shared");d("./Path");d=function(c){var a;this._primaryKey="_id";this._keyArr=[];this._data=[];this._objLookup={};this._count=0;for(a in c)c.hasOwnProperty(a)&&this._keyArr.push({key:a,dir:c[a]})};h.addModule("ActiveBucket",d);h.synthesize(d.prototype,"primaryKey");d.prototype.qs=function(c,a,g,b){if(!a.length)return 0;for(var f=-1,k,e,l=0,u=a.length-
1;u>=l;){k=Math.floor((l+u)/2);if(f===k)break;f=a[k];void 0!==f&&(e=b(this,c,g,f),0<e&&(l=k+1),0>e&&(u=k-1));f=k}return 0<e?k+1:k};d.prototype._sortFunc=function(c,a,g,b){g=g.split(".:.");b=b.split(".:.");var f=c._keyArr,k=f.length,e,l,u;for(e=0;e<k;e++)if(l=f[e],u=typeof a[l.key],"number"===u&&(g[e]=Number(g[e]),b[e]=Number(b[e])),g[e]!==b[e]){if(1===l.dir)return c.sortAsc(g[e],b[e]);if(-1===l.dir)return c.sortDesc(g[e],b[e])}};d.prototype.insert=function(c){var a,g;a=this.documentKey(c);g=this._data.indexOf(a);
-1===g&&(g=this.qs(c,this._data,a,this._sortFunc));this._data.splice(g,0,a);this._objLookup[c[this._primaryKey]]=a;this._count++;return g};d.prototype.remove=function(c){var a;if(a=this._objLookup[c[this._primaryKey]])if(a=this._data.indexOf(a),-1<a)return this._data.splice(a,1),delete this._objLookup[c[this._primaryKey]],this._count--,!0;return!1};d.prototype.index=function(c){var a,g;a=this.documentKey(c);g=this._data.indexOf(a);-1===g&&(g=this.qs(c,this._data,a,this._sortFunc));return g};d.prototype.documentKey=
function(c){var a="",g=this._keyArr,b=g.length,f,k;for(f=0;f<b;f++)k=g[f],a&&(a+=".:."),a+=c[k.key];return a+=".:."+c[this._primaryKey]};d.prototype.count=function(){return this._count};d.prototype.sortAsc=function(c,a){return"string"===typeof c&&"string"===typeof a?c.localeCompare(a):c>a?1:c<a?-1:0};d.prototype.sortDesc=function(c,a){return"string"===typeof c&&"string"===typeof a?a.localeCompare(c):c>a?-1:c<a?1:0};h.finishModule("ActiveBucket");n.exports=d},{"./Path":23,"./Shared":26}],3:[function(d,
n,h){var c,a,g,b,f;h=d("./Shared");var k=function(e){this.init.apply(this,arguments)};k.prototype.init=function(e){this._primaryKey="_id";this._primaryIndex=new a("primary");this._primaryCrc=new a("primaryCrc");this._crcLookup=new a("crcLookup");this._name=e;this._data=[];this._groups=[];this._metrics=new c;this._deferQueue={insert:[],update:[],remove:[],upsert:[]};this._deferThreshold={insert:100,update:100,remove:100,upsert:100};this._deferTime={insert:1,update:1,remove:1,upsert:1};this._subsetOf(this)};
h.addModule("Collection",k);h.mixin(k.prototype,"Mixin.Common");h.mixin(k.prototype,"Mixin.Events");h.mixin(k.prototype,"Mixin.ChainReactor");h.mixin(k.prototype,"Mixin.CRUD");h.mixin(k.prototype,"Mixin.Constants");h.mixin(k.prototype,"Mixin.Triggers");c=d("./Metrics");a=d("./KeyValueStore");g=d("./Path");b=d("./Index");f=d("./Crc");d=h.modules.Core;k.prototype.crc=f;h.synthesize(k.prototype,"state");h.synthesize(k.prototype,"name");k.prototype.data=function(){return this._data};k.prototype.drop=
function(){if("dropped"!==this._state){if(this._db&&this._db._collection&&this._name){this.debug()&&console.log("Dropping collection "+this._name);this._state="dropped";this.emit("drop",this);delete this._db._collection[this._name];if(this._groups&&this._groups.length){var e=[],l;for(l=0;l<this._groups.length;l++)e.push(this._groups[l]);for(l=0;l<e.length;l++)this._groups[l].removeCollection(this)}delete this._primaryKey;delete this._primaryIndex;delete this._primaryCrc;delete this._crcLookup;delete this._name;
delete this._data;delete this._groups;delete this._metrics;return!0}}else return!0;return!1};k.prototype.primaryKey=function(e){return void 0!==e?(this._primaryKey!==e&&(this._primaryKey=e,this._primaryIndex.primaryKey(e),this.rebuildPrimaryKeyIndex()),this):this._primaryKey};k.prototype._onInsert=function(e,l){this.emit("insert",e,l)};k.prototype._onUpdate=function(e){this.emit("update",e)};k.prototype._onRemove=function(e){this.emit("remove",e)};h.synthesize(k.prototype,"db");k.prototype.setData=
function(e,l,b){if(e){var a=this._metrics.create("setData");a.start();l=this.options(l);this.preSetData(e,l,b);l.$decouple&&(e=this.decouple(e));e instanceof Array||(e=[e]);a.time("transformIn");e=this.transformIn(e);a.time("transformIn");var f=[].concat(this._data);this._dataReplace(e);a.time("Rebuild Primary Key Index");this.rebuildPrimaryKeyIndex(l);a.time("Rebuild Primary Key Index");a.time("Resolve chains");this.chainSend("setData",e,{oldData:f});a.time("Resolve chains");a.stop();this.emit("setData",
this._data,f)}b&&b(!1);return this};k.prototype.rebuildPrimaryKeyIndex=function(e){var l=e&&void 0!==e.$ensureKeys?e.$ensureKeys:!0;e=e&&void 0!==e.$violationCheck?e.$violationCheck:!0;var b,a,f,g=this._primaryIndex,k=this._primaryCrc,c=this._crcLookup,d=this._primaryKey,h;g.truncate();k.truncate();c.truncate();b=this._data;for(a=b.length;a--;){f=b[a];l&&this.ensurePrimaryKey(f);if(e){if(!g.uniqueSet(f[d],f))throw'ForerunnerDB.Collection "'+this.name()+'": Call to setData on collection failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: '+
f[this._primaryKey];}else g.set(f[d],f);h=JSON.stringify(f);k.set(f[d],h);c.set(h,f)}};k.prototype.ensurePrimaryKey=function(e){void 0===e[this._primaryKey]&&(e[this._primaryKey]=this.objectId())};k.prototype.truncate=function(){this.emit("truncate",this._data);this._data.length=0;this._primaryIndex=new a("primary");this._primaryCrc=new a("primaryCrc");this._crcLookup=new a("crcLookup");this.deferEmit("change",{type:"truncate"});return this};k.prototype.upsert=function(e,l){if(e){var b=this._deferQueue.upsert,
a=this._deferThreshold.upsert,f={},g;if(e instanceof Array){if(e.length>a)return this._deferQueue.upsert=b.concat(e),this.processQueue("upsert",l),{};f=[];for(b=0;b<e.length;b++)f.push(this.upsert(e[b]));l&&l();return f}e[this._primaryKey]?(g={},g[this._primaryKey]=e[this._primaryKey],this._primaryIndex.lookup(g)[0]?f.op="update":f.op="insert"):f.op="insert";switch(f.op){case "insert":f.result=this.insert(e);break;case "update":f.result=this.update(g,e)}return f}l&&l();return{}};k.prototype.update=
function(e,l,b){l=this.decouple(l);l=this.transformIn(l);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var a=this,f=this._metrics.create("update"),g,k,c=function(g){var k=a.decouple(g),c,d;if(a.willTrigger(a.TYPE_UPDATE,a.PHASE_BEFORE)||a.willTrigger(a.TYPE_UPDATE,a.PHASE_AFTER)){c={type:"update",query:a.decouple(e),update:a.decouple(l),options:a.decouple(b),op:f};if(!1===a.processTrigger(c,a.TYPE_UPDATE,a.PHASE_BEFORE,k)||a.willTrigger(a.TYPE_UPDATE,
a.PHASE_BEFORE)&&(d=a.updateObject(k,c.update,c.query,c.options,""))&&!1===a.processTrigger(c,a.TYPE_UPDATE,a.PHASE_AFTER,g,k))return!1;d=a.updateObject(g,c.update,c.query,c.options,"")}else d=a.updateObject(g,l,e,b,"");return d};f.start();f.time("Retrieve documents to update");g=this.find(e,{$decouple:!1});f.time("Retrieve documents to update");g.length&&(f.time("Update documents"),k=g.filter(c),f.time("Update documents"),k.length&&(f.time("Resolve chains"),this.chainSend("update",{query:e,update:l,
dataSet:g},b),f.time("Resolve chains"),this._onUpdate(k),this.deferEmit("change",{type:"update",data:k})));f.stop();return k||[]};k.prototype._replaceObj=function(e,l){var b;this._removeFromIndexes(e);for(b in e)e.hasOwnProperty(b)&&delete e[b];for(b in l)l.hasOwnProperty(b)&&(e[b]=l[b]);if(!this._insertIntoIndexes(e))throw'ForerunnerDB.Collection "'+this.name()+'": Primary key violation in update! Key violated: '+e[this._primaryKey];return!0};k.prototype.updateById=function(e,l){var b={};b[this._primaryKey]=
e;return this.update(b,l)};k.prototype.updateObject=function(e,l,b,a,f,k){l=this.decouple(l);f=f||"";"."===f.substr(0,1)&&(f=f.substr(1,f.length-1));this.decouple(e);var c=!1,d=!1,h,q,p,m;for(m in l)if(l.hasOwnProperty(m)){h=!1;if("$"===m.substr(0,1))switch(m){case "$key":case "$index":h=!0;break;default:h=!0,d=this.updateObject(e,l[m],b,a,f,m),c=c||d}if(this._isPositionalKey(m)&&(h=!0,m=m.substr(0,m.length-2),d=new g(f+"."+m),e[m]&&e[m]instanceof Array&&e[m].length)){q=[];for(p=0;p<e[m].length;p++)this._match(e[m][p],
d.value(b)[0])&&q.push(p);for(p=0;p<q.length;p++)d=this.updateObject(e[m][q[p]],l[m+".$"],b,a,f+"."+m,k),c=c||d}if(!h)if(k||"object"!==typeof l[m])switch(k){case "$inc":this._updateIncrement(e,m,l[m]);c=!0;break;case "$push":void 0===e[m]&&this._updateProperty(e,m,[]);if(e[m]instanceof Array){if(void 0!==l[m].$position&&l[m].$each instanceof Array)for(d=l[m].$position,h=l[m].$each.length,p=0;p<h;p++)this._updateSplicePush(e[m],d+p,l[m].$each[p]);else if(l[m].$each instanceof Array)for(h=l[m].$each.length,
p=0;p<h;p++)this._updatePush(e[m],l[m].$each[p]);else this._updatePush(e[m],l[m]);c=!0}else throw'ForerunnerDB.Collection "'+this.name()+'": Cannot push to a key that is not an array! ('+m+")";break;case "$pull":if(e[m]instanceof Array){q=[];for(p=0;p<e[m].length;p++)this._match(e[m][p],l[m])&&q.push(p);for(h=q.length;h--;)this._updatePull(e[m],q[h]),c=!0}break;case "$pullAll":if(e[m]instanceof Array)if(l[m]instanceof Array){if(q=e[m],h=q.length,0<h)for(;h--;){for(d=0;d<l[m].length;d++)q[h]===l[m][d]&&
(this._updatePull(e[m],h),h--,c=!0);if(0>h)break}}else throw'ForerunnerDB.Collection "'+this.name()+'": Cannot pullAll without being given an array of values to pull! ('+m+")";break;case "$addToSet":void 0===e[m]&&this._updateProperty(e,m,[]);if(e[m]instanceof Array){p=e[m];var n;q=p.length;var z;h=!0;n=a&&a.$addToSet;var y;l[m].$key?(d=!1,y=new g(l[m].$key),z=y.value(l[m])[0],delete l[m].$key):n&&n.key?(d=!1,y=new g(n.key),z=y.value(l[m])[0]):(z=JSON.stringify(l[m]),d=!0);for(n=0;n<q;n++)if(d){if(JSON.stringify(p[n])===
z){h=!1;break}}else if(z===y.value(p[n])[0]){h=!1;break}h&&(this._updatePush(e[m],l[m]),c=!0)}else throw'ForerunnerDB.Collection "'+this.name()+'": Cannot addToSet on a key that is not an array! (undefined)';break;case "$splicePush":void 0===e[m]&&this._updateProperty(e,m,[]);if(e[m]instanceof Array)if(d=l.$index,void 0!==d)delete l.$index,d>e[m].length&&(d=e[m].length),this._updateSplicePush(e[m],d,l[m]),c=!0;else throw'ForerunnerDB.Collection "'+this.name()+'": Cannot splicePush without a $index integer value!';
else throw'ForerunnerDB.Collection "'+this.name()+'": Cannot splicePush with a key that is not an array! ('+m+")";break;case "$move":if(e[m]instanceof Array)for(p=0;p<e[m].length;p++){if(this._match(e[m][p],l[m])){c=l.$index;if(void 0!==c)delete l.$index,this._updateSpliceMove(e[m],p,c),c=!0;else throw'ForerunnerDB.Collection "'+this.name()+'": Cannot move without a $index integer value!';break}}else throw'ForerunnerDB.Collection "'+this.name()+'": Cannot move on a key that is not an array! ('+m+
")";break;case "$mul":this._updateMultiply(e,m,l[m]);c=!0;break;case "$rename":this._updateRename(e,m,l[m]);c=!0;break;case "$unset":this._updateUnset(e,m);c=!0;break;case "$pop":if(e[m]instanceof Array)this._updatePop(e[m],l[m])&&(c=!0);else throw'ForerunnerDB.Collection "'+this.name()+'": Cannot pop from a key that is not an array! ('+m+")";break;default:e[m]!==l[m]&&(this._updateProperty(e,m,l[m]),c=!0)}else if(null!==e[m]&&"object"===typeof e[m])if(p=e[m]instanceof Array,q=l[m]instanceof Array,
p||q)if(!q&&p)for(p=0;p<e[m].length;p++)d=this.updateObject(e[m][p],l[m],b,a,f+"."+m,k),c=c||d;else e[m]!==l[m]&&(this._updateProperty(e,m,l[m]),c=!0);else d=this.updateObject(e[m],l[m],b,a,f+"."+m,k),c=c||d;else e[m]!==l[m]&&(this._updateProperty(e,m,l[m]),c=!0)}return c};k.prototype._isPositionalKey=function(e){return".$"===e.substr(e.length-2,2)};k.prototype._updateProperty=function(e,l,b){e[l]=b;this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+l+
'" for collection "'+this.name()+'"')};k.prototype._updateIncrement=function(e,l,b){e[l]+=b};k.prototype._updateSpliceMove=function(e,l,b){e.splice(b,0,e.splice(l,1)[0]);this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+l+'" to "'+b+'" for collection "'+this.name()+'"')};k.prototype._updateSplicePush=function(e,l,b){e.length>l?e.splice(l,0,b):e.push(b)};k.prototype._updatePush=function(e,l){e.push(l)};k.prototype._updatePull=function(e,l){e.splice(l,
1)};k.prototype._updateMultiply=function(e,l,b){e[l]*=b};k.prototype._updateRename=function(e,l,b){e[b]=e[l];delete e[l]};k.prototype._updateUnset=function(e,l){delete e[l]};k.prototype._updatePop=function(e,l){var b=!1;0<e.length&&(1===l?(e.pop(),b=!0):-1===l&&(e.shift(),b=!0));return b};k.prototype.remove=function(e,l,b){var a,f;if(e instanceof Array){a=[];for(b=0;b<e.length;b++)a.push(this.remove(e[b],{noEmit:!0}));(!l||l&&!l.noEmit)&&this._onRemove(a);return a}b=this.find(e,{$decouple:!1});if(b.length){for(var g=
0;g<b.length;g++)f=b[g],this._removeFromIndexes(f),a=this._data.indexOf(f),this._dataRemoveAtIndex(a),this.processTrigger(this.TYPE_REMOVE,this.PHASE_AFTER,f,{});this.chainSend("remove",{query:e,dataSet:b},l);(!l||l&&!l.noEmit)&&this._onRemove(b);this.deferEmit("change",{type:"remove",data:b})}return b};k.prototype.removeById=function(e){var b={};b[this._primaryKey]=e;return this.remove(b)};k.prototype.deferEmit=function(){var e=this,b;this._noEmitDefer||this._db&&(!this._db||this._db._noEmitDefer)?
this.emit.apply(this,arguments):(b=arguments,this._changeTimeout&&clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){e.debug()&&console.log("ForerunnerDB.Collection: Emitting "+b[0]);e.emit.apply(e,b)},100))};k.prototype.processQueue=function(e,b){var a=this._deferQueue[e],f=this._deferThreshold[e],g=this._deferTime[e];if(a.length){var c=this;a.length&&(a=a.length>f?a.splice(0,f):a.splice(0,a.length),this[e](a));setTimeout(function(){c.processQueue(e,b)},g)}else b&&b()};k.prototype.insert=
function(e,b,a){"function"===typeof b?(a=b,b=this._data.length):void 0===b&&(b=this._data.length);e=this.transformIn(e);return this._insertHandle(e,b,a)};k.prototype._insertHandle=function(e,b,a){var f=this._deferQueue.insert,g=this._deferThreshold.insert,c=[],k=[];if(e instanceof Array){if(e.length>g){this._deferQueue.insert=f.concat(e);this.processQueue("insert",a);return}for(g=0;g<e.length;g++)f=this._insert(e[g],b+g),!0===f?c.push(e[g]):k.push({doc:e[g],reason:f})}else f=this._insert(e,b),!0===
f?c.push(e):k.push({doc:e,reason:f});this.chainSend("insert",e,{index:b});this._onInsert(c,k);a&&a();this.deferEmit("change",{type:"insert",data:c});return{inserted:c,failed:k}};k.prototype._insert=function(e,b){if(e){var a;this.ensurePrimaryKey(e);if(a=this.insertIndexViolation(e))return"Index violation in index: "+a;this._insertIntoIndexes(e);b>this._data.length&&(b=this._data.length);this._dataInsertAtIndex(b,e);this.processTrigger(this.TYPE_INSERT,this.PHASE_AFTER,{},e);return!0}return"No document passed to insert"};
k.prototype._dataInsertAtIndex=function(e,b){this._data.splice(e,0,b)};k.prototype._dataRemoveAtIndex=function(e){this._data.splice(e,1)};k.prototype._dataReplace=function(e){for(;this._data.length;)this._data.pop();this._data=this._data.concat(e)};k.prototype._insertIntoIndexes=function(e){var b=this._indexByName,a,f,g=JSON.stringify(e);f=this._primaryIndex.uniqueSet(e[this._primaryKey],e);this._primaryCrc.uniqueSet(e[this._primaryKey],g);this._crcLookup.uniqueSet(g,e);for(a in b)b.hasOwnProperty(a)&&
b[a].insert(e);return f};k.prototype._removeFromIndexes=function(e){var b=this._indexByName,a,f=JSON.stringify(e);this._primaryIndex.unSet(e[this._primaryKey]);this._primaryCrc.unSet(e[this._primaryKey]);this._crcLookup.unSet(f);for(a in b)b.hasOwnProperty(a)&&b[a].remove(e)};k.prototype.indexOfDocById=function(e){return this._data.indexOf(this._primaryIndex.get(e[this._primaryKey]))};k.prototype.subset=function(e,b){var a=this.find(e,b);return(new k)._subsetOf(this).primaryKey(this._primaryKey).setData(a)};
k.prototype.subsetOf=function(){return this.__subsetOf};k.prototype._subsetOf=function(e){this.__subsetOf=e;return this};k.prototype.distinct=function(e,b,a){b=this.find(b,a);e=new g(e);a={};var f=[],c,k;for(k=0;k<b.length;k++)(c=e.value(b[k])[0])&&!a[c]&&(a[c]=!0,f.push(c));return f};k.prototype.findById=function(e,b){var a={};a[this._primaryKey]=e;return this.find(a,b)[0]};k.prototype.peek=function(e,b){var a=this._data,f=a.length,g,c,d=new k;if("string"===typeof e){for(g=0;g<f;g++)c=JSON.stringify(a[g]),
-1<c.indexOf(e)&&d.insert(a[g]);return d.find({},b)}return this.find(e,b)};k.prototype.explain=function(e,b){return this.find(e,b).__fdbOp._data};k.prototype.options=function(e){e=e||{};e.$decouple=void 0!==e.$decouple?e.$decouple:!0;e.$explain=void 0!==e.$explain?e.$explain:!1;return e};k.prototype.find=function(e,b){e=e||{};b=this.options(b);var a=this._metrics.create("find"),f=this,c,k=!0,d,h,s,q,p,m,n,z,y,A=[];h=function(b){return f._match(b,e,"and")};a.start();if(e){a.time("analyseQuery");c=
this._analyseQuery(e,b,a);a.time("analyseQuery");a.data("analysis",c);if(c.hasJoin&&c.queriesJoin){a.time("joinReferences");for(s=0;s<c.joinsOn.length;s++)p=c.joinsOn[s],q=new g(c.joinQueries[p]),q=q.value(e)[0],this._db.collection(c.joinsOn[s]).subset(q);a.time("joinReferences")}c.indexMatch.length&&(!b||b&&!b.$skipIndex)?(a.data("index.potential",c.indexMatch),a.data("index.used",c.indexMatch[0].index),a.time("indexLookup"),d=c.indexMatch[0].lookup,a.time("indexLookup"),c.indexMatch[0].keyData.totalKeyCount===
c.indexMatch[0].keyData.matchedKeyCount&&(k=!1)):a.flag("usedIndex",!1);k&&(d&&d.length?(c=d.length,a.time("tableScan: "+c),d=d.filter(h)):(c=this._data.length,a.time("tableScan: "+c),d=this._data.filter(h)),b.$orderBy&&(a.time("sort"),d=this.sort(b.$orderBy,d),a.time("sort")),a.time("tableScan: "+c));b.limit&&d&&d.length>b.limit&&(d.length=b.limit,a.data("limit",b.limit));b.$decouple&&(a.time("decouple"),d=this.decouple(d),a.time("decouple"),a.data("flag.decouple",!0));if(b.join){for(h=0;h<b.join.length;h++)for(p in b.join[h])if(b.join[h].hasOwnProperty(p))for(z=
p,c=this._db.collection(p),k=b.join[h][p],y=0;y<d.length;y++){n={};q=s=!1;for(m in k)if(k.hasOwnProperty(m))if("$"===m.substr(0,1))switch(m){case "$as":z=k[m];break;case "$multi":s=k[m];break;case "$require":q=k[m];break;default:m.substr(0,3)}else n[m]=(new g(k[m])).value(d[y])[0];n=c.find(n);!q||q&&n[0]?d[y][z]=!1===s?n[0]:n:A.push(d[y])}a.data("flag.join",!0)}if(A.length){a.time("removalQueue");for(m=0;m<A.length;m++)p=d.indexOf(A[m]),-1<p&&d.splice(p,1);a.time("removalQueue")}if(b.transform){a.time("transform");
for(m=0;m<d.length;m++)d.splice(m,1,b.transform(d[m]));a.time("transform");a.data("flag.transform",!0)}this._transformEnabled&&this._transformOut&&(a.time("transformOut"),d=this.transformOut(d),a.time("transformOut"));a.data("results",d.length);a.stop()}else a.stop(),d=[];d.__fdbOp=a;return d};k.prototype.indexOf=function(e){if(e=this.find(e,{$decouple:!1})[0])return this._data.indexOf(e)};k.prototype.transform=function(e){return void 0!==e?("object"===typeof e?(void 0!==e.enabled&&(this._transformEnabled=
e.enabled),void 0!==e.dataIn&&(this._transformIn=e.dataIn),void 0!==e.dataOut&&(this._transformOut=e.dataOut)):this._transformEnabled=!1===e?!1:!0,this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};k.prototype.transformIn=function(e){if(this._transformEnabled&&this._transformIn){if(e instanceof Array){var b=[],a;for(a=0;a<e.length;a++)b[a]=this._transformIn(e[a]);return b}return this._transformIn(e)}return e};k.prototype.transformOut=function(e){if(this._transformEnabled&&
this._transformOut){if(e instanceof Array){var b=[],a;for(a=0;a<e.length;a++)b[a]=this._transformOut(e[a]);return b}return this._transformOut(e)}return e};k.prototype.sort=function(e,b){b=b||[];var a=[],f,g;for(f in e)e.hasOwnProperty(f)&&(g={},g[f]=e[f],g.___fdbKey=f,a.push(g));return 2>a.length?this._sort(e,b):this._bucketSort(a,b)};k.prototype._bucketSort=function(e,b){var a=e.shift(),f,g,c=[];if(0<e.length){b=this._sort(a,b);f=this.bucket(a.___fdbKey,b);for(g in f)f.hasOwnProperty(g)&&(a=[].concat(e),
c=c.concat(this._bucketSort(a,f[g])));return c}return this._sort(a,b)};k.prototype._sort=function(e,b){var a,f=new g;a=f.parse(e,!0)[0];f.path(a.path);if(1===a.value)a=function(e,b){var a=f.value(e)[0],l=f.value(b)[0];return"string"===typeof a&&"string"===typeof l?a.localeCompare(l):a>l?1:a<l?-1:0};else if(-1===a.value)a=function(e,b){var a=f.value(e)[0],l=f.value(b)[0];return"string"===typeof a&&"string"===typeof l?l.localeCompare(a):a>l?-1:a<l?1:0};else throw'ForerunnerDB.Collection "'+this.name()+
'": $orderBy clause has invalid direction: '+a.value+", accepted values are 1 or -1 for ascending or descending!";return b.sort(a)};k.prototype.bucket=function(e,b){var a,f={};for(a=0;a<b.length;a++)f[b[a][e]]=f[b[a][e]]||[],f[b[a][e]].push(b[a]);return f};k.prototype._analyseQuery=function(e,b,a){var f={queriesOn:[this._name],indexMatch:[],hasJoin:!1,queriesJoin:!1,joinQueries:{},query:e,options:b},c,k=[],d=[],h,s,q,p,m;a.time("checkIndexes");void 0!==e[this._primaryKey]&&(a.time("checkIndexMatch: Primary Key"),
h=new g,f.indexMatch.push({lookup:this._primaryIndex.lookup(e,b),keyData:{matchedKeys:[this._primaryKey],matchedKeyCount:1,totalKeyCount:h.countKeys(e)},index:this._primaryIndex}),a.time("checkIndexMatch: Primary Key"));for(m in this._indexById)if(this._indexById.hasOwnProperty(m)&&(s=this._indexById[m],q=s.name(),a.time("checkIndexMatch: "+q),h=s.match(e,b),0<h.matchedKeyCount&&(p=s.lookup(e,b),f.indexMatch.push({lookup:p,keyData:h,index:s})),a.time("checkIndexMatch: "+q),h.totalKeyCount===h.matchedKeyCount))break;
a.time("checkIndexes");1<f.indexMatch.length&&(a.time("findOptimalIndex"),f.indexMatch.sort(function(b,e){return b.keyData.totalKeyCount===b.keyData.matchedKeyCount?-1:e.keyData.totalKeyCount===e.keyData.matchedKeyCount?1:b.keyData.matchedKeyCount===e.keyData.matchedKeyCount?b.lookup.length-e.lookup.length:e.keyData.matchedKeyCount-b.keyData.matchedKeyCount}),a.time("findOptimalIndex"));if(b.join){f.hasJoin=!0;for(a=0;a<b.join.length;a++)for(c in b.join[a])b.join[a].hasOwnProperty(c)&&(k.push(c),
"$as"in b.join[a][c]?d.push(b.join[a][c].$as):d.push(c));for(c=0;c<d.length;c++)if(b=this._queryReferencesCollection(e,d[c],""))f.joinQueries[k[c]]=b,f.queriesJoin=!0;f.joinsOn=k;f.queriesOn=f.queriesOn.concat(k)}return f};k.prototype._queryReferencesCollection=function(b,a,f){for(var c in b)if(b.hasOwnProperty(c)){if(c===a)return f&&(f+="."),f+c;if("object"===typeof b[c])return f&&(f+="."),f+=c,this._queryReferencesCollection(b[c],a,f)}return!1};k.prototype._match=function(b,a,f){var c,g;c=typeof b;
g=typeof a;var k=!0,d;if(!("string"!==c&&"number"!==c||"string"!==g&&"number"!==g))b!==a&&(k=!1);else for(d in a)if(a.hasOwnProperty(d)){c=!1;if("$"===d.substr(0,1)&&(g=this._matchOp(d,b,a),-1<g)){if(g){if("or"===f)return!0}else k=g;c=!0}if(!c&&a[d]instanceof RegExp)if(c=!0,"object"===typeof b&&void 0!==b[d]&&a[d].test(b[d])){if("or"===f)return!0}else k=!1;if(!c)if("object"===typeof a[d])if(void 0!==b[d]){if(b[d]instanceof Array&&!(a[d]instanceof Array))for(c=!1,g=0;g<b[d].length&&!(c=this._match(b[d][g],
a[d],void 0));g++);else if(!(b[d]instanceof Array)&&a[d]instanceof Array)for(c=!1,g=0;g<a[d].length&&!(c=this._match(b[d],a[d][g],void 0));g++);else c="object"===typeof b?this._match(b[d],a[d],void 0):this._match(void 0,a[d],void 0);if(c){if("or"===f)return!0}else k=!1}else if(a[d]&&void 0!==a[d].$exists)if(c=this._match(void 0,a[d],void 0)){if("or"===f)return!0}else k=!1;else k=!1;else if(b&&b[d]===a[d]){if("or"===f)return!0}else if(b&&b[d]&&b[d]instanceof Array&&a[d]&&"object"!==typeof a[d]){c=
!1;for(g=0;g<b[d].length&&!(c=this._match(b[d][g],a[d],void 0));g++);if(c){if("or"===f)return!0}else k=!1}else k=!1;if("and"===f&&!k)return!1}return k};k.prototype._matchOp=function(b,a,f){switch(b){case "$gt":return a>f[b];case "$gte":return a>=f[b];case "$lt":return a<f[b];case "$lte":return a<=f[b];case "$exists":return void 0===a!==f[b];case "$ne":return a!=f[b];case "$or":for(var c=0;c<f[b].length;c++)if(this._match(a,f[b][c],"and"))return!0;return!1;case "$and":for(c=0;c<f[b].length;c++)if(!this._match(a,
f[b][c],"and"))return!1;return!0;case "$in":if(f[b]instanceof Array){b=f[b];f=b.length;for(c=0;c<f;c++)if(b[c]===a)return!0;return!1}throw'ForerunnerDB.Collection "'+this.name()+'": Cannot use an $in operator on a non-array key: '+b;case "$nin":if(f[b]instanceof Array){b=f[b];f=b.length;for(c=0;c<f;c++)if(b[c]===a)return!1;return!0}throw'ForerunnerDB.Collection "'+this.name()+'": Cannot use a $nin operator on a non-array key: '+b;}return-1};k.prototype.count=function(b,a){return b?this.find(b,a).length:
this._data.length};k.prototype.findSub=function(b,a,f,c){var k=new g(a);b=this.find(b);var d=b.length,h,n,s=this._db.collection("__FDB_temp_"+this.objectId()),q={parents:d,subDocTotal:0,subDocs:[],pathFound:!1,err:""};for(h=0;h<d;h++)if(n=k.value(b[h])[0]){s.setData(n);n=s.find(f,c);if(c.returnFirst&&n.length)return n[0];q.subDocs.push(n);q.subDocTotal+=n.length;q.pathFound=!0}s.drop();if(c.noStats)return q.subDocs;q.pathFound||(q.err="No objects found in the parent documents with a matching path of: "+
a);return q};k.prototype.insertIndexViolation=function(b){var a,f=this._indexByName,c,g;if(this._primaryIndex.get(b[this._primaryKey]))a=this._primaryIndex;else for(c in f)if(f.hasOwnProperty(c)&&(g=f[c],g.unique()&&g.violation(b))){a=g;break}return a?a.name():!1};k.prototype.ensureIndex=function(a,f){this._indexByName=this._indexByName||{};this._indexById=this._indexById||{};var c=new b(a,f,this),g={start:(new Date).getTime()};if(this._indexByName[c.name()])return{err:"Index with that name already exists"};
if(this._indexById[c.id()])return{err:"Index with those keys already exists"};c.rebuild();this._indexByName[c.name()]=c;this._indexById[c.id()]=c;g.end=(new Date).getTime();g.total=g.end-g.start;this._lastOp={type:"ensureIndex",stats:{time:g}};return{index:c,id:c.id(),name:c.name(),state:c.state()}};k.prototype.index=function(b){if(this._indexByName)return this._indexByName[b]};k.prototype.lastOp=function(){return this._metrics.list()};k.prototype.diff=function(b){var a={insert:[],update:[],remove:[]},
f=this.primaryKey(),c,g,k,d;if(f===b.primaryKey()){for(c=b._data;c&&!(c instanceof Array);)b=c,c=b._data;d=c.length;for(g=0;g<d;g++)k=c[g],this._primaryIndex.get(k[f])?this._primaryCrc.get(k[f])!==b._primaryCrc.get(k[f])&&a.update.push(k):a.insert.push(k);c=this._data;d=c.length;for(g=0;g<d;g++)k=c[g],b._primaryIndex.get(k[f])||a.remove.push(k)}else throw'ForerunnerDB.Collection "'+this.name()+'": Collection diffing requires that both collections have the same primary key!';return a};d.prototype.collection=
function(b,a){if(b)return this._collection[b]||this.debug()&&console.log("Creating collection "+b),this._collection[b]=this._collection[b]||(new k(b)).db(this),void 0!==a&&this._collection[b].primaryKey(a),this._collection[b];throw'ForerunnerDB.Core "'+this.name()+'": Cannot get collection with undefined name!';};d.prototype.collectionExists=function(b){return Boolean(this._collection[b])};d.prototype.collections=function(b){var a=[],f;b&&(b instanceof RegExp||(b=RegExp(b)));for(f in this._collection)this._collection.hasOwnProperty(f)&&
(b?b.exec(f)&&a.push({name:f,count:this._collection[f].count()}):a.push({name:f,count:this._collection[f].count()}));return a};h.finishModule("Collection");n.exports=k},{"./Crc":6,"./Index":9,"./KeyValueStore":10,"./Metrics":11,"./Path":23,"./Shared":26}],4:[function(d,n,h){var c,a;h=d("./Shared");var g=function(){this.init.apply(this,arguments)};g.prototype.init=function(b){this._name=b;this._data=new a("__FDB__cg_data_"+this._name);this._collections=[];this._view=[]};h.addModule("CollectionGroup",
g);h.mixin(g.prototype,"Mixin.Common");h.mixin(g.prototype,"Mixin.ChainReactor");h.mixin(g.prototype,"Mixin.Constants");h.mixin(g.prototype,"Mixin.Triggers");a=d("./Collection");d=h.modules.Core;c=h.modules.Core.prototype.init;g.prototype.on=function(){this._data.on.apply(this._data,arguments)};g.prototype.off=function(){this._data.off.apply(this._data,arguments)};g.prototype.emit=function(){this._data.emit.apply(this._data,arguments)};g.prototype.primaryKey=function(b){return void 0!==b?(this._primaryKey=
b,this):this._primaryKey};h.synthesize(g.prototype,"state");h.synthesize(g.prototype,"db");g.prototype.addCollection=function(b){if(b&&-1===this._collections.indexOf(b)){if(this._collections.length){if(this._primaryKey!==b.primaryKey())throw'ForerunnerDB.CollectionGroup "'+this.name()+'": All collections in a collection group must have the same primary key!';}else this.primaryKey(b.primaryKey());this._collections.push(b);b._groups.push(this);b.chain(this);this._data.insert(b.find())}return this};
g.prototype.removeCollection=function(b){if(b){var a=this._collections.indexOf(b);-1!==a&&(b.unChain(this),this._collections.splice(a,1),a=b._groups.indexOf(this),-1!==a&&b._groups.splice(a,1));0===this._collections.length&&delete this._primaryKey}return this};g.prototype._chainHandler=function(b){switch(b.type){case "setData":b.data=this.decouple(b.data);this._data.remove(b.options.oldData);this._data.insert(b.data);break;case "insert":b.data=this.decouple(b.data);this._data.insert(b.data);break;
case "update":this._data.update(b.data.query,b.data.update,b.options);break;case "remove":this._data.remove(b.data.query,b.options)}};g.prototype.insert=function(){this._collectionsRun("insert",arguments)};g.prototype.update=function(){this._collectionsRun("update",arguments)};g.prototype.updateById=function(){this._collectionsRun("updateById",arguments)};g.prototype.remove=function(){this._collectionsRun("remove",arguments)};g.prototype._collectionsRun=function(b,a){for(var c=0;c<this._collections.length;c++)this._collections[c][b].apply(this._collections[c],
a)};g.prototype.find=function(b,a){return this._data.find(b,a)};g.prototype.removeById=function(b){for(var a=0;a<this._collections.length;a++)this._collections[a].removeById(b)};g.prototype.subset=function(b,f){var c=this.find(b,f);return(new a)._subsetOf(this).primaryKey(this._primaryKey).setData(c)};g.prototype.drop=function(){if("dropped"!==this._state){var b,a;this._debug&&console.log("Dropping collection group "+this._name);this._state="dropped";if(this._collections&&this._collections.length)for(a=
[].concat(this._collections),b=0;b<a.length;b++)this.removeCollection(a[b]);if(this._view&&this._view.length)for(a=[].concat(this._view),b=0;b<a.length;b++)this._removeView(a[b]);this.emit("drop",this)}return!0};d.prototype.init=function(){this._collectionGroup={};c.apply(this,arguments)};d.prototype.collectionGroup=function(b){return b?(this._collectionGroup[b]=this._collectionGroup[b]||(new g(b)).db(this),this._collectionGroup[b]):this._collectionGroup};d.prototype.collectionGroups=function(){var b=
[],a;for(a in this._collectionGroup)this._collectionGroup.hasOwnProperty(a)&&b.push({name:a});return b};n.exports=g},{"./Collection":3,"./Shared":26}],5:[function(d,n,h){var c,a,g;c=d("./Shared");g=d("./Overload");h=function(b){this.init.apply(this,arguments)};h.prototype.init=function(b){this._name=b;this._collection={};this._debug={};this._version="1.3.0"};h.prototype.moduleLoaded=g({string:function(b){if(void 0!==b){b=b.replace(/ /g,"");b=b.split(",");var a;for(a=0;a<b.length;a++)if(!c.modules[b[a]])return!1;
return!0}return!1},"string, function":function(b,a){if(void 0!==b){b=b.replace(/ /g,"");var g=b.split(","),e;for(e=0;e<g.length;e++)if(!c.modules[g[e]])return!1;a()}},"string, function, function":function(b,a,g){if(void 0!==b){b=b.replace(/ /g,"");b=b.split(",");var e;for(e=0;e<b.length;e++)if(!c.modules[b[e]])return g(),!1;a()}}});h.moduleLoaded=h.prototype.moduleLoaded;h.shared=c;h.prototype.shared=c;c.addModule("Core",h);c.mixin(h.prototype,"Mixin.Common");c.mixin(h.prototype,"Mixin.ChainReactor");
c.mixin(h.prototype,"Mixin.Constants");a=d("./Collection.js");d("./Metrics.js");d=d("./Crc.js");h.prototype._isServer=!1;c.synthesize(h.prototype,"state");c.synthesize(h.prototype,"name");h.prototype.isClient=function(){return!this._isServer};h.prototype.isServer=function(){return this._isServer};h.prototype.crc=d;h.prototype.isClient=function(){return!this._isServer};h.prototype.isServer=function(){return this._isServer};h.prototype.arrayToCollection=function(b){return(new a).setData(b)};h.prototype.on=
function(b,a){this._listeners=this._listeners||{};this._listeners[b]=this._listeners[b]||[];this._listeners[b].push(a);return this};h.prototype.off=function(b,a){if(b in this._listeners){var c=this._listeners[b],e=c.indexOf(a);-1<e&&c.splice(e,1)}return this};h.prototype.emit=function(b,a){this._listeners=this._listeners||{};if(b in this._listeners){var c=this._listeners[b],e=c.length,g;for(g=0;g<e;g++)c[g].apply(this,Array.prototype.slice.call(arguments,1))}return this};h.prototype.peek=function(b){var a,
c,e=[],g=typeof b;for(a in this._collection)this._collection.hasOwnProperty(a)&&(c=this._collection[a],e="string"===g?e.concat(c.peek(b)):e.concat(c.find(b)));return e};h.prototype.peekCat=function(b){var a,c,e={},g,d=typeof b;for(a in this._collection)this._collection.hasOwnProperty(a)&&(c=this._collection[a],(g="string"===d?c.peek(b):c.find(b))&&g.length&&(e[c.name()]=g));return e};h.prototype.drop=function(b){if("dropped"!==this._state){var a=this.collections(),c=a.length,e,g=0;this._state="dropped";
for(e=0;e<c;e++)this.collection(a[e].name).drop(function(){g++;g===c&&b&&b()}),delete this._collection[a[e].name];this.emit("drop",this)}return!0};n.exports=h},{"./Collection.js":3,"./Crc.js":6,"./Metrics.js":11,"./Overload":21,"./Shared":26}],6:[function(d,n,h){var c=function(){var a=[],c,b,f;for(b=0;256>b;b++){c=b;for(f=0;8>f;f++)c=c&1?3988292384^c>>>1:c>>>1;a[b]=c}return a}();n.exports=function(a){var g=-1,b;for(b=0;b<a.length;b++)g=g>>>8^c[(g^a.charCodeAt(b))&255];return(g^-1)>>>0}},{}],7:[function(d,
n,h){var c,a;h=d("./Shared");var g=function(){this.init.apply(this,arguments)};g.prototype.init=function(b){this._name=b;this._data={}};h.addModule("Document",g);h.mixin(g.prototype,"Mixin.Common");h.mixin(g.prototype,"Mixin.Events");h.mixin(g.prototype,"Mixin.ChainReactor");h.mixin(g.prototype,"Mixin.Constants");h.mixin(g.prototype,"Mixin.Triggers");d=d("./Collection");c=h.modules.Core;a=h.modules.Core.prototype.init;h.synthesize(g.prototype,"state");h.synthesize(g.prototype,"db");h.synthesize(g.prototype,
"name");g.prototype.setData=function(b){var a,c;if(b)if(b=this.decouple(b),this._linked){c={};for(a in this._data)"jQuery"!==a.substr(0,6)&&this._data.hasOwnProperty(a)&&void 0===b[a]&&(c[a]=1);b.$unset=c;this.updateObject(this._data,b,{})}else this._data=b;return this};g.prototype.update=function(b,a,c){this.updateObject(this._data,a,b,c)};g.prototype.updateObject=d.prototype.updateObject;g.prototype._isPositionalKey=function(b){return".$"===b.substr(b.length-2,2)};g.prototype._updateProperty=function(b,
a,c){this._linked?(jQuery.observable(b).setProperty(a,c),this.debug()&&console.log('ForerunnerDB.Document: Setting data-bound document property "'+a+'" for collection "'+this.name()+'"')):(b[a]=c,this.debug()&&console.log('ForerunnerDB.Document: Setting non-data-bound document property "'+a+'" for collection "'+this.name()+'"'))};g.prototype._updateIncrement=function(b,a,c){this._linked?jQuery.observable(b).setProperty(a,b[a]+c):b[a]+=c};g.prototype._updateSpliceMove=function(b,a,c){this._linked?
(jQuery.observable(b).move(a,c),this.debug()&&console.log('ForerunnerDB.Document: Moving data-bound document array index from "'+a+'" to "'+c+'" for collection "'+this.name()+'"')):(b.splice(c,0,b.splice(a,1)[0]),this.debug()&&console.log('ForerunnerDB.Document: Moving non-data-bound document array index from "'+a+'" to "'+c+'" for collection "'+this.name()+'"'))};g.prototype._updateSplicePush=function(b,a,c){b.length>a?this._linked?jQuery.observable(b).insert(a,c):b.splice(a,0,c):this._linked?jQuery.observable(b).insert(c):
b.push(c)};g.prototype._updatePush=function(b,a){this._linked?jQuery.observable(b).insert(a):b.push(a)};g.prototype._updatePull=function(b,a){this._linked?jQuery.observable(b).remove(a):b.splice(a,1)};g.prototype._updateMultiply=function(b,a,c){this._linked?jQuery.observable(b).setProperty(a,b[a]*c):b[a]*=c};g.prototype._updateRename=function(b,a,c){var e=b[a];this._linked?(jQuery.observable(b).setProperty(c,e),jQuery.observable(b).removeProperty(a)):(b[c]=e,delete b[a])};g.prototype._updateUnset=
function(b,a){this._linked?jQuery.observable(b).removeProperty(a):delete b[a]};g.prototype._updatePop=function(b,a){var c,e=!1;0<b.length&&(this._linked?(1===a?c=b.length-1:-1===a&&(c=0),-1<c&&(jQuery.observable(arr).remove(c),e=!0)):1===a?(b.pop(),e=!0):-1===a&&(b.shift(),e=!0));return e};g.prototype.drop=function(){if("dropped"!==this._state){if(this._db&&this._name&&this._db&&this._db._document&&this._db._document[this._name])return this._state="dropped",delete this._db._document[this._name],delete this._data,
this.emit("drop",this),!0}else return!0;return!1};c.prototype.init=function(){a.apply(this,arguments)};c.prototype.document=function(b){return b?(this._document=this._document||{},this._document[b]=this._document[b]||(new g(b)).db(this),this._document[b]):this._document};c.prototype.documents=function(){var b=[],a;for(a in this._document)this._document.hasOwnProperty(a)&&b.push({name:a});return b};h.finishModule("Document");n.exports=g},{"./Collection":3,"./Shared":26}],8:[function(d,n,h){var c,a;
h=d("./Shared");a=d("./Overload");var g=function(b,a){this.init.apply(this,arguments)};g.prototype.init=function(b,a){this._options=a;this._selector=$(this._options.selector);if(!this._selector[0])throw'ForerunnerDB.Highchart "'+b.name()+'": Chart target element does not exist via selector: '+this._options.selector;this._listeners={};this._collection=b;this._options.series=[];a.chartOptions=a.chartOptions||{};a.chartOptions.credits=!1;var c,e;switch(this._options.type){case "pie":this._selector.highcharts(this._options.chartOptions);
this._chart=this._selector.highcharts();c=this._collection.find();e={allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {y} ({point.percentage:.0f}%)",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}};c=this.pieDataFromCollectionData(c,this._options.keyField,this._options.valField);$.extend(e,this._options.seriesOptions);$.extend(e,{name:this._options.seriesName,data:c});this._chart.addSeries(e,!0,!0);break;case "line":case "area":case "column":case "bar":c=
this.seriesDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,this._options.orderBy);this._options.chartOptions.xAxis=c.xAxis;this._options.chartOptions.series=c.series;this._selector.highcharts(this._options.chartOptions);this._chart=this._selector.highcharts();break;default:throw'ForerunnerDB.Highchart "'+b.name()+'": Chart type specified is not currently supported by ForerunnerDB: '+this._options.type;}this._hookEvents()};h.addModule("Highchart",g);d=
h.modules.Collection;c=d.prototype.init;h.mixin(g.prototype,"Mixin.Events");h.synthesize(g.prototype,"state");g.prototype.pieDataFromCollectionData=function(b,a,c){var e=[],g;for(g=0;g<b.length;g++)e.push([b[g][a],b[g][c]]);return e};g.prototype.seriesDataFromCollectionData=function(b,a,c,e){var g=this._collection.distinct(b),d=[],h={categories:[]},v,n,w,x,s;for(x=0;x<g.length;x++){v=g[x];n={};n[b]=v;w=[];n=this._collection.find(n,{orderBy:e});for(s=0;s<n.length;s++)h.categories.push(n[s][a]),w.push(n[s][c]);
d.push({name:v,data:w})}return{xAxis:h,series:d}};g.prototype._hookEvents=function(){var b=this;b._collection.on("change",function(){b._changeListener.apply(b,arguments)});b._collection.on("drop",function(){b.drop.apply(b,arguments)})};g.prototype._changeListener=function(){if("undefined"!==typeof this._collection&&this._chart){var b=this._collection.find();switch(this._options.type){case "pie":this._chart.series[0].setData(this.pieDataFromCollectionData(b,this._options.keyField,this._options.valField),
!0,!0);break;case "bar":case "line":case "area":case "column":var a=this.seriesDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,this._options.orderBy);this._chart.xAxis[0].setCategories(a.xAxis.categories);for(b=0;b<a.series.length;b++)this._chart.series[b]?this._chart.series[b].setData(a.series[b].data,!0,!0):this._chart.addSeries(a.series[b],!0,!0)}}};g.prototype.drop=function(){"dropped"!==this._state&&(this._state="dropped",this._chart&&this._chart.destroy(),
this._collection&&(this._collection.off("change",this._changeListener),this._collection.off("drop",this.drop),this._collection._highcharts&&delete this._collection._highcharts[this._options.selector]),delete this._chart,delete this._options,delete this._collection,this.emit("drop",this));return!0};d.prototype.init=function(){this._highcharts={};c.apply(this,arguments)};d.prototype.pieChart=new a({object:function(b){b.type="pie";b.chartOptions=b.chartOptions||{};b.chartOptions.chart=b.chartOptions.chart||
{};b.chartOptions.chart.type="pie";this._highcharts[b.selector]||(this._highcharts[b.selector]=new g(this,b));return this._highcharts[b.selector]},"*, string, string, string, ...":function(b,a,c,e,g){g=g||{};g.selector=b;g.keyField=a;g.valField=c;g.seriesName=e;this.pieChart(g)}});d.prototype.lineChart=new a({object:function(b){b.type="line";b.chartOptions=b.chartOptions||{};b.chartOptions.chart=b.chartOptions.chart||{};b.chartOptions.chart.type="line";this._highcharts[b.selector]||(this._highcharts[b.selector]=
new g(this,b));return this._highcharts[b.selector]},"*, string, string, string, ...":function(b,a,c,e,g){g=g||{};g.seriesField=a;g.selector=b;g.keyField=c;g.valField=e;this.lineChart(g)}});d.prototype.areaChart=new a({object:function(b){b.type="area";b.chartOptions=b.chartOptions||{};b.chartOptions.chart=b.chartOptions.chart||{};b.chartOptions.chart.type="area";this._highcharts[b.selector]||(this._highcharts[b.selector]=new g(this,b));return this._highcharts[b.selector]},"*, string, string, string, ...":function(b,
a,c,e,g){g=g||{};g.seriesField=a;g.selector=b;g.keyField=c;g.valField=e;this.areaChart(g)}});d.prototype.columnChart=new a({object:function(a){a.type="column";a.chartOptions=a.chartOptions||{};a.chartOptions.chart=a.chartOptions.chart||{};a.chartOptions.chart.type="column";this._highcharts[a.selector]||(this._highcharts[a.selector]=new g(this,a));return this._highcharts[a.selector]},"*, string, string, string, ...":function(a,c,g,e,l){l=l||{};l.seriesField=c;l.selector=a;l.keyField=g;l.valField=e;
this.columnChart(l)}});d.prototype.barChart=new a({object:function(a){a.type="bar";a.chartOptions=a.chartOptions||{};a.chartOptions.chart=a.chartOptions.chart||{};a.chartOptions.chart.type="bar";this._highcharts[a.selector]||(this._highcharts[a.selector]=new g(this,a));return this._highcharts[a.selector]},"*, string, string, string, ...":function(a,c,g,e,l){l=l||{};l.seriesField=c;l.selector=a;l.keyField=g;l.valField=e;this.barChart(l)}});d.prototype.stackedBarChart=new a({object:function(a){a.type=
"bar";a.chartOptions=a.chartOptions||{};a.chartOptions.chart=a.chartOptions.chart||{};a.chartOptions.chart.type="bar";a.plotOptions=a.plotOptions||{};a.plotOptions.series=a.plotOptions.series||{};a.plotOptions.series.stacking=a.plotOptions.series.stacking||"normal";this._highcharts[a.selector]||(this._highcharts[a.selector]=new g(this,a));return this._highcharts[a.selector]},"*, string, string, string, ...":function(a,c,g,e,l){l=l||{};l.seriesField=c;l.selector=a;l.keyField=g;l.valField=e;this.stackedBarChart(l)}});
d.prototype.dropChart=function(a){this._highcharts&&this._highcharts[a]&&this._highcharts[a].drop()};h.finishModule("Highchart");n.exports=g},{"./Overload":21,"./Shared":26}],9:[function(d,n,h){h=d("./Shared");var c=d("./Path");d=function(){this.init.apply(this,arguments)};d.prototype.init=function(a,c,b){this._crossRef={};this._size=0;this._id=this._itemKeyHash(a,a);this.data({});this.unique(c&&c.unique?c.unique:!1);void 0!==a&&this.keys(a);void 0!==b&&this.collection(b);this.name(c&&c.name?c.name:
this._id)};h.addModule("Index",d);h.mixin(d.prototype,"Mixin.ChainReactor");d.prototype.id=function(){return this._id};d.prototype.state=function(){return this._state};d.prototype.size=function(){return this._size};d.prototype.data=function(a){return void 0!==a?(this._data=a,this):this._data};h.synthesize(d.prototype,"name");d.prototype.collection=function(a){return void 0!==a?(this._collection=a,this):this._collection};d.prototype.keys=function(a){return void 0!==a?(this._keys=a,this._keyCount=(new c).parse(this._keys).length,
this):this._keys};d.prototype.type=function(a){return void 0!==a?(this._type=a,this):this._type};d.prototype.unique=function(a){return void 0!==a?(this._unique=a,this):this._unique};d.prototype.rebuild=function(){if(this._collection){var a=this._collection.subset({},{$decouple:!1,$orderBy:this._keys}).find(),c,b=a.length;this._data={};this._unique&&(this._uniqueLookup={});for(c=0;c<b;c++)this.insert(a[c])}this._state={name:this._name,keys:this._keys,indexSize:this._size,built:new Date,updated:new Date,
ok:!0}};d.prototype.insert=function(a,c){var b,f;this._unique&&(b=this._itemHash(a,this._keys),this._uniqueLookup[b]=a);b=this._itemHashArr(a,this._keys);for(f=0;f<b.length;f++)this.pushToPathValue(b[f],a)};d.prototype.remove=function(a,c){var b,f;this._unique&&(b=this._itemHash(a,this._keys),delete this._uniqueLookup[b]);b=this._itemHashArr(a,this._keys);for(f=0;f<b.length;f++)this.pullFromPathValue(b[f],a)};d.prototype.violation=function(a){a=this._itemHash(a,this._keys);return Boolean(this._uniqueLookup[a])};
d.prototype.hashViolation=function(a){return Boolean(this._uniqueLookup[a])};d.prototype.pushToPathValue=function(a,c){var b=this._data[a]=this._data[a]||[];-1===b.indexOf(c)&&(b.push(c),this._size++,this.pushToCrossRef(c,b))};d.prototype.pullFromPathValue=function(a,c){var b=this._data[a],f;f=b.indexOf(c);-1<f&&(b.splice(f,1),this._size--,this.pullFromCrossRef(c,b));b.length||delete this._data[a]};d.prototype.pull=function(a){var c=a[this._collection.primaryKey()],b=this._crossRef[c],f,d=b.length,
e;for(f=0;f<d;f++)e=b[f],this._pullFromArray(e,a);this._size--;delete this._crossRef[c]};d.prototype._pullFromArray=function(a,c){for(var b=a.length;b--;)a[b]===c&&a.splice(b,1)};d.prototype.pushToCrossRef=function(a,c){var b=a[this._collection.primaryKey()];this._crossRef[b]=this._crossRef[b]||[];b=this._crossRef[b];-1===b.indexOf(c)&&b.push(c)};d.prototype.pullFromCrossRef=function(a,c){var b=a[this._collection.primaryKey()];delete this._crossRef[b]};d.prototype.lookup=function(a){return this._data[this._itemHash(a,
this._keys)]||[]};d.prototype.match=function(a,g){return(new c).countObjectPaths(this._keys,a)};d.prototype._itemHash=function(a,g){var b=new c,f,d="",e;f=b.parse(g);for(e=0;e<f.length;e++)d&&(d+="_"),d+=b.value(a,f[e].path).join(":");return d};d.prototype._itemKeyHash=function(a,g){var b=new c,f,d="",e;f=b.parse(g);for(e=0;e<f.length;e++)d&&(d+="_"),d+=b.keyValue(a,f[e].path);return d};d.prototype._itemHashArr=function(a,g){var b=new c,f,d=[],e,l,h,r;f=b.parse(g);for(h=0;h<f.length;h++)for(e=b.value(a,
f[h].path),l=0;l<e.length;l++)if(0===h)d.push(e[l]);else for(r=0;r<d.length;r++)d[r]=d[r]+"_"+e[l];return d};h.finishModule("Index");n.exports=d},{"./Path":23,"./Shared":26}],10:[function(d,n,h){d=d("./Shared");h=function(c){this.init.apply(this,arguments)};h.prototype.init=function(c){this._name=c;this._data={};this._primaryKey="_id"};d.addModule("KeyValueStore",h);d.mixin(h.prototype,"Mixin.ChainReactor");d.synthesize(h.prototype,"name");h.prototype.primaryKey=function(c){return void 0!==c?(this._primaryKey=
c,this):this._primaryKey};h.prototype.truncate=function(){this._data={};return this};h.prototype.set=function(c,a){this._data[c]=a?a:!0;return this};h.prototype.get=function(c){return this._data[c]};h.prototype.lookup=function(c){c=c[this._primaryKey];var a,g,b,f;if(c instanceof Array){g=c.length;f=[];for(a=0;a<g;a++)(b=this._data[c[a]])&&f.push(b);return f}if(c instanceof RegExp){f=[];for(a in this._data)this._data.hasOwnProperty(a)&&c.test(a)&&f.push(this._data[a]);return f}if("object"===typeof c){if(c.$ne){f=
[];for(a in this._data)this._data.hasOwnProperty(a)&&a!==c.$ne&&f.push(this._data[a]);return f}if(c.$in&&c.$in instanceof Array){f=[];for(a in this._data)this._data.hasOwnProperty(a)&&-1<c.$in.indexOf(a)&&f.push(this._data[a]);return f}if(c.$nin&&c.$nin instanceof Array){f=[];for(a in this._data)this._data.hasOwnProperty(a)&&-1===c.$nin.indexOf(a)&&f.push(this._data[a]);return f}if(c.$or&&c.$or instanceof Array){f=[];for(a=0;a<c.$or.length;a++)f=f.concat(this.lookup(c.$or[a]));return f}}else return b=
this._data[c],void 0!==b?[b]:[]};h.prototype.unSet=function(c){delete this._data[c];return this};h.prototype.uniqueSet=function(c,a){return void 0===this._data[c]?(this._data[c]=a,!0):!1};d.finishModule("KeyValueStore");n.exports=h},{"./Shared":26}],11:[function(d,n,h){h=d("./Shared");var c=d("./Operation");d=function(){this.init.apply(this,arguments)};d.prototype.init=function(){this._data=[]};h.addModule("Metrics",d);h.mixin(d.prototype,"Mixin.ChainReactor");d.prototype.create=function(a){a=new c(a);
this._enabled&&this._data.push(a);return a};d.prototype.start=function(){this._enabled=!0;return this};d.prototype.stop=function(){this._enabled=!1;return this};d.prototype.clear=function(){this._data=[];return this};d.prototype.list=function(){return this._data};h.finishModule("Metrics");n.exports=d},{"./Operation":20,"./Shared":26}],12:[function(d,n,h){n.exports={preSetData:function(){},postSetData:function(){}}},{}],13:[function(d,n,h){n.exports={chain:function(c){this._chain=this._chain||[];-1===
this._chain.indexOf(c)&&this._chain.push(c)},unChain:function(c){this._chain&&(c=this._chain.indexOf(c),-1<c&&this._chain.splice(c,1))},chainSend:function(c,a,g){if(this._chain){var b=this._chain,f=b.length,d;for(d=0;d<f;d++)b[d].chainReceive(this,c,a,g)}},chainReceive:function(c,a,g,b){c={sender:c,type:a,data:g,options:b};(!this._chainHandler||this._chainHandler&&!this._chainHandler(c))&&this.chainSend(c.type,c.data,c.options)}}},{}],14:[function(d,n,h){var c=0;d={decouple:function(a,c){if(void 0!==
a){if(c){var b,f=JSON.stringify(a),d=[];for(b=0;b<c;b++)d.push(JSON.parse(f));return d}return JSON.parse(JSON.stringify(a))}},objectId:function(a){var g=Math.pow(10,17);if(a){var b=0,f=a.length,d;for(d=0;d<f;d++)b+=a.charCodeAt(d)*g;a=b.toString(16)}else c++,a=(c+(Math.random()*g+Math.random()*g+Math.random()*g+Math.random()*g)).toString(16);return a},debug:d("./Overload")([function(){return this._debug&&this._debug.all},function(a){return void 0!==a?"boolean"===typeof a?(this._debug=this._debug||
{},this._debug.all=a,this.chainSend("debug",this._debug),this):this._debug&&this._debug[a]||this._db&&this._db._debug&&this._db._debug[a]||this._debug&&this._debug.all:this._debug&&this._debug.all},function(a,c){return void 0!==a?void 0!==c?(this._debug=this._debug||{},this._debug[a]=c,this.chainSend("debug",this._debug),this):this._debug&&this._debug[c]||this._db&&this._db._debug&&this._db._debug[a]:this._debug&&this._debug.all}])};n.exports=d},{"./Overload":21}],15:[function(d,n,h){n.exports={TYPE_INSERT:0,
TYPE_UPDATE:1,TYPE_REMOVE:2,PHASE_BEFORE:0,PHASE_AFTER:1}},{}],16:[function(d,n,h){d={on:new Overload({"string, function":function(c,a){this._listeners=this._listeners||{};this._listeners[c]=this._listeners[c]||{};this._listeners[c]["*"]=this._listeners[c]["*"]||[];this._listeners[c]["*"].push(a);return this},"string, *, function":function(c,a,g){this._listeners=this._listeners||{};this._listeners[c]=this._listeners[c]||{};this._listeners[c][a]=this._listeners[c][a]||[];this._listeners[c][a].push(g);
return this}}),off:new Overload({string:function(c){this._listeners&&this._listeners[c]&&c in this._listeners&&delete this._listeners[c];return this},"string, function":function(c,a){var g,b;"string"===typeof a?this._listeners&&this._listeners[c]&&this._listeners[c][a]&&delete this._listeners[c][a]:c in this._listeners&&(g=this._listeners[c]["*"],b=g.indexOf(a),-1<b&&g.splice(b,1));return this},"string, *, function":function(c,a,g){this._listeners&&c in this._listeners&&a in this.listeners[c]&&(c=
this._listeners[c][a],g=c.indexOf(g),-1<g&&c.splice(g,1))},"string, *":function(c,a){this._listeners&&c in this._listeners&&a in this._listeners[c]&&delete this._listeners[c][a]}}),emit:function(c,a){this._listeners=this._listeners||{};if(c in this._listeners){if(this._listeners[c]["*"]){var g=this._listeners[c]["*"],b=g.length,f;for(f=0;f<b;f++)g[f].apply(this,Array.prototype.slice.call(arguments,1))}if(a instanceof Array&&a[0]&&a[0][this._primaryKey]){var g=this._listeners[c],d,e,b=a.length;for(f=
0;f<b;f++)if(g[a[f][this._primaryKey]])for(d=g[a[f][this._primaryKey]].length,e=0;e<d;e++)g[a[f][this._primaryKey]][e].apply(this,Array.prototype.slice.call(arguments,1))}}return this}};n.exports=d},{}],17:[function(d,n,h){n.exports={addTrigger:function(c,a,g,b){return-1===this._triggerIndex(c,a,g)?(this._trigger=this._trigger||{},this._trigger[a]=this._trigger[a]||{},this._trigger[a][g]=this._trigger[a][g]||[],this._trigger[a][g].push({id:c,method:b}),!0):!1},removeTrigger:function(c,a,g){c=this._triggerIndex(c,
a,g);-1<c&&this._trigger[a][g].splice(c,1);return!1},willTrigger:function(c,a){return this._trigger&&this._trigger[c]&&this._trigger[c][a]&&this._trigger[c][a].length},processTrigger:function(c,a,g,b,f){var d,e,l,h;if(this._trigger&&this._trigger[a]&&this._trigger[a][g]){d=this._trigger[a][g];l=d.length;for(e=0;e<l;e++){h=d[e];if(this.debug()){var r,v;switch(a){case this.TYPE_INSERT:r="insert";break;case this.TYPE_UPDATE:r="update";break;case this.TYPE_REMOVE:r="remove";break;default:r=""}switch(g){case this.PHASE_BEFORE:v=
"before";break;case this.PHASE_AFTER:v="after";break;default:v=""}console.log('Triggers: Processing trigger "'+id+'" for '+r+' in phase "'+v+'"')}h=h.method.call(this,c,b,f);if(!1===h)return!1;if(void 0!==h&&!0!==h&&!1!==h)throw"ForerunnerDB.Mixin.Triggers: Trigger error: "+h;}return!0}},_triggerIndex:function(c,a,g){var b;if(this._trigger&&this._trigger[a]&&this._trigger[a][g])for(a=this._trigger[a][g],g=a.length,b=0;b<g;b++)if(a[b].id===c)return b;return-1}}},{}],18:[function(d,n,h){var c;d=d("./Shared").modules.OldView;
c=d.prototype.init;d.prototype.init=function(){var a=this;this._binds=[];this._renderEnd=this._renderStart=0;this._deferQueue={insert:[],update:[],remove:[],upsert:[],_bindInsert:[],_bindUpdate:[],_bindRemove:[],_bindUpsert:[]};this._deferThreshold={insert:100,update:100,remove:100,upsert:100,_bindInsert:100,_bindUpdate:100,_bindRemove:100,_bindUpsert:100};this._deferTime={insert:100,update:1,remove:1,upsert:1,_bindInsert:100,_bindUpdate:1,_bindRemove:1,_bindUpsert:1};c.apply(this,arguments);this.on("insert",
function(c,b){a._bindEvent("insert",c,b)});this.on("update",function(c,b){a._bindEvent("update",c,b)});this.on("remove",function(c,b){a._bindEvent("remove",c,b)});this.on("change",a._bindChange)};d.prototype.bind=function(a,c){if(c&&c.template)this._binds[a]=c;else throw'ForerunnerDB.OldView "'+this.name()+'": Cannot bind data to element, missing options information!';return this};d.prototype.unBind=function(a){delete this._binds[a];return this};d.prototype.isBound=function(a){return Boolean(this._binds[a])};
d.prototype.bindSortDom=function(a,c){var b=$(a),f,d,e;this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sorting data in DOM...",c);for(f=0;f<c.length;f++)d=c[f],e=b.find("#"+d[this._primaryKey]),e.length?0===f?(this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sort, moving to index 0...",e),b.prepend(e)):(this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sort, moving to index "+f+"...",e),e.insertAfter(b.children(":eq("+(f-1)+")"))):this.debug()&&console.log("ForerunnerDB.OldView.Bind: Warning, element for array item not found!",
d)};d.prototype.bindRefresh=function(a){var c=this._binds,b,f;a||(a={data:this.find()});for(b in c)c.hasOwnProperty(b)&&(f=c[b],this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sorting DOM..."),this.bindSortDom(b,a.data),f.afterOperation&&f.afterOperation(),f.refresh&&f.refresh())};d.prototype.bindRender=function(a,c){var b=this._binds[a],f=$(a),d,e,l=$("<ul></ul>"),h;if(b){d=this._data.find();for(h=0;h<d.length;h++)e=d[h],b.template(e,function(a){l.append(a)});c?c(a,l.html()):f.append(l.html())}};
d.prototype.processQueue=function(a,c){var b=this._deferQueue[a],f=this._deferThreshold[a],d=this._deferTime[a];if(b.length){var e=this;b.length&&(b=b.length>f?b.splice(0,f):b.splice(0,b.length),this._bindEvent(a,b,[]));setTimeout(function(){e.processQueue(a,c)},d)}else c&&c(),this.emit("bindQueueComplete")};d.prototype._bindEvent=function(a,c,b){var f=this._binds,d=this.find({}),e,l;for(l in f)if(f.hasOwnProperty(l))switch(e=f[l].reduce?this.find(f[l].reduce.query,f[l].reduce.options):d,a){case "insert":this._bindInsert(l,
f[l],c,b,e);break;case "update":this._bindUpdate(l,f[l],c,b,e);break;case "remove":this._bindRemove(l,f[l],c,b,e)}};d.prototype._bindChange=function(a){this.debug()&&console.log("ForerunnerDB.OldView.Bind: Bind data change, refreshing bind...",a);this.bindRefresh(a)};d.prototype._bindInsert=function(a,c,b,f,d){var e=$(a),l;for(l=0;l<b.length;l++)a=e.find("#"+b[l][this._primaryKey]),a.length||c.template(b[l],function(a,b,l,f){return function(a){c.insert?c.insert(a,b,l,f):c.prependInsert?e.prepend(a):
e.append(a);c.afterInsert&&c.afterInsert(a,b,l,f)}}(a,b[l],f,d))};d.prototype._bindUpdate=function(a,c,b,f,d){var e=$(a);for(f=0;f<b.length;f++)a=e.find("#"+b[f][this._primaryKey]),c.template(b[f],function(a,b){return function(f){c.update?c.update(f,b,d,a.length?"update":"append"):a.length?a.replaceWith(f):c.prependUpdate?e.prepend(f):e.append(f);c.afterUpdate&&c.afterUpdate(f,b,d)}}(a,b[f]))};d.prototype._bindRemove=function(a,c,b,f,d){a=$(a);var e;for(e=0;e<b.length;e++)f=a.find("#"+b[e][this._primaryKey]),
f.length&&(c.beforeRemove?c.beforeRemove(f,b[e],d,function(a,b,e){return function(){c.remove?c.remove(a,b,e):(a.remove(),c.afterRemove&&c.afterRemove(a,b,e))}}(f,b[e],d)):c.remove?c.remove(f,b[e],d):(f.remove(),c.afterRemove&&c.afterRemove(f,b[e],d)))}},{"./Shared":26}],19:[function(d,n,h){var c,a,g,b,f;h=d("./Shared");var k=function(){this.init.apply(this,arguments)};k.prototype.init=function(a){var b=this;this._name=a;this._groups=[];this._listeners={};this._query={query:{},options:{}};this._onFromSetData=
function(){b._onSetData.apply(b,arguments)};this._onFromInsert=function(){b._onInsert.apply(b,arguments)};this._onFromUpdate=function(){b._onUpdate.apply(b,arguments)};this._onFromRemove=function(){b._onRemove.apply(b,arguments)};this._onFromChange=function(){b.debug()&&console.log("ForerunnerDB.OldView: Received change");b._onChange.apply(b,arguments)}};h.addModule("OldView",k);c=d("./CollectionGroup");a=d("./Collection");g=a.prototype.init;b=c.prototype.init;d=h.modules.Core;f=d.prototype.init;
h.mixin(k.prototype,"Mixin.Events");k.prototype.drop=function(){return(this._db||this._from)&&this._name?(this.debug()&&console.log("ForerunnerDB.OldView: Dropping view "+this._name),this._state="dropped",this.emit("drop",this),this._db&&this._db._oldViews&&delete this._db._oldViews[this._name],this._from&&this._from._oldViews&&delete this._from._oldViews[this._name],!0):!1};k.prototype.debug=function(){return!1};k.prototype.db=function(a){return void 0!==a?(this._db=a,this):this._db};k.prototype.from=
function(a){if(void 0!==a){if("string"===typeof a)if(this._db.collectionExists(a))a=this._db.collection(a);else throw'ForerunnerDB.OldView "'+this.name()+'": Invalid collection in view.from() call.';this._from!==a&&(this._from&&this.removeFrom(),this.addFrom(a));return this}return this._from};k.prototype.addFrom=function(a){if(this._from=a)return this._from.on("setData",this._onFromSetData),this._from.on("change",this._onFromChange),this._from._addOldView(this),this._primaryKey=this._from._primaryKey,
this.refresh(),this;throw'ForerunnerDB.OldView "'+this.name()+'": Cannot determine collection type in view.from()';};k.prototype.removeFrom=function(){this._from.off("setData",this._onFromSetData);this._from.off("change",this._onFromChange);this._from._removeOldView(this)};k.prototype.primaryKey=function(){if(this._from)return this._from.primaryKey()};k.prototype.queryData=function(a,b,c){void 0!==a&&(this._query.query=a);void 0!==b&&(this._query.options=b);return void 0!==a||void 0!==b?(void 0!==
c&&!0!==c||this.refresh(),this):this._query};k.prototype.queryAdd=function(a,b,c){var g=this._query.query,f;if(void 0!==a)for(f in a)a.hasOwnProperty(f)&&(void 0===g[f]||void 0!==g[f]&&b)&&(g[f]=a[f]);void 0!==c&&!0!==c||this.refresh()};k.prototype.queryRemove=function(a,b){var c=this._query.query,g;if(void 0!==a)for(g in a)a.hasOwnProperty(g)&&delete c[g];void 0!==b&&!0!==b||this.refresh()};k.prototype.query=function(a,b){return void 0!==a?(this._query.query=a,void 0!==b&&!0!==b||this.refresh(),
this):this._query.query};k.prototype.queryOptions=function(a,b){return void 0!==a?(this._query.options=a,void 0!==b&&!0!==b||this.refresh(),this):this._query.options};k.prototype.refresh=function(a){if(this._from){var b=this._data,c,g,f,d,k,h=[],s=[],q=[],p;this.debug()&&(console.log("ForerunnerDB.OldView: Refreshing view "+this._name),console.log("ForerunnerDB.OldView: Existing data: "+("undefined"!==typeof this._data)),"undefined"!==typeof this._data&&console.log("ForerunnerDB.OldView: Current data rows: "+
this._data.find().length));this._query?(this.debug()&&console.log("ForerunnerDB.OldView: View has query and options, getting subset..."),this._data=this._from.subset(this._query.query,this._query.options)):this._query.options?(this.debug()&&console.log("ForerunnerDB.OldView: View has options, getting subset..."),this._data=this._from.subset({},this._query.options)):(this.debug()&&console.log("ForerunnerDB.OldView: View has no query or options, getting subset..."),this._data=this._from.subset({}));
if(!a&&b)if(this.debug()&&console.log("ForerunnerDB.OldView: Refresh not forced, old data detected..."),g=this._data,b.subsetOf()===g.subsetOf()){this.debug()&&console.log("ForerunnerDB.OldView: Old and new data are from same collection...");f=g.find();a=b.find();d=g._primaryKey;for(p=0;p<f.length;p++)k=f[p],c={},c[d]=k[d],(c=b.find(c)[0])?JSON.stringify(c)!==JSON.stringify(k)&&s.push(k):h.push(k);for(p=0;p<a.length;p++)k=a[p],c={},c[d]=k[d],g.find(c)[0]||q.push(k);this.debug()&&(console.log("ForerunnerDB.OldView: Removed "+
q.length+" rows"),console.log("ForerunnerDB.OldView: Inserted "+h.length+" rows"),console.log("ForerunnerDB.OldView: Updated "+s.length+" rows"));h.length&&this._onInsert(h,[]);s.length&&this._onUpdate(s,[]);q.length&&this._onRemove(q,[])}else this.debug()&&console.log("ForerunnerDB.OldView: Old and new data are from different collections..."),q=b.find(),q.length&&this._onRemove(q),h=g.find(),h.length&&this._onInsert(h);else this.debug()&&console.log("ForerunnerDB.OldView: Forcing data update",f),
this._data=this._from.subset(this._query.query,this._query.options),f=this._data.find(),this.debug()&&console.log("ForerunnerDB.OldView: Emitting change event with data",f),this._onInsert(f,[]);this.debug()&&console.log("ForerunnerDB.OldView: Emitting change");this.emit("change")}return this};k.prototype.count=function(){return this._data&&this._data._data?this._data._data.length:0};k.prototype.find=function(){return this._data?(this.debug()&&console.log("ForerunnerDB.OldView: Finding data in view collection...",
this._data),this._data.find.apply(this._data,arguments)):[]};k.prototype.insert=function(){return this._from?this._from.insert.apply(this._from,arguments):[]};k.prototype.update=function(){return this._from?this._from.update.apply(this._from,arguments):[]};k.prototype.remove=function(){return this._from?this._from.remove.apply(this._from,arguments):[]};k.prototype._onSetData=function(a,b){this.emit("remove",b,[]);this.emit("insert",a,[])};k.prototype._onInsert=function(a,b){this.emit("insert",a,b)};
k.prototype._onUpdate=function(a,b){this.emit("update",a,b)};k.prototype._onRemove=function(a,b){this.emit("remove",a,b)};k.prototype._onChange=function(){this.debug()&&console.log("ForerunnerDB.OldView: Refreshing data");this.refresh()};a.prototype.init=function(){this._oldViews=[];g.apply(this,arguments)};a.prototype._addOldView=function(a){void 0!==a&&(this._oldViews[a._name]=a);return this};a.prototype._removeOldView=function(a){void 0!==a&&delete this._oldViews[a._name];return this};c.prototype.init=
function(){this._oldViews=[];b.apply(this,arguments)};c.prototype._addOldView=function(a){void 0!==a&&(this._oldViews[a._name]=a);return this};c.prototype._removeOldView=function(a){void 0!==a&&delete this._oldViews[a._name];return this};d.prototype.init=function(){this._oldViews={};f.apply(this,arguments)};d.prototype.oldView=function(a){this._oldViews[a]||this.debug()&&console.log("ForerunnerDB.OldView: Creating view "+a);this._oldViews[a]=this._oldViews[a]||(new k(a)).db(this);return this._oldViews[a]};
d.prototype.oldViewExists=function(a){return Boolean(this._oldViews[a])};d.prototype.oldViews=function(){var a=[],b;for(b in this._oldViews)this._oldViews.hasOwnProperty(b)&&a.push({name:b,count:this._oldViews[b].count()});return a};h.finishModule("OldView");n.exports=k},{"./Collection":3,"./CollectionGroup":4,"./Shared":26}],20:[function(d,n,h){h=d("./Shared");var c=d("./Path");d=function(a){this.pathSolver=new c;this.counter=0;this.init.apply(this,arguments)};d.prototype.init=function(a){this._data=
{operation:a,index:{potential:[],used:!1},steps:[],time:{startMs:0,stopMs:0,totalMs:0,process:{}},flag:{},log:[]}};h.addModule("Operation",d);h.mixin(d.prototype,"Mixin.ChainReactor");d.prototype.start=function(){this._data.time.startMs=(new Date).getTime()};d.prototype.log=function(a){if(a){var c=0<this._log.length?this._data.log[this._data.log.length-1].time:0;a={event:a,time:(new Date).getTime(),delta:0};this._data.log.push(a);c&&(a.delta=a.time-c);return this}return this._data.log};d.prototype.time=
function(a){if(void 0!==a){var c=this._data.time.process,c=c[a]=c[a]||{};c.startMs?(c.stopMs=(new Date).getTime(),c.totalMs=c.stopMs-c.startMs,c.stepObj.totalMs=c.totalMs,delete c.stepObj):(c.startMs=(new Date).getTime(),c.stepObj={name:a},this._data.steps.push(c.stepObj));return this}return this._data.time};d.prototype.flag=function(a,c){if(void 0!==a&&void 0!==c)this._data.flag[a]=c;else return void 0!==a?this._data.flag[a]:this._data.flag};d.prototype.data=function(a,c,b){return void 0!==c?(this.pathSolver.set(this._data,
a,c),this):this.pathSolver.get(this._data,a)};d.prototype.pushData=function(a,c,b){this.pathSolver.push(this._data,a,c)};d.prototype.stop=function(){this._data.time.stopMs=(new Date).getTime();this._data.time.totalMs=this._data.time.stopMs-this._data.time.startMs};h.finishModule("Operation");n.exports=d},{"./Path":23,"./Shared":26}],21:[function(d,n,h){Overload=function(c){if(c){var a,d,b,f,k;if(!(c instanceof Array)){b={};for(a in c)if(c.hasOwnProperty(a))if(f=a.replace(/ /g,""),-1===f.indexOf("*"))b[f]=
c[a];else for(k=generateSignaturePermutations(f),f=0;f<k.length;f++)b[k[f]]||(b[k[f]]=c[a]);c=b}return function(){if(c instanceof Array)for(d=c.length,a=0;a<d;a++){if(c[a].length===arguments.length)return c[a].apply(this,arguments)}else{var b=[],f;for(a=0;a<arguments.length;a++)f=typeof arguments[a],"object"===f&&arguments[a]instanceof Array&&(f="array"),b.push(f);f=b.join(",");if(c[f])return c[f].apply(this,arguments);for(a=b.length;0<=a;a--)if(f=b.slice(0,a).join(","),c[f+",..."])return c[f+",..."].apply(this,
arguments)}throw'ForerunnerDB.Overload "'+this.name()+'": Overloaded method does not have a matching signature for the passed arguments: '+JSON.stringify(b);}}return function(){}};generateSignaturePermutations=function(c){var a=[],d,b=["string","object","number","function","undefined"],f;if(-1<c.indexOf("*"))for(f=0;f<b.length;f++)d=c.replace("*",b[f]),a=a.concat(generateSignaturePermutations(d));else a.push(c);return a};n.exports=Overload},{}],22:[function(d,n,h){var c,a,g;h=d("./Shared");var b=
function(){this.init.apply(this,arguments)};b.prototype.init=function(b){var c=this;this._name=b;this._data=new g("__FDB__dc_data_"+this._name);this._collData=new a;this._collections=[];this._collectionDroppedWrap=function(){c._collectionDropped.apply(c,arguments)}};h.addModule("Overview",b);h.mixin(b.prototype,"Mixin.Common");h.mixin(b.prototype,"Mixin.ChainReactor");h.mixin(b.prototype,"Mixin.Constants");h.mixin(b.prototype,"Mixin.Triggers");h.mixin(b.prototype,"Mixin.Events");a=d("./Collection");
g=d("./Document");d=h.modules.Core;c=h.modules.Core.prototype.init;h.synthesize(b.prototype,"state");h.synthesize(b.prototype,"db");h.synthesize(b.prototype,"name");h.synthesize(b.prototype,"query",function(a){var b=this.$super(a);void 0!==a&&this._refresh();return b});h.synthesize(b.prototype,"queryOptions",function(a){var b=this.$super(a);void 0!==a&&this._refresh();return b});h.synthesize(b.prototype,"reduce",function(a){var b=this.$super(a);void 0!==a&&this._refresh();return b});b.prototype.from=
function(a){return void 0!==a?("string"===typeof a&&(a=this._db.collection(a)),this._addCollection(a),this):this._collections};b.prototype.find=function(){return this._collData.find.apply(this._collData,arguments)};b.prototype.count=function(){return this._collData.count.apply(this._collData,arguments)};b.prototype._addCollection=function(a){-1===this._collections.indexOf(a)&&(this._collections.push(a),a.chain(this),a.on("drop",this._collectionDroppedWrap),this._refresh());return this};b.prototype._removeCollection=
function(a){-1<this._collections.indexOf(a)&&(this._collections.splice(a,1),a.unChain(this),a.off("drop",this._collectionDroppedWrap),this._refresh());return this};b.prototype._collectionDropped=function(a){a&&this._removeCollection(a)};b.prototype._refresh=function(){if("dropped"!==this._state){if(this._collections&&this._collections[0]){this._collData.primaryKey(this._collections[0].primaryKey());var a=[],b;for(b=0;b<this._collections.length;b++)a=a.concat(this._collections[b].find(this._query,
this._queryOptions));this._collData.setData(a)}this._reduce&&(a=this._reduce(),this._data.setData(a))}};b.prototype._chainHandler=function(a){switch(a.type){case "setData":case "insert":case "update":case "remove":this._refresh()}};b.prototype.data=function(){return this._data};b.prototype.drop=function(){if("dropped"!==this._state){this._state="dropped";delete this._data;for(delete this._collData;this._collections.length;)this._removeCollection(this._collections[0]);delete this._collections;this._db&&
this._name&&delete this._db._overview[this._name];delete this._name;this.emit("drop",this)}return!0};d.prototype.init=function(){this._overview={};c.apply(this,arguments)};d.prototype.overview=function(a){return a?(this._overview[a]=this._overview[a]||(new b(a)).db(this),this._overview[a]):this._overview};h.finishModule("Overview");n.exports=b},{"./Collection":3,"./Document":7,"./Shared":26}],23:[function(d,n,h){d=d("./Shared");h=function(c){this.init.apply(this,arguments)};h.prototype.init=function(c){c&&
this.path(c)};d.addModule("Path",h);d.mixin(h.prototype,"Mixin.ChainReactor");h.prototype.path=function(c){return void 0!==c?(this._path=this.clean(c),this._pathParts=this._path.split("."),this):this._path};h.prototype.hasObjectPaths=function(c,a){var d=!0,b;for(b in c)if(c.hasOwnProperty(b)&&(void 0===a[b]||"object"===typeof c[b]&&(d=this.hasObjectPaths(c[b],a[b]),!d)))return!1;return d};h.prototype.countKeys=function(c){var a=0,d;for(d in c)c.hasOwnProperty(d)&&void 0!==c[d]&&("object"!==typeof c[d]?
a++:a+=this.countKeys(c[d]));return a};h.prototype.countObjectPaths=function(c,a){var d,b={},f=0,k=0,e;for(e in a)a.hasOwnProperty(e)&&("object"===typeof a[e]?(d=this.countObjectPaths(c[e],a[e]),b[e]=d.matchedKeys,k+=d.totalKeyCount,f+=d.matchedKeyCount):(k++,c&&c[e]&&"object"!==typeof c[e]?(b[e]=!0,f++):b[e]=!1));return{matchedKeys:b,matchedKeyCount:f,totalKeyCount:k}};h.prototype.parse=function(c,a){var d=[],b="",f,k,e;for(k in c)if(c.hasOwnProperty(k))if(b=k,"object"===typeof c[k])if(a)for(f=this.parse(c[k],
a),e=0;e<f.length;e++)d.push({path:b+"."+f[e].path,value:f[e].value});else for(f=this.parse(c[k]),e=0;e<f.length;e++)d.push({path:b+"."+f[e].path});else a?d.push({path:b,value:c[k]}):d.push({path:b});return d};h.prototype.parseArr=function(c,a){a=a||{};return this._parseArr(c,"",[],a)};h.prototype._parseArr=function(c,a,d,b){var f,k="";a=a||"";d=d||[];for(f in c)c.hasOwnProperty(f)&&(!b.ignore||b.ignore&&!b.ignore.test(f))&&(k=a?a+"."+f:f,"object"===typeof c[f]?this._parseArr(c[f],k,d,b):d.push(k));
return d};h.prototype.value=function(c,a){if(void 0!==c&&"object"===typeof c){var d,b,f,k,e=[],l;void 0!==a&&(a=this.clean(a),d=a.split("."));d=d||this._pathParts;b=d.length;f=c;for(l=0;l<b;l++){f=f[d[l]];if(k instanceof Array){for(b=0;b<k.length;b++)e=e.concat(this.value(k,b+"."+d[l]));return e}if(!f||"object"!==typeof f)break;k=f}return[f]}return[]};h.prototype.set=function(c,a,d){if(void 0!==c&&void 0!==a){var b;a=this.clean(a);a=a.split(".");b=a.shift();a.length?(c[b]=c[b]||{},this.set(c[b],a.join("."),
d)):c[b]=d}return c};h.prototype.get=function(c,a){return this.value(c,a)[0]};h.prototype.push=function(c,a,d){if(void 0!==c&&void 0!==a){var b;a=this.clean(a);a=a.split(".");b=a.shift();if(a.length)c[b]=c[b]||{},this.set(c[b],a.join("."),d);else if(c[b]=c[b]||[],c[b]instanceof Array)c[b].push(d);else throw"ForerunnerDB.Path: Cannot push to a path whose endpoint is not an array!";}return c};h.prototype.keyValue=function(c,a){var d,b,f,k,e;void 0!==a&&(a=this.clean(a),d=a.split("."));d=d||this._pathParts;
b=d.length;f=c;for(e=0;e<b;e++)if(f=f[d[e]],!f||"object"!==typeof f){k=d[e]+":"+f;break}return k};h.prototype.clean=function(c){"."===c.substr(0,1)&&(c=c.substr(1,c.length-1));return c};d.finishModule("Path");n.exports=h},{"./Shared":26}],24:[function(d,n,h){h=d("./Shared");var c=d("localforage"),a,g,b,f,k;k=function(){this.init.apply(this,arguments)};k.prototype.init=function(a){a.isClient()&&void 0!==Storage&&(this.mode("localforage"),c.config({driver:[c.INDEXEDDB,c.WEBSQL,c.LOCALSTORAGE],name:"ForerunnerDB",
storeName:"FDB"}))};h.addModule("Persist",k);h.mixin(k.prototype,"Mixin.ChainReactor");a=h.modules.Core;g=d("./Collection");b=g.prototype.drop;d("./CollectionGroup");f=a.prototype.init;d=h.overload;k.prototype.mode=function(a){return void 0!==a?(this._mode=a,this):this._mode};k.prototype.driver=function(a){if(void 0!==a){switch(a.toUpperCase()){case "LOCALSTORAGE":c.setDriver(c.LOCALSTORAGE);break;case "WEBSQL":c.setDriver(c.WEBSQL);break;case "INDEXEDDB":c.setDriver(c.INDEXEDDB);break;default:throw"ForerunnerDB.Persist: The persistence driver you have specified is not found. Please use either IndexedDB, WebSQL or LocalStorage!";
}return this}return c.driver()};k.prototype.save=function(a,b,d){var f;f=function(a,b){a="object"===typeof a?"json::fdb::"+JSON.stringify(a):"raw::fdb::"+a;b&&b(!1,a)};switch(this.mode()){case "localforage":f(b,function(b,f){c.setItem(a,f).then(function(a){d(!1,a)},function(a){d(a)})});break;default:d&&d("No data handler.")}};k.prototype.load=function(a,b){var d,f,g;g=function(a,b){if(a){d=a.split("::fdb::");switch(d[0]){case "json":f=JSON.parse(d[1]);break;case "raw":f=d[1]}b&&b(!1,f)}else b(!1,
a)};switch(this.mode()){case "localforage":c.getItem(a).then(function(a){g(a,b)},function(a){b(a)});break;default:b&&b("No data handler or unrecognised data type.")}};k.prototype.drop=function(a,b){switch(this.mode()){case "localforage":c.removeItem(a).then(function(){b(!1)},function(a){b(a)});break;default:b&&b("No data handler or unrecognised data type.")}};g.prototype.drop=new d({"":function(){"dropped"!==this._state&&this.drop(!0)},"function":function(a){"dropped"!==this._state&&this.drop(!0,
a)},"boolean":function(a){if("dropped"!==this._state){if(a)if(this._name)if(this._db)this._db.persist.drop(this._name);else throw"ForerunnerDB.Persist: Cannot drop a collection's persistent storage when the collection is not attached to a database!";else throw"ForerunnerDB.Persist: Cannot drop a collection's persistent storage when no name assigned to collection!";b.apply(this,arguments)}},"boolean, function":function(a,c){"dropped"!==this._state&&(a&&(this._name?this._db?this._db.persist.drop(this._name,
c):c&&c("Cannot drop a collection's persistent storage when the collection is not attached to a database!"):c&&c("Cannot drop a collection's persistent storage when no name assigned to collection!")),b.apply(this,arguments))}});g.prototype.save=function(a){this._name?this._db?this._db.persist.save(this._name,this._data,a):a&&a("Cannot save a collection that is not attached to a database!"):a&&a("Cannot save a collection with no assigned name!")};g.prototype.load=function(a){var b=this;this._name?
this._db?this._db.persist.load(this._name,function(c,d){c?a&&a(c):(d&&b.setData(d),a&&a(!1))}):a&&a("Cannot load a collection that is not attached to a database!"):a&&a("Cannot load a collection with no assigned name!")};a.prototype.init=function(){this.persist=new k(this);f.apply(this,arguments)};a.prototype.load=function(a){var b=this._collection,c=b.keys().length,d;for(d in b)b.hasOwnProperty(d)&&b[d].load(function(b){b?a(b):(c--,0===c&&a(!1))})};a.prototype.save=function(a){var b=this._collection,
c=b.keys().length,d;for(d in b)b.hasOwnProperty(d)&&b[d].save(function(b){b?a(b):(c--,0===c&&a(!1))})};h.finishModule("Persist");n.exports=k},{"./Collection":3,"./CollectionGroup":4,"./Shared":26,localforage:34}],25:[function(d,n,h){d=d("./Shared");h=function(c,a,d){if(c&&a&&d){this._reactorIn=c;this._reactorOut=a;this._chainHandler=d;if(!c.chain||!a.chainReceive)throw"ForerunnerDB.ReactorIO: ReactorIO requires passed in and out objects to implement the ChainReactor mixin!";c.chain(this);this.chain(a)}else throw"ForerunnerDB.ReactorIO: ReactorIO requires an in, out and process argument to instantiate!";
};d.addModule("ReactorIO",h);h.prototype.drop=function(){"dropped"!==this._state&&(this._state="dropped",this._reactorIn&&this._reactorIn.unChain(this),this._reactorOut&&this.unChain(this._reactorOut),delete this._reactorIn,delete this._reactorOut,delete this._chainHandler,this.emit("drop",this));return!0};d.synthesize(h.prototype,"state");d.mixin(h.prototype,"Mixin.ChainReactor");d.mixin(h.prototype,"Mixin.Events");d.finishModule("ReactorIO");n.exports=h},{"./Shared":26}],26:[function(d,n,h){d={modules:{},
_synth:{},addModule:function(c,a){this.modules[c]=a;this.emit("moduleLoad",[c,a])},finishModule:function(c){if(this.modules[c])this.modules[c]._fdbFinished=!0,this.emit("moduleFinished",[c,this.modules[c]]);else throw"ForerunnerDB.Shared: finishModule called on a module that has not been registered with addModule(): "+c;},moduleFinished:function(c,a){if(this.modules[c]&&this.modules[c]._fdbFinished)a(c,this.modules[c]);else this.on("moduleFinished",a)},moduleExists:function(c){return Boolean(this.modules[c])},
mixin:function(c,a){var d=this.mixins[a];if(d)for(var b in d)d.hasOwnProperty(b)&&(c[b]=d[b]);else throw"ForerunnerDB.Shared: Cannot find mixin named: "+a;},synthesize:function(c,a,d){this._synth[a]=this._synth[a]||function(b){return void 0!==b?(this["_"+a]=b,this):this["_"+a]};if(d){var b=this;c[a]=function(){var c=this.$super,k;this.$super=b._synth[a];k=d.apply(this,arguments);this.$super=c;return k}}else c[a]=this._synth[a]},overload:d("./Overload"),mixins:{"Mixin.Common":d("./Mixin.Common"),"Mixin.Events":d("./Mixin.Events"),
"Mixin.ChainReactor":d("./Mixin.ChainReactor"),"Mixin.CRUD":d("./Mixin.CRUD"),"Mixin.Constants":d("./Mixin.Constants"),"Mixin.Triggers":d("./Mixin.Triggers")}};d.mixin(d,"Mixin.Events");n.exports=d},{"./Mixin.CRUD":12,"./Mixin.ChainReactor":13,"./Mixin.Common":14,"./Mixin.Constants":15,"./Mixin.Events":16,"./Mixin.Triggers":17,"./Overload":21}],27:[function(d,n,h){var c,a,g,b,f,k;h=d("./Shared");var e=function(a,b,c){this.init.apply(this,arguments)};e.prototype.init=function(a,b,e){var d=this;this._name=
a;this._groups=[];this._listeners={};this._querySettings={};this._debug={};this.query(b,!1);this.queryOptions(e,!1);this._collectionDroppedWrap=function(){d._collectionDropped.apply(d,arguments)};this._privateData=new c("__FDB__view_privateData_"+this._name)};h.addModule("View",e);h.mixin(e.prototype,"Mixin.Common");h.mixin(e.prototype,"Mixin.ChainReactor");h.mixin(e.prototype,"Mixin.Constants");h.mixin(e.prototype,"Mixin.Triggers");c=d("./Collection");a=d("./CollectionGroup");k=d("./ActiveBucket");
f=d("./ReactorIO");g=c.prototype.init;d=h.modules.Core;b=d.prototype.init;h.synthesize(e.prototype,"state");h.synthesize(e.prototype,"name");e.prototype.insert=function(){this._from.insert.apply(this._from,arguments)};e.prototype.update=function(){this._from.update.apply(this._from,arguments)};e.prototype.updateById=function(){this._from.updateById.apply(this._from,arguments)};e.prototype.remove=function(){this._from.remove.apply(this._from,arguments)};e.prototype.find=function(a,b){return this.publicData().find(a,
b)};e.prototype.data=function(){return this._privateData};e.prototype.from=function(a){var b=this;if(void 0!==a){this._from&&(this._from.off("drop",this._collectionDroppedWrap),this._from._removeView(this));"string"===typeof a&&(a=this._db.collection(a));this._from=a;this._io=new f(a,this,function(a){var c,e,d;if(b._querySettings.query){if("insert"===a.type){c=a.data;if(c instanceof Array)for(e=[],a=0;a<c.length;a++)b._privateData._match(c[a],b._querySettings.query,"and")&&(e.push(c[a]),d=!0);else b._privateData._match(c,
b._querySettings.query,"and")&&(e=c,d=!0);d&&this.chainSend("insert",e);return!0}if("update"===a.type&&(e=b._privateData.diff(b._from.subset(b._querySettings.query,b._querySettings.options)),e.insert.length||e.remove.length)){e.insert.length&&this.chainSend("insert",e.insert);if(e.update.length)for(d=b._privateData.primaryKey(),a=0;a<e.update.length;a++)c={},c[d]=e.update[a][d],this.chainSend("update",{query:c,update:e.update[a]});if(e.remove.length){d=b._privateData.primaryKey();c=[];var f={query:{$or:c}};
for(a=0;a<e.remove.length;a++)c.push({_id:e.remove[a][d]});this.chainSend("remove",f)}return!0}}return!1});var c=a.find(this._querySettings.query,this._querySettings.options);this._transformPrimaryKey(a.primaryKey());this._transformSetData(c);this._privateData.primaryKey(a.primaryKey());this._privateData.setData(c);this._querySettings.options&&this._querySettings.options.$orderBy?this.rebuildActiveBucket(this._querySettings.options.$orderBy):this.rebuildActiveBucket()}return this};e.prototype._collectionDropped=
function(a){a&&delete this._from};e.prototype.ensureIndex=function(){return this._privateData.ensureIndex.apply(this._privateData,arguments)};e.prototype._chainHandler=function(a){var b,c,e,d;switch(a.type){case "setData":this.debug()&&console.log('ForerunnerDB.View: Setting data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');a=this._from.find(this._querySettings.query,this._querySettings.options);this._transformSetData(a);this._privateData.setData(a);
break;case "insert":this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');a.data=this.decouple(a.data);a.data instanceof Array||(a.data=[a.data]);if(this._querySettings.options&&this._querySettings.options.$orderBy)for(b=a.data,c=b.length,e=0;e<c;e++)d=this._activeBucket.insert(b[e]),this._transformInsert(a.data,d),this._privateData._insertHandle(a.data,d);else d=this._privateData._data.length,
this._transformInsert(a.data,d),this._privateData._insertHandle(a.data,d);break;case "update":this.debug()&&console.log('ForerunnerDB.View: Updating some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');this._privateData.primaryKey();a=this._privateData.update(a.data.query,a.data.update,a.data.options);if(this._querySettings.options&&this._querySettings.options.$orderBy)for(c=a.length,e=0;e<c;e++)d=a[e],this._activeBucket.remove(d),b=this._privateData._data.indexOf(d),
d=this._activeBucket.insert(d),b!==d&&this._privateData._updateSpliceMove(this._privateData._data,b,d);if(this._transformEnabled&&this._transformIn)for(c=this._publicData.primaryKey(),b=0;b<a.length;b++)e={},d=a[b],e[c]=d[c],this._transformUpdate(e,d);break;case "remove":this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"'),this._transformRemove(a.data.query,a.options),this._privateData.remove(a.data.query,
a.options)}};e.prototype.on=function(){this._privateData.on.apply(this._privateData,arguments)};e.prototype.off=function(){this._privateData.off.apply(this._privateData,arguments)};e.prototype.emit=function(){this._privateData.emit.apply(this._privateData,arguments)};e.prototype.drop=function(){if("dropped"!==this._state){if(this._from)return this._from.off("drop",this._collectionDroppedWrap),this._from._removeView(this),(this.debug()||this._db&&this._db.debug())&&console.log("ForerunnerDB.View: Dropping view "+
this._name),this._state="dropped",this._io&&this._io.drop(),this._privateData&&this._privateData.drop(),this._db&&this._name&&delete this._db._view[this._name],this.emit("drop",this),delete this._chain,delete this._from,delete this._privateData,delete this._io,delete this._groups,delete this._listeners,delete this._querySettings,delete this._db,!0}else return!0;return!1};e.prototype.db=function(a){return void 0!==a?(this._db=a,this.privateData().db(a),this.publicData().db(a),this):this._db};e.prototype.primaryKey=
function(){return this._privateData.primaryKey()};e.prototype.queryData=function(a,b,c){void 0!==a&&(this._querySettings.query=a);void 0!==b&&(this._querySettings.options=b);return void 0!==a||void 0!==b?(void 0!==c&&!0!==c||this.refresh(),this):this._querySettings};e.prototype.queryAdd=function(a,b,c){var e=this._querySettings.query,d;if(void 0!==a)for(d in a)a.hasOwnProperty(d)&&(void 0===e[d]||void 0!==e[d]&&b)&&(e[d]=a[d]);void 0!==c&&!0!==c||this.refresh()};e.prototype.queryRemove=function(a,
b){var c=this._querySettings.query,e;if(void 0!==a)for(e in a)a.hasOwnProperty(e)&&delete c[e];void 0!==b&&!0!==b||this.refresh()};e.prototype.query=function(a,b){return void 0!==a?(this._querySettings.query=a,void 0!==b&&!0!==b||this.refresh(),this):this._querySettings.query};e.prototype.orderBy=function(a){if(void 0!==a){var b=this.queryOptions()||{};b.$orderBy=a;this.queryOptions(b);return this}return(this.queryOptions()||{}).$orderBy};e.prototype.queryOptions=function(a,b){return void 0!==a?(this._querySettings.options=
a,void 0===a.$decouple&&(a.$decouple=!0),void 0===b||!0===b?this.refresh():this.rebuildActiveBucket(a.$orderBy),this):this._querySettings.options};e.prototype.rebuildActiveBucket=function(a){if(a){var b=this._privateData._data,c=b.length;this._activeBucket=new k(a);this._activeBucket.primaryKey(this._privateData.primaryKey());for(a=0;a<c;a++)this._activeBucket.insert(b[a])}else delete this._activeBucket};e.prototype.refresh=function(){if(this._from){var a=this.publicData();this._privateData.remove();
a.remove();this._privateData.insert(this._from.find(this._querySettings.query,this._querySettings.options))}this._querySettings.options&&this._querySettings.options.$orderBy?this.rebuildActiveBucket(this._querySettings.options.$orderBy):this.rebuildActiveBucket();return this};e.prototype.count=function(){return this._privateData&&this._privateData._data?this._privateData._data.length:0};e.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this._transformEnabled=
a.enabled),void 0!==a.dataIn&&(this._transformIn=a.dataIn),void 0!==a.dataOut&&(this._transformOut=a.dataOut)):this._transformEnabled=!1===a?!1:!0,this._transformPrimaryKey(this.privateData().primaryKey()),this._transformSetData(this.privateData().find()),this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};e.prototype.privateData=function(){return this._privateData};e.prototype.publicData=function(){return this._transformEnabled?this._publicData:this._privateData};
e.prototype._transformSetData=function(a){this._transformEnabled&&(this._publicData=new c("__FDB__view_publicData_"+this._name),this._publicData.db(this._privateData._db),this._publicData.transform({enabled:!0,dataIn:this._transformIn,dataOut:this._transformOut}),this._publicData.setData(a))};e.prototype._transformInsert=function(a,b){this._transformEnabled&&this._publicData&&this._publicData.insert(a,b)};e.prototype._transformUpdate=function(a,b,c){this._transformEnabled&&this._publicData&&this._publicData.update(a,
b,c)};e.prototype._transformRemove=function(a,b){this._transformEnabled&&this._publicData&&this._publicData.remove(a,b)};e.prototype._transformPrimaryKey=function(a){this._transformEnabled&&this._publicData&&this._publicData.primaryKey(a)};c.prototype.init=function(){this._view=[];g.apply(this,arguments)};c.prototype.view=function(a,b,c){if(this._db&&this._db._view){if(this._db._view[a])throw'ForerunnerDB.Collection "'+this.name()+'": Cannot create a view using this collection because a view with this name already exists: '+
a;a=(new e(a,b,c)).db(this._db).from(this);this._view=this._view||[];this._view.push(a);return a}};c.prototype._addView=a.prototype._addView=function(a){void 0!==a&&this._view.push(a);return this};c.prototype._removeView=a.prototype._removeView=function(a){void 0!==a&&(a=this._view.indexOf(a),-1<a&&this._view.splice(a,1));return this};d.prototype.init=function(){this._view={};b.apply(this,arguments)};d.prototype.view=function(a){this._view[a]||(this.debug()||this._db&&this._db.debug())&&console.log("Core.View: Creating view "+
a);this._view[a]=this._view[a]||(new e(a)).db(this);return this._view[a]};d.prototype.viewExists=function(a){return Boolean(this._view[a])};d.prototype.views=function(){var a=[],b;for(b in this._view)this._view.hasOwnProperty(b)&&a.push({name:b,count:this._view[b].count()});return a};h.finishModule("View");n.exports=e},{"./ActiveBucket":2,"./Collection":3,"./CollectionGroup":4,"./ReactorIO":25,"./Shared":26}],28:[function(d,n,h){function c(d){function k(a){null===r?t.push(a):b(function(){var b=r?
a.onFulfilled:a.onRejected;if(null===b)(r?a.resolve:a.reject)(v);else{var c;try{c=b(v)}catch(e){a.reject(e);return}a.resolve(c)}})}function e(a){try{if(a===w)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"===typeof a||"function"===typeof a)){var b=a.then;if("function"===typeof b){g(b.bind(a),e,h);return}}r=!0;v=a;n()}catch(c){h(c)}}function h(a){r=!1;v=a;n()}function n(){for(var a=0,b=t.length;a<b;a++)k(t[a]);t=null}if("object"!==typeof this)throw new TypeError("Promises must be constructed via new");
if("function"!==typeof d)throw new TypeError("not a function");var r=null,v=null,t=[],w=this;this.then=function(b,e){return new c(function(c,d){k(new a(b,e,c,d))})};g(d,e,h)}function a(a,b,c,d){this.onFulfilled="function"===typeof a?a:null;this.onRejected="function"===typeof b?b:null;this.resolve=c;this.reject=d}function g(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(g){d||(d=!0,c(g))}}var b=d("asap");n.exports=c},{asap:30}],29:[function(d,n,h){function c(b){this.then=
function(c){return"function"!==typeof c?this:new a(function(a,e){g(function(){try{a(c(b))}catch(d){e(d)}})})}}var a=d("./core.js"),g=d("asap");n.exports=a;c.prototype=Object.create(a.prototype);var b=new c(!0),f=new c(!1),k=new c(null),e=new c(void 0),l=new c(0),u=new c("");a.resolve=function(d){if(d instanceof a)return d;if(null===d)return k;if(void 0===d)return e;if(!0===d)return b;if(!1===d)return f;if(0===d)return l;if(""===d)return u;if("object"===typeof d||"function"===typeof d)try{var g=d.then;
if("function"===typeof g)return new a(g.bind(d))}catch(h){return new a(function(a,b){b(h)})}return new c(d)};a.from=a.cast=function(b){var c=Error("Promise.from and Promise.cast are deprecated, use Promise.resolve instead");c.name="Warning";console.warn(c.stack);return a.resolve(b)};a.denodeify=function(b,c){c=c||Infinity;return function(){var d=this,e=Array.prototype.slice.call(arguments);return new a(function(a,f){for(;e.length&&e.length>c;)e.pop();e.push(function(b,c){b?f(b):a(c)});b.apply(d,e)})}};
a.nodeify=function(b){return function(){var c=Array.prototype.slice.call(arguments),d="function"===typeof c[c.length-1]?c.pop():null;try{return b.apply(this,arguments).nodeify(d)}catch(e){if(null===d||"undefined"==typeof d)return new a(function(a,b){b(e)});g(function(){d(e)})}}};a.all=function(){var b=1===arguments.length&&Array.isArray(arguments[0]),c=Array.prototype.slice.call(b?arguments[0]:arguments);b||(b=Error("Promise.all should be called with a single array, calling it with multiple arguments is deprecated"),
b.name="Warning",console.warn(b.stack));return new a(function(a,b){function d(f,g){try{if(g&&("object"===typeof g||"function"===typeof g)){var h=g.then;if("function"===typeof h){h.call(g,function(a){d(f,a)},b);return}}c[f]=g;0===--e&&a(c)}catch(k){b(k)}}if(0===c.length)return a([]);for(var e=c.length,f=0;f<c.length;f++)d(f,c[f])})};a.reject=function(b){return new a(function(a,c){c(b)})};a.race=function(b){return new a(function(c,d){b.forEach(function(b){a.resolve(b).then(c,d)})})};a.prototype.done=
function(a,b){(arguments.length?this.then.apply(this,arguments):this).then(null,function(a){g(function(){throw a;})})};a.prototype.nodeify=function(a){if("function"!=typeof a)return this;this.then(function(b){g(function(){a(null,b)})},function(b){g(function(){a(b)})})};a.prototype["catch"]=function(a){return this.then(null,a)}},{"./core.js":28,asap:30}],30:[function(d,n,h){(function(c){function a(){for(;d.next;){d=d.next;var b=d.task;d.task=void 0;var c=d.domain;c&&(d.domain=void 0,c.enter());try{b()}catch(h){if(e)throw c&&
c.exit(),setTimeout(a,0),c&&c.enter(),h;setTimeout(function(){throw h;},0)}c&&c.exit()}f=!1}var d={task:void 0,next:null},b=d,f=!1,h=void 0,e=!1;if("undefined"!==typeof c&&c.nextTick)e=!0,h=function(){c.nextTick(a)};else if("function"===typeof setImmediate)h="undefined"!==typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!==typeof MessageChannel){var l=new MessageChannel;l.port1.onmessage=a;h=function(){l.port2.postMessage(0)}}else h=function(){setTimeout(a,
0)};n.exports=function(a){b=b.next={task:a,domain:e&&c.domain,next:null};f||(f=!0,h())}}).call(this,d("_process"))},{_process:35}],31:[function(d,n,h){(function(){function c(a){var b=this,c={db:null};if(a)for(var d in a)c[d]=a[d];return new t(function(a,d){var e=w.open(c.name,c.version);e.onerror=function(){d(e.error)};e.onupgradeneeded=function(){e.result.createObjectStore(c.storeName)};e.onsuccess=function(){c.db=e.result;b._dbInfo=c;a()}})}function a(a,b){var c=this;"string"!==typeof a&&(window.console.warn(a+
" used as a key, but it is not a string."),a=String(a));var d=new t(function(b,d){c.ready().then(function(){var e=c._dbInfo,f=e.db.transaction(e.storeName,"readonly").objectStore(e.storeName).get(a);f.onsuccess=function(){var a=f.result;void 0===a&&(a=null);b(a)};f.onerror=function(){d(f.error)}})["catch"](d)});r(d,b);return d}function g(a,b,c){var d=this;"string"!==typeof a&&(window.console.warn(a+" used as a key, but it is not a string."),a=String(a));var e=new t(function(c,e){d.ready().then(function(){var f=
d._dbInfo,f=f.db.transaction(f.storeName,"readwrite").objectStore(f.storeName);null===b&&(b=void 0);var g=f.put(b,a);g.onsuccess=function(){void 0===b&&(b=null);c(b)};g.onerror=function(){e(g.error)}})["catch"](e)});r(e,c);return e}function b(a,b){var c=this;"string"!==typeof a&&(window.console.warn(a+" used as a key, but it is not a string."),a=String(a));var d=new t(function(b,d){c.ready().then(function(){var e=c._dbInfo,f=e.db.transaction(e.storeName,"readwrite").objectStore(e.storeName)["delete"](a);
f.onsuccess=function(){b()};f.onerror=function(){d(f.error)};f.onabort=function(a){a=a.target.error;"QuotaExceededError"===a&&d(a)}})["catch"](d)});r(d,b);return d}function f(a){var b=this,c=new t(function(a,c){b.ready().then(function(){var d=b._dbInfo,e=d.db.transaction(d.storeName,"readwrite").objectStore(d.storeName).clear();e.onsuccess=function(){a()};e.onerror=function(){c(e.error)}})["catch"](c)});r(c,a);return c}function h(a){var b=this,c=new t(function(a,c){b.ready().then(function(){var d=
b._dbInfo,e=d.db.transaction(d.storeName,"readonly").objectStore(d.storeName).count();e.onsuccess=function(){a(e.result)};e.onerror=function(){c(e.error)}})["catch"](c)});u(c,a);return c}function e(a,b){var c=this,d=new t(function(b,d){0>a?b(null):c.ready().then(function(){var e=c._dbInfo,f=!1,g=e.db.transaction(e.storeName,"readonly").objectStore(e.storeName).openCursor();g.onsuccess=function(){var c=g.result;c?0===a?b(c.key):f?b(c.key):(f=!0,c.advance(a)):b(null)};g.onerror=function(){d(g.error)}})["catch"](d)});
u(d,b);return d}function l(a){var b=this,c=new t(function(a,c){b.ready().then(function(){var d=b._dbInfo,e=d.db.transaction(d.storeName,"readonly").objectStore(d.storeName).openCursor(),f=[];e.onsuccess=function(){var b=e.result;b?(f.push(b.key),b["continue"]()):a(f)};e.onerror=function(){c(e.error)}})["catch"](c)});u(c,a);return c}function u(a,b){b&&a.then(function(a){b(null,a)},function(a){b(a)})}function r(a,b){b&&a.then(function(a){v(b,a)},function(a){b(a)})}function v(a,b){if(a)return setTimeout(function(){return a(null,
b)},0)}var t="undefined"!==typeof n&&n.exports?d("promise"):this.Promise,w=w||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB;if(w){var x={_driver:"asyncStorage",_initStorage:c,getItem:a,setItem:g,removeItem:b,clear:f,length:h,key:e,keys:l};"undefined"!==typeof n&&n.exports?n.exports=x:this.asyncStorage=x}}).call(window)},{promise:29}],32:[function(d,n,h){(function(){function c(a){if(a.substring(0,u)!==l)return JSON.parse(a);var b=a.substring(y);a=a.substring(u,
y);for(var c=new ArrayBuffer(2*b.length),d=new Uint16Array(c),e=b.length-1;0<=e;e--)d[e]=b.charCodeAt(e);switch(a){case r:return c;case v:return new Blob([c]);case t:return new Int8Array(c);case w:return new Uint8Array(c);case x:return new Uint8ClampedArray(c);case s:return new Int16Array(c);case p:return new Uint16Array(c);case q:return new Int32Array(c);case m:return new Uint32Array(c);case B:return new Float32Array(c);case z:return new Float64Array(c);default:throw Error("Unkown type: "+a);}}function a(a){var b=
"";a=new Uint16Array(a);try{b=String.fromCharCode.apply(null,a)}catch(c){for(var d=0;d<a.length;d++)b+=String.fromCharCode(a[d])}return b}function g(b,c){var d="";b&&(d=b.toString());if(b&&("[object ArrayBuffer]"===b.toString()||b.buffer&&"[object ArrayBuffer]"===b.buffer.toString())){var e,f=l;b instanceof ArrayBuffer?(e=b,f+=r):(e=b.buffer,"[object Int8Array]"===d?f+=t:"[object Uint8Array]"===d?f+=w:"[object Uint8ClampedArray]"===d?f+=x:"[object Int16Array]"===d?f+=s:"[object Uint16Array]"===d?
f+=p:"[object Int32Array]"===d?f+=q:"[object Uint32Array]"===d?f+=m:"[object Float32Array]"===d?f+=B:"[object Float64Array]"===d?f+=z:c(Error("Failed to get type for BinaryArray")));c(f+a(e))}else if("[object Blob]"===d)d=new FileReader,d.onload=function(){var b=a(this.result);c(l+v+b)},d.readAsArrayBuffer(b);else try{c(JSON.stringify(b))}catch(g){window.console.error("Couldn't convert value into a JSON string: ",b),c(g)}}function b(a,b){b&&a.then(function(a){b(null,a)},function(a){b(a)})}var f="undefined"!==
typeof n&&n.exports?d("promise"):this.Promise,h=null;try{if(!(this.localStorage&&"setItem"in this.localStorage))return;h=this.localStorage}catch(e){return}var l="__lfsc__:",u=l.length,r="arbf",v="blob",t="si08",w="ui08",x="uic8",s="si16",q="si32",p="ur16",m="ui32",B="fl32",z="fl64",y=u+r.length,A={_driver:"localStorageWrapper",_initStorage:function(a){var b={};if(a)for(var c in a)b[c]=a[c];b.keyPrefix=b.name+"/";this._dbInfo=b;return f.resolve()},getItem:function(a,d){var e=this;"string"!==typeof a&&
(window.console.warn(a+" used as a key, but it is not a string."),a=String(a));var g=new f(function(b,d){e.ready().then(function(){try{var f=h.getItem(e._dbInfo.keyPrefix+a);f&&(f=c(f));b(f)}catch(g){d(g)}})["catch"](d)});b(g,d);return g},setItem:function(a,c,d){var e=this;"string"!==typeof a&&(window.console.warn(a+" used as a key, but it is not a string."),a=String(a));var l=new f(function(b,d){e.ready().then(function(){void 0===c&&(c=null);var f=c;g(c,function(c,g){if(g)d(g);else{try{h.setItem(e._dbInfo.keyPrefix+
a,c)}catch(l){"QuotaExceededError"!==l.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==l.name||d(l)}b(f)}})})["catch"](d)});b(l,d);return l},removeItem:function(a,c){var d=this;"string"!==typeof a&&(window.console.warn(a+" used as a key, but it is not a string."),a=String(a));var e=new f(function(b,c){d.ready().then(function(){h.removeItem(d._dbInfo.keyPrefix+a);b()})["catch"](c)});b(e,c);return e},clear:function(a){var c=this,d=new f(function(a,b){c.ready().then(function(){for(var b=c._dbInfo.keyPrefix,d=h.length-
1;0<=d;d--){var e=h.key(d);0===e.indexOf(b)&&h.removeItem(e)}a()})["catch"](b)});b(d,a);return d},length:function(a){var c=this,d=new f(function(a,b){c.keys().then(function(b){a(b.length)})["catch"](b)});b(d,a);return d},key:function(a,c){var d=this,e=new f(function(b,c){d.ready().then(function(){var c=d._dbInfo,e;try{e=h.key(a)}catch(f){e=null}e&&(e=e.substring(c.keyPrefix.length));b(e)})["catch"](c)});b(e,c);return e},keys:function(a){var c=this,d=new f(function(a,b){c.ready().then(function(){for(var b=
c._dbInfo,d=h.length,e=[],f=0;f<d;f++)0===h.key(f).indexOf(b.keyPrefix)&&e.push(h.key(f).substring(b.keyPrefix.length));a(e)})["catch"](b)});b(d,a);return d}};"undefined"!==typeof n&&n.exports?n.exports=A:this.localStorageWrapper=A}).call(window)},{promise:29}],33:[function(d,n,h){(function(){function c(a){var b=this,c={db:null};if(a)for(var d in a)c[d]="string"!==typeof a[d]?a[d].toString():a[d];return new x(function(d,e){try{c.db=s(c.name,String(c.version),c.description,c.size)}catch(f){return b.setDriver("localStorageWrapper").then(function(){return b._initStorage(a)}).then(d)["catch"](e)}c.db.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS "+
c.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){b._dbInfo=c;d()},function(a,b){e(b)})})})}function a(a,b){var c=this;"string"!==typeof a&&(window.console.warn(a+" used as a key, but it is not a string."),a=String(a));var d=new x(function(b,d){c.ready().then(function(){var e=c._dbInfo;e.db.transaction(function(c){c.executeSql("SELECT * FROM "+e.storeName+" WHERE key = ? LIMIT 1",[a],function(a,c){var d=c.rows.length?c.rows.item(0).value:null;d&&(d=r(d));b(d)},function(a,b){d(b)})})})["catch"](d)});
t(d,b);return d}function g(a,b,c){var d=this;"string"!==typeof a&&(window.console.warn(a+" used as a key, but it is not a string."),a=String(a));var e=new x(function(c,e){d.ready().then(function(){void 0===b&&(b=null);var f=b;v(b,function(b,g){if(g)e(g);else{var h=d._dbInfo;h.db.transaction(function(d){d.executeSql("INSERT OR REPLACE INTO "+h.storeName+" (key, value) VALUES (?, ?)",[a,b],function(){c(f)},function(a,b){e(b)})},function(a){a.code===a.QUOTA_ERR&&e(a)})}})})["catch"](e)});t(e,c);return e}
function b(a,b){var c=this;"string"!==typeof a&&(window.console.warn(a+" used as a key, but it is not a string."),a=String(a));var d=new x(function(b,d){c.ready().then(function(){var e=c._dbInfo;e.db.transaction(function(c){c.executeSql("DELETE FROM "+e.storeName+" WHERE key = ?",[a],function(){b()},function(a,b){d(b)})})})["catch"](d)});t(d,b);return d}function f(a){var b=this,c=new x(function(a,c){b.ready().then(function(){var d=b._dbInfo;d.db.transaction(function(b){b.executeSql("DELETE FROM "+
d.storeName,[],function(){a()},function(a,b){c(b)})})})["catch"](c)});t(c,a);return c}function h(a){var b=this,c=new x(function(a,c){b.ready().then(function(){var d=b._dbInfo;d.db.transaction(function(b){b.executeSql("SELECT COUNT(key) as c FROM "+d.storeName,[],function(b,c){var d=c.rows.item(0).c;a(d)},function(a,b){c(b)})})})["catch"](c)});t(c,a);return c}function e(a,b){var c=this,d=new x(function(b,d){c.ready().then(function(){var e=c._dbInfo;e.db.transaction(function(c){c.executeSql("SELECT key FROM "+
e.storeName+" WHERE id = ? LIMIT 1",[a+1],function(a,c){var d=c.rows.length?c.rows.item(0).key:null;b(d)},function(a,b){d(b)})})})["catch"](d)});t(d,b);return d}function l(a){var b=this,c=new x(function(a,c){b.ready().then(function(){var d=b._dbInfo;d.db.transaction(function(b){b.executeSql("SELECT key FROM "+d.storeName,[],function(b,c){for(var d=[],e=0;e<c.rows.length;e++)d.push(c.rows.item(e).key);a(d)},function(a,b){c(b)})})})["catch"](c)});t(c,a);return c}function u(a){a=new Uint8Array(a);var b,
c="";for(b=0;b<a.length;b+=3)c+=w[a[b]>>2],c+=w[(a[b]&3)<<4|a[b+1]>>4],c+=w[(a[b+1]&15)<<2|a[b+2]>>6],c+=w[a[b+2]&63];2===a.length%3?c=c.substring(0,c.length-1)+"=":1===a.length%3&&(c=c.substring(0,c.length-2)+"==");return c}function r(a){if(a.substring(0,p)!==q)return JSON.parse(a);var b=a.substring(I);a=a.substring(p,I);var c=0.75*b.length,d=b.length,e=0,f,g,h,k;"="===b[b.length-1]&&(c--,"="===b[b.length-2]&&c--);for(var l=new ArrayBuffer(c),n=new Uint8Array(l),c=0;c<d;c+=4)f=w.indexOf(b[c]),g=
w.indexOf(b[c+1]),h=w.indexOf(b[c+2]),k=w.indexOf(b[c+3]),n[e++]=f<<2|g>>4,n[e++]=(g&15)<<4|h>>2,n[e++]=(h&3)<<6|k&63;switch(a){case m:return l;case B:return new Blob([l]);case z:return new Int8Array(l);case y:return new Uint8Array(l);case A:return new Uint8ClampedArray(l);case D:return new Int16Array(l);case F:return new Uint16Array(l);case E:return new Int32Array(l);case G:return new Uint32Array(l);case H:return new Float32Array(l);case J:return new Float64Array(l);default:throw Error("Unkown type: "+
a);}}function v(a,b){var c="";a&&(c=a.toString());if(a&&("[object ArrayBuffer]"===a.toString()||a.buffer&&"[object ArrayBuffer]"===a.buffer.toString())){var d,e=q;a instanceof ArrayBuffer?(d=a,e+=m):(d=a.buffer,"[object Int8Array]"===c?e+=z:"[object Uint8Array]"===c?e+=y:"[object Uint8ClampedArray]"===c?e+=A:"[object Int16Array]"===c?e+=D:"[object Uint16Array]"===c?e+=F:"[object Int32Array]"===c?e+=E:"[object Uint32Array]"===c?e+=G:"[object Float32Array]"===c?e+=H:"[object Float64Array]"===c?e+=J:
b(Error("Failed to get type for BinaryArray")));b(e+u(d))}else if("[object Blob]"===c)c=new FileReader,c.onload=function(){var a=u(this.result);b(q+B+a)},c.readAsArrayBuffer(a);else try{b(JSON.stringify(a))}catch(f){window.console.error("Couldn't convert value into a JSON string: ",a),b(null,f)}}function t(a,b){b&&a.then(function(a){b(null,a)},function(a){b(a)})}var w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",x="undefined"!==typeof n&&n.exports?d("promise"):this.Promise,s=
this.openDatabase,q="__lfsc__:",p=q.length,m="arbf",B="blob",z="si08",y="ui08",A="uic8",D="si16",E="si32",F="ur16",G="ui32",H="fl32",J="fl64",I=p+m.length;if(s){var K={_driver:"webSQLStorage",_initStorage:c,getItem:a,setItem:g,removeItem:b,clear:f,length:h,key:e,keys:l};"undefined"!==typeof n&&n.exports?n.exports=K:this.webSQLStorage=K}}).call(window)},{promise:29}],34:[function(d,n,h){(function(){function c(a,b){a[b]=function(){var c=arguments;return a.ready().then(function(){return a[b].apply(a,
c)})}}function a(){for(var a=1;a<arguments.length;a++){var b=arguments[a];if(b)for(var c in b)b.hasOwnProperty(c)&&(t(b[c])?arguments[0][c]=b[c].slice():arguments[0][c]=b[c])}return arguments[0]}function g(a){for(var b in e)if(e.hasOwnProperty(b)&&e[b]===a)return!0;return!1}function b(b){this._config=a({},u,b);this._driverSet=null;this._ready=!1;this._dbInfo=null;for(b=0;b<l.length;b++)c(this,l[b]);this.setDriver(this._config.driver)}var f="undefined"!==typeof n&&n.exports?d("promise"):this.Promise,
h={},e={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"},l="clear getItem key keys length removeItem setItem".split(" "),u={description:"",driver:[e.INDEXEDDB,e.WEBSQL,e.LOCALSTORAGE].slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},r=3;"undefined"!==typeof n&&n.exports&&(r=2);var v=function(a){var b=b||a.indexedDB||a.webkitIndexedDB||a.mozIndexedDB||a.OIndexedDB||a.msIndexedDB,c={};c[e.WEBSQL]=!!a.openDatabase;c[e.INDEXEDDB]=!!function(){if("undefined"!==
typeof a.openDatabase&&a.navigator&&a.navigator.userAgent&&/Safari/.test(a.navigator.userAgent)&&!/Chrome/.test(a.navigator.userAgent))return!1;try{return b&&"function"===typeof b.open&&"undefined"!==typeof a.IDBKeyRange}catch(c){return!1}}();var d=e.LOCALSTORAGE,f;try{f=a.localStorage&&"setItem"in a.localStorage&&a.localStorage.setItem}catch(g){f=!1}c[d]=!!f;return c}(this),t=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},w=this;b.prototype.INDEXEDDB=e.INDEXEDDB;
b.prototype.LOCALSTORAGE=e.LOCALSTORAGE;b.prototype.WEBSQL=e.WEBSQL;b.prototype.config=function(a){if("object"===typeof a){if(this._ready)return Error("Can't call config() after localforage has been used.");for(var b in a)"storeName"===b&&(a[b]=a[b].replace(/\W/g,"_")),this._config[b]=a[b];"driver"in a&&a.driver&&this.setDriver(this._config.driver);return!0}return"string"===typeof a?this._config[a]:this._config};b.prototype.defineDriver=function(a,b,c){var d=new f(function(b,c){try{var d=a._driver,
e=Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"),m=Error("Custom driver name already in use: "+a._driver);if(a._driver)if(g(a._driver))c(m);else{for(var n=l.concat("_initStorage"),m=0;m<n.length;m++){var p=n[m];if(!p||!a[p]||"function"!==typeof a[p]){c(e);return}}var q=f.resolve(!0);"_support"in a&&(q=a._support&&"function"===typeof a._support?a._support():f.resolve(!!a._support));q.then(function(c){v[d]=c;h[d]=a;b()},c)}else c(e)}catch(r){c(r)}});d.then(b,
c);return d};b.prototype.driver=function(){return this._driver||null};b.prototype.ready=function(a){var b=this,c=new f(function(a,c){b._driverSet.then(function(){null===b._ready&&(b._ready=b._initStorage(b._config));b._ready.then(a,c)})["catch"](c)});c.then(a,a);return c};b.prototype.setDriver=function(a,b,c){function e(){l._config.driver=l.driver()}var l=this;"string"===typeof a&&(a=[a]);this._driverSet=new f(function(b,c){var e=l._getFirstSupportedDriver(a),m=Error("No available storage method found.");
if(e){l._dbInfo=null;l._ready=null;if(g(e)){if(1===r){d([e],function(a){l._extend(a);b()});return}if(2===r){var n;switch(e){case l.INDEXEDDB:n=d("./drivers/indexeddb");break;case l.LOCALSTORAGE:n=d("./drivers/localstorage");break;case l.WEBSQL:n=d("./drivers/websql")}l._extend(n)}else l._extend(w[e])}else if(h[e])l._extend(h[e]);else{l._driverSet=f.reject(m);c(m);return}b()}else l._driverSet=f.reject(m),c(m)});this._driverSet.then(e,e);this._driverSet.then(b,c);return this._driverSet};b.prototype.supports=
function(a){return!!v[a]};b.prototype._extend=function(b){a(this,b)};b.prototype._getFirstSupportedDriver=function(a){if(a&&t(a))for(var b=0;b<a.length;b++){var c=a[b];if(this.supports(c))return c}return null};b.prototype.createInstance=function(a){return new b(a)};var x=new b;1===r?(void 0)("localforage",function(){return x}):2===r?n.exports=x:this.localforage=x}).call(window)},{"./drivers/indexeddb":31,"./drivers/localstorage":32,"./drivers/websql":33,promise:29}],35:[function(d,n,h){function c(){}
d=n.exports={};d.nextTick=function(){if("undefined"!==typeof window&&window.setImmediate)return function(a){return window.setImmediate(a)};if("undefined"!==typeof window&&window.postMessage&&window.addEventListener){var a=[];window.addEventListener("message",function(c){var b=c.source;b!==window&&null!==b||"process-tick"!==c.data||(c.stopPropagation(),0<a.length&&a.shift()())},!0);return function(c){a.push(c);window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}();d.title="browser";
d.browser=!0;d.env={};d.argv=[];d.on=c;d.addListener=c;d.once=c;d.off=c;d.removeListener=c;d.removeAllListeners=c;d.emit=c;d.binding=function(a){throw Error("process.binding is not supported");};d.cwd=function(){return"/"};d.chdir=function(a){throw Error("process.chdir is not supported");}},{}]},{},[1])(1)});
